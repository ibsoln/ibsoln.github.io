<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Forwarding Couchbase Logs with Fluent Bit | Couchbase Docs</title>
<link rel="canonical" href="http://127.0.0.1:5000/operator/current/tutorial-couchbase-log-forwarding.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="operator">
<meta name="dcterms.identifier" content="2.2">
<meta name="page-url" content="/operator/current/tutorial-couchbase-log-forwarding.html">
<meta name="generator" content="Antora 3.0.0-alpha.5">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="http://127.0.0.1:5000/home/index.html">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="http://127.0.0.1:5000/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile Local
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../tutorials/index.html">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
<div class="components">
  <div class="components_group-title">
    Cloud-Native
  </div>
  <ul class="components_list">
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Autonomous Operator</span>
        <select class="version_list" data-component="operator">
          <option value="2.2" data-url="overview.html" selected>2.2</option>
        </select>
      </div>
      <div class="version_items hide" data-version="2.2">
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Introduction</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="overview.html">Introduction</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="whats-new.html">What&#8217;s New?</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="best-practices.html">Guidelines and Best Practices</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="prerequisite-and-setup.html">Prerequisites and System Requirements</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="prerequisite-cloud.html">Public Cloud Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="install-kubernetes.html">Install the Operator on Kubernetes</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="install-openshift.html">Install the Operator on OpenShift</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Learn</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Kubernetes Concepts</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-kubernetes-networking.html">Kubernetes Networking</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-persistent-volumes.html">Persistent Volumes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-kubernetes-upgrade.html">Kubernetes Automated Upgrade</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Operator Concepts</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-operator.html">Operator Architecture</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-operator-logging.html">Operator Logging</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Couchbase Cluster Concepts</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-label-selection.html">Couchbase Resource Label Selection</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-rbac.html">Couchbase Resource RBAC</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-user-rbac.html">Couchbase User RBAC</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-memory-allocation.html">Couchbase Memory Allocation</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-mds.html">Couchbase Multi-Dimensional Scaling</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-scheduling.html">Couchbase Scheduling and Isolation</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-sizing.html">Couchbase Sizing</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-vertical-scaling.html">Couchbase Cluster Vertical Scaling</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="concept-couchbase-autoscaling.html">Couchbase Cluster Auto-scaling</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-couchbase-autoscaling-best-practices.html">Auto-scaling Best Practices</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-couchbase-networking.html">Couchbase Networking</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-tls.html">Couchbase TLS</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-credential-rotation.html">Couchbase Credential Rotation</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-server-groups.html">Couchbase Server Groups</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-upgrade.html">Couchbase Upgrades</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-hibernation.html">Couchbase Cluster Hibernation</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-couchbase-logging.html">Couchbase Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="concept-backup.html">Couchbase Backup and Restore</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Manage</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Operator</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-operator-upgrade.html">Upgrade the Operator</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-manage-operator-logging.html">Manage Operator Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-roll-your-own.html">Create Your Own Operator Images</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Couchbase Cluster</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Lifecycle</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-couchbase-create.html">Create a Couchbase Deployment</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-couchbase-update.html">Modify a Couchbase Deployment</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-couchbase-upgrade.html">Upgrade a Couchbase Deployment</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-couchbase-delete.html">Delete a Couchbase Deployment</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-couchbase-scale.html">Scale a Couchbase Deployment</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Configure</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-persistent-volumes.html">Configure Persistent Volumes</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-backup.html">Configure Backup &amp; Restore</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-mds.html">Configure Multi-Dimensional Scaling</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-couchbase-autoscaling.html">Configure Couchbase Cluster Auto-scaling</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-xdcr.html">Configure XDCR</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-public-networking.html">Configure Public Networking</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-nodeport-networking.html">Configure Node Port Networking</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-server-groups.html">Configure Server Groups</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-admin-password-rotation.html">Rotate the Administrator Password</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-tls.html">Configure TLS</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-tls-client-certificates.html">Configure Client Certificate Authentication</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-tls-rotation.html">Rotate TLS Certificates</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-prometheus.html">Configure Prometheus Metrics Collection</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-manage-couchbase-logging.html">Manage Couchbase Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-couchbase-log-forwarding.html">Configure Log Forwarding</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-non-root-install.html">Configure Non-Root Installs</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Connect</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-ui.html">Access the Couchbase User Interface</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-client-sdks.html">Configure Client SDKs</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Kubernetes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="howto-storage-class.html">Create a Lazy Bound Storage Class</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Helm</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="helm-setup-guide.html">Helm Deployment</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="helm-managing-guide.html">Helm Management</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Reference</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Resource Types</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="reference-resources.html">Resource Documentation</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resource/couchbaseautoscaler.html">CouchbaseAutoscaler Resource</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resource/couchbasebackuprestore.html">CouchbaseBackupRestore Resource</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resource/couchbasebackup.html">CouchbaseBackup Resource</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resource/couchbasebucket.html">CouchbaseBucket Resource</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resource/couchbasecluster.html">CouchbaseCluster Resource</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resource/couchbaseephemeralbucket.html">CouchbaseEphemeralBucket Resource</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resource/couchbasegroup.html">CouchbaseGroup Resource</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resource/couchbasememcachedbucket.html">CouchbaseMemcachedBucket Resource</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resource/couchbasereplication.html">CouchbaseReplication Resource</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resource/couchbaserolebinding.html">CouchbaseRoleBinding Resource</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resource/couchbaseuser.html">CouchbaseUser Resource</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Operator</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="reference-admission-cli.html">Dynamic Admission Controller Deployment Settings</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="reference-admission-rbac.html">Dynamic Admission Controller RBAC Settings</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="reference-operator-configuration.html">Operator Deployment Settings</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="reference-operator-rbac.html">Operator RBAC Settings</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="reference-operator-logging.html">Operator Logging</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Couchbase Cluster</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="reference-reference-architecture.html"><code>CouchbaseCluster</code> Reference Architecture</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="reference-couchbasecluster-events.html"><code>CouchbaseCluster</code> Events</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="reference-couchbasecluster-services.html"><code>CouchbaseCluster</code> Services</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Helm</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="helm-couchbase-config.html">Couchbase Helm Chart Specification</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Tools</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tools/cbopcfg.html">cbopcfg</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tools/cbopinfo.html">cbopinfo</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Tutorials</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Authentication and Authorization</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-rbac-auth.html">Authenticating with Couchbase and LDAP</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Autoscaling</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-autoscale-data.html">Autoscaling Couchbase Data Service</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-autoscale-index.html">Autoscaling Couchbase Index Service</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-autoscale-query.html">Autoscaling Couchbase Query Service</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Backup</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-velero-backup.html">Backup with VMware Velero</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Cloud Platforms</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-aks.html">Installing AKS</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-eks.html">Installing EKS</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-gke.html">Installing GKE</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Logging</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-current-page" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link is-current-page" href="tutorial-couchbase-log-forwarding.html">Forwarding Couchbase Logs with Fluent Bit</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Metering</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-metering-kubernetes.html">Metering Couchbase Resources In Kubernetes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-metering.html">Metering Couchbase Resources In OpenShift</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Monitoring</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-prometheus.html">Quick Start with Prometheus Monitoring</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Networking</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-remote-dns.html">Inter-Kubernetes Networking with Forwarded DNS</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-public-addressability.html">Public Networking with External DNS</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Persistent Volumes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-volume-expansion.html">Persistent Volume Expansion</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Sync Gateway</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-sync-gateway.html">Connecting Sync-Gateway to a Couchbase Cluster</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-sync-gateway-clients.html">Exposing Sync-Gateway to Couchbase Lite Clients</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-sync-gateway-manage.html">Managing Sync Gateway Cluster </a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">TLS</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-tls.html">Creating TLS Certificates</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="tutorial-cert-manager.html">Using a Certificate Manager</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Release Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="release-notes.html">Release Notes</a>
  </span>
</li>
</ul>
</li>
</ul>
      </div>
    </li>
  </ul>
</div>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
        <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="overview.html">Autonomous Operator</a></li>
<li class="crumb">Tutorials</li>
<li class="crumb">Logging</li>
<li class="crumb"><a href="tutorial-couchbase-log-forwarding.html">Forwarding Couchbase Logs with Fluent Bit</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Forwarding Couchbase Logs with Fluent Bit</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Learn how to configure the Autonomous Operator to forward Couchbase logs using Fluent Bit.
</blockquote>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Tutorials are accurate at the time of writing but rely heavily on third party software.
Tutorials are provided to demonstrate how a particular problem may be solved.
Use of third party software is not supported by Couchbase.
For further help in the event of a problem, contact the relevant software maintainer.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Having a containerized application&#8217;s logs available on standard console output is desirable in Kubernetes environments, since it allows for <a href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-running-pod/#examine-pod-logs" target="_blank" rel="noopener">simple debugging</a>, as well as standards-based integration with centralized log management systems running in a Kubernetes cluster.
Unfortunately, the Couchbase Server container doesn&#8217;t natively write its logs to standard console output.
Instead, the <a href="concept-couchbase-logging.html#default-logging" class="page">default behavior</a> of the Couchbase Server container (in deployments managed by the Autonomous Operator) is to write its <a href="../../server/current/manage/manage-logging/manage-logging.html#log-file-listing" class="page">various log files</a> to the <code>default</code> or <code>logs</code> persistent volumes.</p>
</div>
<div class="paragraph">
<p>However, as of version 2.2, the Autonomous Operator can optionally deploy and manage a third party log processor on each Couchbase pod which enables Couchbase Server logs to be <a href="concept-couchbase-logging.html#log-forwarding" class="page">forwarded</a> to the log processor&#8217;s standard console output as well as other destinations.
This guide will walk you through an example of how to configure log forwarding for a Couchbase deployment using the Couchbase-supplied log processor image based on <a href="https://fluentbit.io/" target="_blank" rel="noopener">Fluent Bit</a>.</p>
</div>
<div class="paragraph">
<p>Examples are provided for forwarding logs to Loki and Elasticsearch, as well as how to target Azure blob storage and Amazon S3 storage for Couchbase Server <a href="howto-manage-couchbase-logging.html#configuring-audit-logging" class="page">audit logs</a>.
An example for configuring log redaction is also shown to demonstrate how the log forwarding solution can redact logs in-flight.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="before-you-begin"><a class="anchor" href="#before-you-begin"></a>Before You Begin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial assumes that you have already <a href="install-kubernetes.html" class="page">installed</a> the Autonomous Operator.
The Autonomous Operator needs to be running in the same namespace where you deploy the Couchbase cluster in the <a href="#configure-the-couchbase-cluster">Configure the Couchbase Cluster</a> section below.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-the-couchbase-cluster"><a class="anchor" href="#configure-the-couchbase-cluster"></a>Configure the Couchbase Cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Log forwarding is enabled via the <a href="resource/couchbasecluster.html" class="page"><code>CouchbaseCluster</code></a> resource specification.
The following example contains a basic Couchbase cluster deployment configuration that already has log forwarding configured.
Important non-default settings are called out and described.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is not a requirement that log forwarding be configured when the cluster is first deployed.
You can always <a href="howto-couchbase-log-forwarding.html" class="page">enable and configure</a> log forwarding post-deployment.
</td>
</tr>
</table>
</div>
<div id="cluster-config-log-forwarding" class="listingblock">
<div class="title">Example: Couchbase Cluster Deployment Configuration with Log Forwarding Enabled</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: cb-example-auth
type: Opaque
data:
  username: QWRtaW5pc3RyYXRvcg== # Administrator
  password: cGFzc3dvcmQ=         # password
---
apiVersion: couchbase.com/v2
kind: CouchbaseBucket
metadata:
  name: default
---
apiVersion: couchbase.com/v2
kind: CouchbaseCluster
metadata:
  name: cb-example
spec:
  logging:
    server:
      enabled: true <i class="conum" data-value="1"></i><b>(1)</b>
      manageConfiguration: true
      configurationName: "fluent-bit-config"
      sidecar:
        image: "couchbase/fluent-bit:1.0.4"
    audit:
      enabled: true <i class="conum" data-value="2"></i><b>(2)</b>
      garbageCollection:
        sidecar:
          enabled: true <i class="conum" data-value="3"></i><b>(3)</b>
  image: couchbase/server:6.6.2
  security:
    adminSecret: cb-example-auth
  buckets:
    managed: true
  servers:
  - size: 3
    name: all_services
    services:
    - data
    - index
    - query
    - search
    - eventing
    - analytics
    volumeMounts:
      default: couchbase
  volumeClaimTemplates: <i class="conum" data-value="4"></i><b>(4)</b>
  - metadata:
      name: couchbase
    spec:
      resources:
        requests:
          storage: 1Gi</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="resource/couchbasecluster.html#couchbaseclusters-spec-logging-server-enabled" class="page"><code>couchbaseclusters.spec.logging.server.enabled</code></a>: Setting this field to <code>true</code> enables the logging sidecar container.
This field normally defaults to <code>false</code>.
<div class="paragraph">
<p>This is technically the only field that needs to be modified in order to enable log forwarding.
The Autonomous Operator will default to pulling the Couchbase-supplied <a href="https://hub.docker.com/r/couchbase/fluent-bit" target="_blank" rel="noopener">log processor image</a> from the Docker public registry.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="resource/couchbasecluster.html#couchbaseclusters-spec-logging-audit-enabled" class="page"><code>couchbaseclusters.spec.logging.audit.enabled</code></a>: Setting this field to <code>true</code> enables <a href="howto-manage-couchbase-logging.html#configuring-audit-logging" class="page">audit logging</a> on the Couchbase cluster.
This field normally defaults to <code>false</code>.
<div class="paragraph">
<p>Unlike other Couchbase logging, audit logging is not turned on by default.
Since some of the examples in this tutorial utilize audit logs, we want to make sure it is turned on.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="resource/couchbasecluster.html#couchbaseclusters-spec-logging-audit-garbagecollection-sidecar-enabled" class="page"><code>couchbaseclusters.spec.logging.audit.garbageCollection.sidecar.enabled</code></a>: Setting this field to <code>true</code> enables garbage collection of rotated audit logs, and instructs the Autonomous Operator to deploy a sidecar helper container in each Couchbase pod for cleaning up rotated logs.
This field normally defaults to <code>false</code>.
<div class="paragraph">
<p>Couchbase Server rotates audit logs, but cannot, itself, expire or delete them.
Therefore, for the purposes of this tutorial, we want to enable garbage collection to clean up rotated audit logs so that they don&#8217;t accidentally consume all available storage.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><a href="resource/couchbasecluster.html#couchbaseclusters-spec-volumeclaimtemplates" class="page"><code>couchbaseclusters.spec.volumeClaimTemplates</code></a>: This setting is not specifically for log forwarding, it is purely that log forwarding requires a persistent volume to access the logs so this shows an example of how to set one up.
Refer to the storage documentation for your platform as well as the <a href="concept-persistent-volumes.html" class="page">Couchbase documentation</a> for full details.
You may want to tweak the resources allocated for example or the storage class.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Copy the example cluster deployment configuration from above and save it to a file.
(In this case we&#8217;ve named the file <code>couchbase-cluster-log-forwarding.yaml</code>.)
Run the following command to deploy it into Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl apply -f couchbase-cluster-log-forwarding.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the Autonomous Operator must already be deployed and running in the current namespace in order for the above command to succeed (refer to the <a href="#before-you-begin">prerequisites</a>).</p>
</div>
<div class="paragraph">
<p>Next, verify that the cluster has been deployed successfully.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl get pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                                  READY     STATUS    RESTARTS   AGE
cb-example-0000                       1/1       Running   0          1m
cb-example-0001                       1/1       Running   0          1m
cb-example-0002                       1/1       Running   0          1m
couchbase-operator-1917615544-pd4q6   1/1       Running   0          8m</pre>
</div>
</div>
<div class="paragraph">
<p>You should observe the three Couchbase pods that were created according to the cluster configuration, and they should each have a status of <code>RUNNING</code>.</p>
</div>
<div class="paragraph">
<p>With the Couchbase cluster successfully deployed, you should now be able to observe Couchbase log events on the standard output of the <code>logging</code> container of each pod.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl logs cb-example-0000 logging</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example log event on standard console output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[1615311121.859344000, {"filename":"/fluent-bit/test/logs/memcached.log.000000.txt","timestamp":"2021-03-09T17:32:01.859344+00:00","level":"INFO","message":"Couchbase version 6.6.0-7909 starting."}]</pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll notice that processed log events are structured messages with keys and values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"timestamp":"2021-03-09T17:32:01.859344+00:00"</code></p>
</li>
<li>
<p><code>"level":"INFO"</code></p>
</li>
<li>
<p><code>"message":"Couchbase version 6.6.0-7909 starting."</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now that we&#8217;ve successfully implemented the default configuration for processing and forwarding Couchbase logs to standard console output, we can move on to the <a href="#customize-the-log-forwarding-configuration">next section</a> where we&#8217;ll explore how to customize the configuration to do things like apply different types of parsing and redaction to specific logs, as well as forward those logs to multiple different locations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customize-the-log-forwarding-configuration"><a class="anchor" href="#customize-the-log-forwarding-configuration"></a>Customize the Log Forwarding Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>log forwarding configuration</em> determines how the <code>logging</code> sidecar container processes and forwards Couchbase logs.
Since this configuration can contain sensitive information, it is stored in a Kubernetes Secret.</p>
</div>
<div class="paragraph">
<p>When we created the Couchbase cluster in the <a href="#configure-the-couchbase-cluster">previous section</a>, the Autonomous Operator automatically created a <em>default</em> log forwarding configuration Secret with the name <code>fluent-bit-config</code>.
We&#8217;ll be modifying this Secret in order to implement our own custom configuration.</p>
</div>
<div class="sect2">
<h3 id="allow-custom-configurations"><a class="anchor" href="#allow-custom-configurations"></a>Allow Custom Configurations</h3>
<div class="paragraph">
<p>Before we can modify the <code>fluent-bit-config</code> secret, we&#8217;ll first need to modify the <a href="resource/couchbasecluster.html" class="page"><code>CouchbaseCluster</code></a> resource to allow custom log forwarding configurations.</p>
</div>
<div class="listingblock">
<div class="title">Updated <a href="resource/couchbasecluster.html" class="page"><code>CouchbaseCluster</code></a> Parameters That Enable Custom Log Forwarding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.com/v2
kind: CouchbaseCluster
metadata:
  name: cb-example
spec:
  logging:
    server:
      manageConfiguration: false <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="resource/couchbasecluster.html#couchbaseclusters-spec-logging-server-manageconfiguration" class="page"><code>couchbaseclusters.spec.logging.server.manageConfiguration</code></a>: When this field is set to <code>true</code>, the Autonomous Operator will always enforce the default log forwarding configuration by overwriting the Secret if it detects a non-default configuration.
<em>Therefore, we need to set this field to <code>false</code>.</em>
Setting this field to <code>false</code> is vital to ensure that the Autonomous Operator doesn&#8217;t remove the custom configurations we&#8217;re going to make in the rest of this tutorial.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Modify your <a href="resource/couchbasecluster.html" class="page"><code>CouchbaseCluster</code></a> configuration file so that <a href="resource/couchbasecluster.html#couchbaseclusters-spec-logging-server-manageconfiguration" class="page"><code>couchbaseclusters.spec.logging.server.manageConfiguration</code></a> is set to <code>false</code> (do not just use the snippet above), then run the following command to deploy it into Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl apply -f couchbase-cluster-log-forwarding.yaml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since we used <code>kubectl apply</code> to only change the <a href="resource/couchbasecluster.html#couchbaseclusters-spec-logging-server-manageconfiguration" class="page"><code>couchbaseclusters.spec.logging.server.manageConfiguration</code></a> field, Couchbase pods will continue to consume the same log forwarding configuration Secret (<code>fluent-bit-config</code>) and the Autonomous Operator will not need to re-create the Couchbase cluster.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now that we&#8217;ve successfully allowed our Couchbase cluster to use custom log forwarding configurations, let&#8217;s get to customizing!</p>
</div>
</div>
<div class="sect2">
<h3 id="create-a-custom-configuration"><a class="anchor" href="#create-a-custom-configuration"></a>Create a Custom Configuration</h3>
<div class="paragraph">
<p>Since the Couchbase-supplied default <a href="https://hub.docker.com/r/couchbase/fluent-bit" target="_blank" rel="noopener">log processor image</a> is based on Fluent Bit, you can technically customize the log forwarding configuration with any kind of configuration that is <a href="https://docs.fluentbit.io/manual/administration/configuring-fluent-bit" target="_blank" rel="noopener">supported by Fluent Bit</a>.
In addition, the default image also contains built-in parsers, redaction scripts, and other configuration files&#8201;&#8212;&#8201;all of which can be selectively utilized in your custom configuration.</p>
</div>
<div class="paragraph">
<p>The following is an example of a custom log forwarding configuration Secret that limits the number of Couchbase logs that are processed and forwarded to just the Couchbase <a href="howto-manage-couchbase-logging.html#configuring-audit-logging" class="page">audit log</a>:</p>
</div>
<div id="custom-log-forwarding-config-secret" class="listingblock">
<div class="title">Example: Custom Log Forwarding Configuration Secret</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: fluent-bit-config
stringData:
  fluent-bit.conf: |<i class="conum" data-value="1"></i><b>(1)</b>
    [SERVICE]
        flush        1
        daemon       Off
        log_level    Warning
        parsers_file /fluent-bit/etc/parsers-couchbase.conf<i class="conum" data-value="2"></i><b>(2)</b>
    # Include audit log only
    @include /fluent-bit/etc/couchbase/in-audit-log.conf<i class="conum" data-value="3"></i><b>(3)</b>
    # Send to the standard output
    [OUTPUT]
        name  stdout
        match couchbase.log.*<i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>stringData.fluent-bit.conf</code>: Log forwarding configuration files are defined in the <code>stringData</code> field of the Secret.
The <code>fluent-bit.conf</code> file is specified with a field that starts with a space and a vertical bar (<code>|</code>), followed by the contents of the <a href="https://docs.fluentbit.io/manual/administration/configuring-fluent-bit/configuration-file" target="_blank" rel="noopener"><em>main configuration</em></a>.
Note that Fluent Bit is very particular about its <a href="https://docs.fluentbit.io/manual/administration/configuring-fluent-bit/format-schema" target="_blank" rel="noopener">format and schema</a>&#8201;&#8212;&#8201;files must all follow the same indentation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>/fluent-bit/etc/parsers-couchbase.conf</code>: This is the path to the built-in file that contains all of the default <a href="https://docs.fluentbit.io/manual/pipeline/filters/parser" target="_blank" rel="noopener"><em>parser configurations</em></a> in the Couchbase-supplied log processor image (you can view this file on <a href="https://github.com/couchbase/couchbase-fluent-bit/blob/main/conf/parsers-couchbase.conf" target="_blank" rel="noopener">GitHub</a>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@include /fluent-bit/etc/couchbase/in-audit-log.conf</code>: This is the path to the built-in file that contains the <a href="https://docs.fluentbit.io/manual/administration/configuring-fluent-bit/configuration-file#config_input" target="_blank" rel="noopener"><em>input configuration</em></a> that processes just the Couchbase audit log (you can view this file on <a href="https://github.com/couchbase/couchbase-fluent-bit/blob/main/conf/couchbase/in-audit-log.conf" target="_blank" rel="noopener">GitHub</a>).
<div class="paragraph">
<p>Since we want to limit the Couchbase logs being processed to just the audit log, we want to make sure that we only <a href="https://docs.fluentbit.io/manual/administration/configuring-fluent-bit/configuration-file#config_include_file-1" target="_blank" rel="noopener"><em>include</em></a> the input configuration file for the audit log.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>couchbase.log.*</code>: By default, all parsed Couchbase log events are <a href="https://docs.fluentbit.io/manual/concepts/key-concepts#tag" target="_blank" rel="noopener"><em>tagged</em></a> with <code>couchbase.log.<em>&lt;name-of-log</em>&gt;</code>.
The default <a href="https://docs.fluentbit.io/manual/administration/configuring-fluent-bit/configuration-file#config_output" target="_blank" rel="noopener"><em>output configuration</em></a> then uses the wildcard <a href="https://docs.fluentbit.io/manual/concepts/key-concepts#match" target="_blank" rel="noopener"><em>match</em></a> <code>couchbase.log.*</code> to forward all tagged Couchbase logs to the output.
However, because we defined a single input configuration that only processes the audit log, we are free to leave the default wildcard match.
This is because the only log events that will be available for output will be those from the audit log.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This log forwarding configuration assumes that you&#8217;ve already enabled Couchbase audit logging in the <a href="resource/couchbasecluster.html" class="page"><code>CouchbaseCluster</code></a> resource.
If you deployed the <a href="#cluster-config-log-forwarding">example cluster configuration</a> from earlier in this tutorial, then audit logging is already enabled and no action is necessary.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Copy the above secret configuration and save it to a file.
Make sure to check for any formatting issues when copying from HTML to text format for YAML.
(In this case we&#8217;ve named the file <code>fluent-bit-config.yaml</code>.)
Run the following command to deploy it into Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl replace -f fluent-bit-config.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the Secret is updated in Kubernetes, the configuration changes will be populated into the volume that is mounted in the <code>logging</code> sidecar container on each Couchbase pod.
The <code>logging</code> container&#8217;s watcher process will detect the new configuration, and restart Fluent internally to consume the new configuration.
Once Fluent Bit restarts, only audit log events will be processed and forwarded to standard console output.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The ability to restart Fluent Bit internally is a special characteristic of the Couchbase-supplied <a href="https://hub.docker.com/r/couchbase/fluent-bit" target="_blank" rel="noopener">log processor image</a>.
If you&#8217;re using a custom sidecar container image, be aware that Fluent Bit, on its own, does not currently support <a href="https://github.com/fluent/fluent-bit/issues/365" target="_blank" rel="noopener">dynamic reload</a> of its configuration.</p>
</div>
<div class="paragraph">
<p>Also note that the Couchbase-supplied log forwarding implementation does not currently support log buffering during restart.
Therefore, log events that occur while Fluent Bit is restarting may be lost.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to check the configuration then a simple base64 decode command can be run using the Kubernetes <code>Secret</code> name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl get secret "fluent-bit-config" -o go-template='{{range $k,$v := .data}}{{printf "%s: " $k}}{{if not $v}}{{$v}}{{else}}{{$v | base64decode}}{{end}}{{"\n"}}{{end}}'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="next-steps"><a class="anchor" href="#next-steps"></a>Next Steps</h3>
<div class="paragraph">
<p>Now that you&#8217;ve successfully implemented some basic log forwarding customizations, we recommend that you try out some of the other examples in this tutorial.
These examples should help you get an even better idea of the capabilities of both Fluent Bit and the Autonomous Operator when it comes to processing and forwarding Couchbase logs.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example-loki-stack"><a class="anchor" href="#example-loki-stack"></a>Example: Loki Stack</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This example assumes you&#8217;ve deployed the CouchbaseCluster resource described at the <a href="#cluster-config-log-forwarding">beginning of the tutorial</a>. It also assumes that you are familiar with how to <a href="#customize-the-log-forwarding-configuration">customize a log forwarding configuration</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A simple approach to deploy a full logging and monitoring solution is to use a <a href="https://grafana.com/docs/loki/latest/overview/" target="_blank" rel="noopener">Loki Stack</a>.
A stack that includes a Fluent Bit <code>daemonset</code> (node logs), Loki, Grafana, and Prometheus, provides a nice and simple integrated solution for monitoring and logging.
You can deploy this stack using a Helm chart.</p>
</div>
<div class="paragraph">
<p>Once you have Helm installed, add the chart repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">helm repo add grafana https://grafana.github.io/helm-charts</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command installs the chart in the default namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">helm upgrade --install loki grafana/loki-stack \
--set fluent-bit.enabled=false,promtail.enabled=true,grafana.enabled=true,prometheus.enabled=true,prometheus.alertmanager.persistentVolume.enabled=false,prometheus.server.persistentVolume.enabled=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command was borrowed and modified from the <a href="https://grafana.com/docs/loki/latest/installation/helm/#deploy-loki-stack-loki-fluent-bit-grafana-prometheus" target="_blank" rel="noopener">official Loki documentation</a>, where you can find further details on how to then use Grafana and configure the stack how you might want in your cluster.
The main difference between the above command and the one found in the official documentation, is that we&#8217;ve set <code>promtail.enabled=true</code>.
This is because we want to use PromTail over Fluent Bit for shipping logs from the Kubernetes nodes in order to mitigate an issue with the Couchbase-supplied <a href="https://hub.docker.com/r/couchbase/fluent-bit" target="_blank" rel="noopener">log processor image</a> triggering a fingerprint collision in Loki (<a href="https://github.com/fluent/fluent-bit/issues/1746" target="_blank" rel="noopener">fluent-bit #1746</a>, <a href="https://github.com/grafana/loki/issues/898#issuecomment-552333246" target="_blank" rel="noopener">loki #898</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It may be better/easier to ship direct from the Fluent Bit sidecar to Loki using the <a href="https://docs.fluentbit.io/manual/pipeline/outputs/loki" target="_blank" rel="noopener">plugin</a>.
This would allow you to forward individual logs separately without having to configure PromTail or Fluent Bit for multi-line parsing on the node.
The Helm deployment is the typical <code>daemonset</code> deployment of all logs on the node.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the chart is is deployed, you can retrieve the Grafana admin secret and do any port forwarding or similar required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">kubectl get secret loki-grafana -o jsonpath="{.data.admin-password}" | base64 --decode ; echo
kubectl port-forward service/loki-grafana 3000:80</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order to have alerting on logs through the UI, you&#8217;ll need to use Grafana 7.5 or higher.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example-elasticsearch"><a class="anchor" href="#example-elasticsearch"></a>Example: Elasticsearch</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This example assumes you&#8217;ve deployed the CouchbaseCluster resource described at the <a href="#cluster-config-log-forwarding">beginning of the tutorial</a>. It also assumes that you are familiar with how to <a href="#customize-the-log-forwarding-configuration">customize a log forwarding configuration</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An Elasticsearch deployment or StatefulSet can provide a good integrated solution for monitoring and logging.
A basic deployment configuration with a single replica is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: Service
apiVersion: v1
metadata:
  name: elasticsearch
  labels:
    app: elasticsearch
spec:
  selector:
    app: elasticsearch
  clusterIP: None
  ports:
    - port: 9200
      name: rest
    - port: 9300
      name: inter-node
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: es-cluster
spec:
  serviceName: elasticsearch
  replicas: 1
  selector:
    matchLabels:
      app: elasticsearch
  template:
    metadata:
      labels:
        app: elasticsearch
    spec:
      containers:
      - name: elasticsearch
        image: docker.elastic.co/elasticsearch/elasticsearch:7.2.0
        resources:
            limits:
              cpu: 1000m
            requests:
              cpu: 100m
        ports:
        - containerPort: 9200
          name: rest
          protocol: TCP
        - containerPort: 9300
          name: inter-node
          protocol: TCP
        env:
          - name: cluster.name
            value: k8s-logs
          - name: node.name
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: discovery.seed_hosts
            value: "es-cluster-0.elasticsearch"
          - name: cluster.initial_master_nodes
            value: "es-cluster-0"
          - name: ES_JAVA_OPTS
            value: "-Xms512m -Xmx512m"
---
apiVersion: v1
kind: Service
metadata:
  name: kibana
  labels:
    app: kibana
spec:
  ports:
  - port: 5601
  selector:
    app: kibana
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kibana
  labels:
    app: kibana
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kibana
  template:
    metadata:
      labels:
        app: kibana
    spec:
      containers:
      - name: kibana
        image: docker.elastic.co/kibana/kibana:7.2.0
        resources:
          limits:
            cpu: 1000m
          requests:
            cpu: 100m
        env:
          - name: ELASTICSEARCH_URL
            value: http://elasticsearch:9200
        ports:
        - containerPort: 5601</code></pre>
</div>
</div>
<div class="paragraph">
<p>This needs to be deployed in the same namespace as the Couchbase cluster, otherwise the service URL will need to be explicit (include the namespace) in the log configuration.</p>
</div>
<div class="paragraph">
<p>Once the Elasticsearch deployment is in place, we can start configuring Fluent Bit.
The main area to manage is the output configuration, so in the following example we&#8217;ve simply included the default configuration file and then appended an output to Elasticsearch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: fluent-bit-config
stringData:
  fluent-bit.conf: |
    # Just include the normal file and append to it the Elasticsearch output
    @include /fluent-bit/etc/fluent-bit.conf

    # Output to Elasticsearch
    [OUTPUT]
        name  es
        match couchbase.log.*<i class="conum" data-value="1"></i><b>(1)</b>
        Logstash_Format On
        Include_Tag_Key On
        Tag_Key FluentBit-Key
        Host elasticsearch<i class="conum" data-value="2"></i><b>(2)</b>
        Port 9200</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this case we send all logs to Elasticsearch via a regex match.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the Elasticsearch instance is in another namespace, then the <code>Host</code> must be updated to include the namespace according to the usual Kubernetes syntax <code>&lt;service&gt;.&lt;namespace&gt;</code>.
Similarly if it is external, then the correct URL needs to be provided and resolved correctly.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example-azure-blob-storage"><a class="anchor" href="#example-azure-blob-storage"></a>Example: Azure Blob Storage</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This example assumes you&#8217;ve deployed the CouchbaseCluster resource described at the <a href="#cluster-config-log-forwarding">beginning of the tutorial</a>. It also assumes that you are familiar with how to <a href="#customize-the-log-forwarding-configuration">customize a log forwarding configuration</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example shows you how to forward audit logs to an Azure endpoint.
The main area to manage is the output configuration, so in the following example we&#8217;ve simply included the default configuration file and then appended an output to Azure Blob Storage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: fluent-bit-config
stringData:
  fluent-bit.conf: |
    # Just include the normal file and append to it the Azure Blob output
    @include /fluent-bit/etc/fluent-bit.conf

    # Output only audit log by default
    [OUTPUT]<i class="conum" data-value="1"></i><b>(1)</b>
        name                  azure_blob
        match                 couchbase.log.audit
        account_name          YOUR_ACCOUNT_NAME
        shared_key            YOUR_SHARED_KEY
        path                  kubernetes
        container_name        logs
        auto_create_container on
        tls                   on</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Make sure to specify your details for <code>account_name</code> and <code>shared_key</code>, along with things like the <code>container_name</code> and <code>path</code>.
All the various options are described in the official Fluent Bit documentation for the <a href="https://docs.fluentbit.io/manual/pipeline/outputs/azure_blob" target="_blank" rel="noopener">Azure Blob output plugin</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To simplify testing, the <a href="https://github.com/Azure/Azurite" target="_blank" rel="noopener">Azurite</a> emulator can be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Service
metadata:
  name: azurite
  labels:
    app: azurite
spec:
  ports:
  - port: 10000
  selector:
    app: azurite
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: azurite-deployment
  labels:
    app: azurite
spec:
  replicas: 1
  selector:
    matchLabels:
      app: azurite
  template:
    metadata:
      labels:
        app: azurite
    spec:
      containers:
      - name: azurite
        image: mcr.microsoft.com/azure-storage/azurite
        ports:
        - containerPort: 10000</code></pre>
</div>
</div>
<div class="paragraph">
<p>The log forwarding configuration then becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: fluent-bit-config
stringData:
  fluent-bit.conf: |
    # Just include the normal file and append to it the Azure Blob output
    @include /fluent-bit/etc/fluent-bit.conf
    # Output only audit log by default
    [OUTPUT]
        name                  azure_blob
        match                 couchbase.log.audit
        account_name          devstoreaccount1
        shared_key            Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==
        path                  kubernetes
        container_name        logs
        auto_create_container on
        tls                   off
        emulator_mode         on
        endpoint              azurite:10000</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example-amazon-s3"><a class="anchor" href="#example-amazon-s3"></a>Example: Amazon S3</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This example assumes you&#8217;ve deployed the CouchbaseCluster resource described at the <a href="#cluster-config-log-forwarding">beginning of the tutorial</a>. It also assumes that you are familiar with how to <a href="#customize-the-log-forwarding-configuration">customize a log forwarding configuration</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example shows you how to forward audit logs to an Amazon S3 endpoint.
The main area to manage is the output configuration, so in the following example we&#8217;ve simply included the default configuration file and then appended an output to the S3 cloud object store:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: fluent-bit-config
stringData:
  fluent-bit.conf: |
    # Just include the normal file and append to it the S3 output
    @include /fluent-bit/etc/fluent-bit.conf
    # Output only audit log by default
    [OUTPUT] <i class="conum" data-value="1"></i><b>(1)</b>
        Name                         s3
        Match                        couchbase.log.audit
        bucket                       my-bucket
        region                       us-west-2
        total_file_size              250M
        s3_key_format                /$TAG[2]/$TAG[0]/%Y/%m/%d/%H/%M/%S/$UUID.gz
        s3_key_format_tag_delimiters .-</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note that the <code>role_arn</code> key is an important setting to specify if not using something like instance roles.
All the various options are described in the official Fluent Bit documentation for the <a href="https://docs.fluentbit.io/manual/pipeline/outputs/s3" target="_blank" rel="noopener">Amazon S3 output plugin</a>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="log-redaction-in-flight"><a class="anchor" href="#log-redaction-in-flight"></a>Log Redaction In-flight</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This example assumes you&#8217;ve deployed the CouchbaseCluster resource described at the <a href="#cluster-config-log-forwarding">beginning of the tutorial</a>. It also assumes that you are familiar with how to <a href="#customize-the-log-forwarding-configuration">customize a log forwarding configuration</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Fluent Bit provides some very powerful facilities to mutate the log lines before they even leave the container.
These facilities can be effectively utilized to redact sensitive information from log events.</p>
</div>
<div class="paragraph">
<p>When Couchbase Server writes an event to a log file, it encases certain <a href="../../server/current/manage/manage-logging/manage-logging.html#understanding_redaction" class="page">sensitive information</a> in special tags.
Therefore, the goal of redaction is to remove or replace the contents of the <code>&lt;ud&gt;&#8230;&#8203;&lt;/ud&gt;</code> tags in the string.</p>
</div>
<div class="paragraph">
<p>There are two main approaches we can take:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Just remove the entire line</p>
</li>
<li>
<p>Replace or remove redacted content within the line</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <em>first approach</em> can be provided by a simple <a href="https://docs.fluentbit.io/manual/pipeline/filters/grep" target="_blank" rel="noopener">grep filter</a> within Fluent Bit.
The following configuration will filter out any entries for the <code>message</code> key that match a regex:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[FILTER]
    Name grep
    Match *
    Exclude message \&lt;ud\&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the Couchbase-supplied <a href="https://hub.docker.com/r/couchbase/fluent-bit" target="_blank" rel="noopener">log processor image</a> provides optional support for the <em>second approach,</em> whereby the contents of the <code>&lt;ud&gt;&#8230;&#8203;&lt;/ud&gt;</code> tags are hashed before the log events are forwarded to standard console output or other locations.
This selective log redaction is currently facilitated by a <a href="https://docs.fluentbit.io/manual/pipeline/filters/lua" target="_blank" rel="noopener">LUA filter</a> that leverages a Couchbase-supplied <a href="https://github.com/couchbase/couchbase-fluent-bit/blob/main/redaction/redaction.lua" target="_blank" rel="noopener">LUA script</a> and a third-party <a href="https://github.com/mpeterv/sha1" target="_blank" rel="noopener">SHA-1 hashing library</a>, both of which are included in the default log processor image.</p>
</div>
<div class="paragraph">
<p>Log redaction isn&#8217;t enabled by default, so we&#8217;ll need to enable it by customizing the log forwarding configuration.
The following example generates a sample message to redact using the Fluent Bit dummy plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># Simple test generator for redaction
[INPUT]
    Name dummy
    Tag couchbase.redact.test
    Dummy {"message": "Cats are &lt;ud&gt;sma#@&amp;*+-.!!!!!rter&lt;/ud&gt; than dogs, and &lt;ud&gt;sheeps&lt;/ud&gt;"}

# Redaction of fields
[FILTER]
    Name    lua
    # Typically this would be a couchbase.log.X tag instead you match on, this is just for the test here
    Match   couchbase.redact.*
    script  redaction.lua
    call    cb_sub_message

# Now rewrite the tags for redacted information - not required if redacting normal logs
[FILTER]
    Name rewrite_tag
    Match couchbase.redact.*
    Rule message .* couchbase.log.$TAG[2] false

[OUTPUT]
    name  stdout
    match couchbase.log.*</code></pre>
</div>
</div>
<div class="paragraph">
<p>When run, this will output something like the following showing the redacted strings as hashes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[0] couchbase.logs.test: [1616146713.035099437, {"message"=&gt;"Cats are &lt;ud&gt;00b335216f27c1e7d35149b5bbfe19d4eb2d6af1&lt;/ud&gt; than dogs, and &lt;ud&gt;888f807d45ff6ce47240c7ed4e884a6f9dc7b4fb&lt;/ud&gt;"}]
[0] couchbase.logs.test: [1616146714.035226932, {"message"=&gt;"Cats are &lt;ud&gt;00b335216f27c1e7d35149b5bbfe19d4eb2d6af1&lt;/ud&gt; than dogs, and &lt;ud&gt;888f807d45ff6ce47240c7ed4e884a6f9dc7b4fb&lt;/ud&gt;"}]
[0] couchbase.logs.test: [1616146715.035028818, {"message"=&gt;"Cats are &lt;ud&gt;00b335216f27c1e7d35149b5bbfe19d4eb2d6af1&lt;/ud&gt; than dogs, and &lt;ud&gt;888f807d45ff6ce47240c7ed4e884a6f9dc7b4fb&lt;/ud&gt;"}]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For redaction we recommend only matching those streams you want to redact to reduce the load.
LUA scripting has an overhead and it is recommended to use an extra Fluent Bit worker thread at least if you enable it.</p>
</div>
<div class="paragraph">
<p>A salt for redaction can be provided in the logging configuration secret by specifying it in the <code>redaction.salt</code> file/key.
The salt is defaulted to the cluster name by the operator and is provided in the default configuration even though it is not used by default.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span> 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../_/js/site.js"></script>
<script defer src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
