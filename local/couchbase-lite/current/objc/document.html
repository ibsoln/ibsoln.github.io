<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Documents&#8201;&#8212;&#8201;Data Model | Couchbase Docs</title>
<link rel="canonical" href="http://127.0.0.1:5000/couchbase-lite/current/objc/document.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Couchbase Lite concepts -- Data model -- Documents">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="couchbase-lite">
<meta name="dcterms.identifier" content="3.0">
<meta name="page-url" content="/couchbase-lite/current/objc/document.html">
<meta name="generator" content="Antora 3.0.0-alpha.5">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="http://127.0.0.1:5000/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="http://127.0.0.1:5000/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile Local
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../tutorials/index.html">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
<div class="components">
  <div class="components_group-title">
    <a href="../../../home/mobile.html">Mobile Local</a>
  </div>
  <ul class="components_list">
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Couchbase Lite</span>
        <select class="version_list" data-component="couchbase-lite">
          <option value="3.0" data-url="../index.html" selected>3.0</option>
          <option value="2.8" data-url="../../2.8/index.html">2.8</option>
        </select>
      </div>
      <div class="version_items hide" data-version="3.0">
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../index.html">Introduction</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../cbl-whatsnew.html">New in 3.0</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../android/quickstart.html">Android</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/kotlin.html">Kotlin</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Data Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../android/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0/couchbase-lite-android/">API References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0/couchbase-lite-android-ktx">Kotlin Extensions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../c/quickstart.html">C</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/gs-downloads.html">Download</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/c_fleece.html">Fleece API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/field-level-encryption.html">Field Level Encryption</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/replication.html">Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/{version-full}/couchbase-lite-c/">API&#160;References</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../c/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../csharp/quickstart.html">.Net</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-n1ql-mobile-server-diffs.html">N1QL Mobile - Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Data Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../csharp/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/{version-full}/couchbase-lite-net/index.html">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../java/quickstart.html">Java</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Data Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../java/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/{version-full}/couchbase-lite-java/">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="quickstart.html">Objective-C</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list is-current-page" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link is-current-page" href="document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/{version-full}/couchbase-lite-objc/index.html">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="troubleshooting-crashes.html">Troubleshooting Crashes</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../swift/quickstart.html">Swift</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#swift:landing-replications.adoc">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../swift/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/{version-full}/couchbase-lite-swift/index.html">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-crashes.html">Troubleshooting Crashes</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../javascript.html">JavaScript</a>
  </span>
</li>
</ul>
      </div>
      <div class="version_items hide" data-version="2.8">
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/index.html">Introduction</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../cbl-whatsnew.html">What&#8217;s New</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../android/quickstart.html">Android</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/android/gs-prereqs.html">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/querybuilder.html">QueryBuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-live.html">Live Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-predictive.html">Predictive Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/android/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/dbreplica.html">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/android/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/p2psync-custom.html">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0.{base}/couchbase-lite-android/">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/android/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/supported-os.html">Supported OS</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../android/refer-glossary.html">Glossary</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../csharp/quickstart.html">C#.Net</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/querybuilder.html">QueryBuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-live.html">Live Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#couchbase-lite:csharp:query-predictive.adoc">Predictive Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/csharp/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/dbreplica.html">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/csharp/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/p2psync-custom.html">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0.{base}/couchbase-lite-net">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/csharp/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/supported-os.html">Supported OS</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../csharp/refer-glossary.html">Glossary</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../java/quickstart.html">Java</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/java/gs-prereqs.html">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/querybuilder.html">QueryBuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-live.html">Live Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-predictive.html">Predictive Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/java/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/dbreplica.html">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/java/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/p2psync-custom.html">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0.{base}/couchbase-lite-java/">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/java/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/supported-os.html">Supported OS</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../java/refer-glossary.html">Glossary</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="quickstart.html">Objective-C</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/objc/gs-prereqs.html">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list is-current-page" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link is-current-page" href="document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/querybuilder.html">QueryBuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-live.html">Live Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#couchbase-lite:objc:query-predictive.adoc">Predictive Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/objc/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/dbreplica.html">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/objc/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/p2psync-custom.html">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0.{base}/couchbase-lite-objc">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="troubleshooting-crashes.html">Decoding Crash Logs</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/objc/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="supported-os.html">Supported OS</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="refer-glossary.html">Glossary</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../swift/quickstart.html">Swift</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/swift/gs-prereqs.html">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/querybuilder.html">QueryBuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-live.html">Live Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-predictive.html">Predictive Query</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/swift/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/dbreplica.html">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/swift/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/p2psync-custom.html">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://ibsoln.github.io/api/mobile/3.0.{base}/couchbase-lite-swift">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/troubleshooting-crashes.html">Decoding Crash Logs</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/swift/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/supported-os.html">Supported OS</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../swift/refer-glossary.html">Glossary</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../2.8/javascript.html">JavaScript</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../2.8/javascript.html">JavaScript</a>
  </span>
</li>
</ul>
</li>
</ul>
      </div>
    </li>
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Sync Gateway</span>
        <select class="version_list" data-component="sync-gateway">
          <option value="3.0" data-url="../../../sync-gateway/current/index.html" selected>3.0</option>
          <option value="2.8" data-url="../../../sync-gateway/2.8/index.html">2.8</option>
        </select>
      </div>
      <div class="version_items hide" data-version="3.0">
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/introduction.html">Introduction</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/whatsnew.html"><strong><em>New in 3.0</em></strong></a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/index.html">Quick Links</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-prepare.html">Prepare</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-verify-install.html">Verify</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/data-modeling.html">Data Modeling</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Configuration</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-bootstrap.html">Bootstrap</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-database.html">Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-db-security.html">Database Security</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-access-control.html">Access Control</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-import-filter.html">Import Filter</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-schema-isgr.html">Inter-Sync&#160;Gateway Replication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-properties-legacy.html">Legacy Pre-3.0&#160;BETA Configuration</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-javascript-functions.html">Javascript Functions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-environment-variables.html">Environment Variables</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Security</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/secure-sgw-access.html">Secure Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/authentication-users.html">User Authentication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/authentication-certs.html">TLS Cert Authentication</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Access Control</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-concepts.html">Concepts</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-model.html">Access Control Model</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/channels.html">Channels</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/roles.html">Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/users.html">Users</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function.html">Sync Function</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api.html">API Reference</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-access-cmd.html">access()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-channel-cmd.html">channel()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-expiry-cmd.html">expiry()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-access-cmd.html">requireAccess()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-admin-cmd.html">requireAdmin()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-role-cmd.html">requireRole()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-require-user-cmd.html">requireUser()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-role-cmd.html">role()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function-api-throw-cmd.html">throw()</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how.html">How-to</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-create-users.html">Create Users</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-create-roles.html">Create Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-assign-users-to-roles.html">Assign User to Role</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-control-document-access.html">Control Document Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-verify-access.html">Verify Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/access-control-how-use-xattrs-for-access-grants.html">Use XATTRS for Access Grants</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/auto-purge-channel-access-revocation.html">Auto-Purge Channel Access Revocation</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">REST API</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-access.html">Secure Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-admin.html">Admin REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-metrics.html">Metrics REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api.html">Public REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-access-rbac-roles.html">RBAC Role - Endpoint Cross-Reference</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-with-couchbase-server.html">Sync with Server</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-using-app.html">Sync with Application</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Inter-Sync Gateway Replication</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-run.html">Initialize</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-manage.html">Manage</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-monitor.html">Monitor</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-conflict-resolution.html">Inter Syncgateway Conflict Resolution</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/delta-sync.html">Delta Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/import-filter.html">Import Filter</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Manage</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/revisions.html">Revisions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/managing-tombstones.html">Tombstones</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/resync.html">Resync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/stats-monitoring.html">Stats Monitoring</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/database-offline.html">Database Offline</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Logging and Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/logging.html">Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sgcollect-info.html">SG Collect Info</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Deploy</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/deployment.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/command-line-options.html">Command Line Options</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/load-balancer.html">Load Balancer</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/os-level-tuning.html">OS Level Tuning</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/webhooks.html">Webhooks</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/changes-feed.html">Changes Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/integrating-external-stores.html">External Stores</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/stats-prometheus.html">Prometheus Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/setting-up-dr-cluster.html">Disaster Recovery</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/upgrading.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Use Kubernetes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/deploy-cluster-to-kubernetes.html">Deploy</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#couchbase-operator::tutorial-sync-gateway-manage.adoc">Manage a Sync Gateway Cluster</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#couchbase-operator::tutorial-sync-gateway-clients.adoc">Expose Sync Gateway to Couchbase Lite clients</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Server Compatibility</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-collections.html">Collections</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-eventing.html">Eventing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-transactions.html">Transactions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-xdcr.html">XDCR</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/supported-environments.html">Supported Environments</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/compatibility.html">Compatibility Matrix</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Legacy Features</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-sg-replicate.html">SG Replicate</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-sgreplicate-resolving-conflicts.html">SG Replicate - Resolving Conflicts (depr)</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-logging-pre2-1.html">Legacy Pre-2.1 Logging</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/glossary.html">Glossary</a>
  </span>
</li>
</ul>
      </div>
      <div class="version_items hide" data-version="2.8">
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/introduction.html">Introduction</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/2.8/index.html">Quick Start</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/whatsnew.html">What&#8217;s New</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-prepare.html">Prepare</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/get-started-verify-install.html">Verify</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/data-modeling.html">Data Modeling</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/data-modeling.html">Data Modeling</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Concepts</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/users.html">Users</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/roles.html">Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/channels.html">Channels</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/managing-tombstones.html">Tombstones</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/revisions.html">Revisions</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/configuration-properties-legacy.html">Configuration</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">REST API</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-access.html">REST API Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api.html">Public REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-admin.html">Admin REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/rest-api-metrics.html">Metrics REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#sync-gateway::rest-api-client-app.adoc">REST API Client</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Security</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/authentication-users.html">User Authentication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/authentication-certs.html">TLS Certificate Authentication</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Access Control</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-function.html">Sync Function</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#sync-gateway::read-access.adoc">Read Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#sync-gateway::write-access.adoc">Write Access</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-with-couchbase-server.html">Sync with Couchbase Server</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-using-app.html">Sync with Couchbase Lite</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Inter-Sync Gateway Replication</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-run.html">Initialize</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-manage.html">Manage</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-monitor.html">Monitor</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sync-inter-syncgateway-conflict-resolution.html">Conflict Resolution</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/managing-tombstones.html">Managing Tombstones</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/delta-sync.html">Delta Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/resync.html">Resync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/import-filter.html">Import filter</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Manage</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/stats-monitoring.html">Monitor</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Logging and Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/logging.html">Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/sgcollect-info.html">SG Collect</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/database-offline.html">Take Database Offline/Online</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/deployment.html">Deploy</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/command-line-options.html">Command Line Options</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/load-balancer.html">Load Balancer</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/os-level-tuning.html">OS-level Tuning</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/webhooks.html">Webhooks</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/2.8/server-integration.html">Changes Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/integrating-external-stores.html">External Stores</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/stats-prometheus.html">Prometheus Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/indexing.html">Indexing versus Views</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/setting-up-dr-cluster.html">Disaster Recovery</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/upgrading.html">Upgrade</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/upgrading.html">Upgrade</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Server Compatibility</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-collections.html">Collections</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-eventing.html">Eventing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-transactions.html">Transactions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/server-compatibility-xdcr.html">XDCR</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Use Kubernetes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/deploy-cluster-to-kubernetes.html">Deploy</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#operator::tutorial-sync-gateway-manage.adoc">Manage a Sync Gateway Cluster</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#operator::tutorial-sync-gateway-clients.adoc">Expose Sync Gateway to Couchbase Lite clients</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#sync-gateway::pn-supported-os.adoc">Supported OS</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/compatibility.html">Compatibility Matrix</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Legacy Features</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#sync-gateway::resolving-conflicts.adoc">Conflict Resolution 1.x Clients</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-sg-replicate.html">SG-Replicate</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/legacy-logging-pre2-1.html">Log Rotation pre-2.1</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../sync-gateway/current/glossary.html">Sync Gateway Glossary</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../sync-gateway/current/glossary.html">Sync Gateway Glossary</a>
  </span>
</li>
</ul>
</li>
</ul>
      </div>
    </li>
  </ul>
</div>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2@">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/pages/document.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">Couchbase Lite</a></li>
<li class="crumb"><a href="quickstart.html">Objective-C</a></li>
<li class="crumb"><a href="document.html">Documents</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Documents&#8201;&#8212;&#8201;Data Model</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Description&#8201;&#8212;&#8201;<em>Couchbase Lite concepts&#8201;&#8212;&#8201;Data model&#8201;&#8212;&#8201;Documents</em><br>
Related Content&#8201;&#8212;&#8201;<a href="database.html" class="page">Databases</a> | <a href="blob.html" class="page">Blobs</a> | <a href="indexing.html" class="page">Indexing</a> |</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Couchbase Lite the term 'document' is refers to an entry in the database; a record, or row in a table if you like.</p>
</div>
<div class="paragraph">
<p>Each document has an ID (primary key in other databases) by which it can be located.
This ID can be automatically generated (as a UUID) or specified programmatically;
the only constraints are that it must be unique within the database, and it can&#8217;t be changed.
The document also has a value which contains the actual application data.
This value is stored as a dictionary collection of key-value (k-v) pairs where the values themselves may comprise different types of data such as numbers, strings, arrays or even nested objects&#8201;&#8212;&#8201;see: <a href="#data-types">Data Types</a></p>
</div>
<div class="paragraph">
<p>The document body is stored in an internal, efficient, binary form (
<a href="https://github.com/couchbaselabs/fleece#readme">Fleece</a>
).<br>
This internal form is easily converted into a manageable native dictionary format for manipulation in applications.</p>
</div>
<div class="paragraph">
<p>Couchbase Lite also provides for the direct handling of JSON data implemented in most cases by the provision of a <code>toJSON()</code> method on appropriate API classes (for example, on MutableDocument, Dictionary, Blob and Array)&#8201;&#8212;&#8201;see <a href="#lbl-json-data">Working with JSON Data</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="constructing-a-document"><a class="anchor" href="#constructing-a-document"></a>Constructing a Document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An individual document often represents a single instance of an object in application code.
A document might be considered equivalent to a row in a relational table; with each of the documents attributes being equivalent to a column.</p>
</div>
<div class="paragraph">
<p>Documents can contain nested structures.
This allows developers to express many-to-many relationships without requiring a reference or junction table; and is naturally expressive of hierarchical data.</p>
</div>
<div class="paragraph">
<p>Most apps will work with one or more documents, persisting them to a local database and optionally syncing the either centrally or to the cloud.</p>
</div>
<div class="paragraph">
<p>In this section we provide an example of how you might create a <code>hotel</code> document, which provides basic contact details and price data.</p>
</div>
<div class="listingblock">
<div class="title">Data Model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">hotel: {
  type: string (value = `hotel`)
  name: string
  address: dictionary {
    street: string
    city: string
    state: string
    country: string
    code: string
  }
  phones: array
  rate: float
}</code></pre>
</div>
</div>
<div id="ex-usage" class="olist arabic">
<ol class="arabic">
<li>
<p>Open or create your database</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">//
//  SampleCodeTest.m
//  CouchbaseLite
//
//  Copyright (c) 2018 Couchbase, Inc All rights reserved.
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//  <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//

#import &lt;UIKit/UIKit.h&gt;
#import &lt;CouchbaseLite/CouchbaseLite.h&gt;
#import &lt;CoreML/CoreML.h&gt;


#pragma mark - !!!Note
/<strong>*
 Note for Consistency across the code snippets:

 1. We will keep the '</strong>' with instance after the space.
    <code>NSDictionary <strong>dict = [NSDictionary dictionary];</code>

 2. For making more space in single line, we will avoid space after the ':' in function call.
    <code>[myMLModel predictImage:imageData];</code>

 3. Will only keep <code>self.database</code> when using database, query and replicator related code snippet.
    Except when creating a new database sample.

 4. Will only keep <code>self.otherDB</code> when using listener-db

 5. While using replicator/listener, we will use as ivar <code>self.replicator</code> and <code>self.listener</code> resp.
 */

#pragma mark -

// <code>myMLModel</code> is a fake implementation
// this would be the implementation of the ml model you have chosen
@interface myMLModel :NSObject

+ (NSDictionary</strong>)predictImage:(NSData*)data;

@end

@interface ImageClassifierModel :NSObject &lt;CBLPredictiveModel&gt;

- (nullable CBLDictionary*) predict:(CBLDictionary*)input;

@end

@implementation ImageClassifierModel

- (nullable CBLDictionary*) predict:(CBLDictionary*)input; {
    CBLBlob <strong>blob = [input blobForKey:@"photo"];

    NSData *imageData = blob.content;
    // <code>myMLModel</code> is a fake implementation
    // this would be the implementation of the ml model you have chosen
    NSDictionary *modelOutput = [myMLModel predictImage:imageData];

    CBLMutableDictionary *output = [[CBLMutableDictionary alloc] initWithData:modelOutput];
    return output; <i class="conum" data-value="1"></i><b>(1)</b>
}

@end

// to avoid link error
@implementation myMLModel
+ (NSDictionary</strong>)predictImage:(NSData*)data { return [NSDictionary dictionary]; }
@end

@interface LogTestLogger :NSObject&lt;CBLLogger&gt;

// set the log level
@property (nonatomic) CBLLogLevel level;

@end

@implementation LogTestLogger

@synthesize level=_level;

- (void) logWithLevel:(CBLLogLevel)level domain:(CBLLogDomain)domain message:(NSString*)message {
    // handle the message, for example piping it to
    // a third party framework
}

@end


@interface LocalWinConflictResolver :NSObject&lt;CBLConflictResolver&gt;
@end

@implementation LocalWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.localDocument;
}

@end

@interface RemoteWinConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation RemoteWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.remoteDocument;
}

@end


@interface MergeConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation MergeConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    NSDictionary <strong>localDict = conflict.localDocument.toDictionary;
    NSDictionary *remoteDict = conflict.remoteDocument.toDictionary;

    NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:localDict];
    [result addEntriesFromDictionary:remoteDict];

    return [[CBLMutableDocument alloc] initWithID:conflict.documentID
                                             data:result];
}

@end

@interface Hotel :NSObject
@property (nonatomic) NSString *id;
@property (nonatomic) NSString *name;
@property (nonatomic) NSString *city;
@property (nonatomic) NSString *country;
@property (nonatomic) NSString *descriptive;
@end

@implementation Hotel
@synthesize id, name, city, country, descriptive;
@end

@interface SampleCodeTest :NSObject
@property(nonatomic) CBLDatabase *database;
@property(nonatomic) CBLDatabase *otherDB;
@property(nonatomic) CBLURLEndpointListener *listener;
@property(nonatomic) CBLReplicator *replicator;
@end

@implementation SampleCodeTest

#pragma mark - Database

- (void) dontTestNewDatabase {
    NSError *error;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"my-database" error:&amp;error];
    if (!database) {
        NSLog(@"Cannot open the database:%@", error);
    }
    self.database = database;

    if (![self.database close:&amp;error])
        NSLog(@"Error closing db:%@", error);

}

- (void) dontTestLogging {

    // Replicator / Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Query /  Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainQuery;
}

#if COUCHBASE_ENTERPRISE
- (void) dontTestDatabaseEncryption {
    CBLDatabaseConfiguration *config = [[CBLDatabaseConfiguration alloc] init];
    config.encryptionKey = [[CBLEncryptionKey alloc] initWithPassword:@"secretpassword"];

    NSError *error;
    self.database = [[CBLDatabase alloc] initWithName:@"my-database" config:config error:&amp;error];
    if (!self.database) {
        NSLog(@"Cannot open the database:%@", error);
    }
}
#endif

- (void) dontTestEnableConsoleLogging {
    CBLDatabase.log.console.domains = kCBLLogDomainAll; <i class="conum" data-value="1"></i><b>(1)</b>
    CBLDatabase.log.console.level = kCBLLogLevelVerbose; <i class="conum" data-value="2"></i><b>(2)</b>


    CBLDatabase.log.console.domains = kCBLLogDomainAll;

}

- (void) dontTestFileLogging {
    NSString *tempFolder = [NSTemporaryDirectory() stringByAppendingPathComponent:@"cbllog"];
    CBLLogFileConfiguration *config = [[CBLLogFileConfiguration alloc] initWithDirectory:tempFolder]; <i class="conum" data-value="3"></i><b>(3)</b>
    config.maxRotateCount = 2; <i class="conum" data-value="4"></i><b>(4)</b>
    config.maxSize = 1024; <i class="conum" data-value="5"></i><b>(5)</b>
    config.usePlainText = YES; <i class="conum" data-value="6"></i><b>(6)</b>
    [CBLDatabase.log.file setConfig:config];
    [CBLDatabase.log.file setLevel:kCBLLogLevelInfo]; <i class="conum" data-value="7"></i><b>(7)</b>
}

- (void) dontTestEnableCustomLogging {
    LogTestLogger *logger = [[LogTestLogger alloc] init];
    logger.level = kCBLLogLevelWarning;
    [CBLDatabase.log setCustom:logger];

}

- (void) dontTestLoadingPrebuilt {
    // Note:Getting the path to a database is platform-specific.
    // For iOS you need to get the path from the main bundle.
    if (![CBLDatabase databaseExists:@"travel-sample" inDirectory:nil]) {
        NSError *error;
        NSString *path = [[NSBundle bundleForClass:[self class]] pathForResource:@"travel-sample" ofType:@"cblite2"];
        if (![CBLDatabase copyFromPath:path toDatabase:@"travel-sample" withConfig:nil error:&amp;error]) {
            [NSException raise:NSInternalInconsistencyException
                        format:@"Could not load pre-built database:%@", error];
        }
    }
}

#pragma mark - Document

- (void) dontTestInitializer {
    NSError *error;

    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];
    [newTask setString:@"task" forKey:@"task"];
    [newTask setString:@"todo" forKey:@"owner"];
    [newTask setString:@"task" forKey:@"createdAt"];
    [self.database saveDocument:newTask error:&amp;error];
}

- (void) dontTestMutability {
    NSError *error;

    CBLDocument *document = [self.database documentWithID:@"xyz"];
    CBLMutableDocument *mutableDocument = [document toMutable];
    [mutableDocument setString:@"apples" forKey:@"name"];
    [self.database saveDocument:mutableDocument error:&amp;error];
}

- (void) dontTestTypedAcessors {
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];

    [newTask setValue:[NSDate date] forKey:@"createdAt"];
    NSDate *date = [newTask dateForKey:@"createdAt"];

    NSLog(@"Date:%@", date);
}

- (void) dontTestDataTypeDictionary {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting a dictionary value from the document
    CBLDictionary *dict = [document dictionaryForKey:@"address"];
    
    // Access a value from the dictionary
    NSString *street = [dict stringForKey:@"street"];
    NSLog(@"Street:: %@", street);
    
    // Iterate dictionary
    for (NSString *key in dict) {
        id value = [dict valueForKey:key];
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableDictionary *mutableDict = [dict toMutable];
    [mutableDict setString:@"1 Great sts" forKey:@"street"];
}

- (void) dontTestDataTypeMutableDictionary {
    
    // Create a new mutable dictionary and populate some keys/values
    CBLMutableDictionary *dict = [[CBLMutableDictionary alloc] init];
    [dict setString:@"1 Main st" forKey:@"street"];
    [dict setString:@"San Francisco" forKey:@"city"];
    
    // Set the dictionary to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setDictionary:dict forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestDataTypeArray {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting an array value from the document
    CBLArray *array = [document arrayForKey:@"phones"];
    
    // Get element count
    NSUInteger count = array.count;
    NSLog(@"Count:: %lu", (unsigned long)count);
    
    // Access an array element by index
    if (count &gt; 0) {
        id value = [array valueAtIndex:0];
        NSLog(@"Value:: %@", value);
    }
    
    // Iterate the array
    for (id value in array) {
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableArray *mutableArray = [array toMutable];
    [mutableArray addString:@"650-000-0002"];
}

- (void) dontTestDataTypeMutableArray {
    // Create a new mutable array and populate data into the array
    CBLMutableArray *array = [[CBLMutableArray alloc] init];
    [array addString:@"650-000-0000"];
    [array addString:@"650-000-0001"];
    
    // Set the array to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setArray:array forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestBatchOperations {
    NSError *error;

    [self.database inBatch:&amp;error usingBlock:^{
        for (int i = 0; i &lt; 10; i++) {
            CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
            [doc setValue:@"user" forKey:@"type"];
            [doc setValue:[NSString stringWithFormat:@"user %d", i] forKey:@"name"];
            [doc setBoolean:NO forKey:@"admin"];

            NSError *err = nil;
            [self.database saveDocument:doc error:&amp;err];
        }
    }];
}

- (void) dontTestChangeListener {
    <em>block SampleCodeTest *wSelf = self;
    [self.database addDocumentChangeListenerWithID:@"user.john" listener:^(CBLDocumentChange  *change) {
        CBLDocument *document = [wSelf.database documentWithID:change.documentID];
        NSLog(@"Status ::%@)", [document stringForKey:@"verified_account"]);
    }];
}

- (void) dontTestDocumentExpiration {
    NSError *error;

    // Purge the document one day from now
    NSDate *ttl = [[NSCalendar currentCalendar] dateByAddingUnit:NSCalendarUnitDay
                                                           value:1
                                                          toDate:[NSDate date]
                                                         options:0];
    [self.database setDocumentExpirationWithID:@"doc123" expiration:ttl error:&amp;error];

    // Reset expiration
    [self.database setDocumentExpirationWithID:@"doc1" expiration:nil error:&amp;error];

    // Query documents that will be expired in less than five minutes
    NSTimeInterval fiveMinutesFromNow = [[NSDate dateWithTimeIntervalSinceNow:60 * 5] timeIntervalSince1970];
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryMeta expiration]
                                                lessThan:[CBLQueryExpression double:fiveMinutesFromNow]]];
    NSLog(@"%@", query);
}

- (void) dontTestBlob {
#if TARGET_OS_IPHONE
    NSError *error;
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] initWithID:@"task1"];

    UIImage *appleImage = [UIImage imageNamed:@"avatar.jpg"];
    NSData *imageData = UIImageJPEGRepresentation(appleImage, 1.0);  <i class="conum" data-value="8"></i><b>(8)</b>

    CBLBlob *blob = [[CBLBlob alloc] initWithContentType:@"image/jpeg" data:imageData];  <i class="conum" data-value="9"></i><b>(9)</b>
    [newTask setBlob:blob forKey:@"avatar"]; <i class="conum" data-value="10"></i><b>(10)</b>
    [self.database saveDocument:newTask error:&amp;error];

    CBLDocument *savedTask = [self.database documentWithID:@"task1"];
    CBLBlob *taskBlob = [savedTask blobForKey:@"avatar"];
    UIImage *taskImage = [UIImage imageWithData:taskBlob.content];

    NSLog(@"%@", taskImage);
#endif
}

- (void) dontTest1xAttachment {
    CBLMutableDocument *document = [[CBLMutableDocument alloc] initWithID:@"task1"];

    CBLDictionary *attachments = [document dictionaryForKey:@"_attachments"];
    CBLBlob *avatar = [attachments blobForKey:@"avatar"];
    NSData *content = [avatar content];

    NSLog(@"%@", content);
}

#pragma mark - Query

- (void) dontTestIndexing {
    NSError *error;


    CBLValueIndexConfiguration</strong> config =
                [[CBLValueIndexConfiguration alloc]
                    initWithExpression: @[@"type", @"name"]];

    [self.database createIndexWithConfig: config name: @"TypeNameIndex" error: &amp;error];


}

- (void) dontTestIndexing_Querybuilder {
    NSError <strong>error;

    CBLValueIndexItem *type = [CBLValueIndexItem property:@"type"];
    CBLValueIndexItem *name = [CBLValueIndexItem property:@"name"];
    CBLIndex *index = [CBLIndexBuilder valueIndexWithItems:@[type, name]];
    [self.database createIndex:index withName:@"TypeNameIndex" error:&amp;error];
}



- (void) dontTestSelect {
    NSError *error;
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression value:@"user"]] andExpression:
                                               [[CBLQueryExpression property:@"admin"] equalTo:[CBLQueryExpression boolean:NO]]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"user name ::%@", [result stringAtIndex:0]);
    }
}

- (void) dontTestSelectProps {
    NSError *error;
    CBLQuerySelectResult *metaId = [CBLQuerySelectResult expression: CBLQueryMeta.id as:@"id"];
    CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[metaId, type, name]
                                         from:[CBLQueryDataSource database:self.database]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id :: %@", [result stringForKey:@"id"]);
        NSLog(@"document name :: %@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestSelectAll {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]];

    NSLog(@"%@", query);
}

- (void) dontTestLiveQuery {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]]; <i class="conum" data-value="11"></i><b>(11)</b>

    // Adds a query change listener.
    // Changes will be posted on the main queue.
    id&lt;CBLListenerToken&gt; token = [query addChangeListener:^(CBLQueryChange  *change) { <i class="conum" data-value="12"></i><b>(12)</b>
        for (CBLQueryResultSet *results in [change results]) {
            NSLog(@"%@", results);
            /</strong> Update UI <strong>/
        }
    }]; <i class="conum" data-value="13"></i><b>(13)</b>


    [query removeChangeListenerWithToken:token]; <i class="conum" data-value="14"></i><b>(14)</b>
}

- (void) dontTestWhere {
    NSError *error;
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:[CBLQueryLimit limit:[CBLQueryExpression integer:10]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        CBLDictionary *dict = [result valueForKey:@"travel-sample"];
        NSLog(@"document name ::%@", [dict stringForKey:@"name"]);
    }

    NSLog(@"%@", query);
}

- (void) dontTestQueryDeletedDocuments {
    // Query documents that have been deleted
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:CBLQueryMeta.id]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:CBLQueryMeta.isDeleted];
    NSLog(@"%@", query);
}

- (void) dontTestCollectionOperatorContains {
    NSError *error;

    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuerySelectResult *likes = [CBLQuerySelectResult property:@"public_likes"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]];
    CBLQueryExpression *contains = [CBLQueryArrayFunction contains:[CBLQueryExpression property:@"public_likes"]
                                                             value:[CBLQueryExpression string:@"Armani Langworth"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name, likes]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:contains]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"public_likes ::%@", [[result arrayForKey:@"public_likes"] toArray]);
    }
}

- (void) dontTestCollectionOperatorIn {
    NSArray *values = @[[CBLQueryExpression property:@"first"],
                       [CBLQueryExpression property:@"last"],
                       [CBLQueryExpression property:@"username"]];

    [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                       from:[CBLQueryDataSource database:self.database]
                      where:[[CBLQueryExpression string:@"Armani"] in:values]];
}

- (void) dontTestLikeOperator {
    NSError *error;
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"royal engineers museum"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"name property ::%@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestWildCardMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"eng%e%"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestWildCardCharacterMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryExpression property:@"name"] like:[CBLQueryExpression string:@"eng</em><em>r"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestRegexMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *regex = [[CBLQueryExpression property:@"name"] regex:[CBLQueryExpression string:@"\\bEng.*e\\b"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:regex]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestJoin {
    CBLQuerySelectResult *name = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"name" from:@"airline"]];
    CBLQuerySelectResult *callsign = [CBLQuerySelectResult
                                      expression:[CBLQueryExpression property:@"callsign" from:@"airline"]];
    CBLQuerySelectResult *dest = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"destinationairport" from:@"route"]];
    CBLQuerySelectResult *stops = [CBLQuerySelectResult
                                   expression:[CBLQueryExpression property:@"stops" from:@"route"]];
    CBLQuerySelectResult *airline = [CBLQuerySelectResult
                                     expression:[CBLQueryExpression property:@"airline" from:@"route"]];

    CBLQueryJoin *join = [CBLQueryJoin join:[CBLQueryDataSource database:self.database
                                                                      as:@"route"]
                                         on:[[CBLQueryMeta idFrom:@"airline"]
                                             equalTo:[CBLQueryExpression property:@"airlineid"
                                                                             from:@"route"]]];

    CBLQueryExpression *typeRoute = [[CBLQueryExpression property:@"type" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"route"]];
    CBLQueryExpression *typeAirline = [[CBLQueryExpression property:@"type" from:@"airline"]
                                       equalTo:[CBLQueryExpression string:@"airline"]];
    CBLQueryExpression *sourceRIX = [[CBLQueryExpression property:@"sourceairport" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"RIX"]];

    CBLQuery *query = [CBLQueryBuilder select:@[name, callsign, dest, stops, airline]
                                         from:[CBLQueryDataSource database:self.database as:@"airline"]
                                         join:@[join]
                                        where:[[typeRoute andExpression:typeAirline] andExpression:sourceRIX]];

    NSLog(@"%@", query);
}

- (void) dontTestGroupBy {
    CBLQuerySelectResult *count = [CBLQuerySelectResult expression:[CBLQueryFunction count:[CBLQueryExpression all]]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *tz = [CBLQuerySelectResult property:@"tz"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"airport"]];
    CBLQueryExpression *geoAlt = [[CBLQueryExpression property:@"geo.alt"] greaterThanOrEqualTo:[CBLQueryExpression integer:300]];

    CBLQuery *query = [CBLQueryBuilder select:@[count, country, tz]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:geoAlt]
                                      groupBy:@[[CBLQueryExpression property:@"country"],
                                                [CBLQueryExpression property:@"tz"]]];

    NSLog(@"%@", query);
}

- (void) dontTestOrderBy {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *title = [CBLQuerySelectResult property:@"title"];

    CBLQuery *query = [CBLQueryBuilder select:@[id, title]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      orderBy:@[[[CBLQueryOrdering property:@"title"] descending]]];

    NSLog(@"%@", query);
}


- (void) dontTestExplainAll {
    NSError *error;
    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[[CBLQueryExpression property:@"type"]
                   equalTo:[CBLQueryExpression string:@"university"]]
//            groupBy:@[[CBLQueryExpression property:@"country"]] <i class="conum" data-value="15"></i><b>(15)</b>
                          orderBy:@[[[CBLQueryOrdering property:@"title"] descending]] <i class="conum" data-value="16"></i><b>(16)</b>
       ];

    NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="17"></i><b>(17)</b>

}
- (void) dontTestExplainLike {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"%hotel%"]];
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];
      NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="18"></i><b>(18)</b>


}
- (void) dontTestExplainNoPfx {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"hotel%"]]; <i class="conum" data-value="19"></i><b>(19)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainFunction {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryFunction lower:[CBLQueryExpression property:@"type"]]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="20"></i><b>(20)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
                from:[CBLQueryDataSource database:self.database]
                where:[type andExpression:name]];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainNoFunction {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="21"></i><b>(21)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);


}



- (void) dontTestCreateFullTextIndex {
    NSError *error;

    // Insert documents
    NSArray *overviews = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *overview in overviews) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:overview forKey:@"overview"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndexConfiguration</strong> config =
        [[CBLFullTextIndexConfiguration alloc]
            initWithExpression: @[@"overview"]
            ignoreAccents: NO language: nil];

    [self.database createIndexWithConfig: config
            name: @"overviewFTSIndex" error: &amp;error];

}

- (void) dontTestFullTextSearch {
    NSError <strong>error;

    NSString *ftsQueryString =
    @"SELECT META().id FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)";

    CBLQueryResultSet *resultSet = [ftsQuery execute:&amp;error];
    NSArray</strong> results  = [resultSet allResults];
    for (CBLQueryResult <strong>result in results) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}




- (void) dontTestCreateFullTextIndex_Querybuilder {
    NSError *error;

    // Insert documents
    NSArray *tasks = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *task in tasks) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:task forKey:@"name"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndex *index = [CBLIndexBuilder fullTextIndexWithItems:@[[CBLFullTextIndexItem property:@"name"]]];
    index.ignoreAccents = NO;
    [self.database createIndex:index withName:@"nameFTSIndex" error:&amp;error];
}

- (void) dontTestFullTextSearch_Querybuilder {
    NSError *error;

    CBLQueryExpression *where = [CBLQueryFullTextFunction matchWithIndexName:@"nameFTSIndex"
                                                                       query:@"'buy'"];
    CBLQuery *query =
      [CBLQueryBuilder
        select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
        from:[CBLQueryDataSource database:self.database]
        where:where];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}









#pragma mark - Replication

/</strong> The <code>tag::replication[]</code> example is inlined in objc.adoc <strong>/

- (void) dontTestEnableReplicatorLogging {
    // Replicator
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Network
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainNetwork;
}

- (void) dontTestReplicationBasicAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicationSessionAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLSessionAuthenticator alloc] initWithSessionID:@"904ac010862f37c8dd99015a33ab5a3565fd8447"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicatorStatus {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    [self.replicator addChangeListener:^(CBLReplicatorChange *change) {
        if (change.status.activity == kCBLReplicatorStopped) {
            NSLog(@"Replication stopped");
        }
    }];
}


//  BEGIN PendingDocuments IB -- 11/Feb/21 --
- (void) testReplicationPendingDocs {

    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database
                                                                                       target:target];

    config.replicatorType = kCBLReplicatorTypePush;

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    // Get list of pending doc IDs
    NSError *err = nil;
    NSSet *pendingDocIds = [self.replicator pendingDocumentIDs:&amp;err]; <i class="conum" data-value="22"></i><b>(22)</b>


    if ([pendingDocIds count] &gt; 0) {

        NSLog(@"There are %lu documents pending", (unsigned long)[pendingDocIds count]);

        [self.replicator addChangeListener:^(CBLReplicatorChange *change) {

            NSLog(@"Replicator activity level is %u", change.status.activity);
            // iterate and report-on the pending doc IDs  in 'mydocids'
            for (NSString *docID in pendingDocIds) {

                NSError *err = nil;
                if (![change.replicator isDocumentPending:docID error:&amp;err]) { <i class="conum" data-value="23"></i><b>(23)</b>
                    NSLog(@"Doc ID %@ now pushed", docID);
                }
            }

        }];
        [self.replicator start];

    };

}
//  END PendingDocuments IB -- 11/Feb/21 --


- (void) dontTestReplicatorDocumentEvent {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    id token = [self.replicator addDocumentReplicationListener:^(CBLDocumentReplication  *replication) {
        NSLog(@"Replication type ::%@", replication.isPush ? @"Push" :@"Pull");
        for (CBLReplicatedDocument *document in replication.documents) {
            if (document.error == nil) {
                NSLog(@"Doc ID ::%@", document.id);
                if document.flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {                     NSLog(@"Successfully replicated a deleted document");                 }             } else {                 // There was an error             }         }     }];      [self.replicator start];      [self.replicator removeChangeListenerWithToken:token]; }  - (void) dontTestCustomReplicationHeader {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:endpoint];     config.headers = @{@"CustomHeaderName" :@"Value"}; }  - (void) dontTestHandlingReplicationError {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }]; }  - (void) dontTestReplicationResetCheckpoint {     BOOL restCheckpoint = NO;     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      if (restCheckpoint)         [self.replicator startWithReset:restCheckpoint]; <i class="conum" data-value="24"></i><b>(24)</b>  }  - (void) dontTestReplicationPushFilter {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pushFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ([[document stringForKey:@"type"] isEqualToString:@"draft"]) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestReplicationPullFilter {      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pullFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ((flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  //  Added 2/Feb/21 - Ian Bridge - (void) dontTestCustomRetryConfig {     id target = [[CBLURLEndpoint alloc] initWithURL:[NSURL URLWithString:@"ws://foo.cbl.com/db"]];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.replicatorType = kCBLReplicatorTypePush;     config.continuous = YES;     //  other config as required . . .      config.heartbeat = 150; <i class="conum" data-value="25"></i><b>(25)</b>      config.maxAttempts = 20; <i class="conum" data-value="26"></i><b>(26)</b>      config.maxAttemptWaitTime = 600; <i class="conum" data-value="27"></i><b>(27)</b>      //  other config as required . . .     self.replicator = [[CBLReplicator alloc] initWithConfig:config];  }   #ifdef COUCHBASE_ENTERPRISE - (void) dontTestDatabaseReplica {     /</strong> EE feature:code below might throw a compilation error      if it's compiled against CBL Swift Community. <strong>/     CBLDatabaseEndpoint *targetDatabase = [[CBLDatabaseEndpoint alloc] initWithDatabase:self.otherDB];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:targetDatabase];     config.replicatorType = kCBLReplicatorTypePush;      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; } #endif  - (void) dontTestCertificatePinning {     // Active - Example 4     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      NSLog(@"%@", config); }  - (NSData</strong>) dataFromResource:(NSString*)file ofType:(NSString*)type {     return [NSData data]; }  - (void) dontTestGettingStarted {     // Get the database (and create it if it doesnt exist).     NSError <strong>error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      // Create a new document (i.e. a record) in the database.     CBLMutableDocument *mutableDoc = [[CBLMutableDocument alloc] init];     [mutableDoc setFloat:2.0 forKey:@"version"];     [mutableDoc setString:@"SDK" forKey:@"type"];      // Save it to the database.     [self.database saveDocument:mutableDoc error:&amp;error];      // Update a document.     CBLMutableDocument *mutableDoc2 = [[self.database documentWithID:mutableDoc.id] toMutable];     [mutableDoc2 setString:@"Swift" forKey:@"language"];     [self.database saveDocument:mutableDoc2 error:&amp;error];      CBLDocument *document = [self.database documentWithID:mutableDoc2.id];     // Log the document ID (generated by the database)     // and properties     NSLog(@"Document ID ::%@", document.id);     NSLog(@"Learning %@", [document stringForKey:@"language"]);      // Create a query to fetch documents of type SDK.     CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"SDK"]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                           from:[CBLQueryDataSource database:self.database]                                          where:type];      // Run the query     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]);      // Create replicators to push and pull changes to and from the cloud.     NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *targetEndpoint = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                            target:targetEndpoint];     config.replicatorType = kCBLReplicatorTypePushAndPull;      // Add authentication.     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];      // Create replicator (make sure to add an ivar)     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      // Listen to replicator change events.     [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }];      // Start replication     [self.replicator start]; }  - (void) dontTestPredictiveModel {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      ImageClassifierModel *model = [[ImageClassifierModel alloc] init];     [[CBLDatabase prediction] registerModel:model withName:@"ImageClassifier"];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input];      CBLValueIndex *index = [CBLIndexBuilder valueIndexWithItems:@[[CBLValueIndexItem expression:[prediction property:@"label"]]]];     [self.database createIndex:index withName:@"value-index-image-classifier" error:&amp;error];      [[CBLDatabase prediction] unregisterModelWithName:@"ImageClassifier"]; }  - (void) dontTestPredictiveIndex {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];      CBLPredictiveIndex *index = [CBLIndexBuilder predictiveIndexWithModel:@"ImageClassifier" input:input properties:nil];     [self.database createIndex:index withName:@"predictive-index-image-classifier" error:&amp;error]; }  - (void) dontTestPredictiveQuery {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input]; <i class="conum" data-value="1"></i><b>(1)</b>      CBLQueryExpression *condition = [[[prediction property:@"label"] equalTo:[CBLQueryExpression string:@"car"]]                                      andExpression:[[prediction property:@"probablity"] greaterThanOrEqualTo:[CBLQueryExpression double:0.8]]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:condition];      // Run the query.     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]); }  - (void) dontTestCoreMLPredictiveModel {     NSError *error;      // Load MLModel from <code>ImageClassifier.mlmodel</code>     NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@"ImageClassifier" withExtension:@"mlmodel"];     NSURL *compiledModelURL = [MLModel compileModelAtURL:modelURL error:&amp;error];     MLModel *model = [MLModel modelWithContentsOfURL:compiledModelURL error:&amp;error];     CBLCoreMLPredictiveModel *predictiveModel = [[CBLCoreMLPredictiveModel alloc] initWithMLModel:model];      // Register model     [[CBLDatabase prediction] registerModel:predictiveModel withName:@"ImageClassifier"]; }  - (void) dontTestReplicatorConflictResolver {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.conflictResolver = [[LocalWinConflictResolver alloc] init];      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestSaveWithConflictHandler {     NSError *error;      CBLDocument *document = [self.database documentWithID:@"xyz"];     CBLMutableDocument *mutableDocument = [document toMutable];     [mutableDocument setString:@"apples" forKey:@"name"];      [self.database saveDocument:mutableDocument            conflictHandler:^BOOL(CBLMutableDocument *new, CBLDocument *current) {                NSDictionary *currentDict = current.toDictionary;                NSDictionary *newDict = new.toDictionary;                 NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:currentDict];                [result addEntriesFromDictionary:newDict];                [new setData:result];                return YES;            }                      error:&amp;error]; }  #pragma mark - URLListener  - (BOOL) isValidCredentials:(NSString</strong>)u password:(NSString*)p { return YES; } // helper - (BOOL) isValidCertificates:(NSArray*)certs { return YES; } // helper  - (void) dontTestInitListener {     CBLURLEndpointListenerConfiguration <strong>config;     config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.database];     config.tlsIdentity = nil; // Use with anonymous self signed cert     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL( NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; }  - (void) dontTestListenerStart {     NSError *error = nil;      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } }  - (void) dontTestListenerStop {     [self.listener stop]; }  - (void) dontTestCreateSelfSignedCert {     NSError *error = nil;     CBLTLSIdentity *identity = nil;     // &lt;site-rooot&gt;/objc/advance/objc-p2psync-websocket-using-passive.html     // Example-6      NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" };     identity =       [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/         attributes:attrs         expiration:[NSDate dateWithTimeIntervalSinceNow:86400]         label:@"Server-Cert-Label"         error:&amp;error]; }  - (void) dontTestListenerCertificateAuthenticatorRootCert {     CBLURLEndpointListenerConfiguration *config;      // Example 8-tab1      NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]]; }  - (void) dontTestListenerCertificateAuthenticatorCallback {     CBLURLEndpointListenerConfiguration *config;     // Example 8-tab2      CBLListenerCertificateAuthenticator *listenerAuth =     [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];      config.authenticator = listenerAuth; }  # pragma mark - QUERY RESULT SET HANDLING EXAMPLES  - (void) dontTestQuerySyntaxJson {     NSError *error;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                              from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="28"></i><b>(28)</b>        CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {          NSDictionary *data = [result valueAtIndex:0];          // Use dictionary values         NSLog(@"id = %@", [data valueForKey:@"id"]);         NSLog(@"name = %@", [data valueForKey:@"name"]);         NSLog(@"type = %@", [data valueForKey:@"type"]);         NSLog(@"city = %@", [data valueForKey:@"city"]);      } // end for       CBLQueryResultSet *rs = [query execute:&amp;error];     for (CBLQueryResult *result in rs) {          // Get result as a JSON string         NSString *json = [result toJSON]; <i class="conum" data-value="29"></i><b>(29)</b>          // Get an native Obj-C object from the Json String         NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:[json dataUsingEncoding:NSUTF8StringEncoding]                                                                          options:NSJSONReadingAllowFragments                                                                            error:&amp;error]; <i class="conum" data-value="30"></i><b>(30)</b>          // Log generated Json and Native objects         // For demo/example purposes         NSLog(@"Json String %@", json);         NSLog(@"Native Object %@", dict);      }; // end for   } // end function  - (void) dontTestQuerySyntaxAndAccessProps {     NSError *error = nil;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];      CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];      CBLQuerySelectResult *city = [CBLQuerySelectResult property:@"city"];      CBLQuery *query = [CBLQueryBuilder select:@[id, type, name, city]                                          from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="31"></i><b>(31)</b>       CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) { // all results         NSLog(@"id = %@", [result stringForKey:@"id"]);         NSLog(@"name = %@", [result stringForKey:@"name"]);         NSLog(@"type = %@", [result stringForKey:@"type"]);         NSLog(@"city = %@", [result stringForKey:@"city"]);      }  }  - (void) dontTestQuerySyntaxCount {     NSError *error = nil;     NSInteger count = 0;     CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQueryExpression *countExpression = [CBLQueryFunction count:[CBLQueryExpression all]];     CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:countExpression                                                                        as:@"myCount"];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]]; <i class="conum" data-value="32"></i><b>(32)</b>      CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {         count = [result integerForKey:@"myCount"]; <i class="conum" data-value="33"></i><b>(33)</b>      } // end for       NSLog(@"print to avoid warning %@ %ld", query, count); }  - (void) dontTestQuerySyntaxID {     NSError *error = nil;      CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]];      NSLog(@"print to avoid warning %@", query); }  - (void) dontTestQueryAccessID {     CBLQuery *query;     NSError *error = nil;      CBLQueryResultSet *results = [query execute:&amp;error];     CBLDocument *doc = nil;     NSString *docId = nil;     for (CBLQueryResult *result in results) {         docId = [result stringForKey:@"id"]; <i class="conum" data-value="34"></i><b>(34)</b>          // Now you can get the document using its ID         // for example using         doc = [self.database documentWithID:docId];      }      NSLog(@"doc.id = %@", doc.id); }  - (void) dontTestQuerySyntaxPagination {     int offset = 0;     int limit = 20;      CBLQueryLimit *queryLimit = [CBLQueryLimit limit:[CBLQueryExpression integer:limit]                                               offset:[CBLQueryExpression integer:offset]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:nil                                       groupBy:nil                                        having:nil                                       orderBy:nil                                         limit:queryLimit];     NSLog(@"print to avoid warning %@", query); }  - (void) dontTestDocsOnly_QuerySyntaxN1QL {     // Documentation Only query-syntax-n1ql     NSError *error;      NSString *queryString = @"SELECT * FROM _ WHERE type = \"hotel\""; <i class="conum" data-value="35"></i><b>(35)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryResultSet *results = [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  - (void) dontTestDocsOnly_QuerySyntaxN1QLParams {     // Documentation Only query-syntax-n1ql-params     NSError *error;      NSString *queryString = [NSString stringWithFormat:@"SELECT * FROM _ WHERE type = $type"]; <i class="conum" data-value="36"></i><b>(36)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryParameters *params = [[CBLQueryParameters alloc] init];     [params setString:@"hotel" forName:@"type"]; <i class="conum" data-value="37"></i><b>(37)</b>     query.parameters = params;      CBLQueryResultSet *results =  [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  #pragma mark - PEER-to-PEER  - (void) dontTestListenerSimple {     NSError *error = nil;      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database]; <i class="conum" data-value="38"></i><b>(38)</b>      config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                                 initWithBlock:^BOOL(NSString  *validUser, NSString  *validPassword) {         return [self isValidCredentials:validUser password:validPassword];     }]; <i class="conum" data-value="39"></i><b>(39)</b>      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="40"></i><b>(40)</b>      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } <i class="conum" data-value="41"></i><b>(41)</b>  }  - (void) dontTestReplicatorSimple {     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="42"></i><b>(42)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:endpoint]; <i class="conum" data-value="43"></i><b>(43)</b>      config.acceptOnlySelfSignedServerCertificate = YES; // &lt;.&gt; //FIXME: Remove this from doc!      config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"valid.user"                                                                   password:@"valid.password.string"]; <i class="conum" data-value="44"></i><b>(44)</b>       self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="45"></i><b>(45)</b>      [self.replicator start]; <i class="conum" data-value="46"></i><b>(46)</b>  }  - (void) dontTestP2PURLEndpointListener {     // FIXME: can we use the docsn site to show the interface of the Listener class?     // <a href="https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html" class="bare">https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html</a> }  - (void) dontTestURLEndpointListenerConstructor {     NSUInteger wssPort = 4985;     NSUInteger wsPort = 4984;     BOOL isTLS = NO;     CBLListenerPasswordAuthenticator *auth = [[CBLListenerPasswordAuthenticator alloc]                                               initWithBlock:^BOOL(NSString *username, NSString *password) {         return YES;     }];      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.otherDB];     config.port = isTLS ? wssPort :wsPort;     config.disableTLS = !isTLS;     config.authenticator = auth;      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="1"></i><b>(1)</b> }  - (void) dontTestMyActivePeer {     NSError *error = nil;     self.database = [[CBLDatabase alloc] initWithName:@"database" error:&amp;error];     if (!self.database) {         NSLog(@"Cannot open the database:%@", error);     };      // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="47"></i><b>(47)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:endpoint]; <i class="conum" data-value="48"></i><b>(48)</b>      config.replicatorType = kCBLReplicatorTypePush;      // set auto-purge behavior (here we override default)     config.enableAutoPurge = NO; <i class="conum" data-value="49"></i><b>(49)</b>      config.continuous = YES;      // Configure Server Authentication     // Here - expect and accept self-signed certs     config.acceptOnlySelfSignedServerCertificate = YES; <i class="conum" data-value="50"></i><b>(50)</b>      // Configure Client Authentication     // Here set client to use basic authentication     // Providing username and password credentials     // If prompted for them by server     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"Our Username" password:@"Our Password"]; <i class="conum" data-value="51"></i><b>(51)</b>      /</strong> Optionally set custom conflict resolver call back <strong>/     config.conflictResolver = [[LocalWinConflictResolver alloc] init]; <i class="conum" data-value="52"></i><b>(52)</b>      // Apply configuration settings to the replicator     self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="53"></i><b>(53)</b>      // Optionally add a change listener <i class="conum" data-value="54"></i><b>(54)</b>     // Retain token for use in deletion     id&lt;CBLListenerToken&gt; listenerToken = [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.activity == kCBLReplicatorStopped) {             NSLog(@"Replication stopped");         } else {             NSLog(@"Status:%d", change.status.activity);         };     }];     // Run the replicator using the config settings     [self.replicator start]; <i class="conum" data-value="55"></i><b>(55)</b>       NSLog(@"print to avoid warning %@", listenerToken); }  - (void) dontTestReplicatorStop {     id&lt;CBLListenerToken&gt; listenerToken;      // Remove the change listener     [self.replicator removeChangeListenerWithToken:listenerToken];      // Stop the replicator     [self.replicator stop];  }  // Additional Snippets from above  - (void) dontTestReplicatorConfigCerts {     CBLReplicatorConfiguration *config;     SecCertificateRef cert;     // Configure Server Security -- only accept CA Certs     config.acceptOnlySelfSignedServerCertificate = NO; <i class="conum" data-value="56"></i><b>(56)</b>        // Return the remote pinned cert (the listener's cert)     config.pinnedServerCertificate = cert; // Get listener cert if pinned   }  - (void) dontTestCACertPinned {     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      config.acceptOnlySelfSignedServerCertificate=false;   }  #pragma mark - Listener  - (void) dontTestListener {     NSError *error = nil;      // Initialize the listener config <i class="conum" data-value="57"></i><b>(57)</b>     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];      config.port =  55990; <i class="conum" data-value="58"></i><b>(58)</b>      config.networkInterface = @"10.1.1.10"; <i class="conum" data-value="59"></i><b>(59)</b>      config.enableDeltaSync = true; <i class="conum" data-value="60"></i><b>(60)</b>      // Configure server security     config.disableTLS  = false; <i class="conum" data-value="61"></i><b>(61)</b>       // Use an anonymous self-signed cert     config.tlsIdentity = nil; <i class="conum" data-value="62"></i><b>(62)</b>      // Configure Client Security using an Authenticator     // For example, Basic Authentication <i class="conum" data-value="63"></i><b>(63)</b>     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL(NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      // Initialize the listener <i class="conum" data-value="64"></i><b>(64)</b>     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      // start the listener <i class="conum" data-value="65"></i><b>(65)</b>     BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     }       [self.listener stop];  }  - (void) dontTestListenerGetNetworkInterfaces {     // . . .  code snippet to be provided  }  - (void) dontTestListenerGetURLList {     NSError *error = nil;     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      [self.listener startWithError:&amp;error];      NSLog(@"%@", self.listener.urls);  }  - (void) dontTestlistenerConfigClientAuth {     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];     // EXAMPLE 8     // Configure the client authenticator     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="66"></i><b>(66)</b>     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]];  <i class="conum" data-value="67"></i><b>(67)</b> <i class="conum" data-value="68"></i><b>(68)</b>  }  - (void) dontTestListenerLocalDB {     NSError *error = nil;     SecCertificateRef cert;     // . . . preceding application logic . . .     // FIXME: anything??     // Include websockets listener initializer code      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     // Configure server authentication     config.disableTLS  = true; <i class="conum" data-value="69"></i><b>(69)</b>       // EXAMPLE 6     // Use CA Cert     // Create a TLSIdentity from a key-pair and     // certificate in secure storage     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="70"></i><b>(70)</b>      NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     CBLTLSIdentity *tlsIdentity = [CBLTLSIdentity importIdentityWithData:data                                                                 password:@"123"                                                                    label:@"couchbase-docs-cert"                                                                    error:&amp;error]; <i class="conum" data-value="71"></i><b>(71)</b>      config.tlsIdentity = tlsIdentity; <i class="conum" data-value="72"></i><b>(72)</b>      // Use a self-signed certificate     NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" }; <i class="conum" data-value="73"></i><b>(73)</b>      tlsIdentity = [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/                                                attributes:attrs                                                expiration:[NSDate dateWithTimeIntervalSinceNow:86400]                                                     label:@"couchbase-docs-cert"                                                     error:&amp;error]; <i class="conum" data-value="74"></i><b>(74)</b>      // set the TLS Identity     config.tlsIdentity = tlsIdentity; <i class="conum" data-value="75"></i><b>(75)</b>        // Authenticate self-signed cert     // using application logic     CBLListenerCertificateAuthenticator *authenticator = [[CBLListenerCertificateAuthenticator alloc]                                                           initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  <i class="conum" data-value="76"></i><b>(76)</b>      config.authenticator = authenticator; <i class="conum" data-value="77"></i><b>(77)</b>        config.disableTLS  = YES;       config.tlsIdentity = nil;        config.enableDeltaSync = YES;        NSUInteger totalConnections = self.listener.status.connectionCount;     NSUInteger activeConnections = self.listener.status.activeConnectionCount;      NSLog(@"Connection status = %lu/%lu", activeConnections,totalConnections);       // cert is a pre-populated object of type:SecCertificate representing a certificate     CFDataRef rootCertData = SecCertificateCopyData(cert);     CFAutorelease(rootCertData);     SecCertificateRef rootCert = SecCertificateCreateWithData(NULL, rootCertData);      // Listener:     config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCert)]];       config.authenticator = [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  }  #pragma mark - JSON API  - (void) dontTestToJSONBlob {     // Example 2. Using Blobs      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     CBLBlob *blob = [doc blobForKey:@"avatar"];     NSString *json = [blob toJSON];     NSLog(@"json string is %@", json);  }  - (void) dontTestDictionaryAsJSON {     NSError *error = nil;     // Example 6. Dictionaries as JSON strings     NSString *aJSONstring = @"{\"id\":\"1002\",\"type\":\"hotel\",\"name\":\"Hotel Ned\","     "\"city\":\"Balmain\",\"country\":\"Australia\",\"description\":\"Undefined description for Hotel Ned\"}";       CBLMutableDictionary *myDict = [[CBLMutableDictionary alloc] initWithJSON:aJSONstring                                                                         error:&amp;error];      NSString *name = [myDict stringForKey:@"name"];      for (NSString *key in myDict) {         NSLog(@"%@ %@", key, [myDict valueForKey:key]);     }      NSLog(@"%@", name); }  - (void) dontTestToJSONDocument {     // Example 7. Documents as JSON strings      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     NSString *json = [doc toJSON];     NSLog(@"json %@", json);  }  - (void) dontTestJSONAsArray {     NSError *error = nil;     NSString *json = @"[\"1000\",\"1001\",\"1002\",\"1003\"]";      CBLMutableArray *myArray = [[CBLMutableArray alloc] initWithJSON:json error:&amp;error];      for (NSString *item in myArray) {         NSLog(@"%@", item);     }  }  #pragma mark - SGW - (void) dontTestSGWActiveReplicatorInitialize {     // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://10.0.2.2.com:55990/travel-sample"];     CBLURLEndpoint *listener = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:listener]; <i class="conum" data-value="78"></i><b>(78)</b>      // END -- snippets --     NSLog(@"print to aviod warning %@", config.description); }  @end  #pragma mark -  // Singleton Pattern // &lt;doc&gt; @interface DataManager :NSObject  @property (nonatomic, readonly) CBLDatabase *database;  + (id)sharedInstance;  @end  @implementation DataManager  @synthesize database=_database;  + (id)sharedInstance {     static DataManager *sharedInstance = nil;     static dispatch_once_t onceToken;     dispatch_once(&amp;onceToken, ^{         sharedInstance = [[self alloc] init];     });     return sharedInstance; }  - (id)init {     if (self = [super init]) {         NSError *error;         _database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];         if (!_database) {             NSLog(@"Cannot open the database:%@", error);             return nil;         }     }     return self; }  @end // &lt;doc&gt;  // Peer-to-Peer Sample  /</strong> ----------------------------------------------------------- <strong>/ /</strong> ---------------------  ACTIVE SIDE  ----------------------- <strong>/ /</strong> ---------------  stubs for documentation  ----------------- <strong>/ /</strong> ----------------------------------------------------------- <strong>/ @interface ActivePeer:NSObject &lt;CBLMessageEndpointDelegate&gt;  @end  @interface ActivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt; - (void)disconnect; - (void)receive:(NSData</strong>)data; @end  @implementation ActivePeer  - (instancetype) init {     self = [super init];     if (self) {         NSError <strong>error = nil;         CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];          // The delegate must implement the <code>CBLMessageEndpointDelegate</code> protocol.         NSString *id = @"";         CBLMessageEndpoint *endpoint = [[CBLMessageEndpoint alloc] initWithUID:@"UID:123"                                                                         target:id                                                                   protocolType:kCBLProtocolTypeMessageStream                                                                       delegate:self];          CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                               initWithDatabase:database target:endpoint];          // Create the replicator object.         CBLReplicator *replicator = [[CBLReplicator alloc] initWithConfig:config];         [replicator start];     }     return self; }  - (id&lt;CBLMessageEndpointConnection&gt;)createConnectionForEndpoint:(CBLMessageEndpoint *)endpoint {     return [[ActivePeerConnection alloc] init]; }  @end   @implementation ActivePeerConnection {     id &lt;CBLReplicatorConnection&gt; _replicatorConnection; }  - (void)disconnect {     [_replicatorConnection close:nil]; }  /</strong> implementation of CBLMessageEndpointConnection <strong>/ - (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullablecompletion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}

@end

/</strong> ----------------------------------------------------------- <strong>/
/</strong> ---------------------  PASSIVE SIDE  ---------------------- <strong>/
/</strong> ---------------  stubs for documentation  ----------------- <strong>/
/</strong> ----------------------------------------------------------- <strong>/
@interface PassivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt;
- (void)startListener;
- (void)stopListener;
- (void)disconnect;
- (void)receive:(NSData</strong>)data;
@end

@implementation PassivePeerConnection {
    CBLMessageEndpointListener <strong>_messageEndpointListener;
    id &lt;CBLReplicatorConnection&gt; _replicatorConnection;
}

- (void)startListener {
    NSError *error = nil;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];

    CBLMessageEndpointListenerConfiguration *config =
    [[CBLMessageEndpointListenerConfiguration alloc] initWithDatabase:database
                                                         protocolType:kCBLProtocolTypeMessageStream];
    _messageEndpointListener = [[CBLMessageEndpointListener alloc] initWithConfig:config];
}

- (void)stopListener {
    [_messageEndpointListener closeAll];
}

- (void)acceptConnection {
    PassivePeerConnection *connection = [[PassivePeerConnection alloc] init]; /</strong> implements CBLMessageEndpointConnection <strong>/
    [_messageEndpointListener accept:connection];
}

- (void)disconnect {
    [_replicatorConnection close:nil];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}
@end

#pragma mark - TLS Manage Functions

//
//  cMyGetCert.swift
//  doco-sync
//
//  Created by Ian Bridge on 20/06/2020.
//  Copyright  2020 Couchbase Inc. All rights reserved.
//

@interface MyGetCert1 :NSObject

- (CBLTLSIdentity</strong>) fMyGetCert;

@end

@implementation MyGetCert1

- (CBLTLSIdentity*) fMyGetCert {
    NSError <strong>error = nil;
    CBLReplicatorConfiguration *config; // FIXME: Are we sure? this is Replicator config?
    // Check if Id exists in keychain and if so, use it
    CBLTLSIdentity *identity = [CBLTLSIdentity identityWithLabel:@"doco-sync-server" error:&amp;error]; <i class="conum" data-value="79"></i><b>(79)</b>

    config.authenticator = [[CBLClientCertificateAuthenticator alloc] initWithIdentity:identity]; <i class="conum" data-value="80"></i><b>(80)</b>


    // CREATE IDENTITY FROM BUNDLED RESOURCE IF FOUND

    // Check for a resource bundle with required label to generate identity from
    // return nil identify if not found
    NSString *path = [[NSBundle mainBundle] pathForResource:@"doco-sync-server" ofType:@"p12"];
    NSData *data = [NSData dataWithContentsOfFile:path
                                              options:0
                                                error:&amp;error];
    if (!data)
        return nil;


    // Use SecPKCS12Import to import the contents (identities and certificates)
    // of the required resource bundle (PKCS #12 formatted blob).
    //
    // Set passphrase using kSecImportExportPassphrase.
    // This passphrase should correspond to what was specified when .p12 file was created
    CFArrayRef result = NULL;
    NSDictionary *options = @{ (id)kSecImportExportPassphrase:@"couchbase" };
    OSStatus status = SecPKCS12Import((</em>bridge CFDataRef)data, (<em>bridge CFDictionaryRef)options, &amp;result);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import data from provided with error :%d ", (int)status);
        return nil;
    }

    NSArray *importedItems = (NSArray</strong>)CFBridgingRelease(result);
    NSDictionary <strong>item = importedItems[0];

    // Get SecIdentityRef representing the item's id
    SecIdentityRef identityRef = (</em>bridge SecIdentityRef) item[(id)kSecImportItemIdentity];

    // Get Id's Private Key, return nil id if fails
    SecKeyRef privateKey;
    status = SecIdentityCopyPrivateKey(identityRef, &amp;privateKey);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import private key from provided with error :%d ", (int)status);
        return nil;
    }
    CFAutorelease(privateKey);

    // Get all relevant certs [SecCertificate] from the ID's cert chain using kSecImportItemCertChain
    NSArray *certChain = item[(id)kSecImportItemCertChain];

    // Return nil Id if errors in key or cert chain at this stage
    if (!certChain || !privateKey)
        return nil;


    // FIXME: Use the same tag as tag: [create-self-signed-cert]

    // RETURN A TLSIDENTITY FROM THE KEYCHAIN FOR USE IN CONFIGURING TLS COMMUNICATION
    return [CBLTLSIdentity identityWithIdentity:identityRef
                                          certs:@[certChain[1]]
                                          error:&amp;error];
}

- (void) dontTestDeleteTLSIdentityFromKeychain {
    NSError *error;

    [CBLTLSIdentity deleteIdentityWithLabel:@"doco-sync-server-1" error:&amp;error];

}

@end

#pragma mark - For replications

// BEGIN -- snippets --
//    Purpose -- code samples for use in replication topic

@interface MyClass :NSObject
@property (nonatomic) CBLDatabase *database;
@property (nonatomic) CBLReplicator *replicator; <i class="conum" data-value="1"></i><b>(1)</b>
@end

@implementation MyClass
@synthesize database=_database;
@synthesize replicator=_replicator;

- (void) startReplication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"]; <i class="conum" data-value="2"></i><b>(2)</b>
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:_database
                                                                                       target:target];
    config.replicatorType = kCBLReplicatorTypePull;
    _replicator = [[CBLReplicator alloc] initWithConfig:config];
    [_replicator start];
}
@end


/</strong>
&lt;1&gt; A replication is an asynchronous operation.
To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
&lt;2&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.


 */</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>+
See: <a href="database.html" class="page">Databases</a> for more information</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize a new mutable document</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">//
//  SampleCodeTest.m
//  CouchbaseLite
//
//  Copyright (c) 2018 Couchbase, Inc All rights reserved.
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//  <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//

#import &lt;UIKit/UIKit.h&gt;
#import &lt;CouchbaseLite/CouchbaseLite.h&gt;
#import &lt;CoreML/CoreML.h&gt;


#pragma mark - !!!Note
/<strong>*
 Note for Consistency across the code snippets:

 1. We will keep the '</strong>' with instance after the space.
    <code>NSDictionary <strong>dict = [NSDictionary dictionary];</code>

 2. For making more space in single line, we will avoid space after the ':' in function call.
    <code>[myMLModel predictImage:imageData];</code>

 3. Will only keep <code>self.database</code> when using database, query and replicator related code snippet.
    Except when creating a new database sample.

 4. Will only keep <code>self.otherDB</code> when using listener-db

 5. While using replicator/listener, we will use as ivar <code>self.replicator</code> and <code>self.listener</code> resp.
 */

#pragma mark -

// <code>myMLModel</code> is a fake implementation
// this would be the implementation of the ml model you have chosen
@interface myMLModel :NSObject

+ (NSDictionary</strong>)predictImage:(NSData*)data;

@end

@interface ImageClassifierModel :NSObject &lt;CBLPredictiveModel&gt;

- (nullable CBLDictionary*) predict:(CBLDictionary*)input;

@end

@implementation ImageClassifierModel

- (nullable CBLDictionary*) predict:(CBLDictionary*)input; {
    CBLBlob <strong>blob = [input blobForKey:@"photo"];

    NSData *imageData = blob.content;
    // <code>myMLModel</code> is a fake implementation
    // this would be the implementation of the ml model you have chosen
    NSDictionary *modelOutput = [myMLModel predictImage:imageData];

    CBLMutableDictionary *output = [[CBLMutableDictionary alloc] initWithData:modelOutput];
    return output; <i class="conum" data-value="1"></i><b>(1)</b>
}

@end

// to avoid link error
@implementation myMLModel
+ (NSDictionary</strong>)predictImage:(NSData*)data { return [NSDictionary dictionary]; }
@end

@interface LogTestLogger :NSObject&lt;CBLLogger&gt;

// set the log level
@property (nonatomic) CBLLogLevel level;

@end

@implementation LogTestLogger

@synthesize level=_level;

- (void) logWithLevel:(CBLLogLevel)level domain:(CBLLogDomain)domain message:(NSString*)message {
    // handle the message, for example piping it to
    // a third party framework
}

@end


@interface LocalWinConflictResolver :NSObject&lt;CBLConflictResolver&gt;
@end

@implementation LocalWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.localDocument;
}

@end

@interface RemoteWinConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation RemoteWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.remoteDocument;
}

@end


@interface MergeConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation MergeConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    NSDictionary <strong>localDict = conflict.localDocument.toDictionary;
    NSDictionary *remoteDict = conflict.remoteDocument.toDictionary;

    NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:localDict];
    [result addEntriesFromDictionary:remoteDict];

    return [[CBLMutableDocument alloc] initWithID:conflict.documentID
                                             data:result];
}

@end

@interface Hotel :NSObject
@property (nonatomic) NSString *id;
@property (nonatomic) NSString *name;
@property (nonatomic) NSString *city;
@property (nonatomic) NSString *country;
@property (nonatomic) NSString *descriptive;
@end

@implementation Hotel
@synthesize id, name, city, country, descriptive;
@end

@interface SampleCodeTest :NSObject
@property(nonatomic) CBLDatabase *database;
@property(nonatomic) CBLDatabase *otherDB;
@property(nonatomic) CBLURLEndpointListener *listener;
@property(nonatomic) CBLReplicator *replicator;
@end

@implementation SampleCodeTest

#pragma mark - Database

- (void) dontTestNewDatabase {
    NSError *error;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"my-database" error:&amp;error];
    if (!database) {
        NSLog(@"Cannot open the database:%@", error);
    }
    self.database = database;

    if (![self.database close:&amp;error])
        NSLog(@"Error closing db:%@", error);

}

- (void) dontTestLogging {

    // Replicator / Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Query /  Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainQuery;
}

#if COUCHBASE_ENTERPRISE
- (void) dontTestDatabaseEncryption {
    CBLDatabaseConfiguration *config = [[CBLDatabaseConfiguration alloc] init];
    config.encryptionKey = [[CBLEncryptionKey alloc] initWithPassword:@"secretpassword"];

    NSError *error;
    self.database = [[CBLDatabase alloc] initWithName:@"my-database" config:config error:&amp;error];
    if (!self.database) {
        NSLog(@"Cannot open the database:%@", error);
    }
}
#endif

- (void) dontTestEnableConsoleLogging {
    CBLDatabase.log.console.domains = kCBLLogDomainAll; <i class="conum" data-value="1"></i><b>(1)</b>
    CBLDatabase.log.console.level = kCBLLogLevelVerbose; <i class="conum" data-value="2"></i><b>(2)</b>


    CBLDatabase.log.console.domains = kCBLLogDomainAll;

}

- (void) dontTestFileLogging {
    NSString *tempFolder = [NSTemporaryDirectory() stringByAppendingPathComponent:@"cbllog"];
    CBLLogFileConfiguration *config = [[CBLLogFileConfiguration alloc] initWithDirectory:tempFolder]; <i class="conum" data-value="3"></i><b>(3)</b>
    config.maxRotateCount = 2; <i class="conum" data-value="4"></i><b>(4)</b>
    config.maxSize = 1024; <i class="conum" data-value="5"></i><b>(5)</b>
    config.usePlainText = YES; <i class="conum" data-value="6"></i><b>(6)</b>
    [CBLDatabase.log.file setConfig:config];
    [CBLDatabase.log.file setLevel:kCBLLogLevelInfo]; <i class="conum" data-value="7"></i><b>(7)</b>
}

- (void) dontTestEnableCustomLogging {
    LogTestLogger *logger = [[LogTestLogger alloc] init];
    logger.level = kCBLLogLevelWarning;
    [CBLDatabase.log setCustom:logger];

}

- (void) dontTestLoadingPrebuilt {
    // Note:Getting the path to a database is platform-specific.
    // For iOS you need to get the path from the main bundle.
    if (![CBLDatabase databaseExists:@"travel-sample" inDirectory:nil]) {
        NSError *error;
        NSString *path = [[NSBundle bundleForClass:[self class]] pathForResource:@"travel-sample" ofType:@"cblite2"];
        if (![CBLDatabase copyFromPath:path toDatabase:@"travel-sample" withConfig:nil error:&amp;error]) {
            [NSException raise:NSInternalInconsistencyException
                        format:@"Could not load pre-built database:%@", error];
        }
    }
}

#pragma mark - Document

- (void) dontTestInitializer {
    NSError *error;

    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];
    [newTask setString:@"task" forKey:@"task"];
    [newTask setString:@"todo" forKey:@"owner"];
    [newTask setString:@"task" forKey:@"createdAt"];
    [self.database saveDocument:newTask error:&amp;error];
}

- (void) dontTestMutability {
    NSError *error;

    CBLDocument *document = [self.database documentWithID:@"xyz"];
    CBLMutableDocument *mutableDocument = [document toMutable];
    [mutableDocument setString:@"apples" forKey:@"name"];
    [self.database saveDocument:mutableDocument error:&amp;error];
}

- (void) dontTestTypedAcessors {
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];

    [newTask setValue:[NSDate date] forKey:@"createdAt"];
    NSDate *date = [newTask dateForKey:@"createdAt"];

    NSLog(@"Date:%@", date);
}

- (void) dontTestDataTypeDictionary {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting a dictionary value from the document
    CBLDictionary *dict = [document dictionaryForKey:@"address"];
    
    // Access a value from the dictionary
    NSString *street = [dict stringForKey:@"street"];
    NSLog(@"Street:: %@", street);
    
    // Iterate dictionary
    for (NSString *key in dict) {
        id value = [dict valueForKey:key];
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableDictionary *mutableDict = [dict toMutable];
    [mutableDict setString:@"1 Great sts" forKey:@"street"];
}

- (void) dontTestDataTypeMutableDictionary {
    
    // Create a new mutable dictionary and populate some keys/values
    CBLMutableDictionary *dict = [[CBLMutableDictionary alloc] init];
    [dict setString:@"1 Main st" forKey:@"street"];
    [dict setString:@"San Francisco" forKey:@"city"];
    
    // Set the dictionary to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setDictionary:dict forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestDataTypeArray {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting an array value from the document
    CBLArray *array = [document arrayForKey:@"phones"];
    
    // Get element count
    NSUInteger count = array.count;
    NSLog(@"Count:: %lu", (unsigned long)count);
    
    // Access an array element by index
    if (count &gt; 0) {
        id value = [array valueAtIndex:0];
        NSLog(@"Value:: %@", value);
    }
    
    // Iterate the array
    for (id value in array) {
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableArray *mutableArray = [array toMutable];
    [mutableArray addString:@"650-000-0002"];
}

- (void) dontTestDataTypeMutableArray {
    // Create a new mutable array and populate data into the array
    CBLMutableArray *array = [[CBLMutableArray alloc] init];
    [array addString:@"650-000-0000"];
    [array addString:@"650-000-0001"];
    
    // Set the array to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setArray:array forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestBatchOperations {
    NSError *error;

    [self.database inBatch:&amp;error usingBlock:^{
        for (int i = 0; i &lt; 10; i++) {
            CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
            [doc setValue:@"user" forKey:@"type"];
            [doc setValue:[NSString stringWithFormat:@"user %d", i] forKey:@"name"];
            [doc setBoolean:NO forKey:@"admin"];

            NSError *err = nil;
            [self.database saveDocument:doc error:&amp;err];
        }
    }];
}

- (void) dontTestChangeListener {
    <em>block SampleCodeTest *wSelf = self;
    [self.database addDocumentChangeListenerWithID:@"user.john" listener:^(CBLDocumentChange  *change) {
        CBLDocument *document = [wSelf.database documentWithID:change.documentID];
        NSLog(@"Status ::%@)", [document stringForKey:@"verified_account"]);
    }];
}

- (void) dontTestDocumentExpiration {
    NSError *error;

    // Purge the document one day from now
    NSDate *ttl = [[NSCalendar currentCalendar] dateByAddingUnit:NSCalendarUnitDay
                                                           value:1
                                                          toDate:[NSDate date]
                                                         options:0];
    [self.database setDocumentExpirationWithID:@"doc123" expiration:ttl error:&amp;error];

    // Reset expiration
    [self.database setDocumentExpirationWithID:@"doc1" expiration:nil error:&amp;error];

    // Query documents that will be expired in less than five minutes
    NSTimeInterval fiveMinutesFromNow = [[NSDate dateWithTimeIntervalSinceNow:60 * 5] timeIntervalSince1970];
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryMeta expiration]
                                                lessThan:[CBLQueryExpression double:fiveMinutesFromNow]]];
    NSLog(@"%@", query);
}

- (void) dontTestBlob {
#if TARGET_OS_IPHONE
    NSError *error;
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] initWithID:@"task1"];

    UIImage *appleImage = [UIImage imageNamed:@"avatar.jpg"];
    NSData *imageData = UIImageJPEGRepresentation(appleImage, 1.0);  <i class="conum" data-value="8"></i><b>(8)</b>

    CBLBlob *blob = [[CBLBlob alloc] initWithContentType:@"image/jpeg" data:imageData];  <i class="conum" data-value="9"></i><b>(9)</b>
    [newTask setBlob:blob forKey:@"avatar"]; <i class="conum" data-value="10"></i><b>(10)</b>
    [self.database saveDocument:newTask error:&amp;error];

    CBLDocument *savedTask = [self.database documentWithID:@"task1"];
    CBLBlob *taskBlob = [savedTask blobForKey:@"avatar"];
    UIImage *taskImage = [UIImage imageWithData:taskBlob.content];

    NSLog(@"%@", taskImage);
#endif
}

- (void) dontTest1xAttachment {
    CBLMutableDocument *document = [[CBLMutableDocument alloc] initWithID:@"task1"];

    CBLDictionary *attachments = [document dictionaryForKey:@"_attachments"];
    CBLBlob *avatar = [attachments blobForKey:@"avatar"];
    NSData *content = [avatar content];

    NSLog(@"%@", content);
}

#pragma mark - Query

- (void) dontTestIndexing {
    NSError *error;


    CBLValueIndexConfiguration</strong> config =
                [[CBLValueIndexConfiguration alloc]
                    initWithExpression: @[@"type", @"name"]];

    [self.database createIndexWithConfig: config name: @"TypeNameIndex" error: &amp;error];


}

- (void) dontTestIndexing_Querybuilder {
    NSError <strong>error;

    CBLValueIndexItem *type = [CBLValueIndexItem property:@"type"];
    CBLValueIndexItem *name = [CBLValueIndexItem property:@"name"];
    CBLIndex *index = [CBLIndexBuilder valueIndexWithItems:@[type, name]];
    [self.database createIndex:index withName:@"TypeNameIndex" error:&amp;error];
}



- (void) dontTestSelect {
    NSError *error;
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression value:@"user"]] andExpression:
                                               [[CBLQueryExpression property:@"admin"] equalTo:[CBLQueryExpression boolean:NO]]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"user name ::%@", [result stringAtIndex:0]);
    }
}

- (void) dontTestSelectProps {
    NSError *error;
    CBLQuerySelectResult *metaId = [CBLQuerySelectResult expression: CBLQueryMeta.id as:@"id"];
    CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[metaId, type, name]
                                         from:[CBLQueryDataSource database:self.database]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id :: %@", [result stringForKey:@"id"]);
        NSLog(@"document name :: %@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestSelectAll {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]];

    NSLog(@"%@", query);
}

- (void) dontTestLiveQuery {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]]; <i class="conum" data-value="11"></i><b>(11)</b>

    // Adds a query change listener.
    // Changes will be posted on the main queue.
    id&lt;CBLListenerToken&gt; token = [query addChangeListener:^(CBLQueryChange  *change) { <i class="conum" data-value="12"></i><b>(12)</b>
        for (CBLQueryResultSet *results in [change results]) {
            NSLog(@"%@", results);
            /</strong> Update UI <strong>/
        }
    }]; <i class="conum" data-value="13"></i><b>(13)</b>


    [query removeChangeListenerWithToken:token]; <i class="conum" data-value="14"></i><b>(14)</b>
}

- (void) dontTestWhere {
    NSError *error;
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:[CBLQueryLimit limit:[CBLQueryExpression integer:10]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        CBLDictionary *dict = [result valueForKey:@"travel-sample"];
        NSLog(@"document name ::%@", [dict stringForKey:@"name"]);
    }

    NSLog(@"%@", query);
}

- (void) dontTestQueryDeletedDocuments {
    // Query documents that have been deleted
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:CBLQueryMeta.id]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:CBLQueryMeta.isDeleted];
    NSLog(@"%@", query);
}

- (void) dontTestCollectionOperatorContains {
    NSError *error;

    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuerySelectResult *likes = [CBLQuerySelectResult property:@"public_likes"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]];
    CBLQueryExpression *contains = [CBLQueryArrayFunction contains:[CBLQueryExpression property:@"public_likes"]
                                                             value:[CBLQueryExpression string:@"Armani Langworth"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name, likes]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:contains]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"public_likes ::%@", [[result arrayForKey:@"public_likes"] toArray]);
    }
}

- (void) dontTestCollectionOperatorIn {
    NSArray *values = @[[CBLQueryExpression property:@"first"],
                       [CBLQueryExpression property:@"last"],
                       [CBLQueryExpression property:@"username"]];

    [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                       from:[CBLQueryDataSource database:self.database]
                      where:[[CBLQueryExpression string:@"Armani"] in:values]];
}

- (void) dontTestLikeOperator {
    NSError *error;
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"royal engineers museum"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"name property ::%@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestWildCardMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"eng%e%"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestWildCardCharacterMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryExpression property:@"name"] like:[CBLQueryExpression string:@"eng</em><em>r"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestRegexMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *regex = [[CBLQueryExpression property:@"name"] regex:[CBLQueryExpression string:@"\\bEng.*e\\b"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:regex]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestJoin {
    CBLQuerySelectResult *name = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"name" from:@"airline"]];
    CBLQuerySelectResult *callsign = [CBLQuerySelectResult
                                      expression:[CBLQueryExpression property:@"callsign" from:@"airline"]];
    CBLQuerySelectResult *dest = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"destinationairport" from:@"route"]];
    CBLQuerySelectResult *stops = [CBLQuerySelectResult
                                   expression:[CBLQueryExpression property:@"stops" from:@"route"]];
    CBLQuerySelectResult *airline = [CBLQuerySelectResult
                                     expression:[CBLQueryExpression property:@"airline" from:@"route"]];

    CBLQueryJoin *join = [CBLQueryJoin join:[CBLQueryDataSource database:self.database
                                                                      as:@"route"]
                                         on:[[CBLQueryMeta idFrom:@"airline"]
                                             equalTo:[CBLQueryExpression property:@"airlineid"
                                                                             from:@"route"]]];

    CBLQueryExpression *typeRoute = [[CBLQueryExpression property:@"type" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"route"]];
    CBLQueryExpression *typeAirline = [[CBLQueryExpression property:@"type" from:@"airline"]
                                       equalTo:[CBLQueryExpression string:@"airline"]];
    CBLQueryExpression *sourceRIX = [[CBLQueryExpression property:@"sourceairport" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"RIX"]];

    CBLQuery *query = [CBLQueryBuilder select:@[name, callsign, dest, stops, airline]
                                         from:[CBLQueryDataSource database:self.database as:@"airline"]
                                         join:@[join]
                                        where:[[typeRoute andExpression:typeAirline] andExpression:sourceRIX]];

    NSLog(@"%@", query);
}

- (void) dontTestGroupBy {
    CBLQuerySelectResult *count = [CBLQuerySelectResult expression:[CBLQueryFunction count:[CBLQueryExpression all]]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *tz = [CBLQuerySelectResult property:@"tz"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"airport"]];
    CBLQueryExpression *geoAlt = [[CBLQueryExpression property:@"geo.alt"] greaterThanOrEqualTo:[CBLQueryExpression integer:300]];

    CBLQuery *query = [CBLQueryBuilder select:@[count, country, tz]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:geoAlt]
                                      groupBy:@[[CBLQueryExpression property:@"country"],
                                                [CBLQueryExpression property:@"tz"]]];

    NSLog(@"%@", query);
}

- (void) dontTestOrderBy {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *title = [CBLQuerySelectResult property:@"title"];

    CBLQuery *query = [CBLQueryBuilder select:@[id, title]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      orderBy:@[[[CBLQueryOrdering property:@"title"] descending]]];

    NSLog(@"%@", query);
}


- (void) dontTestExplainAll {
    NSError *error;
    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[[CBLQueryExpression property:@"type"]
                   equalTo:[CBLQueryExpression string:@"university"]]
//            groupBy:@[[CBLQueryExpression property:@"country"]] <i class="conum" data-value="15"></i><b>(15)</b>
                          orderBy:@[[[CBLQueryOrdering property:@"title"] descending]] <i class="conum" data-value="16"></i><b>(16)</b>
       ];

    NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="17"></i><b>(17)</b>

}
- (void) dontTestExplainLike {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"%hotel%"]];
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];
      NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="18"></i><b>(18)</b>


}
- (void) dontTestExplainNoPfx {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"hotel%"]]; <i class="conum" data-value="19"></i><b>(19)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainFunction {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryFunction lower:[CBLQueryExpression property:@"type"]]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="20"></i><b>(20)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
                from:[CBLQueryDataSource database:self.database]
                where:[type andExpression:name]];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainNoFunction {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="21"></i><b>(21)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);


}



- (void) dontTestCreateFullTextIndex {
    NSError *error;

    // Insert documents
    NSArray *overviews = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *overview in overviews) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:overview forKey:@"overview"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndexConfiguration</strong> config =
        [[CBLFullTextIndexConfiguration alloc]
            initWithExpression: @[@"overview"]
            ignoreAccents: NO language: nil];

    [self.database createIndexWithConfig: config
            name: @"overviewFTSIndex" error: &amp;error];

}

- (void) dontTestFullTextSearch {
    NSError <strong>error;

    NSString *ftsQueryString =
    @"SELECT META().id FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)";

    CBLQueryResultSet *resultSet = [ftsQuery execute:&amp;error];
    NSArray</strong> results  = [resultSet allResults];
    for (CBLQueryResult <strong>result in results) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}




- (void) dontTestCreateFullTextIndex_Querybuilder {
    NSError *error;

    // Insert documents
    NSArray *tasks = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *task in tasks) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:task forKey:@"name"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndex *index = [CBLIndexBuilder fullTextIndexWithItems:@[[CBLFullTextIndexItem property:@"name"]]];
    index.ignoreAccents = NO;
    [self.database createIndex:index withName:@"nameFTSIndex" error:&amp;error];
}

- (void) dontTestFullTextSearch_Querybuilder {
    NSError *error;

    CBLQueryExpression *where = [CBLQueryFullTextFunction matchWithIndexName:@"nameFTSIndex"
                                                                       query:@"'buy'"];
    CBLQuery *query =
      [CBLQueryBuilder
        select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
        from:[CBLQueryDataSource database:self.database]
        where:where];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}









#pragma mark - Replication

/</strong> The <code>tag::replication[]</code> example is inlined in objc.adoc <strong>/

- (void) dontTestEnableReplicatorLogging {
    // Replicator
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Network
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainNetwork;
}

- (void) dontTestReplicationBasicAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicationSessionAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLSessionAuthenticator alloc] initWithSessionID:@"904ac010862f37c8dd99015a33ab5a3565fd8447"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicatorStatus {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    [self.replicator addChangeListener:^(CBLReplicatorChange *change) {
        if (change.status.activity == kCBLReplicatorStopped) {
            NSLog(@"Replication stopped");
        }
    }];
}


//  BEGIN PendingDocuments IB -- 11/Feb/21 --
- (void) testReplicationPendingDocs {

    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database
                                                                                       target:target];

    config.replicatorType = kCBLReplicatorTypePush;

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    // Get list of pending doc IDs
    NSError *err = nil;
    NSSet *pendingDocIds = [self.replicator pendingDocumentIDs:&amp;err]; <i class="conum" data-value="22"></i><b>(22)</b>


    if ([pendingDocIds count] &gt; 0) {

        NSLog(@"There are %lu documents pending", (unsigned long)[pendingDocIds count]);

        [self.replicator addChangeListener:^(CBLReplicatorChange *change) {

            NSLog(@"Replicator activity level is %u", change.status.activity);
            // iterate and report-on the pending doc IDs  in 'mydocids'
            for (NSString *docID in pendingDocIds) {

                NSError *err = nil;
                if (![change.replicator isDocumentPending:docID error:&amp;err]) { <i class="conum" data-value="23"></i><b>(23)</b>
                    NSLog(@"Doc ID %@ now pushed", docID);
                }
            }

        }];
        [self.replicator start];

    };

}
//  END PendingDocuments IB -- 11/Feb/21 --


- (void) dontTestReplicatorDocumentEvent {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    id token = [self.replicator addDocumentReplicationListener:^(CBLDocumentReplication  *replication) {
        NSLog(@"Replication type ::%@", replication.isPush ? @"Push" :@"Pull");
        for (CBLReplicatedDocument *document in replication.documents) {
            if (document.error == nil) {
                NSLog(@"Doc ID ::%@", document.id);
                if document.flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {                     NSLog(@"Successfully replicated a deleted document");                 }             } else {                 // There was an error             }         }     }];      [self.replicator start];      [self.replicator removeChangeListenerWithToken:token]; }  - (void) dontTestCustomReplicationHeader {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:endpoint];     config.headers = @{@"CustomHeaderName" :@"Value"}; }  - (void) dontTestHandlingReplicationError {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }]; }  - (void) dontTestReplicationResetCheckpoint {     BOOL restCheckpoint = NO;     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      if (restCheckpoint)         [self.replicator startWithReset:restCheckpoint]; <i class="conum" data-value="24"></i><b>(24)</b>  }  - (void) dontTestReplicationPushFilter {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pushFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ([[document stringForKey:@"type"] isEqualToString:@"draft"]) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestReplicationPullFilter {      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pullFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ((flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  //  Added 2/Feb/21 - Ian Bridge - (void) dontTestCustomRetryConfig {     id target = [[CBLURLEndpoint alloc] initWithURL:[NSURL URLWithString:@"ws://foo.cbl.com/db"]];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.replicatorType = kCBLReplicatorTypePush;     config.continuous = YES;     //  other config as required . . .      config.heartbeat = 150; <i class="conum" data-value="25"></i><b>(25)</b>      config.maxAttempts = 20; <i class="conum" data-value="26"></i><b>(26)</b>      config.maxAttemptWaitTime = 600; <i class="conum" data-value="27"></i><b>(27)</b>      //  other config as required . . .     self.replicator = [[CBLReplicator alloc] initWithConfig:config];  }   #ifdef COUCHBASE_ENTERPRISE - (void) dontTestDatabaseReplica {     /</strong> EE feature:code below might throw a compilation error      if it's compiled against CBL Swift Community. <strong>/     CBLDatabaseEndpoint *targetDatabase = [[CBLDatabaseEndpoint alloc] initWithDatabase:self.otherDB];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:targetDatabase];     config.replicatorType = kCBLReplicatorTypePush;      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; } #endif  - (void) dontTestCertificatePinning {     // Active - Example 4     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      NSLog(@"%@", config); }  - (NSData</strong>) dataFromResource:(NSString*)file ofType:(NSString*)type {     return [NSData data]; }  - (void) dontTestGettingStarted {     // Get the database (and create it if it doesnt exist).     NSError <strong>error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      // Create a new document (i.e. a record) in the database.     CBLMutableDocument *mutableDoc = [[CBLMutableDocument alloc] init];     [mutableDoc setFloat:2.0 forKey:@"version"];     [mutableDoc setString:@"SDK" forKey:@"type"];      // Save it to the database.     [self.database saveDocument:mutableDoc error:&amp;error];      // Update a document.     CBLMutableDocument *mutableDoc2 = [[self.database documentWithID:mutableDoc.id] toMutable];     [mutableDoc2 setString:@"Swift" forKey:@"language"];     [self.database saveDocument:mutableDoc2 error:&amp;error];      CBLDocument *document = [self.database documentWithID:mutableDoc2.id];     // Log the document ID (generated by the database)     // and properties     NSLog(@"Document ID ::%@", document.id);     NSLog(@"Learning %@", [document stringForKey:@"language"]);      // Create a query to fetch documents of type SDK.     CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"SDK"]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                           from:[CBLQueryDataSource database:self.database]                                          where:type];      // Run the query     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]);      // Create replicators to push and pull changes to and from the cloud.     NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *targetEndpoint = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                            target:targetEndpoint];     config.replicatorType = kCBLReplicatorTypePushAndPull;      // Add authentication.     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];      // Create replicator (make sure to add an ivar)     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      // Listen to replicator change events.     [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }];      // Start replication     [self.replicator start]; }  - (void) dontTestPredictiveModel {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      ImageClassifierModel *model = [[ImageClassifierModel alloc] init];     [[CBLDatabase prediction] registerModel:model withName:@"ImageClassifier"];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input];      CBLValueIndex *index = [CBLIndexBuilder valueIndexWithItems:@[[CBLValueIndexItem expression:[prediction property:@"label"]]]];     [self.database createIndex:index withName:@"value-index-image-classifier" error:&amp;error];      [[CBLDatabase prediction] unregisterModelWithName:@"ImageClassifier"]; }  - (void) dontTestPredictiveIndex {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];      CBLPredictiveIndex *index = [CBLIndexBuilder predictiveIndexWithModel:@"ImageClassifier" input:input properties:nil];     [self.database createIndex:index withName:@"predictive-index-image-classifier" error:&amp;error]; }  - (void) dontTestPredictiveQuery {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input]; <i class="conum" data-value="1"></i><b>(1)</b>      CBLQueryExpression *condition = [[[prediction property:@"label"] equalTo:[CBLQueryExpression string:@"car"]]                                      andExpression:[[prediction property:@"probablity"] greaterThanOrEqualTo:[CBLQueryExpression double:0.8]]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:condition];      // Run the query.     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]); }  - (void) dontTestCoreMLPredictiveModel {     NSError *error;      // Load MLModel from <code>ImageClassifier.mlmodel</code>     NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@"ImageClassifier" withExtension:@"mlmodel"];     NSURL *compiledModelURL = [MLModel compileModelAtURL:modelURL error:&amp;error];     MLModel *model = [MLModel modelWithContentsOfURL:compiledModelURL error:&amp;error];     CBLCoreMLPredictiveModel *predictiveModel = [[CBLCoreMLPredictiveModel alloc] initWithMLModel:model];      // Register model     [[CBLDatabase prediction] registerModel:predictiveModel withName:@"ImageClassifier"]; }  - (void) dontTestReplicatorConflictResolver {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.conflictResolver = [[LocalWinConflictResolver alloc] init];      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestSaveWithConflictHandler {     NSError *error;      CBLDocument *document = [self.database documentWithID:@"xyz"];     CBLMutableDocument *mutableDocument = [document toMutable];     [mutableDocument setString:@"apples" forKey:@"name"];      [self.database saveDocument:mutableDocument            conflictHandler:^BOOL(CBLMutableDocument *new, CBLDocument *current) {                NSDictionary *currentDict = current.toDictionary;                NSDictionary *newDict = new.toDictionary;                 NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:currentDict];                [result addEntriesFromDictionary:newDict];                [new setData:result];                return YES;            }                      error:&amp;error]; }  #pragma mark - URLListener  - (BOOL) isValidCredentials:(NSString</strong>)u password:(NSString*)p { return YES; } // helper - (BOOL) isValidCertificates:(NSArray*)certs { return YES; } // helper  - (void) dontTestInitListener {     CBLURLEndpointListenerConfiguration <strong>config;     config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.database];     config.tlsIdentity = nil; // Use with anonymous self signed cert     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL( NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; }  - (void) dontTestListenerStart {     NSError *error = nil;      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } }  - (void) dontTestListenerStop {     [self.listener stop]; }  - (void) dontTestCreateSelfSignedCert {     NSError *error = nil;     CBLTLSIdentity *identity = nil;     // &lt;site-rooot&gt;/objc/advance/objc-p2psync-websocket-using-passive.html     // Example-6      NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" };     identity =       [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/         attributes:attrs         expiration:[NSDate dateWithTimeIntervalSinceNow:86400]         label:@"Server-Cert-Label"         error:&amp;error]; }  - (void) dontTestListenerCertificateAuthenticatorRootCert {     CBLURLEndpointListenerConfiguration *config;      // Example 8-tab1      NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]]; }  - (void) dontTestListenerCertificateAuthenticatorCallback {     CBLURLEndpointListenerConfiguration *config;     // Example 8-tab2      CBLListenerCertificateAuthenticator *listenerAuth =     [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];      config.authenticator = listenerAuth; }  # pragma mark - QUERY RESULT SET HANDLING EXAMPLES  - (void) dontTestQuerySyntaxJson {     NSError *error;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                              from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="28"></i><b>(28)</b>        CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {          NSDictionary *data = [result valueAtIndex:0];          // Use dictionary values         NSLog(@"id = %@", [data valueForKey:@"id"]);         NSLog(@"name = %@", [data valueForKey:@"name"]);         NSLog(@"type = %@", [data valueForKey:@"type"]);         NSLog(@"city = %@", [data valueForKey:@"city"]);      } // end for       CBLQueryResultSet *rs = [query execute:&amp;error];     for (CBLQueryResult *result in rs) {          // Get result as a JSON string         NSString *json = [result toJSON]; <i class="conum" data-value="29"></i><b>(29)</b>          // Get an native Obj-C object from the Json String         NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:[json dataUsingEncoding:NSUTF8StringEncoding]                                                                          options:NSJSONReadingAllowFragments                                                                            error:&amp;error]; <i class="conum" data-value="30"></i><b>(30)</b>          // Log generated Json and Native objects         // For demo/example purposes         NSLog(@"Json String %@", json);         NSLog(@"Native Object %@", dict);      }; // end for   } // end function  - (void) dontTestQuerySyntaxAndAccessProps {     NSError *error = nil;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];      CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];      CBLQuerySelectResult *city = [CBLQuerySelectResult property:@"city"];      CBLQuery *query = [CBLQueryBuilder select:@[id, type, name, city]                                          from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="31"></i><b>(31)</b>       CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) { // all results         NSLog(@"id = %@", [result stringForKey:@"id"]);         NSLog(@"name = %@", [result stringForKey:@"name"]);         NSLog(@"type = %@", [result stringForKey:@"type"]);         NSLog(@"city = %@", [result stringForKey:@"city"]);      }  }  - (void) dontTestQuerySyntaxCount {     NSError *error = nil;     NSInteger count = 0;     CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQueryExpression *countExpression = [CBLQueryFunction count:[CBLQueryExpression all]];     CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:countExpression                                                                        as:@"myCount"];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]]; <i class="conum" data-value="32"></i><b>(32)</b>      CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {         count = [result integerForKey:@"myCount"]; <i class="conum" data-value="33"></i><b>(33)</b>      } // end for       NSLog(@"print to avoid warning %@ %ld", query, count); }  - (void) dontTestQuerySyntaxID {     NSError *error = nil;      CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]];      NSLog(@"print to avoid warning %@", query); }  - (void) dontTestQueryAccessID {     CBLQuery *query;     NSError *error = nil;      CBLQueryResultSet *results = [query execute:&amp;error];     CBLDocument *doc = nil;     NSString *docId = nil;     for (CBLQueryResult *result in results) {         docId = [result stringForKey:@"id"]; <i class="conum" data-value="34"></i><b>(34)</b>          // Now you can get the document using its ID         // for example using         doc = [self.database documentWithID:docId];      }      NSLog(@"doc.id = %@", doc.id); }  - (void) dontTestQuerySyntaxPagination {     int offset = 0;     int limit = 20;      CBLQueryLimit *queryLimit = [CBLQueryLimit limit:[CBLQueryExpression integer:limit]                                               offset:[CBLQueryExpression integer:offset]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:nil                                       groupBy:nil                                        having:nil                                       orderBy:nil                                         limit:queryLimit];     NSLog(@"print to avoid warning %@", query); }  - (void) dontTestDocsOnly_QuerySyntaxN1QL {     // Documentation Only query-syntax-n1ql     NSError *error;      NSString *queryString = @"SELECT * FROM _ WHERE type = \"hotel\""; <i class="conum" data-value="35"></i><b>(35)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryResultSet *results = [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  - (void) dontTestDocsOnly_QuerySyntaxN1QLParams {     // Documentation Only query-syntax-n1ql-params     NSError *error;      NSString *queryString = [NSString stringWithFormat:@"SELECT * FROM _ WHERE type = $type"]; <i class="conum" data-value="36"></i><b>(36)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryParameters *params = [[CBLQueryParameters alloc] init];     [params setString:@"hotel" forName:@"type"]; <i class="conum" data-value="37"></i><b>(37)</b>     query.parameters = params;      CBLQueryResultSet *results =  [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  #pragma mark - PEER-to-PEER  - (void) dontTestListenerSimple {     NSError *error = nil;      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database]; <i class="conum" data-value="38"></i><b>(38)</b>      config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                                 initWithBlock:^BOOL(NSString  *validUser, NSString  *validPassword) {         return [self isValidCredentials:validUser password:validPassword];     }]; <i class="conum" data-value="39"></i><b>(39)</b>      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="40"></i><b>(40)</b>      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } <i class="conum" data-value="41"></i><b>(41)</b>  }  - (void) dontTestReplicatorSimple {     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="42"></i><b>(42)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:endpoint]; <i class="conum" data-value="43"></i><b>(43)</b>      config.acceptOnlySelfSignedServerCertificate = YES; // &lt;.&gt; //FIXME: Remove this from doc!      config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"valid.user"                                                                   password:@"valid.password.string"]; <i class="conum" data-value="44"></i><b>(44)</b>       self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="45"></i><b>(45)</b>      [self.replicator start]; <i class="conum" data-value="46"></i><b>(46)</b>  }  - (void) dontTestP2PURLEndpointListener {     // FIXME: can we use the docsn site to show the interface of the Listener class?     // <a href="https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html" class="bare">https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html</a> }  - (void) dontTestURLEndpointListenerConstructor {     NSUInteger wssPort = 4985;     NSUInteger wsPort = 4984;     BOOL isTLS = NO;     CBLListenerPasswordAuthenticator *auth = [[CBLListenerPasswordAuthenticator alloc]                                               initWithBlock:^BOOL(NSString *username, NSString *password) {         return YES;     }];      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.otherDB];     config.port = isTLS ? wssPort :wsPort;     config.disableTLS = !isTLS;     config.authenticator = auth;      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="1"></i><b>(1)</b> }  - (void) dontTestMyActivePeer {     NSError *error = nil;     self.database = [[CBLDatabase alloc] initWithName:@"database" error:&amp;error];     if (!self.database) {         NSLog(@"Cannot open the database:%@", error);     };      // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="47"></i><b>(47)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:endpoint]; <i class="conum" data-value="48"></i><b>(48)</b>      config.replicatorType = kCBLReplicatorTypePush;      // set auto-purge behavior (here we override default)     config.enableAutoPurge = NO; <i class="conum" data-value="49"></i><b>(49)</b>      config.continuous = YES;      // Configure Server Authentication     // Here - expect and accept self-signed certs     config.acceptOnlySelfSignedServerCertificate = YES; <i class="conum" data-value="50"></i><b>(50)</b>      // Configure Client Authentication     // Here set client to use basic authentication     // Providing username and password credentials     // If prompted for them by server     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"Our Username" password:@"Our Password"]; <i class="conum" data-value="51"></i><b>(51)</b>      /</strong> Optionally set custom conflict resolver call back <strong>/     config.conflictResolver = [[LocalWinConflictResolver alloc] init]; <i class="conum" data-value="52"></i><b>(52)</b>      // Apply configuration settings to the replicator     self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="53"></i><b>(53)</b>      // Optionally add a change listener <i class="conum" data-value="54"></i><b>(54)</b>     // Retain token for use in deletion     id&lt;CBLListenerToken&gt; listenerToken = [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.activity == kCBLReplicatorStopped) {             NSLog(@"Replication stopped");         } else {             NSLog(@"Status:%d", change.status.activity);         };     }];     // Run the replicator using the config settings     [self.replicator start]; <i class="conum" data-value="55"></i><b>(55)</b>       NSLog(@"print to avoid warning %@", listenerToken); }  - (void) dontTestReplicatorStop {     id&lt;CBLListenerToken&gt; listenerToken;      // Remove the change listener     [self.replicator removeChangeListenerWithToken:listenerToken];      // Stop the replicator     [self.replicator stop];  }  // Additional Snippets from above  - (void) dontTestReplicatorConfigCerts {     CBLReplicatorConfiguration *config;     SecCertificateRef cert;     // Configure Server Security -- only accept CA Certs     config.acceptOnlySelfSignedServerCertificate = NO; <i class="conum" data-value="56"></i><b>(56)</b>        // Return the remote pinned cert (the listener's cert)     config.pinnedServerCertificate = cert; // Get listener cert if pinned   }  - (void) dontTestCACertPinned {     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      config.acceptOnlySelfSignedServerCertificate=false;   }  #pragma mark - Listener  - (void) dontTestListener {     NSError *error = nil;      // Initialize the listener config <i class="conum" data-value="57"></i><b>(57)</b>     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];      config.port =  55990; <i class="conum" data-value="58"></i><b>(58)</b>      config.networkInterface = @"10.1.1.10"; <i class="conum" data-value="59"></i><b>(59)</b>      config.enableDeltaSync = true; <i class="conum" data-value="60"></i><b>(60)</b>      // Configure server security     config.disableTLS  = false; <i class="conum" data-value="61"></i><b>(61)</b>       // Use an anonymous self-signed cert     config.tlsIdentity = nil; <i class="conum" data-value="62"></i><b>(62)</b>      // Configure Client Security using an Authenticator     // For example, Basic Authentication <i class="conum" data-value="63"></i><b>(63)</b>     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL(NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      // Initialize the listener <i class="conum" data-value="64"></i><b>(64)</b>     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      // start the listener <i class="conum" data-value="65"></i><b>(65)</b>     BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     }       [self.listener stop];  }  - (void) dontTestListenerGetNetworkInterfaces {     // . . .  code snippet to be provided  }  - (void) dontTestListenerGetURLList {     NSError *error = nil;     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      [self.listener startWithError:&amp;error];      NSLog(@"%@", self.listener.urls);  }  - (void) dontTestlistenerConfigClientAuth {     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];     // EXAMPLE 8     // Configure the client authenticator     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="66"></i><b>(66)</b>     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]];  <i class="conum" data-value="67"></i><b>(67)</b> <i class="conum" data-value="68"></i><b>(68)</b>  }  - (void) dontTestListenerLocalDB {     NSError *error = nil;     SecCertificateRef cert;     // . . . preceding application logic . . .     // FIXME: anything??     // Include websockets listener initializer code      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     // Configure server authentication     config.disableTLS  = true; <i class="conum" data-value="69"></i><b>(69)</b>       // EXAMPLE 6     // Use CA Cert     // Create a TLSIdentity from a key-pair and     // certificate in secure storage     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="70"></i><b>(70)</b>      NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     CBLTLSIdentity *tlsIdentity = [CBLTLSIdentity importIdentityWithData:data                                                                 password:@"123"                                                                    label:@"couchbase-docs-cert"                                                                    error:&amp;error]; <i class="conum" data-value="71"></i><b>(71)</b>      config.tlsIdentity = tlsIdentity; <i class="conum" data-value="72"></i><b>(72)</b>      // Use a self-signed certificate     NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" }; <i class="conum" data-value="73"></i><b>(73)</b>      tlsIdentity = [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/                                                attributes:attrs                                                expiration:[NSDate dateWithTimeIntervalSinceNow:86400]                                                     label:@"couchbase-docs-cert"                                                     error:&amp;error]; <i class="conum" data-value="74"></i><b>(74)</b>      // set the TLS Identity     config.tlsIdentity = tlsIdentity; <i class="conum" data-value="75"></i><b>(75)</b>        // Authenticate self-signed cert     // using application logic     CBLListenerCertificateAuthenticator *authenticator = [[CBLListenerCertificateAuthenticator alloc]                                                           initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  <i class="conum" data-value="76"></i><b>(76)</b>      config.authenticator = authenticator; <i class="conum" data-value="77"></i><b>(77)</b>        config.disableTLS  = YES;       config.tlsIdentity = nil;        config.enableDeltaSync = YES;        NSUInteger totalConnections = self.listener.status.connectionCount;     NSUInteger activeConnections = self.listener.status.activeConnectionCount;      NSLog(@"Connection status = %lu/%lu", activeConnections,totalConnections);       // cert is a pre-populated object of type:SecCertificate representing a certificate     CFDataRef rootCertData = SecCertificateCopyData(cert);     CFAutorelease(rootCertData);     SecCertificateRef rootCert = SecCertificateCreateWithData(NULL, rootCertData);      // Listener:     config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCert)]];       config.authenticator = [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  }  #pragma mark - JSON API  - (void) dontTestToJSONBlob {     // Example 2. Using Blobs      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     CBLBlob *blob = [doc blobForKey:@"avatar"];     NSString *json = [blob toJSON];     NSLog(@"json string is %@", json);  }  - (void) dontTestDictionaryAsJSON {     NSError *error = nil;     // Example 6. Dictionaries as JSON strings     NSString *aJSONstring = @"{\"id\":\"1002\",\"type\":\"hotel\",\"name\":\"Hotel Ned\","     "\"city\":\"Balmain\",\"country\":\"Australia\",\"description\":\"Undefined description for Hotel Ned\"}";       CBLMutableDictionary *myDict = [[CBLMutableDictionary alloc] initWithJSON:aJSONstring                                                                         error:&amp;error];      NSString *name = [myDict stringForKey:@"name"];      for (NSString *key in myDict) {         NSLog(@"%@ %@", key, [myDict valueForKey:key]);     }      NSLog(@"%@", name); }  - (void) dontTestToJSONDocument {     // Example 7. Documents as JSON strings      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     NSString *json = [doc toJSON];     NSLog(@"json %@", json);  }  - (void) dontTestJSONAsArray {     NSError *error = nil;     NSString *json = @"[\"1000\",\"1001\",\"1002\",\"1003\"]";      CBLMutableArray *myArray = [[CBLMutableArray alloc] initWithJSON:json error:&amp;error];      for (NSString *item in myArray) {         NSLog(@"%@", item);     }  }  #pragma mark - SGW - (void) dontTestSGWActiveReplicatorInitialize {     // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://10.0.2.2.com:55990/travel-sample"];     CBLURLEndpoint *listener = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:listener]; <i class="conum" data-value="78"></i><b>(78)</b>      // END -- snippets --     NSLog(@"print to aviod warning %@", config.description); }  @end  #pragma mark -  // Singleton Pattern // &lt;doc&gt; @interface DataManager :NSObject  @property (nonatomic, readonly) CBLDatabase *database;  + (id)sharedInstance;  @end  @implementation DataManager  @synthesize database=_database;  + (id)sharedInstance {     static DataManager *sharedInstance = nil;     static dispatch_once_t onceToken;     dispatch_once(&amp;onceToken, ^{         sharedInstance = [[self alloc] init];     });     return sharedInstance; }  - (id)init {     if (self = [super init]) {         NSError *error;         _database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];         if (!_database) {             NSLog(@"Cannot open the database:%@", error);             return nil;         }     }     return self; }  @end // &lt;doc&gt;  // Peer-to-Peer Sample  /</strong> ----------------------------------------------------------- <strong>/ /</strong> ---------------------  ACTIVE SIDE  ----------------------- <strong>/ /</strong> ---------------  stubs for documentation  ----------------- <strong>/ /</strong> ----------------------------------------------------------- <strong>/ @interface ActivePeer:NSObject &lt;CBLMessageEndpointDelegate&gt;  @end  @interface ActivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt; - (void)disconnect; - (void)receive:(NSData</strong>)data; @end  @implementation ActivePeer  - (instancetype) init {     self = [super init];     if (self) {         NSError <strong>error = nil;         CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];          // The delegate must implement the <code>CBLMessageEndpointDelegate</code> protocol.         NSString *id = @"";         CBLMessageEndpoint *endpoint = [[CBLMessageEndpoint alloc] initWithUID:@"UID:123"                                                                         target:id                                                                   protocolType:kCBLProtocolTypeMessageStream                                                                       delegate:self];          CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                               initWithDatabase:database target:endpoint];          // Create the replicator object.         CBLReplicator *replicator = [[CBLReplicator alloc] initWithConfig:config];         [replicator start];     }     return self; }  - (id&lt;CBLMessageEndpointConnection&gt;)createConnectionForEndpoint:(CBLMessageEndpoint *)endpoint {     return [[ActivePeerConnection alloc] init]; }  @end   @implementation ActivePeerConnection {     id &lt;CBLReplicatorConnection&gt; _replicatorConnection; }  - (void)disconnect {     [_replicatorConnection close:nil]; }  /</strong> implementation of CBLMessageEndpointConnection <strong>/ - (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullablecompletion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}

@end

/</strong> ----------------------------------------------------------- <strong>/
/</strong> ---------------------  PASSIVE SIDE  ---------------------- <strong>/
/</strong> ---------------  stubs for documentation  ----------------- <strong>/
/</strong> ----------------------------------------------------------- <strong>/
@interface PassivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt;
- (void)startListener;
- (void)stopListener;
- (void)disconnect;
- (void)receive:(NSData</strong>)data;
@end

@implementation PassivePeerConnection {
    CBLMessageEndpointListener <strong>_messageEndpointListener;
    id &lt;CBLReplicatorConnection&gt; _replicatorConnection;
}

- (void)startListener {
    NSError *error = nil;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];

    CBLMessageEndpointListenerConfiguration *config =
    [[CBLMessageEndpointListenerConfiguration alloc] initWithDatabase:database
                                                         protocolType:kCBLProtocolTypeMessageStream];
    _messageEndpointListener = [[CBLMessageEndpointListener alloc] initWithConfig:config];
}

- (void)stopListener {
    [_messageEndpointListener closeAll];
}

- (void)acceptConnection {
    PassivePeerConnection *connection = [[PassivePeerConnection alloc] init]; /</strong> implements CBLMessageEndpointConnection <strong>/
    [_messageEndpointListener accept:connection];
}

- (void)disconnect {
    [_replicatorConnection close:nil];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}
@end

#pragma mark - TLS Manage Functions

//
//  cMyGetCert.swift
//  doco-sync
//
//  Created by Ian Bridge on 20/06/2020.
//  Copyright  2020 Couchbase Inc. All rights reserved.
//

@interface MyGetCert1 :NSObject

- (CBLTLSIdentity</strong>) fMyGetCert;

@end

@implementation MyGetCert1

- (CBLTLSIdentity*) fMyGetCert {
    NSError <strong>error = nil;
    CBLReplicatorConfiguration *config; // FIXME: Are we sure? this is Replicator config?
    // Check if Id exists in keychain and if so, use it
    CBLTLSIdentity *identity = [CBLTLSIdentity identityWithLabel:@"doco-sync-server" error:&amp;error]; <i class="conum" data-value="79"></i><b>(79)</b>

    config.authenticator = [[CBLClientCertificateAuthenticator alloc] initWithIdentity:identity]; <i class="conum" data-value="80"></i><b>(80)</b>


    // CREATE IDENTITY FROM BUNDLED RESOURCE IF FOUND

    // Check for a resource bundle with required label to generate identity from
    // return nil identify if not found
    NSString *path = [[NSBundle mainBundle] pathForResource:@"doco-sync-server" ofType:@"p12"];
    NSData *data = [NSData dataWithContentsOfFile:path
                                              options:0
                                                error:&amp;error];
    if (!data)
        return nil;


    // Use SecPKCS12Import to import the contents (identities and certificates)
    // of the required resource bundle (PKCS #12 formatted blob).
    //
    // Set passphrase using kSecImportExportPassphrase.
    // This passphrase should correspond to what was specified when .p12 file was created
    CFArrayRef result = NULL;
    NSDictionary *options = @{ (id)kSecImportExportPassphrase:@"couchbase" };
    OSStatus status = SecPKCS12Import((</em>bridge CFDataRef)data, (<em>bridge CFDictionaryRef)options, &amp;result);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import data from provided with error :%d ", (int)status);
        return nil;
    }

    NSArray *importedItems = (NSArray</strong>)CFBridgingRelease(result);
    NSDictionary <strong>item = importedItems[0];

    // Get SecIdentityRef representing the item's id
    SecIdentityRef identityRef = (</em>bridge SecIdentityRef) item[(id)kSecImportItemIdentity];

    // Get Id's Private Key, return nil id if fails
    SecKeyRef privateKey;
    status = SecIdentityCopyPrivateKey(identityRef, &amp;privateKey);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import private key from provided with error :%d ", (int)status);
        return nil;
    }
    CFAutorelease(privateKey);

    // Get all relevant certs [SecCertificate] from the ID's cert chain using kSecImportItemCertChain
    NSArray *certChain = item[(id)kSecImportItemCertChain];

    // Return nil Id if errors in key or cert chain at this stage
    if (!certChain || !privateKey)
        return nil;


    // FIXME: Use the same tag as tag: [create-self-signed-cert]

    // RETURN A TLSIDENTITY FROM THE KEYCHAIN FOR USE IN CONFIGURING TLS COMMUNICATION
    return [CBLTLSIdentity identityWithIdentity:identityRef
                                          certs:@[certChain[1]]
                                          error:&amp;error];
}

- (void) dontTestDeleteTLSIdentityFromKeychain {
    NSError *error;

    [CBLTLSIdentity deleteIdentityWithLabel:@"doco-sync-server-1" error:&amp;error];

}

@end

#pragma mark - For replications

// BEGIN -- snippets --
//    Purpose -- code samples for use in replication topic

@interface MyClass :NSObject
@property (nonatomic) CBLDatabase *database;
@property (nonatomic) CBLReplicator *replicator; <i class="conum" data-value="1"></i><b>(1)</b>
@end

@implementation MyClass
@synthesize database=_database;
@synthesize replicator=_replicator;

- (void) startReplication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"]; <i class="conum" data-value="2"></i><b>(2)</b>
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:_database
                                                                                       target:target];
    config.replicatorType = kCBLReplicatorTypePull;
    _replicator = [[CBLReplicator alloc] initWithConfig:config];
    [_replicator start];
}
@end


/</strong>
&lt;1&gt; A replication is an asynchronous operation.
To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
&lt;2&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.


 */</code></pre>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create and populate a mutable dictionary <code>address</code></p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">//
//  SampleCodeTest.m
//  CouchbaseLite
//
//  Copyright (c) 2018 Couchbase, Inc All rights reserved.
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//  <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//

#import &lt;UIKit/UIKit.h&gt;
#import &lt;CouchbaseLite/CouchbaseLite.h&gt;
#import &lt;CoreML/CoreML.h&gt;


#pragma mark - !!!Note
/<strong>*
 Note for Consistency across the code snippets:

 1. We will keep the '</strong>' with instance after the space.
    <code>NSDictionary <strong>dict = [NSDictionary dictionary];</code>

 2. For making more space in single line, we will avoid space after the ':' in function call.
    <code>[myMLModel predictImage:imageData];</code>

 3. Will only keep <code>self.database</code> when using database, query and replicator related code snippet.
    Except when creating a new database sample.

 4. Will only keep <code>self.otherDB</code> when using listener-db

 5. While using replicator/listener, we will use as ivar <code>self.replicator</code> and <code>self.listener</code> resp.
 */

#pragma mark -

// <code>myMLModel</code> is a fake implementation
// this would be the implementation of the ml model you have chosen
@interface myMLModel :NSObject

+ (NSDictionary</strong>)predictImage:(NSData*)data;

@end

@interface ImageClassifierModel :NSObject &lt;CBLPredictiveModel&gt;

- (nullable CBLDictionary*) predict:(CBLDictionary*)input;

@end

@implementation ImageClassifierModel

- (nullable CBLDictionary*) predict:(CBLDictionary*)input; {
    CBLBlob <strong>blob = [input blobForKey:@"photo"];

    NSData *imageData = blob.content;
    // <code>myMLModel</code> is a fake implementation
    // this would be the implementation of the ml model you have chosen
    NSDictionary *modelOutput = [myMLModel predictImage:imageData];

    CBLMutableDictionary *output = [[CBLMutableDictionary alloc] initWithData:modelOutput];
    return output; <i class="conum" data-value="1"></i><b>(1)</b>
}

@end

// to avoid link error
@implementation myMLModel
+ (NSDictionary</strong>)predictImage:(NSData*)data { return [NSDictionary dictionary]; }
@end

@interface LogTestLogger :NSObject&lt;CBLLogger&gt;

// set the log level
@property (nonatomic) CBLLogLevel level;

@end

@implementation LogTestLogger

@synthesize level=_level;

- (void) logWithLevel:(CBLLogLevel)level domain:(CBLLogDomain)domain message:(NSString*)message {
    // handle the message, for example piping it to
    // a third party framework
}

@end


@interface LocalWinConflictResolver :NSObject&lt;CBLConflictResolver&gt;
@end

@implementation LocalWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.localDocument;
}

@end

@interface RemoteWinConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation RemoteWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.remoteDocument;
}

@end


@interface MergeConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation MergeConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    NSDictionary <strong>localDict = conflict.localDocument.toDictionary;
    NSDictionary *remoteDict = conflict.remoteDocument.toDictionary;

    NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:localDict];
    [result addEntriesFromDictionary:remoteDict];

    return [[CBLMutableDocument alloc] initWithID:conflict.documentID
                                             data:result];
}

@end

@interface Hotel :NSObject
@property (nonatomic) NSString *id;
@property (nonatomic) NSString *name;
@property (nonatomic) NSString *city;
@property (nonatomic) NSString *country;
@property (nonatomic) NSString *descriptive;
@end

@implementation Hotel
@synthesize id, name, city, country, descriptive;
@end

@interface SampleCodeTest :NSObject
@property(nonatomic) CBLDatabase *database;
@property(nonatomic) CBLDatabase *otherDB;
@property(nonatomic) CBLURLEndpointListener *listener;
@property(nonatomic) CBLReplicator *replicator;
@end

@implementation SampleCodeTest

#pragma mark - Database

- (void) dontTestNewDatabase {
    NSError *error;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"my-database" error:&amp;error];
    if (!database) {
        NSLog(@"Cannot open the database:%@", error);
    }
    self.database = database;

    if (![self.database close:&amp;error])
        NSLog(@"Error closing db:%@", error);

}

- (void) dontTestLogging {

    // Replicator / Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Query /  Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainQuery;
}

#if COUCHBASE_ENTERPRISE
- (void) dontTestDatabaseEncryption {
    CBLDatabaseConfiguration *config = [[CBLDatabaseConfiguration alloc] init];
    config.encryptionKey = [[CBLEncryptionKey alloc] initWithPassword:@"secretpassword"];

    NSError *error;
    self.database = [[CBLDatabase alloc] initWithName:@"my-database" config:config error:&amp;error];
    if (!self.database) {
        NSLog(@"Cannot open the database:%@", error);
    }
}
#endif

- (void) dontTestEnableConsoleLogging {
    CBLDatabase.log.console.domains = kCBLLogDomainAll; <i class="conum" data-value="1"></i><b>(1)</b>
    CBLDatabase.log.console.level = kCBLLogLevelVerbose; <i class="conum" data-value="2"></i><b>(2)</b>


    CBLDatabase.log.console.domains = kCBLLogDomainAll;

}

- (void) dontTestFileLogging {
    NSString *tempFolder = [NSTemporaryDirectory() stringByAppendingPathComponent:@"cbllog"];
    CBLLogFileConfiguration *config = [[CBLLogFileConfiguration alloc] initWithDirectory:tempFolder]; <i class="conum" data-value="3"></i><b>(3)</b>
    config.maxRotateCount = 2; <i class="conum" data-value="4"></i><b>(4)</b>
    config.maxSize = 1024; <i class="conum" data-value="5"></i><b>(5)</b>
    config.usePlainText = YES; <i class="conum" data-value="6"></i><b>(6)</b>
    [CBLDatabase.log.file setConfig:config];
    [CBLDatabase.log.file setLevel:kCBLLogLevelInfo]; <i class="conum" data-value="7"></i><b>(7)</b>
}

- (void) dontTestEnableCustomLogging {
    LogTestLogger *logger = [[LogTestLogger alloc] init];
    logger.level = kCBLLogLevelWarning;
    [CBLDatabase.log setCustom:logger];

}

- (void) dontTestLoadingPrebuilt {
    // Note:Getting the path to a database is platform-specific.
    // For iOS you need to get the path from the main bundle.
    if (![CBLDatabase databaseExists:@"travel-sample" inDirectory:nil]) {
        NSError *error;
        NSString *path = [[NSBundle bundleForClass:[self class]] pathForResource:@"travel-sample" ofType:@"cblite2"];
        if (![CBLDatabase copyFromPath:path toDatabase:@"travel-sample" withConfig:nil error:&amp;error]) {
            [NSException raise:NSInternalInconsistencyException
                        format:@"Could not load pre-built database:%@", error];
        }
    }
}

#pragma mark - Document

- (void) dontTestInitializer {
    NSError *error;

    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];
    [newTask setString:@"task" forKey:@"task"];
    [newTask setString:@"todo" forKey:@"owner"];
    [newTask setString:@"task" forKey:@"createdAt"];
    [self.database saveDocument:newTask error:&amp;error];
}

- (void) dontTestMutability {
    NSError *error;

    CBLDocument *document = [self.database documentWithID:@"xyz"];
    CBLMutableDocument *mutableDocument = [document toMutable];
    [mutableDocument setString:@"apples" forKey:@"name"];
    [self.database saveDocument:mutableDocument error:&amp;error];
}

- (void) dontTestTypedAcessors {
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];

    [newTask setValue:[NSDate date] forKey:@"createdAt"];
    NSDate *date = [newTask dateForKey:@"createdAt"];

    NSLog(@"Date:%@", date);
}

- (void) dontTestDataTypeDictionary {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting a dictionary value from the document
    CBLDictionary *dict = [document dictionaryForKey:@"address"];
    
    // Access a value from the dictionary
    NSString *street = [dict stringForKey:@"street"];
    NSLog(@"Street:: %@", street);
    
    // Iterate dictionary
    for (NSString *key in dict) {
        id value = [dict valueForKey:key];
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableDictionary *mutableDict = [dict toMutable];
    [mutableDict setString:@"1 Great sts" forKey:@"street"];
}

- (void) dontTestDataTypeMutableDictionary {
    
    // Create a new mutable dictionary and populate some keys/values
    CBLMutableDictionary *dict = [[CBLMutableDictionary alloc] init];
    [dict setString:@"1 Main st" forKey:@"street"];
    [dict setString:@"San Francisco" forKey:@"city"];
    
    // Set the dictionary to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setDictionary:dict forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestDataTypeArray {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting an array value from the document
    CBLArray *array = [document arrayForKey:@"phones"];
    
    // Get element count
    NSUInteger count = array.count;
    NSLog(@"Count:: %lu", (unsigned long)count);
    
    // Access an array element by index
    if (count &gt; 0) {
        id value = [array valueAtIndex:0];
        NSLog(@"Value:: %@", value);
    }
    
    // Iterate the array
    for (id value in array) {
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableArray *mutableArray = [array toMutable];
    [mutableArray addString:@"650-000-0002"];
}

- (void) dontTestDataTypeMutableArray {
    // Create a new mutable array and populate data into the array
    CBLMutableArray *array = [[CBLMutableArray alloc] init];
    [array addString:@"650-000-0000"];
    [array addString:@"650-000-0001"];
    
    // Set the array to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setArray:array forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestBatchOperations {
    NSError *error;

    [self.database inBatch:&amp;error usingBlock:^{
        for (int i = 0; i &lt; 10; i++) {
            CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
            [doc setValue:@"user" forKey:@"type"];
            [doc setValue:[NSString stringWithFormat:@"user %d", i] forKey:@"name"];
            [doc setBoolean:NO forKey:@"admin"];

            NSError *err = nil;
            [self.database saveDocument:doc error:&amp;err];
        }
    }];
}

- (void) dontTestChangeListener {
    <em>block SampleCodeTest *wSelf = self;
    [self.database addDocumentChangeListenerWithID:@"user.john" listener:^(CBLDocumentChange  *change) {
        CBLDocument *document = [wSelf.database documentWithID:change.documentID];
        NSLog(@"Status ::%@)", [document stringForKey:@"verified_account"]);
    }];
}

- (void) dontTestDocumentExpiration {
    NSError *error;

    // Purge the document one day from now
    NSDate *ttl = [[NSCalendar currentCalendar] dateByAddingUnit:NSCalendarUnitDay
                                                           value:1
                                                          toDate:[NSDate date]
                                                         options:0];
    [self.database setDocumentExpirationWithID:@"doc123" expiration:ttl error:&amp;error];

    // Reset expiration
    [self.database setDocumentExpirationWithID:@"doc1" expiration:nil error:&amp;error];

    // Query documents that will be expired in less than five minutes
    NSTimeInterval fiveMinutesFromNow = [[NSDate dateWithTimeIntervalSinceNow:60 * 5] timeIntervalSince1970];
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryMeta expiration]
                                                lessThan:[CBLQueryExpression double:fiveMinutesFromNow]]];
    NSLog(@"%@", query);
}

- (void) dontTestBlob {
#if TARGET_OS_IPHONE
    NSError *error;
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] initWithID:@"task1"];

    UIImage *appleImage = [UIImage imageNamed:@"avatar.jpg"];
    NSData *imageData = UIImageJPEGRepresentation(appleImage, 1.0);  <i class="conum" data-value="8"></i><b>(8)</b>

    CBLBlob *blob = [[CBLBlob alloc] initWithContentType:@"image/jpeg" data:imageData];  <i class="conum" data-value="9"></i><b>(9)</b>
    [newTask setBlob:blob forKey:@"avatar"]; <i class="conum" data-value="10"></i><b>(10)</b>
    [self.database saveDocument:newTask error:&amp;error];

    CBLDocument *savedTask = [self.database documentWithID:@"task1"];
    CBLBlob *taskBlob = [savedTask blobForKey:@"avatar"];
    UIImage *taskImage = [UIImage imageWithData:taskBlob.content];

    NSLog(@"%@", taskImage);
#endif
}

- (void) dontTest1xAttachment {
    CBLMutableDocument *document = [[CBLMutableDocument alloc] initWithID:@"task1"];

    CBLDictionary *attachments = [document dictionaryForKey:@"_attachments"];
    CBLBlob *avatar = [attachments blobForKey:@"avatar"];
    NSData *content = [avatar content];

    NSLog(@"%@", content);
}

#pragma mark - Query

- (void) dontTestIndexing {
    NSError *error;


    CBLValueIndexConfiguration</strong> config =
                [[CBLValueIndexConfiguration alloc]
                    initWithExpression: @[@"type", @"name"]];

    [self.database createIndexWithConfig: config name: @"TypeNameIndex" error: &amp;error];


}

- (void) dontTestIndexing_Querybuilder {
    NSError <strong>error;

    CBLValueIndexItem *type = [CBLValueIndexItem property:@"type"];
    CBLValueIndexItem *name = [CBLValueIndexItem property:@"name"];
    CBLIndex *index = [CBLIndexBuilder valueIndexWithItems:@[type, name]];
    [self.database createIndex:index withName:@"TypeNameIndex" error:&amp;error];
}



- (void) dontTestSelect {
    NSError *error;
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression value:@"user"]] andExpression:
                                               [[CBLQueryExpression property:@"admin"] equalTo:[CBLQueryExpression boolean:NO]]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"user name ::%@", [result stringAtIndex:0]);
    }
}

- (void) dontTestSelectProps {
    NSError *error;
    CBLQuerySelectResult *metaId = [CBLQuerySelectResult expression: CBLQueryMeta.id as:@"id"];
    CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[metaId, type, name]
                                         from:[CBLQueryDataSource database:self.database]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id :: %@", [result stringForKey:@"id"]);
        NSLog(@"document name :: %@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestSelectAll {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]];

    NSLog(@"%@", query);
}

- (void) dontTestLiveQuery {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]]; <i class="conum" data-value="11"></i><b>(11)</b>

    // Adds a query change listener.
    // Changes will be posted on the main queue.
    id&lt;CBLListenerToken&gt; token = [query addChangeListener:^(CBLQueryChange  *change) { <i class="conum" data-value="12"></i><b>(12)</b>
        for (CBLQueryResultSet *results in [change results]) {
            NSLog(@"%@", results);
            /</strong> Update UI <strong>/
        }
    }]; <i class="conum" data-value="13"></i><b>(13)</b>


    [query removeChangeListenerWithToken:token]; <i class="conum" data-value="14"></i><b>(14)</b>
}

- (void) dontTestWhere {
    NSError *error;
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:[CBLQueryLimit limit:[CBLQueryExpression integer:10]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        CBLDictionary *dict = [result valueForKey:@"travel-sample"];
        NSLog(@"document name ::%@", [dict stringForKey:@"name"]);
    }

    NSLog(@"%@", query);
}

- (void) dontTestQueryDeletedDocuments {
    // Query documents that have been deleted
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:CBLQueryMeta.id]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:CBLQueryMeta.isDeleted];
    NSLog(@"%@", query);
}

- (void) dontTestCollectionOperatorContains {
    NSError *error;

    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuerySelectResult *likes = [CBLQuerySelectResult property:@"public_likes"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]];
    CBLQueryExpression *contains = [CBLQueryArrayFunction contains:[CBLQueryExpression property:@"public_likes"]
                                                             value:[CBLQueryExpression string:@"Armani Langworth"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name, likes]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:contains]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"public_likes ::%@", [[result arrayForKey:@"public_likes"] toArray]);
    }
}

- (void) dontTestCollectionOperatorIn {
    NSArray *values = @[[CBLQueryExpression property:@"first"],
                       [CBLQueryExpression property:@"last"],
                       [CBLQueryExpression property:@"username"]];

    [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                       from:[CBLQueryDataSource database:self.database]
                      where:[[CBLQueryExpression string:@"Armani"] in:values]];
}

- (void) dontTestLikeOperator {
    NSError *error;
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"royal engineers museum"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"name property ::%@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestWildCardMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"eng%e%"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestWildCardCharacterMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryExpression property:@"name"] like:[CBLQueryExpression string:@"eng</em><em>r"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestRegexMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *regex = [[CBLQueryExpression property:@"name"] regex:[CBLQueryExpression string:@"\\bEng.*e\\b"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:regex]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestJoin {
    CBLQuerySelectResult *name = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"name" from:@"airline"]];
    CBLQuerySelectResult *callsign = [CBLQuerySelectResult
                                      expression:[CBLQueryExpression property:@"callsign" from:@"airline"]];
    CBLQuerySelectResult *dest = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"destinationairport" from:@"route"]];
    CBLQuerySelectResult *stops = [CBLQuerySelectResult
                                   expression:[CBLQueryExpression property:@"stops" from:@"route"]];
    CBLQuerySelectResult *airline = [CBLQuerySelectResult
                                     expression:[CBLQueryExpression property:@"airline" from:@"route"]];

    CBLQueryJoin *join = [CBLQueryJoin join:[CBLQueryDataSource database:self.database
                                                                      as:@"route"]
                                         on:[[CBLQueryMeta idFrom:@"airline"]
                                             equalTo:[CBLQueryExpression property:@"airlineid"
                                                                             from:@"route"]]];

    CBLQueryExpression *typeRoute = [[CBLQueryExpression property:@"type" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"route"]];
    CBLQueryExpression *typeAirline = [[CBLQueryExpression property:@"type" from:@"airline"]
                                       equalTo:[CBLQueryExpression string:@"airline"]];
    CBLQueryExpression *sourceRIX = [[CBLQueryExpression property:@"sourceairport" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"RIX"]];

    CBLQuery *query = [CBLQueryBuilder select:@[name, callsign, dest, stops, airline]
                                         from:[CBLQueryDataSource database:self.database as:@"airline"]
                                         join:@[join]
                                        where:[[typeRoute andExpression:typeAirline] andExpression:sourceRIX]];

    NSLog(@"%@", query);
}

- (void) dontTestGroupBy {
    CBLQuerySelectResult *count = [CBLQuerySelectResult expression:[CBLQueryFunction count:[CBLQueryExpression all]]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *tz = [CBLQuerySelectResult property:@"tz"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"airport"]];
    CBLQueryExpression *geoAlt = [[CBLQueryExpression property:@"geo.alt"] greaterThanOrEqualTo:[CBLQueryExpression integer:300]];

    CBLQuery *query = [CBLQueryBuilder select:@[count, country, tz]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:geoAlt]
                                      groupBy:@[[CBLQueryExpression property:@"country"],
                                                [CBLQueryExpression property:@"tz"]]];

    NSLog(@"%@", query);
}

- (void) dontTestOrderBy {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *title = [CBLQuerySelectResult property:@"title"];

    CBLQuery *query = [CBLQueryBuilder select:@[id, title]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      orderBy:@[[[CBLQueryOrdering property:@"title"] descending]]];

    NSLog(@"%@", query);
}


- (void) dontTestExplainAll {
    NSError *error;
    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[[CBLQueryExpression property:@"type"]
                   equalTo:[CBLQueryExpression string:@"university"]]
//            groupBy:@[[CBLQueryExpression property:@"country"]] <i class="conum" data-value="15"></i><b>(15)</b>
                          orderBy:@[[[CBLQueryOrdering property:@"title"] descending]] <i class="conum" data-value="16"></i><b>(16)</b>
       ];

    NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="17"></i><b>(17)</b>

}
- (void) dontTestExplainLike {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"%hotel%"]];
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];
      NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="18"></i><b>(18)</b>


}
- (void) dontTestExplainNoPfx {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"hotel%"]]; <i class="conum" data-value="19"></i><b>(19)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainFunction {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryFunction lower:[CBLQueryExpression property:@"type"]]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="20"></i><b>(20)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
                from:[CBLQueryDataSource database:self.database]
                where:[type andExpression:name]];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainNoFunction {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="21"></i><b>(21)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);


}



- (void) dontTestCreateFullTextIndex {
    NSError *error;

    // Insert documents
    NSArray *overviews = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *overview in overviews) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:overview forKey:@"overview"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndexConfiguration</strong> config =
        [[CBLFullTextIndexConfiguration alloc]
            initWithExpression: @[@"overview"]
            ignoreAccents: NO language: nil];

    [self.database createIndexWithConfig: config
            name: @"overviewFTSIndex" error: &amp;error];

}

- (void) dontTestFullTextSearch {
    NSError <strong>error;

    NSString *ftsQueryString =
    @"SELECT META().id FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)";

    CBLQueryResultSet *resultSet = [ftsQuery execute:&amp;error];
    NSArray</strong> results  = [resultSet allResults];
    for (CBLQueryResult <strong>result in results) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}




- (void) dontTestCreateFullTextIndex_Querybuilder {
    NSError *error;

    // Insert documents
    NSArray *tasks = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *task in tasks) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:task forKey:@"name"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndex *index = [CBLIndexBuilder fullTextIndexWithItems:@[[CBLFullTextIndexItem property:@"name"]]];
    index.ignoreAccents = NO;
    [self.database createIndex:index withName:@"nameFTSIndex" error:&amp;error];
}

- (void) dontTestFullTextSearch_Querybuilder {
    NSError *error;

    CBLQueryExpression *where = [CBLQueryFullTextFunction matchWithIndexName:@"nameFTSIndex"
                                                                       query:@"'buy'"];
    CBLQuery *query =
      [CBLQueryBuilder
        select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
        from:[CBLQueryDataSource database:self.database]
        where:where];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}









#pragma mark - Replication

/</strong> The <code>tag::replication[]</code> example is inlined in objc.adoc <strong>/

- (void) dontTestEnableReplicatorLogging {
    // Replicator
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Network
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainNetwork;
}

- (void) dontTestReplicationBasicAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicationSessionAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLSessionAuthenticator alloc] initWithSessionID:@"904ac010862f37c8dd99015a33ab5a3565fd8447"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicatorStatus {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    [self.replicator addChangeListener:^(CBLReplicatorChange *change) {
        if (change.status.activity == kCBLReplicatorStopped) {
            NSLog(@"Replication stopped");
        }
    }];
}


//  BEGIN PendingDocuments IB -- 11/Feb/21 --
- (void) testReplicationPendingDocs {

    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database
                                                                                       target:target];

    config.replicatorType = kCBLReplicatorTypePush;

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    // Get list of pending doc IDs
    NSError *err = nil;
    NSSet *pendingDocIds = [self.replicator pendingDocumentIDs:&amp;err]; <i class="conum" data-value="22"></i><b>(22)</b>


    if ([pendingDocIds count] &gt; 0) {

        NSLog(@"There are %lu documents pending", (unsigned long)[pendingDocIds count]);

        [self.replicator addChangeListener:^(CBLReplicatorChange *change) {

            NSLog(@"Replicator activity level is %u", change.status.activity);
            // iterate and report-on the pending doc IDs  in 'mydocids'
            for (NSString *docID in pendingDocIds) {

                NSError *err = nil;
                if (![change.replicator isDocumentPending:docID error:&amp;err]) { <i class="conum" data-value="23"></i><b>(23)</b>
                    NSLog(@"Doc ID %@ now pushed", docID);
                }
            }

        }];
        [self.replicator start];

    };

}
//  END PendingDocuments IB -- 11/Feb/21 --


- (void) dontTestReplicatorDocumentEvent {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    id token = [self.replicator addDocumentReplicationListener:^(CBLDocumentReplication  *replication) {
        NSLog(@"Replication type ::%@", replication.isPush ? @"Push" :@"Pull");
        for (CBLReplicatedDocument *document in replication.documents) {
            if (document.error == nil) {
                NSLog(@"Doc ID ::%@", document.id);
                if document.flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {                     NSLog(@"Successfully replicated a deleted document");                 }             } else {                 // There was an error             }         }     }];      [self.replicator start];      [self.replicator removeChangeListenerWithToken:token]; }  - (void) dontTestCustomReplicationHeader {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:endpoint];     config.headers = @{@"CustomHeaderName" :@"Value"}; }  - (void) dontTestHandlingReplicationError {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }]; }  - (void) dontTestReplicationResetCheckpoint {     BOOL restCheckpoint = NO;     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      if (restCheckpoint)         [self.replicator startWithReset:restCheckpoint]; <i class="conum" data-value="24"></i><b>(24)</b>  }  - (void) dontTestReplicationPushFilter {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pushFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ([[document stringForKey:@"type"] isEqualToString:@"draft"]) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestReplicationPullFilter {      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pullFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ((flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  //  Added 2/Feb/21 - Ian Bridge - (void) dontTestCustomRetryConfig {     id target = [[CBLURLEndpoint alloc] initWithURL:[NSURL URLWithString:@"ws://foo.cbl.com/db"]];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.replicatorType = kCBLReplicatorTypePush;     config.continuous = YES;     //  other config as required . . .      config.heartbeat = 150; <i class="conum" data-value="25"></i><b>(25)</b>      config.maxAttempts = 20; <i class="conum" data-value="26"></i><b>(26)</b>      config.maxAttemptWaitTime = 600; <i class="conum" data-value="27"></i><b>(27)</b>      //  other config as required . . .     self.replicator = [[CBLReplicator alloc] initWithConfig:config];  }   #ifdef COUCHBASE_ENTERPRISE - (void) dontTestDatabaseReplica {     /</strong> EE feature:code below might throw a compilation error      if it's compiled against CBL Swift Community. <strong>/     CBLDatabaseEndpoint *targetDatabase = [[CBLDatabaseEndpoint alloc] initWithDatabase:self.otherDB];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:targetDatabase];     config.replicatorType = kCBLReplicatorTypePush;      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; } #endif  - (void) dontTestCertificatePinning {     // Active - Example 4     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      NSLog(@"%@", config); }  - (NSData</strong>) dataFromResource:(NSString*)file ofType:(NSString*)type {     return [NSData data]; }  - (void) dontTestGettingStarted {     // Get the database (and create it if it doesnt exist).     NSError <strong>error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      // Create a new document (i.e. a record) in the database.     CBLMutableDocument *mutableDoc = [[CBLMutableDocument alloc] init];     [mutableDoc setFloat:2.0 forKey:@"version"];     [mutableDoc setString:@"SDK" forKey:@"type"];      // Save it to the database.     [self.database saveDocument:mutableDoc error:&amp;error];      // Update a document.     CBLMutableDocument *mutableDoc2 = [[self.database documentWithID:mutableDoc.id] toMutable];     [mutableDoc2 setString:@"Swift" forKey:@"language"];     [self.database saveDocument:mutableDoc2 error:&amp;error];      CBLDocument *document = [self.database documentWithID:mutableDoc2.id];     // Log the document ID (generated by the database)     // and properties     NSLog(@"Document ID ::%@", document.id);     NSLog(@"Learning %@", [document stringForKey:@"language"]);      // Create a query to fetch documents of type SDK.     CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"SDK"]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                           from:[CBLQueryDataSource database:self.database]                                          where:type];      // Run the query     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]);      // Create replicators to push and pull changes to and from the cloud.     NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *targetEndpoint = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                            target:targetEndpoint];     config.replicatorType = kCBLReplicatorTypePushAndPull;      // Add authentication.     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];      // Create replicator (make sure to add an ivar)     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      // Listen to replicator change events.     [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }];      // Start replication     [self.replicator start]; }  - (void) dontTestPredictiveModel {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      ImageClassifierModel *model = [[ImageClassifierModel alloc] init];     [[CBLDatabase prediction] registerModel:model withName:@"ImageClassifier"];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input];      CBLValueIndex *index = [CBLIndexBuilder valueIndexWithItems:@[[CBLValueIndexItem expression:[prediction property:@"label"]]]];     [self.database createIndex:index withName:@"value-index-image-classifier" error:&amp;error];      [[CBLDatabase prediction] unregisterModelWithName:@"ImageClassifier"]; }  - (void) dontTestPredictiveIndex {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];      CBLPredictiveIndex *index = [CBLIndexBuilder predictiveIndexWithModel:@"ImageClassifier" input:input properties:nil];     [self.database createIndex:index withName:@"predictive-index-image-classifier" error:&amp;error]; }  - (void) dontTestPredictiveQuery {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input]; <i class="conum" data-value="1"></i><b>(1)</b>      CBLQueryExpression *condition = [[[prediction property:@"label"] equalTo:[CBLQueryExpression string:@"car"]]                                      andExpression:[[prediction property:@"probablity"] greaterThanOrEqualTo:[CBLQueryExpression double:0.8]]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:condition];      // Run the query.     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]); }  - (void) dontTestCoreMLPredictiveModel {     NSError *error;      // Load MLModel from <code>ImageClassifier.mlmodel</code>     NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@"ImageClassifier" withExtension:@"mlmodel"];     NSURL *compiledModelURL = [MLModel compileModelAtURL:modelURL error:&amp;error];     MLModel *model = [MLModel modelWithContentsOfURL:compiledModelURL error:&amp;error];     CBLCoreMLPredictiveModel *predictiveModel = [[CBLCoreMLPredictiveModel alloc] initWithMLModel:model];      // Register model     [[CBLDatabase prediction] registerModel:predictiveModel withName:@"ImageClassifier"]; }  - (void) dontTestReplicatorConflictResolver {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.conflictResolver = [[LocalWinConflictResolver alloc] init];      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestSaveWithConflictHandler {     NSError *error;      CBLDocument *document = [self.database documentWithID:@"xyz"];     CBLMutableDocument *mutableDocument = [document toMutable];     [mutableDocument setString:@"apples" forKey:@"name"];      [self.database saveDocument:mutableDocument            conflictHandler:^BOOL(CBLMutableDocument *new, CBLDocument *current) {                NSDictionary *currentDict = current.toDictionary;                NSDictionary *newDict = new.toDictionary;                 NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:currentDict];                [result addEntriesFromDictionary:newDict];                [new setData:result];                return YES;            }                      error:&amp;error]; }  #pragma mark - URLListener  - (BOOL) isValidCredentials:(NSString</strong>)u password:(NSString*)p { return YES; } // helper - (BOOL) isValidCertificates:(NSArray*)certs { return YES; } // helper  - (void) dontTestInitListener {     CBLURLEndpointListenerConfiguration <strong>config;     config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.database];     config.tlsIdentity = nil; // Use with anonymous self signed cert     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL( NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; }  - (void) dontTestListenerStart {     NSError *error = nil;      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } }  - (void) dontTestListenerStop {     [self.listener stop]; }  - (void) dontTestCreateSelfSignedCert {     NSError *error = nil;     CBLTLSIdentity *identity = nil;     // &lt;site-rooot&gt;/objc/advance/objc-p2psync-websocket-using-passive.html     // Example-6      NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" };     identity =       [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/         attributes:attrs         expiration:[NSDate dateWithTimeIntervalSinceNow:86400]         label:@"Server-Cert-Label"         error:&amp;error]; }  - (void) dontTestListenerCertificateAuthenticatorRootCert {     CBLURLEndpointListenerConfiguration *config;      // Example 8-tab1      NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]]; }  - (void) dontTestListenerCertificateAuthenticatorCallback {     CBLURLEndpointListenerConfiguration *config;     // Example 8-tab2      CBLListenerCertificateAuthenticator *listenerAuth =     [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];      config.authenticator = listenerAuth; }  # pragma mark - QUERY RESULT SET HANDLING EXAMPLES  - (void) dontTestQuerySyntaxJson {     NSError *error;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                              from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="28"></i><b>(28)</b>        CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {          NSDictionary *data = [result valueAtIndex:0];          // Use dictionary values         NSLog(@"id = %@", [data valueForKey:@"id"]);         NSLog(@"name = %@", [data valueForKey:@"name"]);         NSLog(@"type = %@", [data valueForKey:@"type"]);         NSLog(@"city = %@", [data valueForKey:@"city"]);      } // end for       CBLQueryResultSet *rs = [query execute:&amp;error];     for (CBLQueryResult *result in rs) {          // Get result as a JSON string         NSString *json = [result toJSON]; <i class="conum" data-value="29"></i><b>(29)</b>          // Get an native Obj-C object from the Json String         NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:[json dataUsingEncoding:NSUTF8StringEncoding]                                                                          options:NSJSONReadingAllowFragments                                                                            error:&amp;error]; <i class="conum" data-value="30"></i><b>(30)</b>          // Log generated Json and Native objects         // For demo/example purposes         NSLog(@"Json String %@", json);         NSLog(@"Native Object %@", dict);      }; // end for   } // end function  - (void) dontTestQuerySyntaxAndAccessProps {     NSError *error = nil;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];      CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];      CBLQuerySelectResult *city = [CBLQuerySelectResult property:@"city"];      CBLQuery *query = [CBLQueryBuilder select:@[id, type, name, city]                                          from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="31"></i><b>(31)</b>       CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) { // all results         NSLog(@"id = %@", [result stringForKey:@"id"]);         NSLog(@"name = %@", [result stringForKey:@"name"]);         NSLog(@"type = %@", [result stringForKey:@"type"]);         NSLog(@"city = %@", [result stringForKey:@"city"]);      }  }  - (void) dontTestQuerySyntaxCount {     NSError *error = nil;     NSInteger count = 0;     CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQueryExpression *countExpression = [CBLQueryFunction count:[CBLQueryExpression all]];     CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:countExpression                                                                        as:@"myCount"];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]]; <i class="conum" data-value="32"></i><b>(32)</b>      CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {         count = [result integerForKey:@"myCount"]; <i class="conum" data-value="33"></i><b>(33)</b>      } // end for       NSLog(@"print to avoid warning %@ %ld", query, count); }  - (void) dontTestQuerySyntaxID {     NSError *error = nil;      CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]];      NSLog(@"print to avoid warning %@", query); }  - (void) dontTestQueryAccessID {     CBLQuery *query;     NSError *error = nil;      CBLQueryResultSet *results = [query execute:&amp;error];     CBLDocument *doc = nil;     NSString *docId = nil;     for (CBLQueryResult *result in results) {         docId = [result stringForKey:@"id"]; <i class="conum" data-value="34"></i><b>(34)</b>          // Now you can get the document using its ID         // for example using         doc = [self.database documentWithID:docId];      }      NSLog(@"doc.id = %@", doc.id); }  - (void) dontTestQuerySyntaxPagination {     int offset = 0;     int limit = 20;      CBLQueryLimit *queryLimit = [CBLQueryLimit limit:[CBLQueryExpression integer:limit]                                               offset:[CBLQueryExpression integer:offset]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:nil                                       groupBy:nil                                        having:nil                                       orderBy:nil                                         limit:queryLimit];     NSLog(@"print to avoid warning %@", query); }  - (void) dontTestDocsOnly_QuerySyntaxN1QL {     // Documentation Only query-syntax-n1ql     NSError *error;      NSString *queryString = @"SELECT * FROM _ WHERE type = \"hotel\""; <i class="conum" data-value="35"></i><b>(35)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryResultSet *results = [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  - (void) dontTestDocsOnly_QuerySyntaxN1QLParams {     // Documentation Only query-syntax-n1ql-params     NSError *error;      NSString *queryString = [NSString stringWithFormat:@"SELECT * FROM _ WHERE type = $type"]; <i class="conum" data-value="36"></i><b>(36)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryParameters *params = [[CBLQueryParameters alloc] init];     [params setString:@"hotel" forName:@"type"]; <i class="conum" data-value="37"></i><b>(37)</b>     query.parameters = params;      CBLQueryResultSet *results =  [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  #pragma mark - PEER-to-PEER  - (void) dontTestListenerSimple {     NSError *error = nil;      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database]; <i class="conum" data-value="38"></i><b>(38)</b>      config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                                 initWithBlock:^BOOL(NSString  *validUser, NSString  *validPassword) {         return [self isValidCredentials:validUser password:validPassword];     }]; <i class="conum" data-value="39"></i><b>(39)</b>      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="40"></i><b>(40)</b>      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } <i class="conum" data-value="41"></i><b>(41)</b>  }  - (void) dontTestReplicatorSimple {     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="42"></i><b>(42)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:endpoint]; <i class="conum" data-value="43"></i><b>(43)</b>      config.acceptOnlySelfSignedServerCertificate = YES; // &lt;.&gt; //FIXME: Remove this from doc!      config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"valid.user"                                                                   password:@"valid.password.string"]; <i class="conum" data-value="44"></i><b>(44)</b>       self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="45"></i><b>(45)</b>      [self.replicator start]; <i class="conum" data-value="46"></i><b>(46)</b>  }  - (void) dontTestP2PURLEndpointListener {     // FIXME: can we use the docsn site to show the interface of the Listener class?     // <a href="https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html" class="bare">https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html</a> }  - (void) dontTestURLEndpointListenerConstructor {     NSUInteger wssPort = 4985;     NSUInteger wsPort = 4984;     BOOL isTLS = NO;     CBLListenerPasswordAuthenticator *auth = [[CBLListenerPasswordAuthenticator alloc]                                               initWithBlock:^BOOL(NSString *username, NSString *password) {         return YES;     }];      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.otherDB];     config.port = isTLS ? wssPort :wsPort;     config.disableTLS = !isTLS;     config.authenticator = auth;      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="1"></i><b>(1)</b> }  - (void) dontTestMyActivePeer {     NSError *error = nil;     self.database = [[CBLDatabase alloc] initWithName:@"database" error:&amp;error];     if (!self.database) {         NSLog(@"Cannot open the database:%@", error);     };      // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="47"></i><b>(47)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:endpoint]; <i class="conum" data-value="48"></i><b>(48)</b>      config.replicatorType = kCBLReplicatorTypePush;      // set auto-purge behavior (here we override default)     config.enableAutoPurge = NO; <i class="conum" data-value="49"></i><b>(49)</b>      config.continuous = YES;      // Configure Server Authentication     // Here - expect and accept self-signed certs     config.acceptOnlySelfSignedServerCertificate = YES; <i class="conum" data-value="50"></i><b>(50)</b>      // Configure Client Authentication     // Here set client to use basic authentication     // Providing username and password credentials     // If prompted for them by server     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"Our Username" password:@"Our Password"]; <i class="conum" data-value="51"></i><b>(51)</b>      /</strong> Optionally set custom conflict resolver call back <strong>/     config.conflictResolver = [[LocalWinConflictResolver alloc] init]; <i class="conum" data-value="52"></i><b>(52)</b>      // Apply configuration settings to the replicator     self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="53"></i><b>(53)</b>      // Optionally add a change listener <i class="conum" data-value="54"></i><b>(54)</b>     // Retain token for use in deletion     id&lt;CBLListenerToken&gt; listenerToken = [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.activity == kCBLReplicatorStopped) {             NSLog(@"Replication stopped");         } else {             NSLog(@"Status:%d", change.status.activity);         };     }];     // Run the replicator using the config settings     [self.replicator start]; <i class="conum" data-value="55"></i><b>(55)</b>       NSLog(@"print to avoid warning %@", listenerToken); }  - (void) dontTestReplicatorStop {     id&lt;CBLListenerToken&gt; listenerToken;      // Remove the change listener     [self.replicator removeChangeListenerWithToken:listenerToken];      // Stop the replicator     [self.replicator stop];  }  // Additional Snippets from above  - (void) dontTestReplicatorConfigCerts {     CBLReplicatorConfiguration *config;     SecCertificateRef cert;     // Configure Server Security -- only accept CA Certs     config.acceptOnlySelfSignedServerCertificate = NO; <i class="conum" data-value="56"></i><b>(56)</b>        // Return the remote pinned cert (the listener's cert)     config.pinnedServerCertificate = cert; // Get listener cert if pinned   }  - (void) dontTestCACertPinned {     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      config.acceptOnlySelfSignedServerCertificate=false;   }  #pragma mark - Listener  - (void) dontTestListener {     NSError *error = nil;      // Initialize the listener config <i class="conum" data-value="57"></i><b>(57)</b>     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];      config.port =  55990; <i class="conum" data-value="58"></i><b>(58)</b>      config.networkInterface = @"10.1.1.10"; <i class="conum" data-value="59"></i><b>(59)</b>      config.enableDeltaSync = true; <i class="conum" data-value="60"></i><b>(60)</b>      // Configure server security     config.disableTLS  = false; <i class="conum" data-value="61"></i><b>(61)</b>       // Use an anonymous self-signed cert     config.tlsIdentity = nil; <i class="conum" data-value="62"></i><b>(62)</b>      // Configure Client Security using an Authenticator     // For example, Basic Authentication <i class="conum" data-value="63"></i><b>(63)</b>     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL(NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      // Initialize the listener <i class="conum" data-value="64"></i><b>(64)</b>     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      // start the listener <i class="conum" data-value="65"></i><b>(65)</b>     BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     }       [self.listener stop];  }  - (void) dontTestListenerGetNetworkInterfaces {     // . . .  code snippet to be provided  }  - (void) dontTestListenerGetURLList {     NSError *error = nil;     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      [self.listener startWithError:&amp;error];      NSLog(@"%@", self.listener.urls);  }  - (void) dontTestlistenerConfigClientAuth {     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];     // EXAMPLE 8     // Configure the client authenticator     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="66"></i><b>(66)</b>     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]];  <i class="conum" data-value="67"></i><b>(67)</b> <i class="conum" data-value="68"></i><b>(68)</b>  }  - (void) dontTestListenerLocalDB {     NSError *error = nil;     SecCertificateRef cert;     // . . . preceding application logic . . .     // FIXME: anything??     // Include websockets listener initializer code      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     // Configure server authentication     config.disableTLS  = true; <i class="conum" data-value="69"></i><b>(69)</b>       // EXAMPLE 6     // Use CA Cert     // Create a TLSIdentity from a key-pair and     // certificate in secure storage     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="70"></i><b>(70)</b>      NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     CBLTLSIdentity *tlsIdentity = [CBLTLSIdentity importIdentityWithData:data                                                                 password:@"123"                                                                    label:@"couchbase-docs-cert"                                                                    error:&amp;error]; <i class="conum" data-value="71"></i><b>(71)</b>      config.tlsIdentity = tlsIdentity; <i class="conum" data-value="72"></i><b>(72)</b>      // Use a self-signed certificate     NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" }; <i class="conum" data-value="73"></i><b>(73)</b>      tlsIdentity = [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/                                                attributes:attrs                                                expiration:[NSDate dateWithTimeIntervalSinceNow:86400]                                                     label:@"couchbase-docs-cert"                                                     error:&amp;error]; <i class="conum" data-value="74"></i><b>(74)</b>      // set the TLS Identity     config.tlsIdentity = tlsIdentity; <i class="conum" data-value="75"></i><b>(75)</b>        // Authenticate self-signed cert     // using application logic     CBLListenerCertificateAuthenticator *authenticator = [[CBLListenerCertificateAuthenticator alloc]                                                           initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  <i class="conum" data-value="76"></i><b>(76)</b>      config.authenticator = authenticator; <i class="conum" data-value="77"></i><b>(77)</b>        config.disableTLS  = YES;       config.tlsIdentity = nil;        config.enableDeltaSync = YES;        NSUInteger totalConnections = self.listener.status.connectionCount;     NSUInteger activeConnections = self.listener.status.activeConnectionCount;      NSLog(@"Connection status = %lu/%lu", activeConnections,totalConnections);       // cert is a pre-populated object of type:SecCertificate representing a certificate     CFDataRef rootCertData = SecCertificateCopyData(cert);     CFAutorelease(rootCertData);     SecCertificateRef rootCert = SecCertificateCreateWithData(NULL, rootCertData);      // Listener:     config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCert)]];       config.authenticator = [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  }  #pragma mark - JSON API  - (void) dontTestToJSONBlob {     // Example 2. Using Blobs      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     CBLBlob *blob = [doc blobForKey:@"avatar"];     NSString *json = [blob toJSON];     NSLog(@"json string is %@", json);  }  - (void) dontTestDictionaryAsJSON {     NSError *error = nil;     // Example 6. Dictionaries as JSON strings     NSString *aJSONstring = @"{\"id\":\"1002\",\"type\":\"hotel\",\"name\":\"Hotel Ned\","     "\"city\":\"Balmain\",\"country\":\"Australia\",\"description\":\"Undefined description for Hotel Ned\"}";       CBLMutableDictionary *myDict = [[CBLMutableDictionary alloc] initWithJSON:aJSONstring                                                                         error:&amp;error];      NSString *name = [myDict stringForKey:@"name"];      for (NSString *key in myDict) {         NSLog(@"%@ %@", key, [myDict valueForKey:key]);     }      NSLog(@"%@", name); }  - (void) dontTestToJSONDocument {     // Example 7. Documents as JSON strings      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     NSString *json = [doc toJSON];     NSLog(@"json %@", json);  }  - (void) dontTestJSONAsArray {     NSError *error = nil;     NSString *json = @"[\"1000\",\"1001\",\"1002\",\"1003\"]";      CBLMutableArray *myArray = [[CBLMutableArray alloc] initWithJSON:json error:&amp;error];      for (NSString *item in myArray) {         NSLog(@"%@", item);     }  }  #pragma mark - SGW - (void) dontTestSGWActiveReplicatorInitialize {     // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://10.0.2.2.com:55990/travel-sample"];     CBLURLEndpoint *listener = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:listener]; <i class="conum" data-value="78"></i><b>(78)</b>      // END -- snippets --     NSLog(@"print to aviod warning %@", config.description); }  @end  #pragma mark -  // Singleton Pattern // &lt;doc&gt; @interface DataManager :NSObject  @property (nonatomic, readonly) CBLDatabase *database;  + (id)sharedInstance;  @end  @implementation DataManager  @synthesize database=_database;  + (id)sharedInstance {     static DataManager *sharedInstance = nil;     static dispatch_once_t onceToken;     dispatch_once(&amp;onceToken, ^{         sharedInstance = [[self alloc] init];     });     return sharedInstance; }  - (id)init {     if (self = [super init]) {         NSError *error;         _database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];         if (!_database) {             NSLog(@"Cannot open the database:%@", error);             return nil;         }     }     return self; }  @end // &lt;doc&gt;  // Peer-to-Peer Sample  /</strong> ----------------------------------------------------------- <strong>/ /</strong> ---------------------  ACTIVE SIDE  ----------------------- <strong>/ /</strong> ---------------  stubs for documentation  ----------------- <strong>/ /</strong> ----------------------------------------------------------- <strong>/ @interface ActivePeer:NSObject &lt;CBLMessageEndpointDelegate&gt;  @end  @interface ActivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt; - (void)disconnect; - (void)receive:(NSData</strong>)data; @end  @implementation ActivePeer  - (instancetype) init {     self = [super init];     if (self) {         NSError <strong>error = nil;         CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];          // The delegate must implement the <code>CBLMessageEndpointDelegate</code> protocol.         NSString *id = @"";         CBLMessageEndpoint *endpoint = [[CBLMessageEndpoint alloc] initWithUID:@"UID:123"                                                                         target:id                                                                   protocolType:kCBLProtocolTypeMessageStream                                                                       delegate:self];          CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                               initWithDatabase:database target:endpoint];          // Create the replicator object.         CBLReplicator *replicator = [[CBLReplicator alloc] initWithConfig:config];         [replicator start];     }     return self; }  - (id&lt;CBLMessageEndpointConnection&gt;)createConnectionForEndpoint:(CBLMessageEndpoint *)endpoint {     return [[ActivePeerConnection alloc] init]; }  @end   @implementation ActivePeerConnection {     id &lt;CBLReplicatorConnection&gt; _replicatorConnection; }  - (void)disconnect {     [_replicatorConnection close:nil]; }  /</strong> implementation of CBLMessageEndpointConnection <strong>/ - (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullablecompletion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}

@end

/</strong> ----------------------------------------------------------- <strong>/
/</strong> ---------------------  PASSIVE SIDE  ---------------------- <strong>/
/</strong> ---------------  stubs for documentation  ----------------- <strong>/
/</strong> ----------------------------------------------------------- <strong>/
@interface PassivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt;
- (void)startListener;
- (void)stopListener;
- (void)disconnect;
- (void)receive:(NSData</strong>)data;
@end

@implementation PassivePeerConnection {
    CBLMessageEndpointListener <strong>_messageEndpointListener;
    id &lt;CBLReplicatorConnection&gt; _replicatorConnection;
}

- (void)startListener {
    NSError *error = nil;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];

    CBLMessageEndpointListenerConfiguration *config =
    [[CBLMessageEndpointListenerConfiguration alloc] initWithDatabase:database
                                                         protocolType:kCBLProtocolTypeMessageStream];
    _messageEndpointListener = [[CBLMessageEndpointListener alloc] initWithConfig:config];
}

- (void)stopListener {
    [_messageEndpointListener closeAll];
}

- (void)acceptConnection {
    PassivePeerConnection *connection = [[PassivePeerConnection alloc] init]; /</strong> implements CBLMessageEndpointConnection <strong>/
    [_messageEndpointListener accept:connection];
}

- (void)disconnect {
    [_replicatorConnection close:nil];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}
@end

#pragma mark - TLS Manage Functions

//
//  cMyGetCert.swift
//  doco-sync
//
//  Created by Ian Bridge on 20/06/2020.
//  Copyright  2020 Couchbase Inc. All rights reserved.
//

@interface MyGetCert1 :NSObject

- (CBLTLSIdentity</strong>) fMyGetCert;

@end

@implementation MyGetCert1

- (CBLTLSIdentity*) fMyGetCert {
    NSError <strong>error = nil;
    CBLReplicatorConfiguration *config; // FIXME: Are we sure? this is Replicator config?
    // Check if Id exists in keychain and if so, use it
    CBLTLSIdentity *identity = [CBLTLSIdentity identityWithLabel:@"doco-sync-server" error:&amp;error]; <i class="conum" data-value="79"></i><b>(79)</b>

    config.authenticator = [[CBLClientCertificateAuthenticator alloc] initWithIdentity:identity]; <i class="conum" data-value="80"></i><b>(80)</b>


    // CREATE IDENTITY FROM BUNDLED RESOURCE IF FOUND

    // Check for a resource bundle with required label to generate identity from
    // return nil identify if not found
    NSString *path = [[NSBundle mainBundle] pathForResource:@"doco-sync-server" ofType:@"p12"];
    NSData *data = [NSData dataWithContentsOfFile:path
                                              options:0
                                                error:&amp;error];
    if (!data)
        return nil;


    // Use SecPKCS12Import to import the contents (identities and certificates)
    // of the required resource bundle (PKCS #12 formatted blob).
    //
    // Set passphrase using kSecImportExportPassphrase.
    // This passphrase should correspond to what was specified when .p12 file was created
    CFArrayRef result = NULL;
    NSDictionary *options = @{ (id)kSecImportExportPassphrase:@"couchbase" };
    OSStatus status = SecPKCS12Import((</em>bridge CFDataRef)data, (<em>bridge CFDictionaryRef)options, &amp;result);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import data from provided with error :%d ", (int)status);
        return nil;
    }

    NSArray *importedItems = (NSArray</strong>)CFBridgingRelease(result);
    NSDictionary <strong>item = importedItems[0];

    // Get SecIdentityRef representing the item's id
    SecIdentityRef identityRef = (</em>bridge SecIdentityRef) item[(id)kSecImportItemIdentity];

    // Get Id's Private Key, return nil id if fails
    SecKeyRef privateKey;
    status = SecIdentityCopyPrivateKey(identityRef, &amp;privateKey);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import private key from provided with error :%d ", (int)status);
        return nil;
    }
    CFAutorelease(privateKey);

    // Get all relevant certs [SecCertificate] from the ID's cert chain using kSecImportItemCertChain
    NSArray *certChain = item[(id)kSecImportItemCertChain];

    // Return nil Id if errors in key or cert chain at this stage
    if (!certChain || !privateKey)
        return nil;


    // FIXME: Use the same tag as tag: [create-self-signed-cert]

    // RETURN A TLSIDENTITY FROM THE KEYCHAIN FOR USE IN CONFIGURING TLS COMMUNICATION
    return [CBLTLSIdentity identityWithIdentity:identityRef
                                          certs:@[certChain[1]]
                                          error:&amp;error];
}

- (void) dontTestDeleteTLSIdentityFromKeychain {
    NSError *error;

    [CBLTLSIdentity deleteIdentityWithLabel:@"doco-sync-server-1" error:&amp;error];

}

@end

#pragma mark - For replications

// BEGIN -- snippets --
//    Purpose -- code samples for use in replication topic

@interface MyClass :NSObject
@property (nonatomic) CBLDatabase *database;
@property (nonatomic) CBLReplicator *replicator; <i class="conum" data-value="1"></i><b>(1)</b>
@end

@implementation MyClass
@synthesize database=_database;
@synthesize replicator=_replicator;

- (void) startReplication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"]; <i class="conum" data-value="2"></i><b>(2)</b>
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:_database
                                                                                       target:target];
    config.replicatorType = kCBLReplicatorTypePull;
    _replicator = [[CBLReplicator alloc] initWithConfig:config];
    [_replicator start];
}
@end


/</strong>
&lt;1&gt; A replication is an asynchronous operation.
To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
&lt;2&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.


 */</code></pre>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create and populate a mutable array <code>phones</code></p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">//
//  SampleCodeTest.m
//  CouchbaseLite
//
//  Copyright (c) 2018 Couchbase, Inc All rights reserved.
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//  <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//

#import &lt;UIKit/UIKit.h&gt;
#import &lt;CouchbaseLite/CouchbaseLite.h&gt;
#import &lt;CoreML/CoreML.h&gt;


#pragma mark - !!!Note
/<strong>*
 Note for Consistency across the code snippets:

 1. We will keep the '</strong>' with instance after the space.
    <code>NSDictionary <strong>dict = [NSDictionary dictionary];</code>

 2. For making more space in single line, we will avoid space after the ':' in function call.
    <code>[myMLModel predictImage:imageData];</code>

 3. Will only keep <code>self.database</code> when using database, query and replicator related code snippet.
    Except when creating a new database sample.

 4. Will only keep <code>self.otherDB</code> when using listener-db

 5. While using replicator/listener, we will use as ivar <code>self.replicator</code> and <code>self.listener</code> resp.
 */

#pragma mark -

// <code>myMLModel</code> is a fake implementation
// this would be the implementation of the ml model you have chosen
@interface myMLModel :NSObject

+ (NSDictionary</strong>)predictImage:(NSData*)data;

@end

@interface ImageClassifierModel :NSObject &lt;CBLPredictiveModel&gt;

- (nullable CBLDictionary*) predict:(CBLDictionary*)input;

@end

@implementation ImageClassifierModel

- (nullable CBLDictionary*) predict:(CBLDictionary*)input; {
    CBLBlob <strong>blob = [input blobForKey:@"photo"];

    NSData *imageData = blob.content;
    // <code>myMLModel</code> is a fake implementation
    // this would be the implementation of the ml model you have chosen
    NSDictionary *modelOutput = [myMLModel predictImage:imageData];

    CBLMutableDictionary *output = [[CBLMutableDictionary alloc] initWithData:modelOutput];
    return output; <i class="conum" data-value="1"></i><b>(1)</b>
}

@end

// to avoid link error
@implementation myMLModel
+ (NSDictionary</strong>)predictImage:(NSData*)data { return [NSDictionary dictionary]; }
@end

@interface LogTestLogger :NSObject&lt;CBLLogger&gt;

// set the log level
@property (nonatomic) CBLLogLevel level;

@end

@implementation LogTestLogger

@synthesize level=_level;

- (void) logWithLevel:(CBLLogLevel)level domain:(CBLLogDomain)domain message:(NSString*)message {
    // handle the message, for example piping it to
    // a third party framework
}

@end


@interface LocalWinConflictResolver :NSObject&lt;CBLConflictResolver&gt;
@end

@implementation LocalWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.localDocument;
}

@end

@interface RemoteWinConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation RemoteWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.remoteDocument;
}

@end


@interface MergeConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation MergeConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    NSDictionary <strong>localDict = conflict.localDocument.toDictionary;
    NSDictionary *remoteDict = conflict.remoteDocument.toDictionary;

    NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:localDict];
    [result addEntriesFromDictionary:remoteDict];

    return [[CBLMutableDocument alloc] initWithID:conflict.documentID
                                             data:result];
}

@end

@interface Hotel :NSObject
@property (nonatomic) NSString *id;
@property (nonatomic) NSString *name;
@property (nonatomic) NSString *city;
@property (nonatomic) NSString *country;
@property (nonatomic) NSString *descriptive;
@end

@implementation Hotel
@synthesize id, name, city, country, descriptive;
@end

@interface SampleCodeTest :NSObject
@property(nonatomic) CBLDatabase *database;
@property(nonatomic) CBLDatabase *otherDB;
@property(nonatomic) CBLURLEndpointListener *listener;
@property(nonatomic) CBLReplicator *replicator;
@end

@implementation SampleCodeTest

#pragma mark - Database

- (void) dontTestNewDatabase {
    NSError *error;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"my-database" error:&amp;error];
    if (!database) {
        NSLog(@"Cannot open the database:%@", error);
    }
    self.database = database;

    if (![self.database close:&amp;error])
        NSLog(@"Error closing db:%@", error);

}

- (void) dontTestLogging {

    // Replicator / Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Query /  Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainQuery;
}

#if COUCHBASE_ENTERPRISE
- (void) dontTestDatabaseEncryption {
    CBLDatabaseConfiguration *config = [[CBLDatabaseConfiguration alloc] init];
    config.encryptionKey = [[CBLEncryptionKey alloc] initWithPassword:@"secretpassword"];

    NSError *error;
    self.database = [[CBLDatabase alloc] initWithName:@"my-database" config:config error:&amp;error];
    if (!self.database) {
        NSLog(@"Cannot open the database:%@", error);
    }
}
#endif

- (void) dontTestEnableConsoleLogging {
    CBLDatabase.log.console.domains = kCBLLogDomainAll; <i class="conum" data-value="1"></i><b>(1)</b>
    CBLDatabase.log.console.level = kCBLLogLevelVerbose; <i class="conum" data-value="2"></i><b>(2)</b>


    CBLDatabase.log.console.domains = kCBLLogDomainAll;

}

- (void) dontTestFileLogging {
    NSString *tempFolder = [NSTemporaryDirectory() stringByAppendingPathComponent:@"cbllog"];
    CBLLogFileConfiguration *config = [[CBLLogFileConfiguration alloc] initWithDirectory:tempFolder]; <i class="conum" data-value="3"></i><b>(3)</b>
    config.maxRotateCount = 2; <i class="conum" data-value="4"></i><b>(4)</b>
    config.maxSize = 1024; <i class="conum" data-value="5"></i><b>(5)</b>
    config.usePlainText = YES; <i class="conum" data-value="6"></i><b>(6)</b>
    [CBLDatabase.log.file setConfig:config];
    [CBLDatabase.log.file setLevel:kCBLLogLevelInfo]; <i class="conum" data-value="7"></i><b>(7)</b>
}

- (void) dontTestEnableCustomLogging {
    LogTestLogger *logger = [[LogTestLogger alloc] init];
    logger.level = kCBLLogLevelWarning;
    [CBLDatabase.log setCustom:logger];

}

- (void) dontTestLoadingPrebuilt {
    // Note:Getting the path to a database is platform-specific.
    // For iOS you need to get the path from the main bundle.
    if (![CBLDatabase databaseExists:@"travel-sample" inDirectory:nil]) {
        NSError *error;
        NSString *path = [[NSBundle bundleForClass:[self class]] pathForResource:@"travel-sample" ofType:@"cblite2"];
        if (![CBLDatabase copyFromPath:path toDatabase:@"travel-sample" withConfig:nil error:&amp;error]) {
            [NSException raise:NSInternalInconsistencyException
                        format:@"Could not load pre-built database:%@", error];
        }
    }
}

#pragma mark - Document

- (void) dontTestInitializer {
    NSError *error;

    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];
    [newTask setString:@"task" forKey:@"task"];
    [newTask setString:@"todo" forKey:@"owner"];
    [newTask setString:@"task" forKey:@"createdAt"];
    [self.database saveDocument:newTask error:&amp;error];
}

- (void) dontTestMutability {
    NSError *error;

    CBLDocument *document = [self.database documentWithID:@"xyz"];
    CBLMutableDocument *mutableDocument = [document toMutable];
    [mutableDocument setString:@"apples" forKey:@"name"];
    [self.database saveDocument:mutableDocument error:&amp;error];
}

- (void) dontTestTypedAcessors {
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];

    [newTask setValue:[NSDate date] forKey:@"createdAt"];
    NSDate *date = [newTask dateForKey:@"createdAt"];

    NSLog(@"Date:%@", date);
}

- (void) dontTestDataTypeDictionary {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting a dictionary value from the document
    CBLDictionary *dict = [document dictionaryForKey:@"address"];
    
    // Access a value from the dictionary
    NSString *street = [dict stringForKey:@"street"];
    NSLog(@"Street:: %@", street);
    
    // Iterate dictionary
    for (NSString *key in dict) {
        id value = [dict valueForKey:key];
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableDictionary *mutableDict = [dict toMutable];
    [mutableDict setString:@"1 Great sts" forKey:@"street"];
}

- (void) dontTestDataTypeMutableDictionary {
    
    // Create a new mutable dictionary and populate some keys/values
    CBLMutableDictionary *dict = [[CBLMutableDictionary alloc] init];
    [dict setString:@"1 Main st" forKey:@"street"];
    [dict setString:@"San Francisco" forKey:@"city"];
    
    // Set the dictionary to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setDictionary:dict forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestDataTypeArray {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting an array value from the document
    CBLArray *array = [document arrayForKey:@"phones"];
    
    // Get element count
    NSUInteger count = array.count;
    NSLog(@"Count:: %lu", (unsigned long)count);
    
    // Access an array element by index
    if (count &gt; 0) {
        id value = [array valueAtIndex:0];
        NSLog(@"Value:: %@", value);
    }
    
    // Iterate the array
    for (id value in array) {
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableArray *mutableArray = [array toMutable];
    [mutableArray addString:@"650-000-0002"];
}

- (void) dontTestDataTypeMutableArray {
    // Create a new mutable array and populate data into the array
    CBLMutableArray *array = [[CBLMutableArray alloc] init];
    [array addString:@"650-000-0000"];
    [array addString:@"650-000-0001"];
    
    // Set the array to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setArray:array forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestBatchOperations {
    NSError *error;

    [self.database inBatch:&amp;error usingBlock:^{
        for (int i = 0; i &lt; 10; i++) {
            CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
            [doc setValue:@"user" forKey:@"type"];
            [doc setValue:[NSString stringWithFormat:@"user %d", i] forKey:@"name"];
            [doc setBoolean:NO forKey:@"admin"];

            NSError *err = nil;
            [self.database saveDocument:doc error:&amp;err];
        }
    }];
}

- (void) dontTestChangeListener {
    <em>block SampleCodeTest *wSelf = self;
    [self.database addDocumentChangeListenerWithID:@"user.john" listener:^(CBLDocumentChange  *change) {
        CBLDocument *document = [wSelf.database documentWithID:change.documentID];
        NSLog(@"Status ::%@)", [document stringForKey:@"verified_account"]);
    }];
}

- (void) dontTestDocumentExpiration {
    NSError *error;

    // Purge the document one day from now
    NSDate *ttl = [[NSCalendar currentCalendar] dateByAddingUnit:NSCalendarUnitDay
                                                           value:1
                                                          toDate:[NSDate date]
                                                         options:0];
    [self.database setDocumentExpirationWithID:@"doc123" expiration:ttl error:&amp;error];

    // Reset expiration
    [self.database setDocumentExpirationWithID:@"doc1" expiration:nil error:&amp;error];

    // Query documents that will be expired in less than five minutes
    NSTimeInterval fiveMinutesFromNow = [[NSDate dateWithTimeIntervalSinceNow:60 * 5] timeIntervalSince1970];
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryMeta expiration]
                                                lessThan:[CBLQueryExpression double:fiveMinutesFromNow]]];
    NSLog(@"%@", query);
}

- (void) dontTestBlob {
#if TARGET_OS_IPHONE
    NSError *error;
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] initWithID:@"task1"];

    UIImage *appleImage = [UIImage imageNamed:@"avatar.jpg"];
    NSData *imageData = UIImageJPEGRepresentation(appleImage, 1.0);  <i class="conum" data-value="8"></i><b>(8)</b>

    CBLBlob *blob = [[CBLBlob alloc] initWithContentType:@"image/jpeg" data:imageData];  <i class="conum" data-value="9"></i><b>(9)</b>
    [newTask setBlob:blob forKey:@"avatar"]; <i class="conum" data-value="10"></i><b>(10)</b>
    [self.database saveDocument:newTask error:&amp;error];

    CBLDocument *savedTask = [self.database documentWithID:@"task1"];
    CBLBlob *taskBlob = [savedTask blobForKey:@"avatar"];
    UIImage *taskImage = [UIImage imageWithData:taskBlob.content];

    NSLog(@"%@", taskImage);
#endif
}

- (void) dontTest1xAttachment {
    CBLMutableDocument *document = [[CBLMutableDocument alloc] initWithID:@"task1"];

    CBLDictionary *attachments = [document dictionaryForKey:@"_attachments"];
    CBLBlob *avatar = [attachments blobForKey:@"avatar"];
    NSData *content = [avatar content];

    NSLog(@"%@", content);
}

#pragma mark - Query

- (void) dontTestIndexing {
    NSError *error;


    CBLValueIndexConfiguration</strong> config =
                [[CBLValueIndexConfiguration alloc]
                    initWithExpression: @[@"type", @"name"]];

    [self.database createIndexWithConfig: config name: @"TypeNameIndex" error: &amp;error];


}

- (void) dontTestIndexing_Querybuilder {
    NSError <strong>error;

    CBLValueIndexItem *type = [CBLValueIndexItem property:@"type"];
    CBLValueIndexItem *name = [CBLValueIndexItem property:@"name"];
    CBLIndex *index = [CBLIndexBuilder valueIndexWithItems:@[type, name]];
    [self.database createIndex:index withName:@"TypeNameIndex" error:&amp;error];
}



- (void) dontTestSelect {
    NSError *error;
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression value:@"user"]] andExpression:
                                               [[CBLQueryExpression property:@"admin"] equalTo:[CBLQueryExpression boolean:NO]]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"user name ::%@", [result stringAtIndex:0]);
    }
}

- (void) dontTestSelectProps {
    NSError *error;
    CBLQuerySelectResult *metaId = [CBLQuerySelectResult expression: CBLQueryMeta.id as:@"id"];
    CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[metaId, type, name]
                                         from:[CBLQueryDataSource database:self.database]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id :: %@", [result stringForKey:@"id"]);
        NSLog(@"document name :: %@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestSelectAll {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]];

    NSLog(@"%@", query);
}

- (void) dontTestLiveQuery {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]]; <i class="conum" data-value="11"></i><b>(11)</b>

    // Adds a query change listener.
    // Changes will be posted on the main queue.
    id&lt;CBLListenerToken&gt; token = [query addChangeListener:^(CBLQueryChange  *change) { <i class="conum" data-value="12"></i><b>(12)</b>
        for (CBLQueryResultSet *results in [change results]) {
            NSLog(@"%@", results);
            /</strong> Update UI <strong>/
        }
    }]; <i class="conum" data-value="13"></i><b>(13)</b>


    [query removeChangeListenerWithToken:token]; <i class="conum" data-value="14"></i><b>(14)</b>
}

- (void) dontTestWhere {
    NSError *error;
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:[CBLQueryLimit limit:[CBLQueryExpression integer:10]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        CBLDictionary *dict = [result valueForKey:@"travel-sample"];
        NSLog(@"document name ::%@", [dict stringForKey:@"name"]);
    }

    NSLog(@"%@", query);
}

- (void) dontTestQueryDeletedDocuments {
    // Query documents that have been deleted
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:CBLQueryMeta.id]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:CBLQueryMeta.isDeleted];
    NSLog(@"%@", query);
}

- (void) dontTestCollectionOperatorContains {
    NSError *error;

    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuerySelectResult *likes = [CBLQuerySelectResult property:@"public_likes"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]];
    CBLQueryExpression *contains = [CBLQueryArrayFunction contains:[CBLQueryExpression property:@"public_likes"]
                                                             value:[CBLQueryExpression string:@"Armani Langworth"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name, likes]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:contains]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"public_likes ::%@", [[result arrayForKey:@"public_likes"] toArray]);
    }
}

- (void) dontTestCollectionOperatorIn {
    NSArray *values = @[[CBLQueryExpression property:@"first"],
                       [CBLQueryExpression property:@"last"],
                       [CBLQueryExpression property:@"username"]];

    [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                       from:[CBLQueryDataSource database:self.database]
                      where:[[CBLQueryExpression string:@"Armani"] in:values]];
}

- (void) dontTestLikeOperator {
    NSError *error;
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"royal engineers museum"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"name property ::%@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestWildCardMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"eng%e%"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestWildCardCharacterMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryExpression property:@"name"] like:[CBLQueryExpression string:@"eng</em><em>r"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestRegexMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *regex = [[CBLQueryExpression property:@"name"] regex:[CBLQueryExpression string:@"\\bEng.*e\\b"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:regex]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestJoin {
    CBLQuerySelectResult *name = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"name" from:@"airline"]];
    CBLQuerySelectResult *callsign = [CBLQuerySelectResult
                                      expression:[CBLQueryExpression property:@"callsign" from:@"airline"]];
    CBLQuerySelectResult *dest = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"destinationairport" from:@"route"]];
    CBLQuerySelectResult *stops = [CBLQuerySelectResult
                                   expression:[CBLQueryExpression property:@"stops" from:@"route"]];
    CBLQuerySelectResult *airline = [CBLQuerySelectResult
                                     expression:[CBLQueryExpression property:@"airline" from:@"route"]];

    CBLQueryJoin *join = [CBLQueryJoin join:[CBLQueryDataSource database:self.database
                                                                      as:@"route"]
                                         on:[[CBLQueryMeta idFrom:@"airline"]
                                             equalTo:[CBLQueryExpression property:@"airlineid"
                                                                             from:@"route"]]];

    CBLQueryExpression *typeRoute = [[CBLQueryExpression property:@"type" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"route"]];
    CBLQueryExpression *typeAirline = [[CBLQueryExpression property:@"type" from:@"airline"]
                                       equalTo:[CBLQueryExpression string:@"airline"]];
    CBLQueryExpression *sourceRIX = [[CBLQueryExpression property:@"sourceairport" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"RIX"]];

    CBLQuery *query = [CBLQueryBuilder select:@[name, callsign, dest, stops, airline]
                                         from:[CBLQueryDataSource database:self.database as:@"airline"]
                                         join:@[join]
                                        where:[[typeRoute andExpression:typeAirline] andExpression:sourceRIX]];

    NSLog(@"%@", query);
}

- (void) dontTestGroupBy {
    CBLQuerySelectResult *count = [CBLQuerySelectResult expression:[CBLQueryFunction count:[CBLQueryExpression all]]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *tz = [CBLQuerySelectResult property:@"tz"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"airport"]];
    CBLQueryExpression *geoAlt = [[CBLQueryExpression property:@"geo.alt"] greaterThanOrEqualTo:[CBLQueryExpression integer:300]];

    CBLQuery *query = [CBLQueryBuilder select:@[count, country, tz]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:geoAlt]
                                      groupBy:@[[CBLQueryExpression property:@"country"],
                                                [CBLQueryExpression property:@"tz"]]];

    NSLog(@"%@", query);
}

- (void) dontTestOrderBy {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *title = [CBLQuerySelectResult property:@"title"];

    CBLQuery *query = [CBLQueryBuilder select:@[id, title]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      orderBy:@[[[CBLQueryOrdering property:@"title"] descending]]];

    NSLog(@"%@", query);
}


- (void) dontTestExplainAll {
    NSError *error;
    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[[CBLQueryExpression property:@"type"]
                   equalTo:[CBLQueryExpression string:@"university"]]
//            groupBy:@[[CBLQueryExpression property:@"country"]] <i class="conum" data-value="15"></i><b>(15)</b>
                          orderBy:@[[[CBLQueryOrdering property:@"title"] descending]] <i class="conum" data-value="16"></i><b>(16)</b>
       ];

    NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="17"></i><b>(17)</b>

}
- (void) dontTestExplainLike {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"%hotel%"]];
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];
      NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="18"></i><b>(18)</b>


}
- (void) dontTestExplainNoPfx {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"hotel%"]]; <i class="conum" data-value="19"></i><b>(19)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainFunction {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryFunction lower:[CBLQueryExpression property:@"type"]]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="20"></i><b>(20)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
                from:[CBLQueryDataSource database:self.database]
                where:[type andExpression:name]];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainNoFunction {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="21"></i><b>(21)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);


}



- (void) dontTestCreateFullTextIndex {
    NSError *error;

    // Insert documents
    NSArray *overviews = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *overview in overviews) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:overview forKey:@"overview"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndexConfiguration</strong> config =
        [[CBLFullTextIndexConfiguration alloc]
            initWithExpression: @[@"overview"]
            ignoreAccents: NO language: nil];

    [self.database createIndexWithConfig: config
            name: @"overviewFTSIndex" error: &amp;error];

}

- (void) dontTestFullTextSearch {
    NSError <strong>error;

    NSString *ftsQueryString =
    @"SELECT META().id FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)";

    CBLQueryResultSet *resultSet = [ftsQuery execute:&amp;error];
    NSArray</strong> results  = [resultSet allResults];
    for (CBLQueryResult <strong>result in results) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}




- (void) dontTestCreateFullTextIndex_Querybuilder {
    NSError *error;

    // Insert documents
    NSArray *tasks = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *task in tasks) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:task forKey:@"name"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndex *index = [CBLIndexBuilder fullTextIndexWithItems:@[[CBLFullTextIndexItem property:@"name"]]];
    index.ignoreAccents = NO;
    [self.database createIndex:index withName:@"nameFTSIndex" error:&amp;error];
}

- (void) dontTestFullTextSearch_Querybuilder {
    NSError *error;

    CBLQueryExpression *where = [CBLQueryFullTextFunction matchWithIndexName:@"nameFTSIndex"
                                                                       query:@"'buy'"];
    CBLQuery *query =
      [CBLQueryBuilder
        select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
        from:[CBLQueryDataSource database:self.database]
        where:where];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}









#pragma mark - Replication

/</strong> The <code>tag::replication[]</code> example is inlined in objc.adoc <strong>/

- (void) dontTestEnableReplicatorLogging {
    // Replicator
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Network
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainNetwork;
}

- (void) dontTestReplicationBasicAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicationSessionAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLSessionAuthenticator alloc] initWithSessionID:@"904ac010862f37c8dd99015a33ab5a3565fd8447"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicatorStatus {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    [self.replicator addChangeListener:^(CBLReplicatorChange *change) {
        if (change.status.activity == kCBLReplicatorStopped) {
            NSLog(@"Replication stopped");
        }
    }];
}


//  BEGIN PendingDocuments IB -- 11/Feb/21 --
- (void) testReplicationPendingDocs {

    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database
                                                                                       target:target];

    config.replicatorType = kCBLReplicatorTypePush;

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    // Get list of pending doc IDs
    NSError *err = nil;
    NSSet *pendingDocIds = [self.replicator pendingDocumentIDs:&amp;err]; <i class="conum" data-value="22"></i><b>(22)</b>


    if ([pendingDocIds count] &gt; 0) {

        NSLog(@"There are %lu documents pending", (unsigned long)[pendingDocIds count]);

        [self.replicator addChangeListener:^(CBLReplicatorChange *change) {

            NSLog(@"Replicator activity level is %u", change.status.activity);
            // iterate and report-on the pending doc IDs  in 'mydocids'
            for (NSString *docID in pendingDocIds) {

                NSError *err = nil;
                if (![change.replicator isDocumentPending:docID error:&amp;err]) { <i class="conum" data-value="23"></i><b>(23)</b>
                    NSLog(@"Doc ID %@ now pushed", docID);
                }
            }

        }];
        [self.replicator start];

    };

}
//  END PendingDocuments IB -- 11/Feb/21 --


- (void) dontTestReplicatorDocumentEvent {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    id token = [self.replicator addDocumentReplicationListener:^(CBLDocumentReplication  *replication) {
        NSLog(@"Replication type ::%@", replication.isPush ? @"Push" :@"Pull");
        for (CBLReplicatedDocument *document in replication.documents) {
            if (document.error == nil) {
                NSLog(@"Doc ID ::%@", document.id);
                if document.flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {                     NSLog(@"Successfully replicated a deleted document");                 }             } else {                 // There was an error             }         }     }];      [self.replicator start];      [self.replicator removeChangeListenerWithToken:token]; }  - (void) dontTestCustomReplicationHeader {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:endpoint];     config.headers = @{@"CustomHeaderName" :@"Value"}; }  - (void) dontTestHandlingReplicationError {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }]; }  - (void) dontTestReplicationResetCheckpoint {     BOOL restCheckpoint = NO;     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      if (restCheckpoint)         [self.replicator startWithReset:restCheckpoint]; <i class="conum" data-value="24"></i><b>(24)</b>  }  - (void) dontTestReplicationPushFilter {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pushFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ([[document stringForKey:@"type"] isEqualToString:@"draft"]) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestReplicationPullFilter {      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pullFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ((flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  //  Added 2/Feb/21 - Ian Bridge - (void) dontTestCustomRetryConfig {     id target = [[CBLURLEndpoint alloc] initWithURL:[NSURL URLWithString:@"ws://foo.cbl.com/db"]];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.replicatorType = kCBLReplicatorTypePush;     config.continuous = YES;     //  other config as required . . .      config.heartbeat = 150; <i class="conum" data-value="25"></i><b>(25)</b>      config.maxAttempts = 20; <i class="conum" data-value="26"></i><b>(26)</b>      config.maxAttemptWaitTime = 600; <i class="conum" data-value="27"></i><b>(27)</b>      //  other config as required . . .     self.replicator = [[CBLReplicator alloc] initWithConfig:config];  }   #ifdef COUCHBASE_ENTERPRISE - (void) dontTestDatabaseReplica {     /</strong> EE feature:code below might throw a compilation error      if it's compiled against CBL Swift Community. <strong>/     CBLDatabaseEndpoint *targetDatabase = [[CBLDatabaseEndpoint alloc] initWithDatabase:self.otherDB];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:targetDatabase];     config.replicatorType = kCBLReplicatorTypePush;      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; } #endif  - (void) dontTestCertificatePinning {     // Active - Example 4     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      NSLog(@"%@", config); }  - (NSData</strong>) dataFromResource:(NSString*)file ofType:(NSString*)type {     return [NSData data]; }  - (void) dontTestGettingStarted {     // Get the database (and create it if it doesnt exist).     NSError <strong>error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      // Create a new document (i.e. a record) in the database.     CBLMutableDocument *mutableDoc = [[CBLMutableDocument alloc] init];     [mutableDoc setFloat:2.0 forKey:@"version"];     [mutableDoc setString:@"SDK" forKey:@"type"];      // Save it to the database.     [self.database saveDocument:mutableDoc error:&amp;error];      // Update a document.     CBLMutableDocument *mutableDoc2 = [[self.database documentWithID:mutableDoc.id] toMutable];     [mutableDoc2 setString:@"Swift" forKey:@"language"];     [self.database saveDocument:mutableDoc2 error:&amp;error];      CBLDocument *document = [self.database documentWithID:mutableDoc2.id];     // Log the document ID (generated by the database)     // and properties     NSLog(@"Document ID ::%@", document.id);     NSLog(@"Learning %@", [document stringForKey:@"language"]);      // Create a query to fetch documents of type SDK.     CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"SDK"]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                           from:[CBLQueryDataSource database:self.database]                                          where:type];      // Run the query     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]);      // Create replicators to push and pull changes to and from the cloud.     NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *targetEndpoint = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                            target:targetEndpoint];     config.replicatorType = kCBLReplicatorTypePushAndPull;      // Add authentication.     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];      // Create replicator (make sure to add an ivar)     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      // Listen to replicator change events.     [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }];      // Start replication     [self.replicator start]; }  - (void) dontTestPredictiveModel {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      ImageClassifierModel *model = [[ImageClassifierModel alloc] init];     [[CBLDatabase prediction] registerModel:model withName:@"ImageClassifier"];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input];      CBLValueIndex *index = [CBLIndexBuilder valueIndexWithItems:@[[CBLValueIndexItem expression:[prediction property:@"label"]]]];     [self.database createIndex:index withName:@"value-index-image-classifier" error:&amp;error];      [[CBLDatabase prediction] unregisterModelWithName:@"ImageClassifier"]; }  - (void) dontTestPredictiveIndex {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];      CBLPredictiveIndex *index = [CBLIndexBuilder predictiveIndexWithModel:@"ImageClassifier" input:input properties:nil];     [self.database createIndex:index withName:@"predictive-index-image-classifier" error:&amp;error]; }  - (void) dontTestPredictiveQuery {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input]; <i class="conum" data-value="1"></i><b>(1)</b>      CBLQueryExpression *condition = [[[prediction property:@"label"] equalTo:[CBLQueryExpression string:@"car"]]                                      andExpression:[[prediction property:@"probablity"] greaterThanOrEqualTo:[CBLQueryExpression double:0.8]]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:condition];      // Run the query.     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]); }  - (void) dontTestCoreMLPredictiveModel {     NSError *error;      // Load MLModel from <code>ImageClassifier.mlmodel</code>     NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@"ImageClassifier" withExtension:@"mlmodel"];     NSURL *compiledModelURL = [MLModel compileModelAtURL:modelURL error:&amp;error];     MLModel *model = [MLModel modelWithContentsOfURL:compiledModelURL error:&amp;error];     CBLCoreMLPredictiveModel *predictiveModel = [[CBLCoreMLPredictiveModel alloc] initWithMLModel:model];      // Register model     [[CBLDatabase prediction] registerModel:predictiveModel withName:@"ImageClassifier"]; }  - (void) dontTestReplicatorConflictResolver {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.conflictResolver = [[LocalWinConflictResolver alloc] init];      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestSaveWithConflictHandler {     NSError *error;      CBLDocument *document = [self.database documentWithID:@"xyz"];     CBLMutableDocument *mutableDocument = [document toMutable];     [mutableDocument setString:@"apples" forKey:@"name"];      [self.database saveDocument:mutableDocument            conflictHandler:^BOOL(CBLMutableDocument *new, CBLDocument *current) {                NSDictionary *currentDict = current.toDictionary;                NSDictionary *newDict = new.toDictionary;                 NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:currentDict];                [result addEntriesFromDictionary:newDict];                [new setData:result];                return YES;            }                      error:&amp;error]; }  #pragma mark - URLListener  - (BOOL) isValidCredentials:(NSString</strong>)u password:(NSString*)p { return YES; } // helper - (BOOL) isValidCertificates:(NSArray*)certs { return YES; } // helper  - (void) dontTestInitListener {     CBLURLEndpointListenerConfiguration <strong>config;     config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.database];     config.tlsIdentity = nil; // Use with anonymous self signed cert     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL( NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; }  - (void) dontTestListenerStart {     NSError *error = nil;      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } }  - (void) dontTestListenerStop {     [self.listener stop]; }  - (void) dontTestCreateSelfSignedCert {     NSError *error = nil;     CBLTLSIdentity *identity = nil;     // &lt;site-rooot&gt;/objc/advance/objc-p2psync-websocket-using-passive.html     // Example-6      NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" };     identity =       [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/         attributes:attrs         expiration:[NSDate dateWithTimeIntervalSinceNow:86400]         label:@"Server-Cert-Label"         error:&amp;error]; }  - (void) dontTestListenerCertificateAuthenticatorRootCert {     CBLURLEndpointListenerConfiguration *config;      // Example 8-tab1      NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]]; }  - (void) dontTestListenerCertificateAuthenticatorCallback {     CBLURLEndpointListenerConfiguration *config;     // Example 8-tab2      CBLListenerCertificateAuthenticator *listenerAuth =     [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];      config.authenticator = listenerAuth; }  # pragma mark - QUERY RESULT SET HANDLING EXAMPLES  - (void) dontTestQuerySyntaxJson {     NSError *error;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                              from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="28"></i><b>(28)</b>        CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {          NSDictionary *data = [result valueAtIndex:0];          // Use dictionary values         NSLog(@"id = %@", [data valueForKey:@"id"]);         NSLog(@"name = %@", [data valueForKey:@"name"]);         NSLog(@"type = %@", [data valueForKey:@"type"]);         NSLog(@"city = %@", [data valueForKey:@"city"]);      } // end for       CBLQueryResultSet *rs = [query execute:&amp;error];     for (CBLQueryResult *result in rs) {          // Get result as a JSON string         NSString *json = [result toJSON]; <i class="conum" data-value="29"></i><b>(29)</b>          // Get an native Obj-C object from the Json String         NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:[json dataUsingEncoding:NSUTF8StringEncoding]                                                                          options:NSJSONReadingAllowFragments                                                                            error:&amp;error]; <i class="conum" data-value="30"></i><b>(30)</b>          // Log generated Json and Native objects         // For demo/example purposes         NSLog(@"Json String %@", json);         NSLog(@"Native Object %@", dict);      }; // end for   } // end function  - (void) dontTestQuerySyntaxAndAccessProps {     NSError *error = nil;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];      CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];      CBLQuerySelectResult *city = [CBLQuerySelectResult property:@"city"];      CBLQuery *query = [CBLQueryBuilder select:@[id, type, name, city]                                          from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="31"></i><b>(31)</b>       CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) { // all results         NSLog(@"id = %@", [result stringForKey:@"id"]);         NSLog(@"name = %@", [result stringForKey:@"name"]);         NSLog(@"type = %@", [result stringForKey:@"type"]);         NSLog(@"city = %@", [result stringForKey:@"city"]);      }  }  - (void) dontTestQuerySyntaxCount {     NSError *error = nil;     NSInteger count = 0;     CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQueryExpression *countExpression = [CBLQueryFunction count:[CBLQueryExpression all]];     CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:countExpression                                                                        as:@"myCount"];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]]; <i class="conum" data-value="32"></i><b>(32)</b>      CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {         count = [result integerForKey:@"myCount"]; <i class="conum" data-value="33"></i><b>(33)</b>      } // end for       NSLog(@"print to avoid warning %@ %ld", query, count); }  - (void) dontTestQuerySyntaxID {     NSError *error = nil;      CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]];      NSLog(@"print to avoid warning %@", query); }  - (void) dontTestQueryAccessID {     CBLQuery *query;     NSError *error = nil;      CBLQueryResultSet *results = [query execute:&amp;error];     CBLDocument *doc = nil;     NSString *docId = nil;     for (CBLQueryResult *result in results) {         docId = [result stringForKey:@"id"]; <i class="conum" data-value="34"></i><b>(34)</b>          // Now you can get the document using its ID         // for example using         doc = [self.database documentWithID:docId];      }      NSLog(@"doc.id = %@", doc.id); }  - (void) dontTestQuerySyntaxPagination {     int offset = 0;     int limit = 20;      CBLQueryLimit *queryLimit = [CBLQueryLimit limit:[CBLQueryExpression integer:limit]                                               offset:[CBLQueryExpression integer:offset]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:nil                                       groupBy:nil                                        having:nil                                       orderBy:nil                                         limit:queryLimit];     NSLog(@"print to avoid warning %@", query); }  - (void) dontTestDocsOnly_QuerySyntaxN1QL {     // Documentation Only query-syntax-n1ql     NSError *error;      NSString *queryString = @"SELECT * FROM _ WHERE type = \"hotel\""; <i class="conum" data-value="35"></i><b>(35)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryResultSet *results = [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  - (void) dontTestDocsOnly_QuerySyntaxN1QLParams {     // Documentation Only query-syntax-n1ql-params     NSError *error;      NSString *queryString = [NSString stringWithFormat:@"SELECT * FROM _ WHERE type = $type"]; <i class="conum" data-value="36"></i><b>(36)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryParameters *params = [[CBLQueryParameters alloc] init];     [params setString:@"hotel" forName:@"type"]; <i class="conum" data-value="37"></i><b>(37)</b>     query.parameters = params;      CBLQueryResultSet *results =  [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  #pragma mark - PEER-to-PEER  - (void) dontTestListenerSimple {     NSError *error = nil;      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database]; <i class="conum" data-value="38"></i><b>(38)</b>      config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                                 initWithBlock:^BOOL(NSString  *validUser, NSString  *validPassword) {         return [self isValidCredentials:validUser password:validPassword];     }]; <i class="conum" data-value="39"></i><b>(39)</b>      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="40"></i><b>(40)</b>      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } <i class="conum" data-value="41"></i><b>(41)</b>  }  - (void) dontTestReplicatorSimple {     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="42"></i><b>(42)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:endpoint]; <i class="conum" data-value="43"></i><b>(43)</b>      config.acceptOnlySelfSignedServerCertificate = YES; // &lt;.&gt; //FIXME: Remove this from doc!      config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"valid.user"                                                                   password:@"valid.password.string"]; <i class="conum" data-value="44"></i><b>(44)</b>       self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="45"></i><b>(45)</b>      [self.replicator start]; <i class="conum" data-value="46"></i><b>(46)</b>  }  - (void) dontTestP2PURLEndpointListener {     // FIXME: can we use the docsn site to show the interface of the Listener class?     // <a href="https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html" class="bare">https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html</a> }  - (void) dontTestURLEndpointListenerConstructor {     NSUInteger wssPort = 4985;     NSUInteger wsPort = 4984;     BOOL isTLS = NO;     CBLListenerPasswordAuthenticator *auth = [[CBLListenerPasswordAuthenticator alloc]                                               initWithBlock:^BOOL(NSString *username, NSString *password) {         return YES;     }];      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.otherDB];     config.port = isTLS ? wssPort :wsPort;     config.disableTLS = !isTLS;     config.authenticator = auth;      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="1"></i><b>(1)</b> }  - (void) dontTestMyActivePeer {     NSError *error = nil;     self.database = [[CBLDatabase alloc] initWithName:@"database" error:&amp;error];     if (!self.database) {         NSLog(@"Cannot open the database:%@", error);     };      // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="47"></i><b>(47)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:endpoint]; <i class="conum" data-value="48"></i><b>(48)</b>      config.replicatorType = kCBLReplicatorTypePush;      // set auto-purge behavior (here we override default)     config.enableAutoPurge = NO; <i class="conum" data-value="49"></i><b>(49)</b>      config.continuous = YES;      // Configure Server Authentication     // Here - expect and accept self-signed certs     config.acceptOnlySelfSignedServerCertificate = YES; <i class="conum" data-value="50"></i><b>(50)</b>      // Configure Client Authentication     // Here set client to use basic authentication     // Providing username and password credentials     // If prompted for them by server     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"Our Username" password:@"Our Password"]; <i class="conum" data-value="51"></i><b>(51)</b>      /</strong> Optionally set custom conflict resolver call back <strong>/     config.conflictResolver = [[LocalWinConflictResolver alloc] init]; <i class="conum" data-value="52"></i><b>(52)</b>      // Apply configuration settings to the replicator     self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="53"></i><b>(53)</b>      // Optionally add a change listener <i class="conum" data-value="54"></i><b>(54)</b>     // Retain token for use in deletion     id&lt;CBLListenerToken&gt; listenerToken = [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.activity == kCBLReplicatorStopped) {             NSLog(@"Replication stopped");         } else {             NSLog(@"Status:%d", change.status.activity);         };     }];     // Run the replicator using the config settings     [self.replicator start]; <i class="conum" data-value="55"></i><b>(55)</b>       NSLog(@"print to avoid warning %@", listenerToken); }  - (void) dontTestReplicatorStop {     id&lt;CBLListenerToken&gt; listenerToken;      // Remove the change listener     [self.replicator removeChangeListenerWithToken:listenerToken];      // Stop the replicator     [self.replicator stop];  }  // Additional Snippets from above  - (void) dontTestReplicatorConfigCerts {     CBLReplicatorConfiguration *config;     SecCertificateRef cert;     // Configure Server Security -- only accept CA Certs     config.acceptOnlySelfSignedServerCertificate = NO; <i class="conum" data-value="56"></i><b>(56)</b>        // Return the remote pinned cert (the listener's cert)     config.pinnedServerCertificate = cert; // Get listener cert if pinned   }  - (void) dontTestCACertPinned {     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      config.acceptOnlySelfSignedServerCertificate=false;   }  #pragma mark - Listener  - (void) dontTestListener {     NSError *error = nil;      // Initialize the listener config <i class="conum" data-value="57"></i><b>(57)</b>     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];      config.port =  55990; <i class="conum" data-value="58"></i><b>(58)</b>      config.networkInterface = @"10.1.1.10"; <i class="conum" data-value="59"></i><b>(59)</b>      config.enableDeltaSync = true; <i class="conum" data-value="60"></i><b>(60)</b>      // Configure server security     config.disableTLS  = false; <i class="conum" data-value="61"></i><b>(61)</b>       // Use an anonymous self-signed cert     config.tlsIdentity = nil; <i class="conum" data-value="62"></i><b>(62)</b>      // Configure Client Security using an Authenticator     // For example, Basic Authentication <i class="conum" data-value="63"></i><b>(63)</b>     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL(NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      // Initialize the listener <i class="conum" data-value="64"></i><b>(64)</b>     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      // start the listener <i class="conum" data-value="65"></i><b>(65)</b>     BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     }       [self.listener stop];  }  - (void) dontTestListenerGetNetworkInterfaces {     // . . .  code snippet to be provided  }  - (void) dontTestListenerGetURLList {     NSError *error = nil;     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      [self.listener startWithError:&amp;error];      NSLog(@"%@", self.listener.urls);  }  - (void) dontTestlistenerConfigClientAuth {     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];     // EXAMPLE 8     // Configure the client authenticator     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="66"></i><b>(66)</b>     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]];  <i class="conum" data-value="67"></i><b>(67)</b> <i class="conum" data-value="68"></i><b>(68)</b>  }  - (void) dontTestListenerLocalDB {     NSError *error = nil;     SecCertificateRef cert;     // . . . preceding application logic . . .     // FIXME: anything??     // Include websockets listener initializer code      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     // Configure server authentication     config.disableTLS  = true; <i class="conum" data-value="69"></i><b>(69)</b>       // EXAMPLE 6     // Use CA Cert     // Create a TLSIdentity from a key-pair and     // certificate in secure storage     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="70"></i><b>(70)</b>      NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     CBLTLSIdentity *tlsIdentity = [CBLTLSIdentity importIdentityWithData:data                                                                 password:@"123"                                                                    label:@"couchbase-docs-cert"                                                                    error:&amp;error]; <i class="conum" data-value="71"></i><b>(71)</b>      config.tlsIdentity = tlsIdentity; <i class="conum" data-value="72"></i><b>(72)</b>      // Use a self-signed certificate     NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" }; <i class="conum" data-value="73"></i><b>(73)</b>      tlsIdentity = [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/                                                attributes:attrs                                                expiration:[NSDate dateWithTimeIntervalSinceNow:86400]                                                     label:@"couchbase-docs-cert"                                                     error:&amp;error]; <i class="conum" data-value="74"></i><b>(74)</b>      // set the TLS Identity     config.tlsIdentity = tlsIdentity; <i class="conum" data-value="75"></i><b>(75)</b>        // Authenticate self-signed cert     // using application logic     CBLListenerCertificateAuthenticator *authenticator = [[CBLListenerCertificateAuthenticator alloc]                                                           initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  <i class="conum" data-value="76"></i><b>(76)</b>      config.authenticator = authenticator; <i class="conum" data-value="77"></i><b>(77)</b>        config.disableTLS  = YES;       config.tlsIdentity = nil;        config.enableDeltaSync = YES;        NSUInteger totalConnections = self.listener.status.connectionCount;     NSUInteger activeConnections = self.listener.status.activeConnectionCount;      NSLog(@"Connection status = %lu/%lu", activeConnections,totalConnections);       // cert is a pre-populated object of type:SecCertificate representing a certificate     CFDataRef rootCertData = SecCertificateCopyData(cert);     CFAutorelease(rootCertData);     SecCertificateRef rootCert = SecCertificateCreateWithData(NULL, rootCertData);      // Listener:     config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCert)]];       config.authenticator = [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  }  #pragma mark - JSON API  - (void) dontTestToJSONBlob {     // Example 2. Using Blobs      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     CBLBlob *blob = [doc blobForKey:@"avatar"];     NSString *json = [blob toJSON];     NSLog(@"json string is %@", json);  }  - (void) dontTestDictionaryAsJSON {     NSError *error = nil;     // Example 6. Dictionaries as JSON strings     NSString *aJSONstring = @"{\"id\":\"1002\",\"type\":\"hotel\",\"name\":\"Hotel Ned\","     "\"city\":\"Balmain\",\"country\":\"Australia\",\"description\":\"Undefined description for Hotel Ned\"}";       CBLMutableDictionary *myDict = [[CBLMutableDictionary alloc] initWithJSON:aJSONstring                                                                         error:&amp;error];      NSString *name = [myDict stringForKey:@"name"];      for (NSString *key in myDict) {         NSLog(@"%@ %@", key, [myDict valueForKey:key]);     }      NSLog(@"%@", name); }  - (void) dontTestToJSONDocument {     // Example 7. Documents as JSON strings      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     NSString *json = [doc toJSON];     NSLog(@"json %@", json);  }  - (void) dontTestJSONAsArray {     NSError *error = nil;     NSString *json = @"[\"1000\",\"1001\",\"1002\",\"1003\"]";      CBLMutableArray *myArray = [[CBLMutableArray alloc] initWithJSON:json error:&amp;error];      for (NSString *item in myArray) {         NSLog(@"%@", item);     }  }  #pragma mark - SGW - (void) dontTestSGWActiveReplicatorInitialize {     // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://10.0.2.2.com:55990/travel-sample"];     CBLURLEndpoint *listener = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:listener]; <i class="conum" data-value="78"></i><b>(78)</b>      // END -- snippets --     NSLog(@"print to aviod warning %@", config.description); }  @end  #pragma mark -  // Singleton Pattern // &lt;doc&gt; @interface DataManager :NSObject  @property (nonatomic, readonly) CBLDatabase *database;  + (id)sharedInstance;  @end  @implementation DataManager  @synthesize database=_database;  + (id)sharedInstance {     static DataManager *sharedInstance = nil;     static dispatch_once_t onceToken;     dispatch_once(&amp;onceToken, ^{         sharedInstance = [[self alloc] init];     });     return sharedInstance; }  - (id)init {     if (self = [super init]) {         NSError *error;         _database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];         if (!_database) {             NSLog(@"Cannot open the database:%@", error);             return nil;         }     }     return self; }  @end // &lt;doc&gt;  // Peer-to-Peer Sample  /</strong> ----------------------------------------------------------- <strong>/ /</strong> ---------------------  ACTIVE SIDE  ----------------------- <strong>/ /</strong> ---------------  stubs for documentation  ----------------- <strong>/ /</strong> ----------------------------------------------------------- <strong>/ @interface ActivePeer:NSObject &lt;CBLMessageEndpointDelegate&gt;  @end  @interface ActivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt; - (void)disconnect; - (void)receive:(NSData</strong>)data; @end  @implementation ActivePeer  - (instancetype) init {     self = [super init];     if (self) {         NSError <strong>error = nil;         CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];          // The delegate must implement the <code>CBLMessageEndpointDelegate</code> protocol.         NSString *id = @"";         CBLMessageEndpoint *endpoint = [[CBLMessageEndpoint alloc] initWithUID:@"UID:123"                                                                         target:id                                                                   protocolType:kCBLProtocolTypeMessageStream                                                                       delegate:self];          CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                               initWithDatabase:database target:endpoint];          // Create the replicator object.         CBLReplicator *replicator = [[CBLReplicator alloc] initWithConfig:config];         [replicator start];     }     return self; }  - (id&lt;CBLMessageEndpointConnection&gt;)createConnectionForEndpoint:(CBLMessageEndpoint *)endpoint {     return [[ActivePeerConnection alloc] init]; }  @end   @implementation ActivePeerConnection {     id &lt;CBLReplicatorConnection&gt; _replicatorConnection; }  - (void)disconnect {     [_replicatorConnection close:nil]; }  /</strong> implementation of CBLMessageEndpointConnection <strong>/ - (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullablecompletion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}

@end

/</strong> ----------------------------------------------------------- <strong>/
/</strong> ---------------------  PASSIVE SIDE  ---------------------- <strong>/
/</strong> ---------------  stubs for documentation  ----------------- <strong>/
/</strong> ----------------------------------------------------------- <strong>/
@interface PassivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt;
- (void)startListener;
- (void)stopListener;
- (void)disconnect;
- (void)receive:(NSData</strong>)data;
@end

@implementation PassivePeerConnection {
    CBLMessageEndpointListener <strong>_messageEndpointListener;
    id &lt;CBLReplicatorConnection&gt; _replicatorConnection;
}

- (void)startListener {
    NSError *error = nil;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];

    CBLMessageEndpointListenerConfiguration *config =
    [[CBLMessageEndpointListenerConfiguration alloc] initWithDatabase:database
                                                         protocolType:kCBLProtocolTypeMessageStream];
    _messageEndpointListener = [[CBLMessageEndpointListener alloc] initWithConfig:config];
}

- (void)stopListener {
    [_messageEndpointListener closeAll];
}

- (void)acceptConnection {
    PassivePeerConnection *connection = [[PassivePeerConnection alloc] init]; /</strong> implements CBLMessageEndpointConnection <strong>/
    [_messageEndpointListener accept:connection];
}

- (void)disconnect {
    [_replicatorConnection close:nil];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}
@end

#pragma mark - TLS Manage Functions

//
//  cMyGetCert.swift
//  doco-sync
//
//  Created by Ian Bridge on 20/06/2020.
//  Copyright  2020 Couchbase Inc. All rights reserved.
//

@interface MyGetCert1 :NSObject

- (CBLTLSIdentity</strong>) fMyGetCert;

@end

@implementation MyGetCert1

- (CBLTLSIdentity*) fMyGetCert {
    NSError <strong>error = nil;
    CBLReplicatorConfiguration *config; // FIXME: Are we sure? this is Replicator config?
    // Check if Id exists in keychain and if so, use it
    CBLTLSIdentity *identity = [CBLTLSIdentity identityWithLabel:@"doco-sync-server" error:&amp;error]; <i class="conum" data-value="79"></i><b>(79)</b>

    config.authenticator = [[CBLClientCertificateAuthenticator alloc] initWithIdentity:identity]; <i class="conum" data-value="80"></i><b>(80)</b>


    // CREATE IDENTITY FROM BUNDLED RESOURCE IF FOUND

    // Check for a resource bundle with required label to generate identity from
    // return nil identify if not found
    NSString *path = [[NSBundle mainBundle] pathForResource:@"doco-sync-server" ofType:@"p12"];
    NSData *data = [NSData dataWithContentsOfFile:path
                                              options:0
                                                error:&amp;error];
    if (!data)
        return nil;


    // Use SecPKCS12Import to import the contents (identities and certificates)
    // of the required resource bundle (PKCS #12 formatted blob).
    //
    // Set passphrase using kSecImportExportPassphrase.
    // This passphrase should correspond to what was specified when .p12 file was created
    CFArrayRef result = NULL;
    NSDictionary *options = @{ (id)kSecImportExportPassphrase:@"couchbase" };
    OSStatus status = SecPKCS12Import((</em>bridge CFDataRef)data, (<em>bridge CFDictionaryRef)options, &amp;result);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import data from provided with error :%d ", (int)status);
        return nil;
    }

    NSArray *importedItems = (NSArray</strong>)CFBridgingRelease(result);
    NSDictionary <strong>item = importedItems[0];

    // Get SecIdentityRef representing the item's id
    SecIdentityRef identityRef = (</em>bridge SecIdentityRef) item[(id)kSecImportItemIdentity];

    // Get Id's Private Key, return nil id if fails
    SecKeyRef privateKey;
    status = SecIdentityCopyPrivateKey(identityRef, &amp;privateKey);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import private key from provided with error :%d ", (int)status);
        return nil;
    }
    CFAutorelease(privateKey);

    // Get all relevant certs [SecCertificate] from the ID's cert chain using kSecImportItemCertChain
    NSArray *certChain = item[(id)kSecImportItemCertChain];

    // Return nil Id if errors in key or cert chain at this stage
    if (!certChain || !privateKey)
        return nil;


    // FIXME: Use the same tag as tag: [create-self-signed-cert]

    // RETURN A TLSIDENTITY FROM THE KEYCHAIN FOR USE IN CONFIGURING TLS COMMUNICATION
    return [CBLTLSIdentity identityWithIdentity:identityRef
                                          certs:@[certChain[1]]
                                          error:&amp;error];
}

- (void) dontTestDeleteTLSIdentityFromKeychain {
    NSError *error;

    [CBLTLSIdentity deleteIdentityWithLabel:@"doco-sync-server-1" error:&amp;error];

}

@end

#pragma mark - For replications

// BEGIN -- snippets --
//    Purpose -- code samples for use in replication topic

@interface MyClass :NSObject
@property (nonatomic) CBLDatabase *database;
@property (nonatomic) CBLReplicator *replicator; <i class="conum" data-value="1"></i><b>(1)</b>
@end

@implementation MyClass
@synthesize database=_database;
@synthesize replicator=_replicator;

- (void) startReplication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"]; <i class="conum" data-value="2"></i><b>(2)</b>
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:_database
                                                                                       target:target];
    config.replicatorType = kCBLReplicatorTypePull;
    _replicator = [[CBLReplicator alloc] initWithConfig:config];
    [_replicator start];
}
@end


/</strong>
&lt;1&gt; A replication is an asynchronous operation.
To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
&lt;2&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.


 */</code></pre>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Populate your hotel document</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">//
//  SampleCodeTest.m
//  CouchbaseLite
//
//  Copyright (c) 2018 Couchbase, Inc All rights reserved.
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//  <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//

#import &lt;UIKit/UIKit.h&gt;
#import &lt;CouchbaseLite/CouchbaseLite.h&gt;
#import &lt;CoreML/CoreML.h&gt;


#pragma mark - !!!Note
/<strong>*
 Note for Consistency across the code snippets:

 1. We will keep the '</strong>' with instance after the space.
    <code>NSDictionary <strong>dict = [NSDictionary dictionary];</code>

 2. For making more space in single line, we will avoid space after the ':' in function call.
    <code>[myMLModel predictImage:imageData];</code>

 3. Will only keep <code>self.database</code> when using database, query and replicator related code snippet.
    Except when creating a new database sample.

 4. Will only keep <code>self.otherDB</code> when using listener-db

 5. While using replicator/listener, we will use as ivar <code>self.replicator</code> and <code>self.listener</code> resp.
 */

#pragma mark -

// <code>myMLModel</code> is a fake implementation
// this would be the implementation of the ml model you have chosen
@interface myMLModel :NSObject

+ (NSDictionary</strong>)predictImage:(NSData*)data;

@end

@interface ImageClassifierModel :NSObject &lt;CBLPredictiveModel&gt;

- (nullable CBLDictionary*) predict:(CBLDictionary*)input;

@end

@implementation ImageClassifierModel

- (nullable CBLDictionary*) predict:(CBLDictionary*)input; {
    CBLBlob <strong>blob = [input blobForKey:@"photo"];

    NSData *imageData = blob.content;
    // <code>myMLModel</code> is a fake implementation
    // this would be the implementation of the ml model you have chosen
    NSDictionary *modelOutput = [myMLModel predictImage:imageData];

    CBLMutableDictionary *output = [[CBLMutableDictionary alloc] initWithData:modelOutput];
    return output; <i class="conum" data-value="1"></i><b>(1)</b>
}

@end

// to avoid link error
@implementation myMLModel
+ (NSDictionary</strong>)predictImage:(NSData*)data { return [NSDictionary dictionary]; }
@end

@interface LogTestLogger :NSObject&lt;CBLLogger&gt;

// set the log level
@property (nonatomic) CBLLogLevel level;

@end

@implementation LogTestLogger

@synthesize level=_level;

- (void) logWithLevel:(CBLLogLevel)level domain:(CBLLogDomain)domain message:(NSString*)message {
    // handle the message, for example piping it to
    // a third party framework
}

@end


@interface LocalWinConflictResolver :NSObject&lt;CBLConflictResolver&gt;
@end

@implementation LocalWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.localDocument;
}

@end

@interface RemoteWinConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation RemoteWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.remoteDocument;
}

@end


@interface MergeConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation MergeConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    NSDictionary <strong>localDict = conflict.localDocument.toDictionary;
    NSDictionary *remoteDict = conflict.remoteDocument.toDictionary;

    NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:localDict];
    [result addEntriesFromDictionary:remoteDict];

    return [[CBLMutableDocument alloc] initWithID:conflict.documentID
                                             data:result];
}

@end

@interface Hotel :NSObject
@property (nonatomic) NSString *id;
@property (nonatomic) NSString *name;
@property (nonatomic) NSString *city;
@property (nonatomic) NSString *country;
@property (nonatomic) NSString *descriptive;
@end

@implementation Hotel
@synthesize id, name, city, country, descriptive;
@end

@interface SampleCodeTest :NSObject
@property(nonatomic) CBLDatabase *database;
@property(nonatomic) CBLDatabase *otherDB;
@property(nonatomic) CBLURLEndpointListener *listener;
@property(nonatomic) CBLReplicator *replicator;
@end

@implementation SampleCodeTest

#pragma mark - Database

- (void) dontTestNewDatabase {
    NSError *error;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"my-database" error:&amp;error];
    if (!database) {
        NSLog(@"Cannot open the database:%@", error);
    }
    self.database = database;

    if (![self.database close:&amp;error])
        NSLog(@"Error closing db:%@", error);

}

- (void) dontTestLogging {

    // Replicator / Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Query /  Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainQuery;
}

#if COUCHBASE_ENTERPRISE
- (void) dontTestDatabaseEncryption {
    CBLDatabaseConfiguration *config = [[CBLDatabaseConfiguration alloc] init];
    config.encryptionKey = [[CBLEncryptionKey alloc] initWithPassword:@"secretpassword"];

    NSError *error;
    self.database = [[CBLDatabase alloc] initWithName:@"my-database" config:config error:&amp;error];
    if (!self.database) {
        NSLog(@"Cannot open the database:%@", error);
    }
}
#endif

- (void) dontTestEnableConsoleLogging {
    CBLDatabase.log.console.domains = kCBLLogDomainAll; <i class="conum" data-value="1"></i><b>(1)</b>
    CBLDatabase.log.console.level = kCBLLogLevelVerbose; <i class="conum" data-value="2"></i><b>(2)</b>


    CBLDatabase.log.console.domains = kCBLLogDomainAll;

}

- (void) dontTestFileLogging {
    NSString *tempFolder = [NSTemporaryDirectory() stringByAppendingPathComponent:@"cbllog"];
    CBLLogFileConfiguration *config = [[CBLLogFileConfiguration alloc] initWithDirectory:tempFolder]; <i class="conum" data-value="3"></i><b>(3)</b>
    config.maxRotateCount = 2; <i class="conum" data-value="4"></i><b>(4)</b>
    config.maxSize = 1024; <i class="conum" data-value="5"></i><b>(5)</b>
    config.usePlainText = YES; <i class="conum" data-value="6"></i><b>(6)</b>
    [CBLDatabase.log.file setConfig:config];
    [CBLDatabase.log.file setLevel:kCBLLogLevelInfo]; <i class="conum" data-value="7"></i><b>(7)</b>
}

- (void) dontTestEnableCustomLogging {
    LogTestLogger *logger = [[LogTestLogger alloc] init];
    logger.level = kCBLLogLevelWarning;
    [CBLDatabase.log setCustom:logger];

}

- (void) dontTestLoadingPrebuilt {
    // Note:Getting the path to a database is platform-specific.
    // For iOS you need to get the path from the main bundle.
    if (![CBLDatabase databaseExists:@"travel-sample" inDirectory:nil]) {
        NSError *error;
        NSString *path = [[NSBundle bundleForClass:[self class]] pathForResource:@"travel-sample" ofType:@"cblite2"];
        if (![CBLDatabase copyFromPath:path toDatabase:@"travel-sample" withConfig:nil error:&amp;error]) {
            [NSException raise:NSInternalInconsistencyException
                        format:@"Could not load pre-built database:%@", error];
        }
    }
}

#pragma mark - Document

- (void) dontTestInitializer {
    NSError *error;

    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];
    [newTask setString:@"task" forKey:@"task"];
    [newTask setString:@"todo" forKey:@"owner"];
    [newTask setString:@"task" forKey:@"createdAt"];
    [self.database saveDocument:newTask error:&amp;error];
}

- (void) dontTestMutability {
    NSError *error;

    CBLDocument *document = [self.database documentWithID:@"xyz"];
    CBLMutableDocument *mutableDocument = [document toMutable];
    [mutableDocument setString:@"apples" forKey:@"name"];
    [self.database saveDocument:mutableDocument error:&amp;error];
}

- (void) dontTestTypedAcessors {
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];

    [newTask setValue:[NSDate date] forKey:@"createdAt"];
    NSDate *date = [newTask dateForKey:@"createdAt"];

    NSLog(@"Date:%@", date);
}

- (void) dontTestDataTypeDictionary {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting a dictionary value from the document
    CBLDictionary *dict = [document dictionaryForKey:@"address"];
    
    // Access a value from the dictionary
    NSString *street = [dict stringForKey:@"street"];
    NSLog(@"Street:: %@", street);
    
    // Iterate dictionary
    for (NSString *key in dict) {
        id value = [dict valueForKey:key];
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableDictionary *mutableDict = [dict toMutable];
    [mutableDict setString:@"1 Great sts" forKey:@"street"];
}

- (void) dontTestDataTypeMutableDictionary {
    
    // Create a new mutable dictionary and populate some keys/values
    CBLMutableDictionary *dict = [[CBLMutableDictionary alloc] init];
    [dict setString:@"1 Main st" forKey:@"street"];
    [dict setString:@"San Francisco" forKey:@"city"];
    
    // Set the dictionary to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setDictionary:dict forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestDataTypeArray {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting an array value from the document
    CBLArray *array = [document arrayForKey:@"phones"];
    
    // Get element count
    NSUInteger count = array.count;
    NSLog(@"Count:: %lu", (unsigned long)count);
    
    // Access an array element by index
    if (count &gt; 0) {
        id value = [array valueAtIndex:0];
        NSLog(@"Value:: %@", value);
    }
    
    // Iterate the array
    for (id value in array) {
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableArray *mutableArray = [array toMutable];
    [mutableArray addString:@"650-000-0002"];
}

- (void) dontTestDataTypeMutableArray {
    // Create a new mutable array and populate data into the array
    CBLMutableArray *array = [[CBLMutableArray alloc] init];
    [array addString:@"650-000-0000"];
    [array addString:@"650-000-0001"];
    
    // Set the array to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setArray:array forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestBatchOperations {
    NSError *error;

    [self.database inBatch:&amp;error usingBlock:^{
        for (int i = 0; i &lt; 10; i++) {
            CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
            [doc setValue:@"user" forKey:@"type"];
            [doc setValue:[NSString stringWithFormat:@"user %d", i] forKey:@"name"];
            [doc setBoolean:NO forKey:@"admin"];

            NSError *err = nil;
            [self.database saveDocument:doc error:&amp;err];
        }
    }];
}

- (void) dontTestChangeListener {
    <em>block SampleCodeTest *wSelf = self;
    [self.database addDocumentChangeListenerWithID:@"user.john" listener:^(CBLDocumentChange  *change) {
        CBLDocument *document = [wSelf.database documentWithID:change.documentID];
        NSLog(@"Status ::%@)", [document stringForKey:@"verified_account"]);
    }];
}

- (void) dontTestDocumentExpiration {
    NSError *error;

    // Purge the document one day from now
    NSDate *ttl = [[NSCalendar currentCalendar] dateByAddingUnit:NSCalendarUnitDay
                                                           value:1
                                                          toDate:[NSDate date]
                                                         options:0];
    [self.database setDocumentExpirationWithID:@"doc123" expiration:ttl error:&amp;error];

    // Reset expiration
    [self.database setDocumentExpirationWithID:@"doc1" expiration:nil error:&amp;error];

    // Query documents that will be expired in less than five minutes
    NSTimeInterval fiveMinutesFromNow = [[NSDate dateWithTimeIntervalSinceNow:60 * 5] timeIntervalSince1970];
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryMeta expiration]
                                                lessThan:[CBLQueryExpression double:fiveMinutesFromNow]]];
    NSLog(@"%@", query);
}

- (void) dontTestBlob {
#if TARGET_OS_IPHONE
    NSError *error;
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] initWithID:@"task1"];

    UIImage *appleImage = [UIImage imageNamed:@"avatar.jpg"];
    NSData *imageData = UIImageJPEGRepresentation(appleImage, 1.0);  <i class="conum" data-value="8"></i><b>(8)</b>

    CBLBlob *blob = [[CBLBlob alloc] initWithContentType:@"image/jpeg" data:imageData];  <i class="conum" data-value="9"></i><b>(9)</b>
    [newTask setBlob:blob forKey:@"avatar"]; <i class="conum" data-value="10"></i><b>(10)</b>
    [self.database saveDocument:newTask error:&amp;error];

    CBLDocument *savedTask = [self.database documentWithID:@"task1"];
    CBLBlob *taskBlob = [savedTask blobForKey:@"avatar"];
    UIImage *taskImage = [UIImage imageWithData:taskBlob.content];

    NSLog(@"%@", taskImage);
#endif
}

- (void) dontTest1xAttachment {
    CBLMutableDocument *document = [[CBLMutableDocument alloc] initWithID:@"task1"];

    CBLDictionary *attachments = [document dictionaryForKey:@"_attachments"];
    CBLBlob *avatar = [attachments blobForKey:@"avatar"];
    NSData *content = [avatar content];

    NSLog(@"%@", content);
}

#pragma mark - Query

- (void) dontTestIndexing {
    NSError *error;


    CBLValueIndexConfiguration</strong> config =
                [[CBLValueIndexConfiguration alloc]
                    initWithExpression: @[@"type", @"name"]];

    [self.database createIndexWithConfig: config name: @"TypeNameIndex" error: &amp;error];


}

- (void) dontTestIndexing_Querybuilder {
    NSError <strong>error;

    CBLValueIndexItem *type = [CBLValueIndexItem property:@"type"];
    CBLValueIndexItem *name = [CBLValueIndexItem property:@"name"];
    CBLIndex *index = [CBLIndexBuilder valueIndexWithItems:@[type, name]];
    [self.database createIndex:index withName:@"TypeNameIndex" error:&amp;error];
}



- (void) dontTestSelect {
    NSError *error;
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression value:@"user"]] andExpression:
                                               [[CBLQueryExpression property:@"admin"] equalTo:[CBLQueryExpression boolean:NO]]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"user name ::%@", [result stringAtIndex:0]);
    }
}

- (void) dontTestSelectProps {
    NSError *error;
    CBLQuerySelectResult *metaId = [CBLQuerySelectResult expression: CBLQueryMeta.id as:@"id"];
    CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[metaId, type, name]
                                         from:[CBLQueryDataSource database:self.database]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id :: %@", [result stringForKey:@"id"]);
        NSLog(@"document name :: %@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestSelectAll {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]];

    NSLog(@"%@", query);
}

- (void) dontTestLiveQuery {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]]; <i class="conum" data-value="11"></i><b>(11)</b>

    // Adds a query change listener.
    // Changes will be posted on the main queue.
    id&lt;CBLListenerToken&gt; token = [query addChangeListener:^(CBLQueryChange  *change) { <i class="conum" data-value="12"></i><b>(12)</b>
        for (CBLQueryResultSet *results in [change results]) {
            NSLog(@"%@", results);
            /</strong> Update UI <strong>/
        }
    }]; <i class="conum" data-value="13"></i><b>(13)</b>


    [query removeChangeListenerWithToken:token]; <i class="conum" data-value="14"></i><b>(14)</b>
}

- (void) dontTestWhere {
    NSError *error;
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:[CBLQueryLimit limit:[CBLQueryExpression integer:10]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        CBLDictionary *dict = [result valueForKey:@"travel-sample"];
        NSLog(@"document name ::%@", [dict stringForKey:@"name"]);
    }

    NSLog(@"%@", query);
}

- (void) dontTestQueryDeletedDocuments {
    // Query documents that have been deleted
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:CBLQueryMeta.id]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:CBLQueryMeta.isDeleted];
    NSLog(@"%@", query);
}

- (void) dontTestCollectionOperatorContains {
    NSError *error;

    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuerySelectResult *likes = [CBLQuerySelectResult property:@"public_likes"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]];
    CBLQueryExpression *contains = [CBLQueryArrayFunction contains:[CBLQueryExpression property:@"public_likes"]
                                                             value:[CBLQueryExpression string:@"Armani Langworth"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name, likes]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:contains]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"public_likes ::%@", [[result arrayForKey:@"public_likes"] toArray]);
    }
}

- (void) dontTestCollectionOperatorIn {
    NSArray *values = @[[CBLQueryExpression property:@"first"],
                       [CBLQueryExpression property:@"last"],
                       [CBLQueryExpression property:@"username"]];

    [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                       from:[CBLQueryDataSource database:self.database]
                      where:[[CBLQueryExpression string:@"Armani"] in:values]];
}

- (void) dontTestLikeOperator {
    NSError *error;
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"royal engineers museum"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"name property ::%@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestWildCardMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"eng%e%"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestWildCardCharacterMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryExpression property:@"name"] like:[CBLQueryExpression string:@"eng</em><em>r"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestRegexMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *regex = [[CBLQueryExpression property:@"name"] regex:[CBLQueryExpression string:@"\\bEng.*e\\b"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:regex]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestJoin {
    CBLQuerySelectResult *name = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"name" from:@"airline"]];
    CBLQuerySelectResult *callsign = [CBLQuerySelectResult
                                      expression:[CBLQueryExpression property:@"callsign" from:@"airline"]];
    CBLQuerySelectResult *dest = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"destinationairport" from:@"route"]];
    CBLQuerySelectResult *stops = [CBLQuerySelectResult
                                   expression:[CBLQueryExpression property:@"stops" from:@"route"]];
    CBLQuerySelectResult *airline = [CBLQuerySelectResult
                                     expression:[CBLQueryExpression property:@"airline" from:@"route"]];

    CBLQueryJoin *join = [CBLQueryJoin join:[CBLQueryDataSource database:self.database
                                                                      as:@"route"]
                                         on:[[CBLQueryMeta idFrom:@"airline"]
                                             equalTo:[CBLQueryExpression property:@"airlineid"
                                                                             from:@"route"]]];

    CBLQueryExpression *typeRoute = [[CBLQueryExpression property:@"type" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"route"]];
    CBLQueryExpression *typeAirline = [[CBLQueryExpression property:@"type" from:@"airline"]
                                       equalTo:[CBLQueryExpression string:@"airline"]];
    CBLQueryExpression *sourceRIX = [[CBLQueryExpression property:@"sourceairport" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"RIX"]];

    CBLQuery *query = [CBLQueryBuilder select:@[name, callsign, dest, stops, airline]
                                         from:[CBLQueryDataSource database:self.database as:@"airline"]
                                         join:@[join]
                                        where:[[typeRoute andExpression:typeAirline] andExpression:sourceRIX]];

    NSLog(@"%@", query);
}

- (void) dontTestGroupBy {
    CBLQuerySelectResult *count = [CBLQuerySelectResult expression:[CBLQueryFunction count:[CBLQueryExpression all]]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *tz = [CBLQuerySelectResult property:@"tz"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"airport"]];
    CBLQueryExpression *geoAlt = [[CBLQueryExpression property:@"geo.alt"] greaterThanOrEqualTo:[CBLQueryExpression integer:300]];

    CBLQuery *query = [CBLQueryBuilder select:@[count, country, tz]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:geoAlt]
                                      groupBy:@[[CBLQueryExpression property:@"country"],
                                                [CBLQueryExpression property:@"tz"]]];

    NSLog(@"%@", query);
}

- (void) dontTestOrderBy {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *title = [CBLQuerySelectResult property:@"title"];

    CBLQuery *query = [CBLQueryBuilder select:@[id, title]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      orderBy:@[[[CBLQueryOrdering property:@"title"] descending]]];

    NSLog(@"%@", query);
}


- (void) dontTestExplainAll {
    NSError *error;
    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[[CBLQueryExpression property:@"type"]
                   equalTo:[CBLQueryExpression string:@"university"]]
//            groupBy:@[[CBLQueryExpression property:@"country"]] <i class="conum" data-value="15"></i><b>(15)</b>
                          orderBy:@[[[CBLQueryOrdering property:@"title"] descending]] <i class="conum" data-value="16"></i><b>(16)</b>
       ];

    NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="17"></i><b>(17)</b>

}
- (void) dontTestExplainLike {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"%hotel%"]];
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];
      NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="18"></i><b>(18)</b>


}
- (void) dontTestExplainNoPfx {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"hotel%"]]; <i class="conum" data-value="19"></i><b>(19)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainFunction {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryFunction lower:[CBLQueryExpression property:@"type"]]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="20"></i><b>(20)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
                from:[CBLQueryDataSource database:self.database]
                where:[type andExpression:name]];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainNoFunction {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="21"></i><b>(21)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);


}



- (void) dontTestCreateFullTextIndex {
    NSError *error;

    // Insert documents
    NSArray *overviews = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *overview in overviews) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:overview forKey:@"overview"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndexConfiguration</strong> config =
        [[CBLFullTextIndexConfiguration alloc]
            initWithExpression: @[@"overview"]
            ignoreAccents: NO language: nil];

    [self.database createIndexWithConfig: config
            name: @"overviewFTSIndex" error: &amp;error];

}

- (void) dontTestFullTextSearch {
    NSError <strong>error;

    NSString *ftsQueryString =
    @"SELECT META().id FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)";

    CBLQueryResultSet *resultSet = [ftsQuery execute:&amp;error];
    NSArray</strong> results  = [resultSet allResults];
    for (CBLQueryResult <strong>result in results) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}




- (void) dontTestCreateFullTextIndex_Querybuilder {
    NSError *error;

    // Insert documents
    NSArray *tasks = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *task in tasks) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:task forKey:@"name"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndex *index = [CBLIndexBuilder fullTextIndexWithItems:@[[CBLFullTextIndexItem property:@"name"]]];
    index.ignoreAccents = NO;
    [self.database createIndex:index withName:@"nameFTSIndex" error:&amp;error];
}

- (void) dontTestFullTextSearch_Querybuilder {
    NSError *error;

    CBLQueryExpression *where = [CBLQueryFullTextFunction matchWithIndexName:@"nameFTSIndex"
                                                                       query:@"'buy'"];
    CBLQuery *query =
      [CBLQueryBuilder
        select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
        from:[CBLQueryDataSource database:self.database]
        where:where];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}









#pragma mark - Replication

/</strong> The <code>tag::replication[]</code> example is inlined in objc.adoc <strong>/

- (void) dontTestEnableReplicatorLogging {
    // Replicator
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Network
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainNetwork;
}

- (void) dontTestReplicationBasicAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicationSessionAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLSessionAuthenticator alloc] initWithSessionID:@"904ac010862f37c8dd99015a33ab5a3565fd8447"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicatorStatus {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    [self.replicator addChangeListener:^(CBLReplicatorChange *change) {
        if (change.status.activity == kCBLReplicatorStopped) {
            NSLog(@"Replication stopped");
        }
    }];
}


//  BEGIN PendingDocuments IB -- 11/Feb/21 --
- (void) testReplicationPendingDocs {

    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database
                                                                                       target:target];

    config.replicatorType = kCBLReplicatorTypePush;

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    // Get list of pending doc IDs
    NSError *err = nil;
    NSSet *pendingDocIds = [self.replicator pendingDocumentIDs:&amp;err]; <i class="conum" data-value="22"></i><b>(22)</b>


    if ([pendingDocIds count] &gt; 0) {

        NSLog(@"There are %lu documents pending", (unsigned long)[pendingDocIds count]);

        [self.replicator addChangeListener:^(CBLReplicatorChange *change) {

            NSLog(@"Replicator activity level is %u", change.status.activity);
            // iterate and report-on the pending doc IDs  in 'mydocids'
            for (NSString *docID in pendingDocIds) {

                NSError *err = nil;
                if (![change.replicator isDocumentPending:docID error:&amp;err]) { <i class="conum" data-value="23"></i><b>(23)</b>
                    NSLog(@"Doc ID %@ now pushed", docID);
                }
            }

        }];
        [self.replicator start];

    };

}
//  END PendingDocuments IB -- 11/Feb/21 --


- (void) dontTestReplicatorDocumentEvent {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    id token = [self.replicator addDocumentReplicationListener:^(CBLDocumentReplication  *replication) {
        NSLog(@"Replication type ::%@", replication.isPush ? @"Push" :@"Pull");
        for (CBLReplicatedDocument *document in replication.documents) {
            if (document.error == nil) {
                NSLog(@"Doc ID ::%@", document.id);
                if document.flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {                     NSLog(@"Successfully replicated a deleted document");                 }             } else {                 // There was an error             }         }     }];      [self.replicator start];      [self.replicator removeChangeListenerWithToken:token]; }  - (void) dontTestCustomReplicationHeader {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:endpoint];     config.headers = @{@"CustomHeaderName" :@"Value"}; }  - (void) dontTestHandlingReplicationError {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }]; }  - (void) dontTestReplicationResetCheckpoint {     BOOL restCheckpoint = NO;     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      if (restCheckpoint)         [self.replicator startWithReset:restCheckpoint]; <i class="conum" data-value="24"></i><b>(24)</b>  }  - (void) dontTestReplicationPushFilter {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pushFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ([[document stringForKey:@"type"] isEqualToString:@"draft"]) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestReplicationPullFilter {      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pullFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ((flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  //  Added 2/Feb/21 - Ian Bridge - (void) dontTestCustomRetryConfig {     id target = [[CBLURLEndpoint alloc] initWithURL:[NSURL URLWithString:@"ws://foo.cbl.com/db"]];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.replicatorType = kCBLReplicatorTypePush;     config.continuous = YES;     //  other config as required . . .      config.heartbeat = 150; <i class="conum" data-value="25"></i><b>(25)</b>      config.maxAttempts = 20; <i class="conum" data-value="26"></i><b>(26)</b>      config.maxAttemptWaitTime = 600; <i class="conum" data-value="27"></i><b>(27)</b>      //  other config as required . . .     self.replicator = [[CBLReplicator alloc] initWithConfig:config];  }   #ifdef COUCHBASE_ENTERPRISE - (void) dontTestDatabaseReplica {     /</strong> EE feature:code below might throw a compilation error      if it's compiled against CBL Swift Community. <strong>/     CBLDatabaseEndpoint *targetDatabase = [[CBLDatabaseEndpoint alloc] initWithDatabase:self.otherDB];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:targetDatabase];     config.replicatorType = kCBLReplicatorTypePush;      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; } #endif  - (void) dontTestCertificatePinning {     // Active - Example 4     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      NSLog(@"%@", config); }  - (NSData</strong>) dataFromResource:(NSString*)file ofType:(NSString*)type {     return [NSData data]; }  - (void) dontTestGettingStarted {     // Get the database (and create it if it doesnt exist).     NSError <strong>error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      // Create a new document (i.e. a record) in the database.     CBLMutableDocument *mutableDoc = [[CBLMutableDocument alloc] init];     [mutableDoc setFloat:2.0 forKey:@"version"];     [mutableDoc setString:@"SDK" forKey:@"type"];      // Save it to the database.     [self.database saveDocument:mutableDoc error:&amp;error];      // Update a document.     CBLMutableDocument *mutableDoc2 = [[self.database documentWithID:mutableDoc.id] toMutable];     [mutableDoc2 setString:@"Swift" forKey:@"language"];     [self.database saveDocument:mutableDoc2 error:&amp;error];      CBLDocument *document = [self.database documentWithID:mutableDoc2.id];     // Log the document ID (generated by the database)     // and properties     NSLog(@"Document ID ::%@", document.id);     NSLog(@"Learning %@", [document stringForKey:@"language"]);      // Create a query to fetch documents of type SDK.     CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"SDK"]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                           from:[CBLQueryDataSource database:self.database]                                          where:type];      // Run the query     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]);      // Create replicators to push and pull changes to and from the cloud.     NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *targetEndpoint = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                            target:targetEndpoint];     config.replicatorType = kCBLReplicatorTypePushAndPull;      // Add authentication.     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];      // Create replicator (make sure to add an ivar)     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      // Listen to replicator change events.     [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }];      // Start replication     [self.replicator start]; }  - (void) dontTestPredictiveModel {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      ImageClassifierModel *model = [[ImageClassifierModel alloc] init];     [[CBLDatabase prediction] registerModel:model withName:@"ImageClassifier"];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input];      CBLValueIndex *index = [CBLIndexBuilder valueIndexWithItems:@[[CBLValueIndexItem expression:[prediction property:@"label"]]]];     [self.database createIndex:index withName:@"value-index-image-classifier" error:&amp;error];      [[CBLDatabase prediction] unregisterModelWithName:@"ImageClassifier"]; }  - (void) dontTestPredictiveIndex {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];      CBLPredictiveIndex *index = [CBLIndexBuilder predictiveIndexWithModel:@"ImageClassifier" input:input properties:nil];     [self.database createIndex:index withName:@"predictive-index-image-classifier" error:&amp;error]; }  - (void) dontTestPredictiveQuery {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input]; <i class="conum" data-value="1"></i><b>(1)</b>      CBLQueryExpression *condition = [[[prediction property:@"label"] equalTo:[CBLQueryExpression string:@"car"]]                                      andExpression:[[prediction property:@"probablity"] greaterThanOrEqualTo:[CBLQueryExpression double:0.8]]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:condition];      // Run the query.     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]); }  - (void) dontTestCoreMLPredictiveModel {     NSError *error;      // Load MLModel from <code>ImageClassifier.mlmodel</code>     NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@"ImageClassifier" withExtension:@"mlmodel"];     NSURL *compiledModelURL = [MLModel compileModelAtURL:modelURL error:&amp;error];     MLModel *model = [MLModel modelWithContentsOfURL:compiledModelURL error:&amp;error];     CBLCoreMLPredictiveModel *predictiveModel = [[CBLCoreMLPredictiveModel alloc] initWithMLModel:model];      // Register model     [[CBLDatabase prediction] registerModel:predictiveModel withName:@"ImageClassifier"]; }  - (void) dontTestReplicatorConflictResolver {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.conflictResolver = [[LocalWinConflictResolver alloc] init];      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestSaveWithConflictHandler {     NSError *error;      CBLDocument *document = [self.database documentWithID:@"xyz"];     CBLMutableDocument *mutableDocument = [document toMutable];     [mutableDocument setString:@"apples" forKey:@"name"];      [self.database saveDocument:mutableDocument            conflictHandler:^BOOL(CBLMutableDocument *new, CBLDocument *current) {                NSDictionary *currentDict = current.toDictionary;                NSDictionary *newDict = new.toDictionary;                 NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:currentDict];                [result addEntriesFromDictionary:newDict];                [new setData:result];                return YES;            }                      error:&amp;error]; }  #pragma mark - URLListener  - (BOOL) isValidCredentials:(NSString</strong>)u password:(NSString*)p { return YES; } // helper - (BOOL) isValidCertificates:(NSArray*)certs { return YES; } // helper  - (void) dontTestInitListener {     CBLURLEndpointListenerConfiguration <strong>config;     config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.database];     config.tlsIdentity = nil; // Use with anonymous self signed cert     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL( NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; }  - (void) dontTestListenerStart {     NSError *error = nil;      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } }  - (void) dontTestListenerStop {     [self.listener stop]; }  - (void) dontTestCreateSelfSignedCert {     NSError *error = nil;     CBLTLSIdentity *identity = nil;     // &lt;site-rooot&gt;/objc/advance/objc-p2psync-websocket-using-passive.html     // Example-6      NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" };     identity =       [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/         attributes:attrs         expiration:[NSDate dateWithTimeIntervalSinceNow:86400]         label:@"Server-Cert-Label"         error:&amp;error]; }  - (void) dontTestListenerCertificateAuthenticatorRootCert {     CBLURLEndpointListenerConfiguration *config;      // Example 8-tab1      NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]]; }  - (void) dontTestListenerCertificateAuthenticatorCallback {     CBLURLEndpointListenerConfiguration *config;     // Example 8-tab2      CBLListenerCertificateAuthenticator *listenerAuth =     [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];      config.authenticator = listenerAuth; }  # pragma mark - QUERY RESULT SET HANDLING EXAMPLES  - (void) dontTestQuerySyntaxJson {     NSError *error;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                              from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="28"></i><b>(28)</b>        CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {          NSDictionary *data = [result valueAtIndex:0];          // Use dictionary values         NSLog(@"id = %@", [data valueForKey:@"id"]);         NSLog(@"name = %@", [data valueForKey:@"name"]);         NSLog(@"type = %@", [data valueForKey:@"type"]);         NSLog(@"city = %@", [data valueForKey:@"city"]);      } // end for       CBLQueryResultSet *rs = [query execute:&amp;error];     for (CBLQueryResult *result in rs) {          // Get result as a JSON string         NSString *json = [result toJSON]; <i class="conum" data-value="29"></i><b>(29)</b>          // Get an native Obj-C object from the Json String         NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:[json dataUsingEncoding:NSUTF8StringEncoding]                                                                          options:NSJSONReadingAllowFragments                                                                            error:&amp;error]; <i class="conum" data-value="30"></i><b>(30)</b>          // Log generated Json and Native objects         // For demo/example purposes         NSLog(@"Json String %@", json);         NSLog(@"Native Object %@", dict);      }; // end for   } // end function  - (void) dontTestQuerySyntaxAndAccessProps {     NSError *error = nil;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];      CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];      CBLQuerySelectResult *city = [CBLQuerySelectResult property:@"city"];      CBLQuery *query = [CBLQueryBuilder select:@[id, type, name, city]                                          from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="31"></i><b>(31)</b>       CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) { // all results         NSLog(@"id = %@", [result stringForKey:@"id"]);         NSLog(@"name = %@", [result stringForKey:@"name"]);         NSLog(@"type = %@", [result stringForKey:@"type"]);         NSLog(@"city = %@", [result stringForKey:@"city"]);      }  }  - (void) dontTestQuerySyntaxCount {     NSError *error = nil;     NSInteger count = 0;     CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQueryExpression *countExpression = [CBLQueryFunction count:[CBLQueryExpression all]];     CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:countExpression                                                                        as:@"myCount"];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]]; <i class="conum" data-value="32"></i><b>(32)</b>      CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {         count = [result integerForKey:@"myCount"]; <i class="conum" data-value="33"></i><b>(33)</b>      } // end for       NSLog(@"print to avoid warning %@ %ld", query, count); }  - (void) dontTestQuerySyntaxID {     NSError *error = nil;      CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]];      NSLog(@"print to avoid warning %@", query); }  - (void) dontTestQueryAccessID {     CBLQuery *query;     NSError *error = nil;      CBLQueryResultSet *results = [query execute:&amp;error];     CBLDocument *doc = nil;     NSString *docId = nil;     for (CBLQueryResult *result in results) {         docId = [result stringForKey:@"id"]; <i class="conum" data-value="34"></i><b>(34)</b>          // Now you can get the document using its ID         // for example using         doc = [self.database documentWithID:docId];      }      NSLog(@"doc.id = %@", doc.id); }  - (void) dontTestQuerySyntaxPagination {     int offset = 0;     int limit = 20;      CBLQueryLimit *queryLimit = [CBLQueryLimit limit:[CBLQueryExpression integer:limit]                                               offset:[CBLQueryExpression integer:offset]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:nil                                       groupBy:nil                                        having:nil                                       orderBy:nil                                         limit:queryLimit];     NSLog(@"print to avoid warning %@", query); }  - (void) dontTestDocsOnly_QuerySyntaxN1QL {     // Documentation Only query-syntax-n1ql     NSError *error;      NSString *queryString = @"SELECT * FROM _ WHERE type = \"hotel\""; <i class="conum" data-value="35"></i><b>(35)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryResultSet *results = [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  - (void) dontTestDocsOnly_QuerySyntaxN1QLParams {     // Documentation Only query-syntax-n1ql-params     NSError *error;      NSString *queryString = [NSString stringWithFormat:@"SELECT * FROM _ WHERE type = $type"]; <i class="conum" data-value="36"></i><b>(36)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryParameters *params = [[CBLQueryParameters alloc] init];     [params setString:@"hotel" forName:@"type"]; <i class="conum" data-value="37"></i><b>(37)</b>     query.parameters = params;      CBLQueryResultSet *results =  [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  #pragma mark - PEER-to-PEER  - (void) dontTestListenerSimple {     NSError *error = nil;      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database]; <i class="conum" data-value="38"></i><b>(38)</b>      config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                                 initWithBlock:^BOOL(NSString  *validUser, NSString  *validPassword) {         return [self isValidCredentials:validUser password:validPassword];     }]; <i class="conum" data-value="39"></i><b>(39)</b>      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="40"></i><b>(40)</b>      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } <i class="conum" data-value="41"></i><b>(41)</b>  }  - (void) dontTestReplicatorSimple {     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="42"></i><b>(42)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:endpoint]; <i class="conum" data-value="43"></i><b>(43)</b>      config.acceptOnlySelfSignedServerCertificate = YES; // &lt;.&gt; //FIXME: Remove this from doc!      config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"valid.user"                                                                   password:@"valid.password.string"]; <i class="conum" data-value="44"></i><b>(44)</b>       self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="45"></i><b>(45)</b>      [self.replicator start]; <i class="conum" data-value="46"></i><b>(46)</b>  }  - (void) dontTestP2PURLEndpointListener {     // FIXME: can we use the docsn site to show the interface of the Listener class?     // <a href="https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html" class="bare">https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html</a> }  - (void) dontTestURLEndpointListenerConstructor {     NSUInteger wssPort = 4985;     NSUInteger wsPort = 4984;     BOOL isTLS = NO;     CBLListenerPasswordAuthenticator *auth = [[CBLListenerPasswordAuthenticator alloc]                                               initWithBlock:^BOOL(NSString *username, NSString *password) {         return YES;     }];      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.otherDB];     config.port = isTLS ? wssPort :wsPort;     config.disableTLS = !isTLS;     config.authenticator = auth;      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="1"></i><b>(1)</b> }  - (void) dontTestMyActivePeer {     NSError *error = nil;     self.database = [[CBLDatabase alloc] initWithName:@"database" error:&amp;error];     if (!self.database) {         NSLog(@"Cannot open the database:%@", error);     };      // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="47"></i><b>(47)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:endpoint]; <i class="conum" data-value="48"></i><b>(48)</b>      config.replicatorType = kCBLReplicatorTypePush;      // set auto-purge behavior (here we override default)     config.enableAutoPurge = NO; <i class="conum" data-value="49"></i><b>(49)</b>      config.continuous = YES;      // Configure Server Authentication     // Here - expect and accept self-signed certs     config.acceptOnlySelfSignedServerCertificate = YES; <i class="conum" data-value="50"></i><b>(50)</b>      // Configure Client Authentication     // Here set client to use basic authentication     // Providing username and password credentials     // If prompted for them by server     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"Our Username" password:@"Our Password"]; <i class="conum" data-value="51"></i><b>(51)</b>      /</strong> Optionally set custom conflict resolver call back <strong>/     config.conflictResolver = [[LocalWinConflictResolver alloc] init]; <i class="conum" data-value="52"></i><b>(52)</b>      // Apply configuration settings to the replicator     self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="53"></i><b>(53)</b>      // Optionally add a change listener <i class="conum" data-value="54"></i><b>(54)</b>     // Retain token for use in deletion     id&lt;CBLListenerToken&gt; listenerToken = [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.activity == kCBLReplicatorStopped) {             NSLog(@"Replication stopped");         } else {             NSLog(@"Status:%d", change.status.activity);         };     }];     // Run the replicator using the config settings     [self.replicator start]; <i class="conum" data-value="55"></i><b>(55)</b>       NSLog(@"print to avoid warning %@", listenerToken); }  - (void) dontTestReplicatorStop {     id&lt;CBLListenerToken&gt; listenerToken;      // Remove the change listener     [self.replicator removeChangeListenerWithToken:listenerToken];      // Stop the replicator     [self.replicator stop];  }  // Additional Snippets from above  - (void) dontTestReplicatorConfigCerts {     CBLReplicatorConfiguration *config;     SecCertificateRef cert;     // Configure Server Security -- only accept CA Certs     config.acceptOnlySelfSignedServerCertificate = NO; <i class="conum" data-value="56"></i><b>(56)</b>        // Return the remote pinned cert (the listener's cert)     config.pinnedServerCertificate = cert; // Get listener cert if pinned   }  - (void) dontTestCACertPinned {     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      config.acceptOnlySelfSignedServerCertificate=false;   }  #pragma mark - Listener  - (void) dontTestListener {     NSError *error = nil;      // Initialize the listener config <i class="conum" data-value="57"></i><b>(57)</b>     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];      config.port =  55990; <i class="conum" data-value="58"></i><b>(58)</b>      config.networkInterface = @"10.1.1.10"; <i class="conum" data-value="59"></i><b>(59)</b>      config.enableDeltaSync = true; <i class="conum" data-value="60"></i><b>(60)</b>      // Configure server security     config.disableTLS  = false; <i class="conum" data-value="61"></i><b>(61)</b>       // Use an anonymous self-signed cert     config.tlsIdentity = nil; <i class="conum" data-value="62"></i><b>(62)</b>      // Configure Client Security using an Authenticator     // For example, Basic Authentication <i class="conum" data-value="63"></i><b>(63)</b>     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL(NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      // Initialize the listener <i class="conum" data-value="64"></i><b>(64)</b>     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      // start the listener <i class="conum" data-value="65"></i><b>(65)</b>     BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     }       [self.listener stop];  }  - (void) dontTestListenerGetNetworkInterfaces {     // . . .  code snippet to be provided  }  - (void) dontTestListenerGetURLList {     NSError *error = nil;     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      [self.listener startWithError:&amp;error];      NSLog(@"%@", self.listener.urls);  }  - (void) dontTestlistenerConfigClientAuth {     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];     // EXAMPLE 8     // Configure the client authenticator     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="66"></i><b>(66)</b>     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]];  <i class="conum" data-value="67"></i><b>(67)</b> <i class="conum" data-value="68"></i><b>(68)</b>  }  - (void) dontTestListenerLocalDB {     NSError *error = nil;     SecCertificateRef cert;     // . . . preceding application logic . . .     // FIXME: anything??     // Include websockets listener initializer code      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     // Configure server authentication     config.disableTLS  = true; <i class="conum" data-value="69"></i><b>(69)</b>       // EXAMPLE 6     // Use CA Cert     // Create a TLSIdentity from a key-pair and     // certificate in secure storage     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="70"></i><b>(70)</b>      NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     CBLTLSIdentity *tlsIdentity = [CBLTLSIdentity importIdentityWithData:data                                                                 password:@"123"                                                                    label:@"couchbase-docs-cert"                                                                    error:&amp;error]; <i class="conum" data-value="71"></i><b>(71)</b>      config.tlsIdentity = tlsIdentity; <i class="conum" data-value="72"></i><b>(72)</b>      // Use a self-signed certificate     NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" }; <i class="conum" data-value="73"></i><b>(73)</b>      tlsIdentity = [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/                                                attributes:attrs                                                expiration:[NSDate dateWithTimeIntervalSinceNow:86400]                                                     label:@"couchbase-docs-cert"                                                     error:&amp;error]; <i class="conum" data-value="74"></i><b>(74)</b>      // set the TLS Identity     config.tlsIdentity = tlsIdentity; <i class="conum" data-value="75"></i><b>(75)</b>        // Authenticate self-signed cert     // using application logic     CBLListenerCertificateAuthenticator *authenticator = [[CBLListenerCertificateAuthenticator alloc]                                                           initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  <i class="conum" data-value="76"></i><b>(76)</b>      config.authenticator = authenticator; <i class="conum" data-value="77"></i><b>(77)</b>        config.disableTLS  = YES;       config.tlsIdentity = nil;        config.enableDeltaSync = YES;        NSUInteger totalConnections = self.listener.status.connectionCount;     NSUInteger activeConnections = self.listener.status.activeConnectionCount;      NSLog(@"Connection status = %lu/%lu", activeConnections,totalConnections);       // cert is a pre-populated object of type:SecCertificate representing a certificate     CFDataRef rootCertData = SecCertificateCopyData(cert);     CFAutorelease(rootCertData);     SecCertificateRef rootCert = SecCertificateCreateWithData(NULL, rootCertData);      // Listener:     config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCert)]];       config.authenticator = [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  }  #pragma mark - JSON API  - (void) dontTestToJSONBlob {     // Example 2. Using Blobs      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     CBLBlob *blob = [doc blobForKey:@"avatar"];     NSString *json = [blob toJSON];     NSLog(@"json string is %@", json);  }  - (void) dontTestDictionaryAsJSON {     NSError *error = nil;     // Example 6. Dictionaries as JSON strings     NSString *aJSONstring = @"{\"id\":\"1002\",\"type\":\"hotel\",\"name\":\"Hotel Ned\","     "\"city\":\"Balmain\",\"country\":\"Australia\",\"description\":\"Undefined description for Hotel Ned\"}";       CBLMutableDictionary *myDict = [[CBLMutableDictionary alloc] initWithJSON:aJSONstring                                                                         error:&amp;error];      NSString *name = [myDict stringForKey:@"name"];      for (NSString *key in myDict) {         NSLog(@"%@ %@", key, [myDict valueForKey:key]);     }      NSLog(@"%@", name); }  - (void) dontTestToJSONDocument {     // Example 7. Documents as JSON strings      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     NSString *json = [doc toJSON];     NSLog(@"json %@", json);  }  - (void) dontTestJSONAsArray {     NSError *error = nil;     NSString *json = @"[\"1000\",\"1001\",\"1002\",\"1003\"]";      CBLMutableArray *myArray = [[CBLMutableArray alloc] initWithJSON:json error:&amp;error];      for (NSString *item in myArray) {         NSLog(@"%@", item);     }  }  #pragma mark - SGW - (void) dontTestSGWActiveReplicatorInitialize {     // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://10.0.2.2.com:55990/travel-sample"];     CBLURLEndpoint *listener = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:listener]; <i class="conum" data-value="78"></i><b>(78)</b>      // END -- snippets --     NSLog(@"print to aviod warning %@", config.description); }  @end  #pragma mark -  // Singleton Pattern // &lt;doc&gt; @interface DataManager :NSObject  @property (nonatomic, readonly) CBLDatabase *database;  + (id)sharedInstance;  @end  @implementation DataManager  @synthesize database=_database;  + (id)sharedInstance {     static DataManager *sharedInstance = nil;     static dispatch_once_t onceToken;     dispatch_once(&amp;onceToken, ^{         sharedInstance = [[self alloc] init];     });     return sharedInstance; }  - (id)init {     if (self = [super init]) {         NSError *error;         _database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];         if (!_database) {             NSLog(@"Cannot open the database:%@", error);             return nil;         }     }     return self; }  @end // &lt;doc&gt;  // Peer-to-Peer Sample  /</strong> ----------------------------------------------------------- <strong>/ /</strong> ---------------------  ACTIVE SIDE  ----------------------- <strong>/ /</strong> ---------------  stubs for documentation  ----------------- <strong>/ /</strong> ----------------------------------------------------------- <strong>/ @interface ActivePeer:NSObject &lt;CBLMessageEndpointDelegate&gt;  @end  @interface ActivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt; - (void)disconnect; - (void)receive:(NSData</strong>)data; @end  @implementation ActivePeer  - (instancetype) init {     self = [super init];     if (self) {         NSError <strong>error = nil;         CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];          // The delegate must implement the <code>CBLMessageEndpointDelegate</code> protocol.         NSString *id = @"";         CBLMessageEndpoint *endpoint = [[CBLMessageEndpoint alloc] initWithUID:@"UID:123"                                                                         target:id                                                                   protocolType:kCBLProtocolTypeMessageStream                                                                       delegate:self];          CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                               initWithDatabase:database target:endpoint];          // Create the replicator object.         CBLReplicator *replicator = [[CBLReplicator alloc] initWithConfig:config];         [replicator start];     }     return self; }  - (id&lt;CBLMessageEndpointConnection&gt;)createConnectionForEndpoint:(CBLMessageEndpoint *)endpoint {     return [[ActivePeerConnection alloc] init]; }  @end   @implementation ActivePeerConnection {     id &lt;CBLReplicatorConnection&gt; _replicatorConnection; }  - (void)disconnect {     [_replicatorConnection close:nil]; }  /</strong> implementation of CBLMessageEndpointConnection <strong>/ - (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullablecompletion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}

@end

/</strong> ----------------------------------------------------------- <strong>/
/</strong> ---------------------  PASSIVE SIDE  ---------------------- <strong>/
/</strong> ---------------  stubs for documentation  ----------------- <strong>/
/</strong> ----------------------------------------------------------- <strong>/
@interface PassivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt;
- (void)startListener;
- (void)stopListener;
- (void)disconnect;
- (void)receive:(NSData</strong>)data;
@end

@implementation PassivePeerConnection {
    CBLMessageEndpointListener <strong>_messageEndpointListener;
    id &lt;CBLReplicatorConnection&gt; _replicatorConnection;
}

- (void)startListener {
    NSError *error = nil;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];

    CBLMessageEndpointListenerConfiguration *config =
    [[CBLMessageEndpointListenerConfiguration alloc] initWithDatabase:database
                                                         protocolType:kCBLProtocolTypeMessageStream];
    _messageEndpointListener = [[CBLMessageEndpointListener alloc] initWithConfig:config];
}

- (void)stopListener {
    [_messageEndpointListener closeAll];
}

- (void)acceptConnection {
    PassivePeerConnection *connection = [[PassivePeerConnection alloc] init]; /</strong> implements CBLMessageEndpointConnection <strong>/
    [_messageEndpointListener accept:connection];
}

- (void)disconnect {
    [_replicatorConnection close:nil];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}
@end

#pragma mark - TLS Manage Functions

//
//  cMyGetCert.swift
//  doco-sync
//
//  Created by Ian Bridge on 20/06/2020.
//  Copyright  2020 Couchbase Inc. All rights reserved.
//

@interface MyGetCert1 :NSObject

- (CBLTLSIdentity</strong>) fMyGetCert;

@end

@implementation MyGetCert1

- (CBLTLSIdentity*) fMyGetCert {
    NSError <strong>error = nil;
    CBLReplicatorConfiguration *config; // FIXME: Are we sure? this is Replicator config?
    // Check if Id exists in keychain and if so, use it
    CBLTLSIdentity *identity = [CBLTLSIdentity identityWithLabel:@"doco-sync-server" error:&amp;error]; <i class="conum" data-value="79"></i><b>(79)</b>

    config.authenticator = [[CBLClientCertificateAuthenticator alloc] initWithIdentity:identity]; <i class="conum" data-value="80"></i><b>(80)</b>


    // CREATE IDENTITY FROM BUNDLED RESOURCE IF FOUND

    // Check for a resource bundle with required label to generate identity from
    // return nil identify if not found
    NSString *path = [[NSBundle mainBundle] pathForResource:@"doco-sync-server" ofType:@"p12"];
    NSData *data = [NSData dataWithContentsOfFile:path
                                              options:0
                                                error:&amp;error];
    if (!data)
        return nil;


    // Use SecPKCS12Import to import the contents (identities and certificates)
    // of the required resource bundle (PKCS #12 formatted blob).
    //
    // Set passphrase using kSecImportExportPassphrase.
    // This passphrase should correspond to what was specified when .p12 file was created
    CFArrayRef result = NULL;
    NSDictionary *options = @{ (id)kSecImportExportPassphrase:@"couchbase" };
    OSStatus status = SecPKCS12Import((</em>bridge CFDataRef)data, (<em>bridge CFDictionaryRef)options, &amp;result);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import data from provided with error :%d ", (int)status);
        return nil;
    }

    NSArray *importedItems = (NSArray</strong>)CFBridgingRelease(result);
    NSDictionary <strong>item = importedItems[0];

    // Get SecIdentityRef representing the item's id
    SecIdentityRef identityRef = (</em>bridge SecIdentityRef) item[(id)kSecImportItemIdentity];

    // Get Id's Private Key, return nil id if fails
    SecKeyRef privateKey;
    status = SecIdentityCopyPrivateKey(identityRef, &amp;privateKey);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import private key from provided with error :%d ", (int)status);
        return nil;
    }
    CFAutorelease(privateKey);

    // Get all relevant certs [SecCertificate] from the ID's cert chain using kSecImportItemCertChain
    NSArray *certChain = item[(id)kSecImportItemCertChain];

    // Return nil Id if errors in key or cert chain at this stage
    if (!certChain || !privateKey)
        return nil;


    // FIXME: Use the same tag as tag: [create-self-signed-cert]

    // RETURN A TLSIDENTITY FROM THE KEYCHAIN FOR USE IN CONFIGURING TLS COMMUNICATION
    return [CBLTLSIdentity identityWithIdentity:identityRef
                                          certs:@[certChain[1]]
                                          error:&amp;error];
}

- (void) dontTestDeleteTLSIdentityFromKeychain {
    NSError *error;

    [CBLTLSIdentity deleteIdentityWithLabel:@"doco-sync-server-1" error:&amp;error];

}

@end

#pragma mark - For replications

// BEGIN -- snippets --
//    Purpose -- code samples for use in replication topic

@interface MyClass :NSObject
@property (nonatomic) CBLDatabase *database;
@property (nonatomic) CBLReplicator *replicator; <i class="conum" data-value="1"></i><b>(1)</b>
@end

@implementation MyClass
@synthesize database=_database;
@synthesize replicator=_replicator;

- (void) startReplication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"]; <i class="conum" data-value="2"></i><b>(2)</b>
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:_database
                                                                                       target:target];
    config.replicatorType = kCBLReplicatorTypePull;
    _replicator = [[CBLReplicator alloc] initWithConfig:config];
    [_replicator start];
}
@end


/</strong>
&lt;1&gt; A replication is an asynchronous operation.
To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
&lt;2&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.


 */</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="openblock">
<div class="content">
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add hotel name (string)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add average room rate (float)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add document type (string)<br>
Couchbase recommend using a <code>type</code> attribute to define each logical document type.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add address (dictionary)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add phone numbers (array)</td>
</tr>
</table>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Save the new document to database</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>{param-leader}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">//
//  SampleCodeTest.m
//  CouchbaseLite
//
//  Copyright (c) 2018 Couchbase, Inc All rights reserved.
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//  <a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a>
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//

#import &lt;UIKit/UIKit.h&gt;
#import &lt;CouchbaseLite/CouchbaseLite.h&gt;
#import &lt;CoreML/CoreML.h&gt;


#pragma mark - !!!Note
/<strong>*
 Note for Consistency across the code snippets:

 1. We will keep the '</strong>' with instance after the space.
    <code>NSDictionary <strong>dict = [NSDictionary dictionary];</code>

 2. For making more space in single line, we will avoid space after the ':' in function call.
    <code>[myMLModel predictImage:imageData];</code>

 3. Will only keep <code>self.database</code> when using database, query and replicator related code snippet.
    Except when creating a new database sample.

 4. Will only keep <code>self.otherDB</code> when using listener-db

 5. While using replicator/listener, we will use as ivar <code>self.replicator</code> and <code>self.listener</code> resp.
 */

#pragma mark -

// <code>myMLModel</code> is a fake implementation
// this would be the implementation of the ml model you have chosen
@interface myMLModel :NSObject

+ (NSDictionary</strong>)predictImage:(NSData*)data;

@end

@interface ImageClassifierModel :NSObject &lt;CBLPredictiveModel&gt;

- (nullable CBLDictionary*) predict:(CBLDictionary*)input;

@end

@implementation ImageClassifierModel

- (nullable CBLDictionary*) predict:(CBLDictionary*)input; {
    CBLBlob <strong>blob = [input blobForKey:@"photo"];

    NSData *imageData = blob.content;
    // <code>myMLModel</code> is a fake implementation
    // this would be the implementation of the ml model you have chosen
    NSDictionary *modelOutput = [myMLModel predictImage:imageData];

    CBLMutableDictionary *output = [[CBLMutableDictionary alloc] initWithData:modelOutput];
    return output; <i class="conum" data-value="1"></i><b>(1)</b>
}

@end

// to avoid link error
@implementation myMLModel
+ (NSDictionary</strong>)predictImage:(NSData*)data { return [NSDictionary dictionary]; }
@end

@interface LogTestLogger :NSObject&lt;CBLLogger&gt;

// set the log level
@property (nonatomic) CBLLogLevel level;

@end

@implementation LogTestLogger

@synthesize level=_level;

- (void) logWithLevel:(CBLLogLevel)level domain:(CBLLogDomain)domain message:(NSString*)message {
    // handle the message, for example piping it to
    // a third party framework
}

@end


@interface LocalWinConflictResolver :NSObject&lt;CBLConflictResolver&gt;
@end

@implementation LocalWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.localDocument;
}

@end

@interface RemoteWinConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation RemoteWinConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    return conflict.remoteDocument;
}

@end


@interface MergeConflictResolver:NSObject&lt;CBLConflictResolver&gt;
@end

@implementation MergeConflictResolver
- (CBLDocument*) resolve:(CBLConflict*)conflict {
    NSDictionary <strong>localDict = conflict.localDocument.toDictionary;
    NSDictionary *remoteDict = conflict.remoteDocument.toDictionary;

    NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:localDict];
    [result addEntriesFromDictionary:remoteDict];

    return [[CBLMutableDocument alloc] initWithID:conflict.documentID
                                             data:result];
}

@end

@interface Hotel :NSObject
@property (nonatomic) NSString *id;
@property (nonatomic) NSString *name;
@property (nonatomic) NSString *city;
@property (nonatomic) NSString *country;
@property (nonatomic) NSString *descriptive;
@end

@implementation Hotel
@synthesize id, name, city, country, descriptive;
@end

@interface SampleCodeTest :NSObject
@property(nonatomic) CBLDatabase *database;
@property(nonatomic) CBLDatabase *otherDB;
@property(nonatomic) CBLURLEndpointListener *listener;
@property(nonatomic) CBLReplicator *replicator;
@end

@implementation SampleCodeTest

#pragma mark - Database

- (void) dontTestNewDatabase {
    NSError *error;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"my-database" error:&amp;error];
    if (!database) {
        NSLog(@"Cannot open the database:%@", error);
    }
    self.database = database;

    if (![self.database close:&amp;error])
        NSLog(@"Error closing db:%@", error);

}

- (void) dontTestLogging {

    // Replicator / Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Query /  Verbose
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainQuery;
}

#if COUCHBASE_ENTERPRISE
- (void) dontTestDatabaseEncryption {
    CBLDatabaseConfiguration *config = [[CBLDatabaseConfiguration alloc] init];
    config.encryptionKey = [[CBLEncryptionKey alloc] initWithPassword:@"secretpassword"];

    NSError *error;
    self.database = [[CBLDatabase alloc] initWithName:@"my-database" config:config error:&amp;error];
    if (!self.database) {
        NSLog(@"Cannot open the database:%@", error);
    }
}
#endif

- (void) dontTestEnableConsoleLogging {
    CBLDatabase.log.console.domains = kCBLLogDomainAll; <i class="conum" data-value="1"></i><b>(1)</b>
    CBLDatabase.log.console.level = kCBLLogLevelVerbose; <i class="conum" data-value="2"></i><b>(2)</b>


    CBLDatabase.log.console.domains = kCBLLogDomainAll;

}

- (void) dontTestFileLogging {
    NSString *tempFolder = [NSTemporaryDirectory() stringByAppendingPathComponent:@"cbllog"];
    CBLLogFileConfiguration *config = [[CBLLogFileConfiguration alloc] initWithDirectory:tempFolder]; <i class="conum" data-value="3"></i><b>(3)</b>
    config.maxRotateCount = 2; <i class="conum" data-value="4"></i><b>(4)</b>
    config.maxSize = 1024; <i class="conum" data-value="5"></i><b>(5)</b>
    config.usePlainText = YES; <i class="conum" data-value="6"></i><b>(6)</b>
    [CBLDatabase.log.file setConfig:config];
    [CBLDatabase.log.file setLevel:kCBLLogLevelInfo]; <i class="conum" data-value="7"></i><b>(7)</b>
}

- (void) dontTestEnableCustomLogging {
    LogTestLogger *logger = [[LogTestLogger alloc] init];
    logger.level = kCBLLogLevelWarning;
    [CBLDatabase.log setCustom:logger];

}

- (void) dontTestLoadingPrebuilt {
    // Note:Getting the path to a database is platform-specific.
    // For iOS you need to get the path from the main bundle.
    if (![CBLDatabase databaseExists:@"travel-sample" inDirectory:nil]) {
        NSError *error;
        NSString *path = [[NSBundle bundleForClass:[self class]] pathForResource:@"travel-sample" ofType:@"cblite2"];
        if (![CBLDatabase copyFromPath:path toDatabase:@"travel-sample" withConfig:nil error:&amp;error]) {
            [NSException raise:NSInternalInconsistencyException
                        format:@"Could not load pre-built database:%@", error];
        }
    }
}

#pragma mark - Document

- (void) dontTestInitializer {
    NSError *error;

    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];
    [newTask setString:@"task" forKey:@"task"];
    [newTask setString:@"todo" forKey:@"owner"];
    [newTask setString:@"task" forKey:@"createdAt"];
    [self.database saveDocument:newTask error:&amp;error];
}

- (void) dontTestMutability {
    NSError *error;

    CBLDocument *document = [self.database documentWithID:@"xyz"];
    CBLMutableDocument *mutableDocument = [document toMutable];
    [mutableDocument setString:@"apples" forKey:@"name"];
    [self.database saveDocument:mutableDocument error:&amp;error];
}

- (void) dontTestTypedAcessors {
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];

    [newTask setValue:[NSDate date] forKey:@"createdAt"];
    NSDate *date = [newTask dateForKey:@"createdAt"];

    NSLog(@"Date:%@", date);
}

- (void) dontTestDataTypeDictionary {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting a dictionary value from the document
    CBLDictionary *dict = [document dictionaryForKey:@"address"];
    
    // Access a value from the dictionary
    NSString *street = [dict stringForKey:@"street"];
    NSLog(@"Street:: %@", street);
    
    // Iterate dictionary
    for (NSString *key in dict) {
        id value = [dict valueForKey:key];
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableDictionary *mutableDict = [dict toMutable];
    [mutableDict setString:@"1 Great sts" forKey:@"street"];
}

- (void) dontTestDataTypeMutableDictionary {
    
    // Create a new mutable dictionary and populate some keys/values
    CBLMutableDictionary *dict = [[CBLMutableDictionary alloc] init];
    [dict setString:@"1 Main st" forKey:@"street"];
    [dict setString:@"San Francisco" forKey:@"city"];
    
    // Set the dictionary to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setDictionary:dict forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestDataTypeArray {
    CBLDocument *document = [self.database documentWithID:@"doc1"];
    
    // Getting an array value from the document
    CBLArray *array = [document arrayForKey:@"phones"];
    
    // Get element count
    NSUInteger count = array.count;
    NSLog(@"Count:: %lu", (unsigned long)count);
    
    // Access an array element by index
    if (count &gt; 0) {
        id value = [array valueAtIndex:0];
        NSLog(@"Value:: %@", value);
    }
    
    // Iterate the array
    for (id value in array) {
        NSLog(@"Value:: %@", value);
    }
    
    // Create a mutable copy
    CBLMutableArray *mutableArray = [array toMutable];
    [mutableArray addString:@"650-000-0002"];
}

- (void) dontTestDataTypeMutableArray {
    // Create a new mutable array and populate data into the array
    CBLMutableArray *array = [[CBLMutableArray alloc] init];
    [array addString:@"650-000-0000"];
    [array addString:@"650-000-0001"];
    
    // Set the array to a document and save the document
    CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
    [document setArray:array forKey:@"address"];
    NSError *error;
    [self.database saveDocument:document error:&amp;error];
}

- (void) dontTestBatchOperations {
    NSError *error;

    [self.database inBatch:&amp;error usingBlock:^{
        for (int i = 0; i &lt; 10; i++) {
            CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
            [doc setValue:@"user" forKey:@"type"];
            [doc setValue:[NSString stringWithFormat:@"user %d", i] forKey:@"name"];
            [doc setBoolean:NO forKey:@"admin"];

            NSError *err = nil;
            [self.database saveDocument:doc error:&amp;err];
        }
    }];
}

- (void) dontTestChangeListener {
    <em>block SampleCodeTest *wSelf = self;
    [self.database addDocumentChangeListenerWithID:@"user.john" listener:^(CBLDocumentChange  *change) {
        CBLDocument *document = [wSelf.database documentWithID:change.documentID];
        NSLog(@"Status ::%@)", [document stringForKey:@"verified_account"]);
    }];
}

- (void) dontTestDocumentExpiration {
    NSError *error;

    // Purge the document one day from now
    NSDate *ttl = [[NSCalendar currentCalendar] dateByAddingUnit:NSCalendarUnitDay
                                                           value:1
                                                          toDate:[NSDate date]
                                                         options:0];
    [self.database setDocumentExpirationWithID:@"doc123" expiration:ttl error:&amp;error];

    // Reset expiration
    [self.database setDocumentExpirationWithID:@"doc1" expiration:nil error:&amp;error];

    // Query documents that will be expired in less than five minutes
    NSTimeInterval fiveMinutesFromNow = [[NSDate dateWithTimeIntervalSinceNow:60 * 5] timeIntervalSince1970];
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryMeta expiration]
                                                lessThan:[CBLQueryExpression double:fiveMinutesFromNow]]];
    NSLog(@"%@", query);
}

- (void) dontTestBlob {
#if TARGET_OS_IPHONE
    NSError *error;
    CBLMutableDocument *newTask = [[CBLMutableDocument alloc] initWithID:@"task1"];

    UIImage *appleImage = [UIImage imageNamed:@"avatar.jpg"];
    NSData *imageData = UIImageJPEGRepresentation(appleImage, 1.0);  <i class="conum" data-value="8"></i><b>(8)</b>

    CBLBlob *blob = [[CBLBlob alloc] initWithContentType:@"image/jpeg" data:imageData];  <i class="conum" data-value="9"></i><b>(9)</b>
    [newTask setBlob:blob forKey:@"avatar"]; <i class="conum" data-value="10"></i><b>(10)</b>
    [self.database saveDocument:newTask error:&amp;error];

    CBLDocument *savedTask = [self.database documentWithID:@"task1"];
    CBLBlob *taskBlob = [savedTask blobForKey:@"avatar"];
    UIImage *taskImage = [UIImage imageWithData:taskBlob.content];

    NSLog(@"%@", taskImage);
#endif
}

- (void) dontTest1xAttachment {
    CBLMutableDocument *document = [[CBLMutableDocument alloc] initWithID:@"task1"];

    CBLDictionary *attachments = [document dictionaryForKey:@"_attachments"];
    CBLBlob *avatar = [attachments blobForKey:@"avatar"];
    NSData *content = [avatar content];

    NSLog(@"%@", content);
}

#pragma mark - Query

- (void) dontTestIndexing {
    NSError *error;


    CBLValueIndexConfiguration</strong> config =
                [[CBLValueIndexConfiguration alloc]
                    initWithExpression: @[@"type", @"name"]];

    [self.database createIndexWithConfig: config name: @"TypeNameIndex" error: &amp;error];


}

- (void) dontTestIndexing_Querybuilder {
    NSError <strong>error;

    CBLValueIndexItem *type = [CBLValueIndexItem property:@"type"];
    CBLValueIndexItem *name = [CBLValueIndexItem property:@"name"];
    CBLIndex *index = [CBLIndexBuilder valueIndexWithItems:@[type, name]];
    [self.database createIndex:index withName:@"TypeNameIndex" error:&amp;error];
}



- (void) dontTestSelect {
    NSError *error;
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression value:@"user"]] andExpression:
                                               [[CBLQueryExpression property:@"admin"] equalTo:[CBLQueryExpression boolean:NO]]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"user name ::%@", [result stringAtIndex:0]);
    }
}

- (void) dontTestSelectProps {
    NSError *error;
    CBLQuerySelectResult *metaId = [CBLQuerySelectResult expression: CBLQueryMeta.id as:@"id"];
    CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuery *query = [CBLQueryBuilder select:@[metaId, type, name]
                                         from:[CBLQueryDataSource database:self.database]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id :: %@", [result stringForKey:@"id"]);
        NSLog(@"document name :: %@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestSelectAll {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]];

    NSLog(@"%@", query);
}

- (void) dontTestLiveQuery {
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]]; <i class="conum" data-value="11"></i><b>(11)</b>

    // Adds a query change listener.
    // Changes will be posted on the main queue.
    id&lt;CBLListenerToken&gt; token = [query addChangeListener:^(CBLQueryChange  *change) { <i class="conum" data-value="12"></i><b>(12)</b>
        for (CBLQueryResultSet *results in [change results]) {
            NSLog(@"%@", results);
            /</strong> Update UI <strong>/
        }
    }]; <i class="conum" data-value="13"></i><b>(13)</b>


    [query removeChangeListenerWithToken:token]; <i class="conum" data-value="14"></i><b>(14)</b>
}

- (void) dontTestWhere {
    NSError *error;
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:[CBLQueryLimit limit:[CBLQueryExpression integer:10]]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        CBLDictionary *dict = [result valueForKey:@"travel-sample"];
        NSLog(@"document name ::%@", [dict stringForKey:@"name"]);
    }

    NSLog(@"%@", query);
}

- (void) dontTestQueryDeletedDocuments {
    // Query documents that have been deleted
    CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:CBLQueryMeta.id]]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:CBLQueryMeta.isDeleted];
    NSLog(@"%@", query);
}

- (void) dontTestCollectionOperatorContains {
    NSError *error;

    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];
    CBLQuerySelectResult *likes = [CBLQuerySelectResult property:@"public_likes"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]];
    CBLQueryExpression *contains = [CBLQueryArrayFunction contains:[CBLQueryExpression property:@"public_likes"]
                                                             value:[CBLQueryExpression string:@"Armani Langworth"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name, likes]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:contains]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"public_likes ::%@", [[result arrayForKey:@"public_likes"] toArray]);
    }
}

- (void) dontTestCollectionOperatorIn {
    NSArray *values = @[[CBLQueryExpression property:@"first"],
                       [CBLQueryExpression property:@"last"],
                       [CBLQueryExpression property:@"username"]];

    [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]
                       from:[CBLQueryDataSource database:self.database]
                      where:[[CBLQueryExpression string:@"Armani"] in:values]];
}

- (void) dontTestLikeOperator {
    NSError *error;
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"royal engineers museum"]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"name property ::%@", [result stringForKey:@"name"]);
    }
}

- (void) dontTestWildCardMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryFunction lower:[CBLQueryExpression property:@"name"]] like:[CBLQueryExpression string:@"eng%e%"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestWildCardCharacterMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *like = [[CBLQueryExpression property:@"name"] like:[CBLQueryExpression string:@"eng</em><em>r"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, country, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:like]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestRegexMatch {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"landmark"]];
    CBLQueryExpression *regex = [[CBLQueryExpression property:@"name"] regex:[CBLQueryExpression string:@"\\bEng.*e\\b"]];

    CBLQueryLimit *limit = [CBLQueryLimit limit:[CBLQueryExpression integer:10]];

    CBLQuery *query = [CBLQueryBuilder select:@[id, name]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:regex]
                                      groupBy:nil having:nil orderBy:nil
                                        limit:limit];

    NSLog(@"%@", query);
}

- (void) dontTestJoin {
    CBLQuerySelectResult *name = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"name" from:@"airline"]];
    CBLQuerySelectResult *callsign = [CBLQuerySelectResult
                                      expression:[CBLQueryExpression property:@"callsign" from:@"airline"]];
    CBLQuerySelectResult *dest = [CBLQuerySelectResult
                                  expression:[CBLQueryExpression property:@"destinationairport" from:@"route"]];
    CBLQuerySelectResult *stops = [CBLQuerySelectResult
                                   expression:[CBLQueryExpression property:@"stops" from:@"route"]];
    CBLQuerySelectResult *airline = [CBLQuerySelectResult
                                     expression:[CBLQueryExpression property:@"airline" from:@"route"]];

    CBLQueryJoin *join = [CBLQueryJoin join:[CBLQueryDataSource database:self.database
                                                                      as:@"route"]
                                         on:[[CBLQueryMeta idFrom:@"airline"]
                                             equalTo:[CBLQueryExpression property:@"airlineid"
                                                                             from:@"route"]]];

    CBLQueryExpression *typeRoute = [[CBLQueryExpression property:@"type" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"route"]];
    CBLQueryExpression *typeAirline = [[CBLQueryExpression property:@"type" from:@"airline"]
                                       equalTo:[CBLQueryExpression string:@"airline"]];
    CBLQueryExpression *sourceRIX = [[CBLQueryExpression property:@"sourceairport" from:@"route"]
                                     equalTo:[CBLQueryExpression string:@"RIX"]];

    CBLQuery *query = [CBLQueryBuilder select:@[name, callsign, dest, stops, airline]
                                         from:[CBLQueryDataSource database:self.database as:@"airline"]
                                         join:@[join]
                                        where:[[typeRoute andExpression:typeAirline] andExpression:sourceRIX]];

    NSLog(@"%@", query);
}

- (void) dontTestGroupBy {
    CBLQuerySelectResult *count = [CBLQuerySelectResult expression:[CBLQueryFunction count:[CBLQueryExpression all]]];
    CBLQuerySelectResult *country = [CBLQuerySelectResult property:@"country"];
    CBLQuerySelectResult *tz = [CBLQuerySelectResult property:@"tz"];

    CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"airport"]];
    CBLQueryExpression *geoAlt = [[CBLQueryExpression property:@"geo.alt"] greaterThanOrEqualTo:[CBLQueryExpression integer:300]];

    CBLQuery *query = [CBLQueryBuilder select:@[count, country, tz]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[type andExpression:geoAlt]
                                      groupBy:@[[CBLQueryExpression property:@"country"],
                                                [CBLQueryExpression property:@"tz"]]];

    NSLog(@"%@", query);
}

- (void) dontTestOrderBy {
    CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];
    CBLQuerySelectResult *title = [CBLQuerySelectResult property:@"title"];

    CBLQuery *query = [CBLQueryBuilder select:@[id, title]
                                         from:[CBLQueryDataSource database:self.database]
                                        where:[[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"hotel"]]
                                      orderBy:@[[[CBLQueryOrdering property:@"title"] descending]]];

    NSLog(@"%@", query);
}


- (void) dontTestExplainAll {
    NSError *error;
    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[[CBLQueryExpression property:@"type"]
                   equalTo:[CBLQueryExpression string:@"university"]]
//            groupBy:@[[CBLQueryExpression property:@"country"]] <i class="conum" data-value="15"></i><b>(15)</b>
                          orderBy:@[[[CBLQueryOrdering property:@"title"] descending]] <i class="conum" data-value="16"></i><b>(16)</b>
       ];

    NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="17"></i><b>(17)</b>

}
- (void) dontTestExplainLike {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"%hotel%"]];
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];
      NSLog(@"%@", [query explain:&amp;error]); <i class="conum" data-value="18"></i><b>(18)</b>


}
- (void) dontTestExplainNoPfx {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            like:[CBLQueryExpression string:@"hotel%"]]; <i class="conum" data-value="19"></i><b>(19)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainFunction {
    NSError *error;

    CBLQueryExpression *type =
        [[CBLQueryFunction lower:[CBLQueryExpression property:@"type"]]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="20"></i><b>(20)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
                from:[CBLQueryDataSource database:self.database]
                where:[type andExpression:name]];

    NSLog(@"%@", [query explain:&amp;error]);

}

- (void) dontTestExplainNoFunction {
    NSError *error;
    CBLQueryExpression *type =
        [[CBLQueryExpression property:@"type"]
            equalTo:[CBLQueryExpression string:@"hotel"]]; <i class="conum" data-value="21"></i><b>(21)</b>
    CBLQueryExpression *name =
        [[CBLQueryExpression property:@"name"]
            like:[CBLQueryExpression string:@"%royal%"]];

    CBLQuery *query =
        [CBLQueryBuilder
            select:@[[CBLQuerySelectResult all]]
            from:[CBLQueryDataSource database:self.database]
            where:[type andExpression:name]
        ];

    NSLog(@"%@", [query explain:&amp;error]);


}



- (void) dontTestCreateFullTextIndex {
    NSError *error;

    // Insert documents
    NSArray *overviews = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *overview in overviews) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:overview forKey:@"overview"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndexConfiguration</strong> config =
        [[CBLFullTextIndexConfiguration alloc]
            initWithExpression: @[@"overview"]
            ignoreAccents: NO language: nil];

    [self.database createIndexWithConfig: config
            name: @"overviewFTSIndex" error: &amp;error];

}

- (void) dontTestFullTextSearch {
    NSError <strong>error;

    NSString *ftsQueryString =
    @"SELECT META().id FROM _ WHERE MATCH(overviewFTSIndex, 'Michigan') ORDER BY RANK(overviewFTSIndex)";

    CBLQueryResultSet *resultSet = [ftsQuery execute:&amp;error];
    NSArray</strong> results  = [resultSet allResults];
    for (CBLQueryResult <strong>result in results) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}




- (void) dontTestCreateFullTextIndex_Querybuilder {
    NSError *error;

    // Insert documents
    NSArray *tasks = @[@"buy groceries", @"play chess", @"book travels", @"buy museum tickets"];
    for (NSString *task in tasks) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setString:@"task" forKey:@"type"];
        [doc setString:task forKey:@"name"];
        [self.database saveDocument:doc error:&amp;error];
    }

    // Create index
    CBLFullTextIndex *index = [CBLIndexBuilder fullTextIndexWithItems:@[[CBLFullTextIndexItem property:@"name"]]];
    index.ignoreAccents = NO;
    [self.database createIndex:index withName:@"nameFTSIndex" error:&amp;error];
}

- (void) dontTestFullTextSearch_Querybuilder {
    NSError *error;

    CBLQueryExpression *where = [CBLQueryFullTextFunction matchWithIndexName:@"nameFTSIndex"
                                                                       query:@"'buy'"];
    CBLQuery *query =
      [CBLQueryBuilder
        select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
        from:[CBLQueryDataSource database:self.database]
        where:where];

    NSEnumerator *rs = [query execute:&amp;error];
    for (CBLQueryResult *result in rs) {
        NSLog(@"document id %@", [result stringAtIndex:0]);
    }
}









#pragma mark - Replication

/</strong> The <code>tag::replication[]</code> example is inlined in objc.adoc <strong>/

- (void) dontTestEnableReplicatorLogging {
    // Replicator
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainReplicator;

    // Network
    CBLDatabase.log.console.level = kCBLLogLevelVerbose;
    CBLDatabase.log.console.domains = kCBLLogDomainNetwork;
}

- (void) dontTestReplicationBasicAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicationSessionAuthentication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    config.authenticator = [[CBLSessionAuthenticator alloc] initWithSessionID:@"904ac010862f37c8dd99015a33ab5a3565fd8447"];

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];
    [self.replicator start];
}

- (void) dontTestReplicatorStatus {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    [self.replicator addChangeListener:^(CBLReplicatorChange *change) {
        if (change.status.activity == kCBLReplicatorStopped) {
            NSLog(@"Replication stopped");
        }
    }];
}


//  BEGIN PendingDocuments IB -- 11/Feb/21 --
- (void) testReplicationPendingDocs {

    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database
                                                                                       target:target];

    config.replicatorType = kCBLReplicatorTypePush;

    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    // Get list of pending doc IDs
    NSError *err = nil;
    NSSet *pendingDocIds = [self.replicator pendingDocumentIDs:&amp;err]; <i class="conum" data-value="22"></i><b>(22)</b>


    if ([pendingDocIds count] &gt; 0) {

        NSLog(@"There are %lu documents pending", (unsigned long)[pendingDocIds count]);

        [self.replicator addChangeListener:^(CBLReplicatorChange *change) {

            NSLog(@"Replicator activity level is %u", change.status.activity);
            // iterate and report-on the pending doc IDs  in 'mydocids'
            for (NSString *docID in pendingDocIds) {

                NSError *err = nil;
                if (![change.replicator isDocumentPending:docID error:&amp;err]) { <i class="conum" data-value="23"></i><b>(23)</b>
                    NSLog(@"Doc ID %@ now pushed", docID);
                }
            }

        }];
        [self.replicator start];

    };

}
//  END PendingDocuments IB -- 11/Feb/21 --


- (void) dontTestReplicatorDocumentEvent {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];
    self.replicator = [[CBLReplicator alloc] initWithConfig:config];

    id token = [self.replicator addDocumentReplicationListener:^(CBLDocumentReplication  *replication) {
        NSLog(@"Replication type ::%@", replication.isPush ? @"Push" :@"Pull");
        for (CBLReplicatedDocument *document in replication.documents) {
            if (document.error == nil) {
                NSLog(@"Doc ID ::%@", document.id);
                if document.flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {                     NSLog(@"Successfully replicated a deleted document");                 }             } else {                 // There was an error             }         }     }];      [self.replicator start];      [self.replicator removeChangeListenerWithToken:token]; }  - (void) dontTestCustomReplicationHeader {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:endpoint];     config.headers = @{@"CustomHeaderName" :@"Value"}; }  - (void) dontTestHandlingReplicationError {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }]; }  - (void) dontTestReplicationResetCheckpoint {     BOOL restCheckpoint = NO;     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      if (restCheckpoint)         [self.replicator startWithReset:restCheckpoint]; <i class="conum" data-value="24"></i><b>(24)</b>  }  - (void) dontTestReplicationPushFilter {     NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pushFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ([[document stringForKey:@"type"] isEqualToString:@"draft"]) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestReplicationPullFilter {      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.pullFilter = ^BOOL(CBLDocument *document, CBLDocumentFlags flags) { <i class="conum" data-value="1"></i><b>(1)</b>         if ((flags &amp; kCBLDocumentFlagsDeleted) == kCBLDocumentFlagsDeleted) {             return false;         }         return true;     };      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  //  Added 2/Feb/21 - Ian Bridge - (void) dontTestCustomRetryConfig {     id target = [[CBLURLEndpoint alloc] initWithURL:[NSURL URLWithString:@"ws://foo.cbl.com/db"]];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.replicatorType = kCBLReplicatorTypePush;     config.continuous = YES;     //  other config as required . . .      config.heartbeat = 150; <i class="conum" data-value="25"></i><b>(25)</b>      config.maxAttempts = 20; <i class="conum" data-value="26"></i><b>(26)</b>      config.maxAttemptWaitTime = 600; <i class="conum" data-value="27"></i><b>(27)</b>      //  other config as required . . .     self.replicator = [[CBLReplicator alloc] initWithConfig:config];  }   #ifdef COUCHBASE_ENTERPRISE - (void) dontTestDatabaseReplica {     /</strong> EE feature:code below might throw a compilation error      if it's compiled against CBL Swift Community. <strong>/     CBLDatabaseEndpoint *targetDatabase = [[CBLDatabaseEndpoint alloc] initWithDatabase:self.otherDB];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:targetDatabase];     config.replicatorType = kCBLReplicatorTypePush;      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; } #endif  - (void) dontTestCertificatePinning {     // Active - Example 4     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      NSLog(@"%@", config); }  - (NSData</strong>) dataFromResource:(NSString*)file ofType:(NSString*)type {     return [NSData data]; }  - (void) dontTestGettingStarted {     // Get the database (and create it if it doesnt exist).     NSError <strong>error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      // Create a new document (i.e. a record) in the database.     CBLMutableDocument *mutableDoc = [[CBLMutableDocument alloc] init];     [mutableDoc setFloat:2.0 forKey:@"version"];     [mutableDoc setString:@"SDK" forKey:@"type"];      // Save it to the database.     [self.database saveDocument:mutableDoc error:&amp;error];      // Update a document.     CBLMutableDocument *mutableDoc2 = [[self.database documentWithID:mutableDoc.id] toMutable];     [mutableDoc2 setString:@"Swift" forKey:@"language"];     [self.database saveDocument:mutableDoc2 error:&amp;error];      CBLDocument *document = [self.database documentWithID:mutableDoc2.id];     // Log the document ID (generated by the database)     // and properties     NSLog(@"Document ID ::%@", document.id);     NSLog(@"Learning %@", [document stringForKey:@"language"]);      // Create a query to fetch documents of type SDK.     CBLQueryExpression *type = [[CBLQueryExpression property:@"type"] equalTo:[CBLQueryExpression string:@"SDK"]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                           from:[CBLQueryDataSource database:self.database]                                          where:type];      // Run the query     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]);      // Create replicators to push and pull changes to and from the cloud.     NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *targetEndpoint = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                            target:targetEndpoint];     config.replicatorType = kCBLReplicatorTypePushAndPull;      // Add authentication.     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"john" password:@"pass"];      // Create replicator (make sure to add an ivar)     self.replicator = [[CBLReplicator alloc] initWithConfig:config];      // Listen to replicator change events.     [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.error) {             NSLog(@"Error code:%ld", change.status.error.code);         }     }];      // Start replication     [self.replicator start]; }  - (void) dontTestPredictiveModel {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      ImageClassifierModel *model = [[ImageClassifierModel alloc] init];     [[CBLDatabase prediction] registerModel:model withName:@"ImageClassifier"];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input];      CBLValueIndex *index = [CBLIndexBuilder valueIndexWithItems:@[[CBLValueIndexItem expression:[prediction property:@"label"]]]];     [self.database createIndex:index withName:@"value-index-image-classifier" error:&amp;error];      [[CBLDatabase prediction] unregisterModelWithName:@"ImageClassifier"]; }  - (void) dontTestPredictiveIndex {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];      CBLPredictiveIndex *index = [CBLIndexBuilder predictiveIndexWithModel:@"ImageClassifier" input:input properties:nil];     [self.database createIndex:index withName:@"predictive-index-image-classifier" error:&amp;error]; }  - (void) dontTestPredictiveQuery {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      CBLQueryExpression *input = [CBLQueryExpression dictionary:@{@"photo":[CBLQueryExpression property:@"photo"]}];     CBLQueryPredictionFunction *prediction = [CBLQueryFunction predictionUsingModel:@"ImageClassifier" input:input]; <i class="conum" data-value="1"></i><b>(1)</b>      CBLQueryExpression *condition = [[[prediction property:@"label"] equalTo:[CBLQueryExpression string:@"car"]]                                      andExpression:[[prediction property:@"probablity"] greaterThanOrEqualTo:[CBLQueryExpression double:0.8]]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:condition];      // Run the query.     CBLQueryResultSet *results = [query execute:&amp;error];     NSLog(@"Number of rows ::%lu", (unsigned long)[[results allResults] count]); }  - (void) dontTestCoreMLPredictiveModel {     NSError *error;      // Load MLModel from <code>ImageClassifier.mlmodel</code>     NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@"ImageClassifier" withExtension:@"mlmodel"];     NSURL *compiledModelURL = [MLModel compileModelAtURL:modelURL error:&amp;error];     MLModel *model = [MLModel modelWithContentsOfURL:compiledModelURL error:&amp;error];     CBLCoreMLPredictiveModel *predictiveModel = [[CBLCoreMLPredictiveModel alloc] initWithMLModel:model];      // Register model     [[CBLDatabase prediction] registerModel:predictiveModel withName:@"ImageClassifier"]; }  - (void) dontTestReplicatorConflictResolver {     NSError *error;     self.database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];      NSURL *url = [[NSURL alloc] initWithString:@"ws://localhost:4984/getting-started-db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database target:target];     config.conflictResolver = [[LocalWinConflictResolver alloc] init];      self.replicator = [[CBLReplicator alloc] initWithConfig:config];     [self.replicator start]; }  - (void) dontTestSaveWithConflictHandler {     NSError *error;      CBLDocument *document = [self.database documentWithID:@"xyz"];     CBLMutableDocument *mutableDocument = [document toMutable];     [mutableDocument setString:@"apples" forKey:@"name"];      [self.database saveDocument:mutableDocument            conflictHandler:^BOOL(CBLMutableDocument *new, CBLDocument *current) {                NSDictionary *currentDict = current.toDictionary;                NSDictionary *newDict = new.toDictionary;                 NSMutableDictionary *result = [NSMutableDictionary dictionaryWithDictionary:currentDict];                [result addEntriesFromDictionary:newDict];                [new setData:result];                return YES;            }                      error:&amp;error]; }  #pragma mark - URLListener  - (BOOL) isValidCredentials:(NSString</strong>)u password:(NSString*)p { return YES; } // helper - (BOOL) isValidCertificates:(NSArray*)certs { return YES; } // helper  - (void) dontTestInitListener {     CBLURLEndpointListenerConfiguration <strong>config;     config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.database];     config.tlsIdentity = nil; // Use with anonymous self signed cert     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL( NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; }  - (void) dontTestListenerStart {     NSError *error = nil;      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } }  - (void) dontTestListenerStop {     [self.listener stop]; }  - (void) dontTestCreateSelfSignedCert {     NSError *error = nil;     CBLTLSIdentity *identity = nil;     // &lt;site-rooot&gt;/objc/advance/objc-p2psync-websocket-using-passive.html     // Example-6      NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" };     identity =       [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/         attributes:attrs         expiration:[NSDate dateWithTimeIntervalSinceNow:86400]         label:@"Server-Cert-Label"         error:&amp;error]; }  - (void) dontTestListenerCertificateAuthenticatorRootCert {     CBLURLEndpointListenerConfiguration *config;      // Example 8-tab1      NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]]; }  - (void) dontTestListenerCertificateAuthenticatorCallback {     CBLURLEndpointListenerConfiguration *config;     // Example 8-tab2      CBLListenerCertificateAuthenticator *listenerAuth =     [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];      config.authenticator = listenerAuth; }  # pragma mark - QUERY RESULT SET HANDLING EXAMPLES  - (void) dontTestQuerySyntaxJson {     NSError *error;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                              from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="28"></i><b>(28)</b>        CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {          NSDictionary *data = [result valueAtIndex:0];          // Use dictionary values         NSLog(@"id = %@", [data valueForKey:@"id"]);         NSLog(@"name = %@", [data valueForKey:@"name"]);         NSLog(@"type = %@", [data valueForKey:@"type"]);         NSLog(@"city = %@", [data valueForKey:@"city"]);      } // end for       CBLQueryResultSet *rs = [query execute:&amp;error];     for (CBLQueryResult *result in rs) {          // Get result as a JSON string         NSString *json = [result toJSON]; <i class="conum" data-value="29"></i><b>(29)</b>          // Get an native Obj-C object from the Json String         NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:[json dataUsingEncoding:NSUTF8StringEncoding]                                                                          options:NSJSONReadingAllowFragments                                                                            error:&amp;error]; <i class="conum" data-value="30"></i><b>(30)</b>          // Log generated Json and Native objects         // For demo/example purposes         NSLog(@"Json String %@", json);         NSLog(@"Native Object %@", dict);      }; // end for   } // end function  - (void) dontTestQuerySyntaxAndAccessProps {     NSError *error = nil;      CBLDatabase *db = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *id = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuerySelectResult *type = [CBLQuerySelectResult property:@"type"];      CBLQuerySelectResult *name = [CBLQuerySelectResult property:@"name"];      CBLQuerySelectResult *city = [CBLQuerySelectResult property:@"city"];      CBLQuery *query = [CBLQueryBuilder select:@[id, type, name, city]                                          from:[CBLQueryDataSource database:db]]; <i class="conum" data-value="31"></i><b>(31)</b>       CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) { // all results         NSLog(@"id = %@", [result stringForKey:@"id"]);         NSLog(@"name = %@", [result stringForKey:@"name"]);         NSLog(@"type = %@", [result stringForKey:@"type"]);         NSLog(@"city = %@", [result stringForKey:@"city"]);      }  }  - (void) dontTestQuerySyntaxCount {     NSError *error = nil;     NSInteger count = 0;     CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQueryExpression *countExpression = [CBLQueryFunction count:[CBLQueryExpression all]];     CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:countExpression                                                                        as:@"myCount"];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]]; <i class="conum" data-value="32"></i><b>(32)</b>      CBLQueryResultSet *results = [query execute:&amp;error];      for (CBLQueryResult *result in results) {         count = [result integerForKey:@"myCount"]; <i class="conum" data-value="33"></i><b>(33)</b>      } // end for       NSLog(@"print to avoid warning %@ %ld", query, count); }  - (void) dontTestQuerySyntaxID {     NSError *error = nil;      CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"hotels" error:&amp;error];      CBLQuerySelectResult *selectResult = [CBLQuerySelectResult expression:[CBLQueryMeta id]];      CBLQuery *query = [CBLQueryBuilder select:@[selectResult]                                          from:[CBLQueryDataSource database:database]];      NSLog(@"print to avoid warning %@", query); }  - (void) dontTestQueryAccessID {     CBLQuery *query;     NSError *error = nil;      CBLQueryResultSet *results = [query execute:&amp;error];     CBLDocument *doc = nil;     NSString *docId = nil;     for (CBLQueryResult *result in results) {         docId = [result stringForKey:@"id"]; <i class="conum" data-value="34"></i><b>(34)</b>          // Now you can get the document using its ID         // for example using         doc = [self.database documentWithID:docId];      }      NSLog(@"doc.id = %@", doc.id); }  - (void) dontTestQuerySyntaxPagination {     int offset = 0;     int limit = 20;      CBLQueryLimit *queryLimit = [CBLQueryLimit limit:[CBLQueryExpression integer:limit]                                               offset:[CBLQueryExpression integer:offset]];     CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult all]]                                          from:[CBLQueryDataSource database:self.database]                                         where:nil                                       groupBy:nil                                        having:nil                                       orderBy:nil                                         limit:queryLimit];     NSLog(@"print to avoid warning %@", query); }  - (void) dontTestDocsOnly_QuerySyntaxN1QL {     // Documentation Only query-syntax-n1ql     NSError *error;      NSString *queryString = @"SELECT * FROM _ WHERE type = \"hotel\""; <i class="conum" data-value="35"></i><b>(35)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryResultSet *results = [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  - (void) dontTestDocsOnly_QuerySyntaxN1QLParams {     // Documentation Only query-syntax-n1ql-params     NSError *error;      NSString *queryString = [NSString stringWithFormat:@"SELECT * FROM _ WHERE type = $type"]; <i class="conum" data-value="36"></i><b>(36)</b>      CBLQuery *query = [self.database createQuery:queryString];      CBLQueryParameters *params = [[CBLQueryParameters alloc] init];     [params setString:@"hotel" forName:@"type"]; <i class="conum" data-value="37"></i><b>(37)</b>     query.parameters = params;      CBLQueryResultSet *results =  [query execute:&amp;error];      NSLog(@"resultset.count = %lu", (unsigned long)results.allResults.count); }  #pragma mark - PEER-to-PEER  - (void) dontTestListenerSimple {     NSError *error = nil;      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database]; <i class="conum" data-value="38"></i><b>(38)</b>      config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                                 initWithBlock:^BOOL(NSString  *validUser, NSString  *validPassword) {         return [self isValidCredentials:validUser password:validPassword];     }]; <i class="conum" data-value="39"></i><b>(39)</b>      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="40"></i><b>(40)</b>      BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     } <i class="conum" data-value="41"></i><b>(41)</b>  }  - (void) dontTestReplicatorSimple {     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="42"></i><b>(42)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:endpoint]; <i class="conum" data-value="43"></i><b>(43)</b>      config.acceptOnlySelfSignedServerCertificate = YES; // &lt;.&gt; //FIXME: Remove this from doc!      config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"valid.user"                                                                   password:@"valid.password.string"]; <i class="conum" data-value="44"></i><b>(44)</b>       self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="45"></i><b>(45)</b>      [self.replicator start]; <i class="conum" data-value="46"></i><b>(46)</b>  }  - (void) dontTestP2PURLEndpointListener {     // FIXME: can we use the docsn site to show the interface of the Listener class?     // <a href="https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html" class="bare">https://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html</a> }  - (void) dontTestURLEndpointListenerConstructor {     NSUInteger wssPort = 4985;     NSUInteger wsPort = 4984;     BOOL isTLS = NO;     CBLListenerPasswordAuthenticator *auth = [[CBLListenerPasswordAuthenticator alloc]                                               initWithBlock:^BOOL(NSString *username, NSString *password) {         return YES;     }];      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc] initWithDatabase:self.otherDB];     config.port = isTLS ? wssPort :wsPort;     config.disableTLS = !isTLS;     config.authenticator = auth;      self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config]; <i class="conum" data-value="1"></i><b>(1)</b> }  - (void) dontTestMyActivePeer {     NSError *error = nil;     self.database = [[CBLDatabase alloc] initWithName:@"database" error:&amp;error];     if (!self.database) {         NSLog(@"Cannot open the database:%@", error);     };      // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://listener.com:55990/otherDB"];     CBLURLEndpoint *endpoint = [[CBLURLEndpoint alloc] initWithURL:url]; <i class="conum" data-value="47"></i><b>(47)</b>      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:endpoint]; <i class="conum" data-value="48"></i><b>(48)</b>      config.replicatorType = kCBLReplicatorTypePush;      // set auto-purge behavior (here we override default)     config.enableAutoPurge = NO; <i class="conum" data-value="49"></i><b>(49)</b>      config.continuous = YES;      // Configure Server Authentication     // Here - expect and accept self-signed certs     config.acceptOnlySelfSignedServerCertificate = YES; <i class="conum" data-value="50"></i><b>(50)</b>      // Configure Client Authentication     // Here set client to use basic authentication     // Providing username and password credentials     // If prompted for them by server     config.authenticator = [[CBLBasicAuthenticator alloc] initWithUsername:@"Our Username" password:@"Our Password"]; <i class="conum" data-value="51"></i><b>(51)</b>      /</strong> Optionally set custom conflict resolver call back <strong>/     config.conflictResolver = [[LocalWinConflictResolver alloc] init]; <i class="conum" data-value="52"></i><b>(52)</b>      // Apply configuration settings to the replicator     self.replicator = [[CBLReplicator alloc] initWithConfig:config]; <i class="conum" data-value="53"></i><b>(53)</b>      // Optionally add a change listener <i class="conum" data-value="54"></i><b>(54)</b>     // Retain token for use in deletion     id&lt;CBLListenerToken&gt; listenerToken = [self.replicator addChangeListener:^(CBLReplicatorChange *change) {         if (change.status.activity == kCBLReplicatorStopped) {             NSLog(@"Replication stopped");         } else {             NSLog(@"Status:%d", change.status.activity);         };     }];     // Run the replicator using the config settings     [self.replicator start]; <i class="conum" data-value="55"></i><b>(55)</b>       NSLog(@"print to avoid warning %@", listenerToken); }  - (void) dontTestReplicatorStop {     id&lt;CBLListenerToken&gt; listenerToken;      // Remove the change listener     [self.replicator removeChangeListenerWithToken:listenerToken];      // Stop the replicator     [self.replicator stop];  }  // Additional Snippets from above  - (void) dontTestReplicatorConfigCerts {     CBLReplicatorConfiguration *config;     SecCertificateRef cert;     // Configure Server Security -- only accept CA Certs     config.acceptOnlySelfSignedServerCertificate = NO; <i class="conum" data-value="56"></i><b>(56)</b>        // Return the remote pinned cert (the listener's cert)     config.pinnedServerCertificate = cert; // Get listener cert if pinned   }  - (void) dontTestCACertPinned {     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"cer"];     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef certificate = SecCertificateCreateWithData(NULL, (</em>bridge CFDataRef)data);      NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"];     CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];     CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:self.database                                                                                        target:target];     config.pinnedServerCertificate = (SecCertificateRef)CFAutorelease(certificate);      config.acceptOnlySelfSignedServerCertificate=false;   }  #pragma mark - Listener  - (void) dontTestListener {     NSError *error = nil;      // Initialize the listener config <i class="conum" data-value="57"></i><b>(57)</b>     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];      config.port =  55990; <i class="conum" data-value="58"></i><b>(58)</b>      config.networkInterface = @"10.1.1.10"; <i class="conum" data-value="59"></i><b>(59)</b>      config.enableDeltaSync = true; <i class="conum" data-value="60"></i><b>(60)</b>      // Configure server security     config.disableTLS  = false; <i class="conum" data-value="61"></i><b>(61)</b>       // Use an anonymous self-signed cert     config.tlsIdentity = nil; <i class="conum" data-value="62"></i><b>(62)</b>      // Configure Client Security using an Authenticator     // For example, Basic Authentication <i class="conum" data-value="63"></i><b>(63)</b>     config.authenticator = [[CBLListenerPasswordAuthenticator alloc]                             initWithBlock:^BOOL(NSString *username, NSString *password) {         return [self isValidCredentials:username password:password];     }];      // Initialize the listener <i class="conum" data-value="64"></i><b>(64)</b>     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      // start the listener <i class="conum" data-value="65"></i><b>(65)</b>     BOOL success = [self.listener startWithError:&amp;error];     if (!success) {         NSLog(@"Cannot start the listener:%@", error);     }       [self.listener stop];  }  - (void) dontTestListenerGetNetworkInterfaces {     // . . .  code snippet to be provided  }  - (void) dontTestListenerGetURLList {     NSError *error = nil;     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     self.listener = [[CBLURLEndpointListener alloc] initWithConfig:config];      [self.listener startWithError:&amp;error];      NSLog(@"%@", self.listener.urls);  }  - (void) dontTestlistenerConfigClientAuth {     CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.database];     // EXAMPLE 8     // Configure the client authenticator     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="66"></i><b>(66)</b>     NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     SecCertificateRef rootCertRef = SecCertificateCreateWithData(NULL, (<em>bridge CFDataRef)data);      config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCertRef)]];  <i class="conum" data-value="67"></i><b>(67)</b> <i class="conum" data-value="68"></i><b>(68)</b>  }  - (void) dontTestListenerLocalDB {     NSError *error = nil;     SecCertificateRef cert;     // . . . preceding application logic . . .     // FIXME: anything??     // Include websockets listener initializer code      CBLURLEndpointListenerConfiguration *config = [[CBLURLEndpointListenerConfiguration alloc]                                                    initWithDatabase:self.otherDB];     // Configure server authentication     config.disableTLS  = true; <i class="conum" data-value="69"></i><b>(69)</b>       // EXAMPLE 6     // Use CA Cert     // Create a TLSIdentity from a key-pair and     // certificate in secure storage     NSURL *certURL = [[NSBundle mainBundle] URLForResource:@"cert" withExtension:@"p12"]; <i class="conum" data-value="70"></i><b>(70)</b>      NSData *data = [[NSData alloc] initWithContentsOfURL:certURL];     CBLTLSIdentity *tlsIdentity = [CBLTLSIdentity importIdentityWithData:data                                                                 password:@"123"                                                                    label:@"couchbase-docs-cert"                                                                    error:&amp;error]; <i class="conum" data-value="71"></i><b>(71)</b>      config.tlsIdentity = tlsIdentity; <i class="conum" data-value="72"></i><b>(72)</b>      // Use a self-signed certificate     NSDictionary *attrs = @{ kCBLCertAttrCommonName:@"Couchbase Inc" }; <i class="conum" data-value="73"></i><b>(73)</b>      tlsIdentity = [CBLTLSIdentity createIdentityForServer:YES /</strong> isServer <strong>/                                                attributes:attrs                                                expiration:[NSDate dateWithTimeIntervalSinceNow:86400]                                                     label:@"couchbase-docs-cert"                                                     error:&amp;error]; <i class="conum" data-value="74"></i><b>(74)</b>      // set the TLS Identity     config.tlsIdentity = tlsIdentity; <i class="conum" data-value="75"></i><b>(75)</b>        // Authenticate self-signed cert     // using application logic     CBLListenerCertificateAuthenticator *authenticator = [[CBLListenerCertificateAuthenticator alloc]                                                           initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  <i class="conum" data-value="76"></i><b>(76)</b>      config.authenticator = authenticator; <i class="conum" data-value="77"></i><b>(77)</b>        config.disableTLS  = YES;       config.tlsIdentity = nil;        config.enableDeltaSync = YES;        NSUInteger totalConnections = self.listener.status.connectionCount;     NSUInteger activeConnections = self.listener.status.activeConnectionCount;      NSLog(@"Connection status = %lu/%lu", activeConnections,totalConnections);       // cert is a pre-populated object of type:SecCertificate representing a certificate     CFDataRef rootCertData = SecCertificateCopyData(cert);     CFAutorelease(rootCertData);     SecCertificateRef rootCert = SecCertificateCreateWithData(NULL, rootCertData);      // Listener:     config.authenticator = [[CBLListenerCertificateAuthenticator alloc]                             initWithRootCerts:@[(id)CFBridgingRelease(rootCert)]];       config.authenticator = [[CBLListenerCertificateAuthenticator alloc] initWithBlock:^BOOL(NSArray *certs) {         return [self isValidCertificates:certs];     }];  }  #pragma mark - JSON API  - (void) dontTestToJSONBlob {     // Example 2. Using Blobs      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     CBLBlob *blob = [doc blobForKey:@"avatar"];     NSString *json = [blob toJSON];     NSLog(@"json string is %@", json);  }  - (void) dontTestDictionaryAsJSON {     NSError *error = nil;     // Example 6. Dictionaries as JSON strings     NSString *aJSONstring = @"{\"id\":\"1002\",\"type\":\"hotel\",\"name\":\"Hotel Ned\","     "\"city\":\"Balmain\",\"country\":\"Australia\",\"description\":\"Undefined description for Hotel Ned\"}";       CBLMutableDictionary *myDict = [[CBLMutableDictionary alloc] initWithJSON:aJSONstring                                                                         error:&amp;error];      NSString *name = [myDict stringForKey:@"name"];      for (NSString *key in myDict) {         NSLog(@"%@ %@", key, [myDict valueForKey:key]);     }      NSLog(@"%@", name); }  - (void) dontTestToJSONDocument {     // Example 7. Documents as JSON strings      CBLDocument *doc = [self.database documentWithID:@"doc-1000"];     NSString *json = [doc toJSON];     NSLog(@"json %@", json);  }  - (void) dontTestJSONAsArray {     NSError *error = nil;     NSString *json = @"[\"1000\",\"1001\",\"1002\",\"1003\"]";      CBLMutableArray *myArray = [[CBLMutableArray alloc] initWithJSON:json error:&amp;error];      for (NSString *item in myArray) {         NSLog(@"%@", item);     }  }  #pragma mark - SGW - (void) dontTestSGWActiveReplicatorInitialize {     // Set listener DB endpoint     NSURL *url = [NSURL URLWithString:@"ws://10.0.2.2.com:55990/travel-sample"];     CBLURLEndpoint *listener = [[CBLURLEndpoint alloc] initWithURL:url];      CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                           initWithDatabase:self.database target:listener]; <i class="conum" data-value="78"></i><b>(78)</b>      // END -- snippets --     NSLog(@"print to aviod warning %@", config.description); }  @end  #pragma mark -  // Singleton Pattern // &lt;doc&gt; @interface DataManager :NSObject  @property (nonatomic, readonly) CBLDatabase *database;  + (id)sharedInstance;  @end  @implementation DataManager  @synthesize database=_database;  + (id)sharedInstance {     static DataManager *sharedInstance = nil;     static dispatch_once_t onceToken;     dispatch_once(&amp;onceToken, ^{         sharedInstance = [[self alloc] init];     });     return sharedInstance; }  - (id)init {     if (self = [super init]) {         NSError *error;         _database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];         if (!_database) {             NSLog(@"Cannot open the database:%@", error);             return nil;         }     }     return self; }  @end // &lt;doc&gt;  // Peer-to-Peer Sample  /</strong> ----------------------------------------------------------- <strong>/ /</strong> ---------------------  ACTIVE SIDE  ----------------------- <strong>/ /</strong> ---------------  stubs for documentation  ----------------- <strong>/ /</strong> ----------------------------------------------------------- <strong>/ @interface ActivePeer:NSObject &lt;CBLMessageEndpointDelegate&gt;  @end  @interface ActivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt; - (void)disconnect; - (void)receive:(NSData</strong>)data; @end  @implementation ActivePeer  - (instancetype) init {     self = [super init];     if (self) {         NSError <strong>error = nil;         CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"dbname" error:&amp;error];          // The delegate must implement the <code>CBLMessageEndpointDelegate</code> protocol.         NSString *id = @"";         CBLMessageEndpoint *endpoint = [[CBLMessageEndpoint alloc] initWithUID:@"UID:123"                                                                         target:id                                                                   protocolType:kCBLProtocolTypeMessageStream                                                                       delegate:self];          CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc]                                               initWithDatabase:database target:endpoint];          // Create the replicator object.         CBLReplicator *replicator = [[CBLReplicator alloc] initWithConfig:config];         [replicator start];     }     return self; }  - (id&lt;CBLMessageEndpointConnection&gt;)createConnectionForEndpoint:(CBLMessageEndpoint *)endpoint {     return [[ActivePeerConnection alloc] init]; }  @end   @implementation ActivePeerConnection {     id &lt;CBLReplicatorConnection&gt; _replicatorConnection; }  - (void)disconnect {     [_replicatorConnection close:nil]; }  /</strong> implementation of CBLMessageEndpointConnection <strong>/ - (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullablecompletion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError  *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}

@end

/</strong> ----------------------------------------------------------- <strong>/
/</strong> ---------------------  PASSIVE SIDE  ---------------------- <strong>/
/</strong> ---------------  stubs for documentation  ----------------- <strong>/
/</strong> ----------------------------------------------------------- <strong>/
@interface PassivePeerConnection:NSObject &lt;CBLMessageEndpointConnection&gt;
- (void)startListener;
- (void)stopListener;
- (void)disconnect;
- (void)receive:(NSData</strong>)data;
@end

@implementation PassivePeerConnection {
    CBLMessageEndpointListener <strong>_messageEndpointListener;
    id &lt;CBLReplicatorConnection&gt; _replicatorConnection;
}

- (void)startListener {
    NSError *error = nil;
    CBLDatabase *database = [[CBLDatabase alloc] initWithName:@"mydb" error:&amp;error];

    CBLMessageEndpointListenerConfiguration *config =
    [[CBLMessageEndpointListenerConfiguration alloc] initWithDatabase:database
                                                         protocolType:kCBLProtocolTypeMessageStream];
    _messageEndpointListener = [[CBLMessageEndpointListener alloc] initWithConfig:config];
}

- (void)stopListener {
    [_messageEndpointListener closeAll];
}

- (void)acceptConnection {
    PassivePeerConnection *connection = [[PassivePeerConnection alloc] init]; /</strong> implements CBLMessageEndpointConnection <strong>/
    [_messageEndpointListener accept:connection];
}

- (void)disconnect {
    [_replicatorConnection close:nil];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)open:(nonnull id&lt;CBLReplicatorConnection&gt;)connection completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    _replicatorConnection = connection;
    completion(YES, nil);
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)send:(nonnull CBLMessage *)message completion:(nonnull void (^)(BOOL, CBLMessagingError *_Nullable))completion {
    NSData *data = [message toData];
    NSLog(@"%@", data);
    /</strong> send the data to the other peer <strong>/
    /</strong> ... <strong>/
    /</strong> call the completion handler once the message is sent <strong>/
    completion(YES, nil);
}

- (void)receive:(NSData</strong>)data {
    CBLMessage <strong>message = [CBLMessage fromData:data];
    [_replicatorConnection receive:message];
}

/</strong> implementation of CBLMessageEndpointConnection <strong>/
- (void)close:(nullable NSError *)error completion:(nonnull void (^)(void))completion {
    /</strong> disconnect with communications framework <strong>/
    /</strong> ... <strong>/
    /</strong> call completion handler <strong>/
    completion();
}
@end

#pragma mark - TLS Manage Functions

//
//  cMyGetCert.swift
//  doco-sync
//
//  Created by Ian Bridge on 20/06/2020.
//  Copyright  2020 Couchbase Inc. All rights reserved.
//

@interface MyGetCert1 :NSObject

- (CBLTLSIdentity</strong>) fMyGetCert;

@end

@implementation MyGetCert1

- (CBLTLSIdentity*) fMyGetCert {
    NSError <strong>error = nil;
    CBLReplicatorConfiguration *config; // FIXME: Are we sure? this is Replicator config?
    // Check if Id exists in keychain and if so, use it
    CBLTLSIdentity *identity = [CBLTLSIdentity identityWithLabel:@"doco-sync-server" error:&amp;error]; <i class="conum" data-value="79"></i><b>(79)</b>

    config.authenticator = [[CBLClientCertificateAuthenticator alloc] initWithIdentity:identity]; <i class="conum" data-value="80"></i><b>(80)</b>


    // CREATE IDENTITY FROM BUNDLED RESOURCE IF FOUND

    // Check for a resource bundle with required label to generate identity from
    // return nil identify if not found
    NSString *path = [[NSBundle mainBundle] pathForResource:@"doco-sync-server" ofType:@"p12"];
    NSData *data = [NSData dataWithContentsOfFile:path
                                              options:0
                                                error:&amp;error];
    if (!data)
        return nil;


    // Use SecPKCS12Import to import the contents (identities and certificates)
    // of the required resource bundle (PKCS #12 formatted blob).
    //
    // Set passphrase using kSecImportExportPassphrase.
    // This passphrase should correspond to what was specified when .p12 file was created
    CFArrayRef result = NULL;
    NSDictionary *options = @{ (id)kSecImportExportPassphrase:@"couchbase" };
    OSStatus status = SecPKCS12Import((</em>bridge CFDataRef)data, (<em>bridge CFDictionaryRef)options, &amp;result);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import data from provided with error :%d ", (int)status);
        return nil;
    }

    NSArray *importedItems = (NSArray</strong>)CFBridgingRelease(result);
    NSDictionary <strong>item = importedItems[0];

    // Get SecIdentityRef representing the item's id
    SecIdentityRef identityRef = (</em>bridge SecIdentityRef) item[(id)kSecImportItemIdentity];

    // Get Id's Private Key, return nil id if fails
    SecKeyRef privateKey;
    status = SecIdentityCopyPrivateKey(identityRef, &amp;privateKey);
    if (status != errSecSuccess) {
        NSLog(@"Failed to import private key from provided with error :%d ", (int)status);
        return nil;
    }
    CFAutorelease(privateKey);

    // Get all relevant certs [SecCertificate] from the ID's cert chain using kSecImportItemCertChain
    NSArray *certChain = item[(id)kSecImportItemCertChain];

    // Return nil Id if errors in key or cert chain at this stage
    if (!certChain || !privateKey)
        return nil;


    // FIXME: Use the same tag as tag: [create-self-signed-cert]

    // RETURN A TLSIDENTITY FROM THE KEYCHAIN FOR USE IN CONFIGURING TLS COMMUNICATION
    return [CBLTLSIdentity identityWithIdentity:identityRef
                                          certs:@[certChain[1]]
                                          error:&amp;error];
}

- (void) dontTestDeleteTLSIdentityFromKeychain {
    NSError *error;

    [CBLTLSIdentity deleteIdentityWithLabel:@"doco-sync-server-1" error:&amp;error];

}

@end

#pragma mark - For replications

// BEGIN -- snippets --
//    Purpose -- code samples for use in replication topic

@interface MyClass :NSObject
@property (nonatomic) CBLDatabase *database;
@property (nonatomic) CBLReplicator *replicator; <i class="conum" data-value="1"></i><b>(1)</b>
@end

@implementation MyClass
@synthesize database=_database;
@synthesize replicator=_replicator;

- (void) startReplication {
    NSURL *url = [NSURL URLWithString:@"ws://localhost:4984/db"]; <i class="conum" data-value="2"></i><b>(2)</b>
    CBLURLEndpoint *target = [[CBLURLEndpoint alloc] initWithURL:url];
    CBLReplicatorConfiguration *config = [[CBLReplicatorConfiguration alloc] initWithDatabase:_database
                                                                                       target:target];
    config.replicatorType = kCBLReplicatorTypePull;
    _replicator = [[CBLReplicator alloc] initWithConfig:config];
    [_replicator start];
}
@end


/</strong>
&lt;1&gt; A replication is an asynchronous operation.
To keep a reference to the <code>replicator</code> object, you can set it as an instance property.
&lt;2&gt; The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.


 */</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-types"><a class="anchor" href="#data-types"></a>Data Types</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="scalars"><a class="anchor" href="#scalars"></a>Scalars</h3>
<div class="paragraph">
<p>The <code>Document</code> class offers a set of property accessors for various scalar types, including boolean, integers, floating-point and strings.
These accessors take care of converting to/from JSON encoding, and make sure you get the type you&#8217;re expecting.</p>
</div>
<div class="paragraph">
<p>So your document content may well comprise one or more supporting data types such as:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Double</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumerator</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HashCode</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dictionary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a read-only key-value pair collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MutableDictionary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a writeable key-value pair collection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a readonly ordered collection of objects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MutableArray</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a writeable collection of objects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an arbitrary piece of binary data</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="date-accessors"><a class="anchor" href="#date-accessors"></a>Date accessors</h3>
<div class="paragraph">
<p>As a convenience Couchbase Lite offers <em>Date</em> accessors.
Dates are a common data type, but JSON doesn&#8217;t natively support them, so the convention is to store them as strings in ISO-8601 format.</p>
</div>
<div id="ex-date-getter" class="exampleblock">
<div class="title">Example 1. Date Getter</div>
<div class="content">
<div class="paragraph">
<p>This example sets the date on the <code>createdAt</code> property and reads it back using the <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-objc/Protocols/CBLDictionary.html#/c:objc(pl)CBLDictionary(im)dateForKey:">dateForKey:</a> accessor method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">[newTask setValue:[NSDate date] forKey:@"createdAt"];
NSDate *date = [newTask dateForKey:@"createdAt"];</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-dictionaries"><a class="anchor" href="#using-dictionaries"></a>Using Dictionaries</h3>
<div class="ulist">
<div class="title">API References</div>
<ul>
<li>
<p><a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-objc/Classes/CBLDictionary.html">CBLDictionary</a></p>
</li>
<li>
<p><a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-objc/Classes/CBLMutableDictionary.html">CBLMutableDictionary</a></p>
</li>
</ul>
</div>
<div id="ex-dict" class="exampleblock">
<div class="title">Example 2. Read Only</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">CBLDocument *document = [self.database documentWithID:@"doc1"];

// Getting a dictionary value from the document
CBLDictionary *dict = [document dictionaryForKey:@"address"];

// Access a value from the dictionary
NSString *street = [dict stringForKey:@"street"];
NSLog(@"Street:: %@", street);

// Iterate dictionary
for (NSString *key in dict) {
    id value = [dict valueForKey:key];
    NSLog(@"Value:: %@", value);
}

// Create a mutable copy
CBLMutableDictionary *mutableDict = [dict toMutable];
[mutableDict setString:@"1 Great sts" forKey:@"street"];</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-mutdict" class="exampleblock">
<div class="title">Example 3. Mutable</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">
// Create a new mutable dictionary and populate some keys/values
CBLMutableDictionary *dict = [[CBLMutableDictionary alloc] init];
[dict setString:@"1 Main st" forKey:@"street"];
[dict setString:@"San Francisco" forKey:@"city"];

// Set the dictionary to a document and save the document
CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
[document setDictionary:dict forKey:@"address"];
NSError *error;
[self.database saveDocument:document error:&amp;error];</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-arrays"><a class="anchor" href="#using-arrays"></a>Using Arrays</h3>
<div class="ulist">
<div class="title">API References</div>
<ul>
<li>
<p><a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-objc/Classes/CBLArray.html">CBLArray</a></p>
</li>
<li>
<p><a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-objc/Classes/CBLMutableArray.html">CBLMutableArray</a></p>
</li>
</ul>
</div>
<div id="ex-array" class="exampleblock">
<div class="title">Example 4. Read Only</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">CBLDocument *document = [self.database documentWithID:@"doc1"];

// Getting an array value from the document
CBLArray *array = [document arrayForKey:@"phones"];

// Get element count
NSUInteger count = array.count;
NSLog(@"Count:: %lu", (unsigned long)count);

// Access an array element by index
if (count &gt; 0) {
    id value = [array valueAtIndex:0];
    NSLog(@"Value:: %@", value);
}

// Iterate the array
for (id value in array) {
    NSLog(@"Value:: %@", value);
}

// Create a mutable copy
CBLMutableArray *mutableArray = [array toMutable];
[mutableArray addString:@"650-000-0002"];</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-mutarray" class="exampleblock">
<div class="title">Example 5. Mutable</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">// Create a new mutable array and populate data into the array
CBLMutableArray *array = [[CBLMutableArray alloc] init];
[array addString:@"650-000-0000"];
[array addString:@"650-000-0001"];

// Set the array to a document and save the document
CBLMutableDocument *document = [[CBLMutableDocument alloc] init];
[document setArray:array forKey:@"address"];
NSError *error;
[self.database saveDocument:document error:&amp;error];</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-blobs"><a class="anchor" href="#using-blobs"></a>Using Blobs</h3>
<div class="paragraph">
<p>For more on working with blobs&#8201;&#8212;&#8201;see <a href="blob.html" class="page">Blobs</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-initializers"><a class="anchor" href="#document-initializers"></a>Document Initializers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following methods/initializers can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-objc/Classes/CBLMutableDocument.html#/c:objc(cs)CBLMutableDocument(im)init">(nonnull instancetype)init;</a> initializer can be used to create a new document where the document ID is randomly generated by the database.</p>
</li>
<li>
<p>The <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-objc/Classes/CBLMutableDocument.html#/c:objc(cs)CBLMutableDocument(im)initWithID:">(nonnull instancetype)initWithID:(nullable NSString *)documentID;</a> initializer can be used to create a new document with a specific ID.</p>
</li>
<li>
<p>The <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-objc/Classes/CBLDatabase.html#/c:objc(cs)CBLDatabase(im)documentWithID:">(nullable CBLDocument *)documentWithID:(nonnull NSString *)id;</a> method can be used to get a document.
If it doesn&#8217;t exist in the database, it will return <code>null</code>.
This method can be used to check if a document with a given ID already exists in the database.</p>
</li>
</ul>
</div>
<div id="ex-persists-doc" class="exampleblock">
<div class="title">Example 6. Persist a document</div>
<div class="content">
<div class="paragraph">
<p>The following code example creates a document and persists it to the database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">CBLMutableDocument *newTask = [[CBLMutableDocument alloc] init];
[newTask setString:@"task" forKey:@"task"];
[newTask setString:@"todo" forKey:@"owner"];
[newTask setString:@"task" forKey:@"createdAt"];
[self.database saveDocument:newTask error:&amp;error];</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mutability"><a class="anchor" href="#mutability"></a>Mutability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, when a document is read from the database it is immutable.
The <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-objc/Classes/CBLMutableDocument.htmlc:objc(cs)CBLDocument(im)toMutable">(nonnull CBLMutableDocument *)toMutable;</a> method should be used to create an instance of the document which can be updated.</p>
</div>
<div id="ex-update-doc" class="exampleblock">
<div class="title">Example 7. Make a mutable document</div>
<div class="content">
<div class="paragraph">
<p>Changes to the document are persisted to the database when the <code>save</code> method is called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">CBLDocument *document = [self.database documentWithID:@"xyz"];
CBLMutableDocument *mutableDocument = [document toMutable];
[mutableDocument setString:@"apples" forKey:@"name"];
[self.database saveDocument:mutableDocument error:&amp;error];</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Any user change to the value of reserved keys (<code>_id</code>, <code>_rev</code> or <code>_deleted</code>) will be detected when a document is saved and will result in an exception (Error Code 5&#8201;&#8212;&#8201;<code>CorruptRevisionData</code>)&#8201;&#8212;&#8201;see also <a href="#lbl-doc-constraints">Document Constraints</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch-operations"><a class="anchor" href="#batch-operations"></a>Batch operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re making multiple changes to a database at once, it&#8217;s faster to group them together.
The following example persists a few documents in batch.</p>
</div>
<div id="ex-batch-ops" class="exampleblock">
<div class="title">Example 8. Batch operations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">[self.database inBatch:&amp;error usingBlock:^{
    for (int i = 0; i &lt; 10; i++) {
        CBLMutableDocument *doc = [[CBLMutableDocument alloc] init];
        [doc setValue:@"user" forKey:@"type"];
        [doc setValue:[NSString stringWithFormat:@"user %d", i] forKey:@"name"];
        [doc setBoolean:NO forKey:@"admin"];

        NSError *err = nil;
        [self.database saveDocument:doc error:&amp;err];
    }
}];</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At the <strong>local</strong> level this operation is still transactional: no other <code>Database</code> instances, including ones managed by the replicator can make changes during the execution of the block, and other instances will not see partial changes.
But Couchbase Mobile is a distributed system, and due to the way replication works, there&#8217;s no guarantee that Sync Gateway or other devices will receive your changes all at once.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-change-events"><a class="anchor" href="#document-change-events"></a>Document change events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s also possible to register for document changes.
The following example registers for changes to the document with ID <code>user.john</code> and prints the <code>verified_account</code> property.</p>
</div>
<div id="ex-doc-events" class="exampleblock">
<div class="title">Example 9. Document change events</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">[self.database addDocumentChangeListenerWithID:@"user.john" listener:^(CBLDocumentChange  *change) {
    CBLDocument *document = [wSelf.database documentWithID:change.documentID];
    NSLog(@"Status ::%@)", [document stringForKey:@"verified_account"]);
}];</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-expiration"><a class="anchor" href="#document-expiration"></a>Document Expiration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Document expiration allows users to set the expiration date to a document.
When the document is expired, the document will be purged from the database.
The purge will not be replicated to Sync Gateway.</p>
</div>
<div id="ex-set-doc-exp" class="exampleblock">
<div class="title">Example 10. Set document expiration</div>
<div class="content">
<div class="paragraph">
<p>This example sets the TTL for a document to 5 minutes from the current time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">// Purge the document one day from now
NSDate *ttl = [[NSCalendar currentCalendar] dateByAddingUnit:NSCalendarUnitDay
                                                       value:1
                                                      toDate:[NSDate date]
                                                     options:0];
[self.database setDocumentExpirationWithID:@"doc123" expiration:ttl error:&amp;error];

// Reset expiration
[self.database setDocumentExpirationWithID:@"doc1" expiration:nil error:&amp;error];

// Query documents that will be expired in less than five minutes
NSTimeInterval fiveMinutesFromNow = [[NSDate dateWithTimeIntervalSinceNow:60 * 5] timeIntervalSince1970];
CBLQuery *query = [CBLQueryBuilder select:@[[CBLQuerySelectResult expression:[CBLQueryMeta id]]]
                                     from:[CBLQueryDataSource database:self.database]
                                    where:[[CBLQueryMeta expiration]
                                            lessThan:[CBLQueryExpression double:fiveMinutesFromNow]]];</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-doc-constraints"><a class="anchor" href="#lbl-doc-constraints"></a>Document Constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite APIs do not explicitly disallow the use of attributes with the underscore prefix at the top level of document.
This is to facilitate the creation of documents for use either in <em>local only</em> mode where documents are not synced, or when used exclusively in peer-to-peer sync.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
"_id", :"_rev" and "_sequence" are reserved keywords and must not be used as top-level attributes&#8201;&#8212;&#8201;see <a href="#res-keys">Example 11</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Users are cautioned that any attempt to sync such documents to Sync Gateway will result in an error.
To be future proof, you are advised to avoid creating such documents.
Use of these attributes for user-level data may result in undefined system behavior.</p>
</div>
<div class="paragraph">
<p>For more guidance&#8201;&#8212;&#8201;see: <a href="../../../sync-gateway/current/data-modeling.html" class="page">Sync Gateway - data modeling guidelines</a></p>
</div>
<div id="res-keys" class="exampleblock">
<div class="title">Example 11. Reserved Keys List</div>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>_attachments</p>
</li>
<li>
<p>_deleted <sup class="footnote" id="_footnote_fn1">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>_id <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>_removed</p>
</li>
<li>
<p>_rev <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>_sequence</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-json-data"><a class="anchor" href="#lbl-json-data"></a>Working with JSON Data</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-array">Arrays</a>
| <a href="#lbl-blob">Blobs</a>
| <a href="#lbl-dictionary">Dictionaries</a>
| <a href="#lbl-document">Documents</a>
| <a href="#lbl-result">Query Results as JSON</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>toJSON()</code> typed-accessor means you can easily work with JSON data, native and Couchbase Lite objects.</p>
</div>
<div class="sect2">
<h3 id="lbl-array"><a class="anchor" href="#lbl-array"></a>Arrays</h3>
<div class="paragraph">
<p>Convert an <code>ArrayObject</code> to and from JSON using the <code>toJSON()</code> and <code>toArray</code> methods&#8201;&#8212;&#8201;see: <a href="#ex-array">Example 4</a>.</p>
</div>
<div class="paragraph">
<p>Additionally you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize a 'MutableArrayObject' using data supplied as a JSON string.
This is done using the <code>init(json)</code> constructor-- see: <a href="#ex-array">Example 4</a></p>
</li>
<li>
<p>Convert an <code>ArrayFragment</code> object to a JSON String</p>
</li>
<li>
<p>Set data with a JSON string using <code>setJSON()</code></p>
</li>
</ul>
</div>
<div id="ex-array" class="exampleblock">
<div class="title">Example 12. Arrays as JSON strings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">NSString *json = @"[\"1000\",\"1001\",\"1002\",\"1003\"]";

CBLMutableArray *myArray = [[CBLMutableArray alloc] initWithJSON:json error:&amp;error];

for (NSString *item in myArray) {
    NSLog(@"%@", item);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize array with JSON string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create and save new document using the array</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get native array object from new doc and print its elements</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get an array from the document as a JSON string</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-blob"><a class="anchor" href="#lbl-blob"></a>Blobs</h3>
<div class="paragraph">
<p>Convert a <code>Blob</code> to JSON using the <code>toJSON</code> method&#8201;&#8212;&#8201;see <a href="#ex-blob">Example 13</a>.</p>
</div>
<div class="paragraph">
<p>You can also check whether a given dictionary object is a blob, or not, using <code>isBlob()</code>&#8201;&#8212;&#8201;again, see <a href="#ex-blob">Example 13</a>.</p>
</div>
<div class="paragraph">
<p>Note that the blob object must first be saved to the database (generating required metadata) before you can use the <code>toJSON</code> method.</p>
</div>
<div id="ex-blob" class="exampleblock">
<div class="title">Example 13. Blobs as JSON strings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">
CBLDocument *doc = [self.database documentWithID:@"doc-1000"];
CBLBlob *blob = [doc blobForKey:@"avatar"];
NSString *json = [blob toJSON];
NSLog(@"json string is %@", json);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See also: <a href="blob.html" class="page">Blobs</a></p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-dictionary"><a class="anchor" href="#lbl-dictionary"></a>Dictionaries</h3>
<div class="paragraph">
<p>Convert a <code>DictionaryObject</code> to and from JSON using the <code>toJSON</code> and <code>toDictionary</code> methods&#8201;&#8212;&#8201;see <a href="#ex-dictionary">Example 14</a>.</p>
</div>
<div class="paragraph">
<p>Additionally you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize a 'MutableDictionaryObject' using data supplied as a JSON string.
This is done using the <code>init(json)</code> constructor-- see: <a href="#ex-dictionary">Example 14</a></p>
</li>
<li>
<p>Set data with a JSON string using <code>setJSON()</code></p>
</li>
</ul>
</div>
<div id="ex-dictionary" class="exampleblock">
<div class="title">Example 14. Dictionaries as JSON strings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">NSString *aJSONstring = @"{\"id\":\"1002\",\"type\":\"hotel\",\"name\":\"Hotel Ned\","
"\"city\":\"Balmain\",\"country\":\"Australia\",\"description\":\"Undefined description for Hotel Ned\"}";


CBLMutableDictionary *myDict = [[CBLMutableDictionary alloc] initWithJSON:aJSONstring
                                                                    error:&amp;error];

NSString *name = [myDict stringForKey:@"name"];

for (NSString *key in myDict) {
    NSLog(@"%@ %@", key, [myDict valueForKey:key]);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the dictionary using a JSON string</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-document"><a class="anchor" href="#lbl-document"></a>Documents</h3>
<div class="paragraph">
<p>Convert a <code>Document</code> to and from JSON strings using the <code>toJSON()</code> and <code>setJSON()</code> methods&#8201;&#8212;&#8201;see <a href="#ex-document">Example 15</a>.</p>
</div>
<div class="paragraph">
<p>Additionally you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize a 'MutableDocument' using data supplied as a JSON string.
This is done using the <code>init(json)</code> and-or <code>init(id: json:)</code> constructor-- see: <a href="#ex-document">Example 15</a></p>
</li>
<li>
<p>Set data with a JSON string using <code>setJSON()</code></p>
</li>
</ul>
</div>
<div id="ex-document" class="exampleblock">
<div class="title">Example 15. Documents as JSON strings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">
CBLDocument *doc = [self.database documentWithID:@"doc-1000"];
NSString *json = [doc toJSON];
NSLog(@"json %@", json);</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get a document as a JSON string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Initialize a MutableDocument using the JSON string and save to a separate database</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Retrieve the document created from JSON and print values</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-result"><a class="anchor" href="#lbl-result"></a>Query Results as JSON</h3>
<div class="paragraph">
<p>Convert a <code>Query Result</code> to JSON using its <code>toJSON()</code> accessor method.</p>
</div>
<div id="ex-json" class="exampleblock">
<div class="title">Example 16. Using JSON Results</div>
<div class="content">
<div class="paragraph">
<p>Use <a href="https://ibsoln.github.io/api/mobile/3.0.0/couchbase-lite-objc/Classes/CBLQueryResult.html#/c:objc(cs)CBLQueryResult(im)toJSON">CBLResult.toJSON</a> to transform your result string into a JSON string, which can easily be serialized or used as required in your application. See <<ex-json>> for a working example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/examples/code_snippets/SampleCodeTest.m">CBLQueryResultSet *rs = [query execute:&amp;error];
for (CBLQueryResult *result in rs) {

    // Get result as a JSON string
    NSString *json = [result toJSON]; <i class="conum" data-value="1"></i><b>(1)</b>

    // Get an native Obj-C object from the Json String
    NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:[json dataUsingEncoding:NSUTF8StringEncoding]
                                                                     options:NSJSONReadingAllowFragments
                                                                       error:&amp;error]; <i class="conum" data-value="2"></i><b>(2)</b>

    // Log generated Json and Native objects
    // For demo/example purposes
    NSLog(@"Json String %@", json);
    NSLog(@"Native Object %@", dict);

}; // end for</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the Query result as a JSON string&#8201;&#8212;&#8201;see <a href="#ex-json-format">JSON String Format</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get a native object from the JSON string</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Populate your custom object from the dictionary created from JSON data</td>
</tr>
</table>
</div>
<div id="ex-json-format" class="paragraph">
<div class="title">JSON String Format</div>
<p>If your query selects ALL then the JSON format will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
  database-name: {
    key1: "value1",
    keyx: "valuex"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your query selects a sub-set of available properties then the JSON format will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
  key1: "value1",
  keyx: "valuex"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id=""><a class="anchor" href="#"></a></h6>
<div class="ulist">
<div class="title">How to . . .</div>
<ul>
<li>
<p><a href="gs-prereqs.html" class="page">Prerequisites</a></p>
</li>
<li>
<p><a href="gs-install.html" class="page">Install</a></p>
</li>
<li>
<p><a href="gs-build.html" class="page">Build and Run</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Learn more . . .</div>
<ul>
<li>
<p><a href="database.html" class="page">Databases</a></p>
</li>
<li>
<p><a href="document.html" class="page">Documents</a></p>
</li>
<li>
<p><a href="blob.html" class="page">Blobs</a></p>
</li>
<li>
<p><a href="replication.html" class="page">Remote Sync Gateway</a></p>
</li>
<li>
<p><a href="conflict.html" class="page">Handling Data Conflicts</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="paragraph">
<div class="title">Dive Deeper . . .</div>
<p><a href="https://forums.couchbase.com/c/mobile/14">Mobile Forum</a> |
<a href="https://blog.couchbase.com/category/couchbase-mobile/?ref=blog-menu">Blog</a> |
<a href="https://docs.couchbase.com/tutorials/">Tutorials</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Any change to this reserved key will be detected when it is saved and will result in a Couchbase exception (Error Code 5&#8201;&#8212;&#8201;`CorruptRevisionData`)
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span> 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
