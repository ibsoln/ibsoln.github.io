<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Logging | Couchbase Docs</title>
    <link rel="canonical" href="https://ibsoln.github.io/myStaging/sync-gateway/2.7/logging.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="sync-gateway">
    <meta name="dcterms.identifier" content="2.7">
    <meta name="generator" content="Antora 2.0.1">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://ibsoln.github.io/myStaging">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="#">Server</a></li>
                  <li><a href="../../server//n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server//fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server//analytics/introduction.html">Analytics</a></li>
                  <li><a href="../../server//eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="#">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="../../couchbase-lite/2.1/index.html">Lite</a></li>
                  <li><a href="index.html">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server//sdk/overview.html">SDKs</a></li>
                  <li><a href="#">C</a></li>
                  <li><a href="#">.NET</a></li>
                  <li><a href="#">Go</a></li>
                  <li><a href="#">Java</a></li>
                  <li><a href="#">Node.js</a></li>
                  <li><a href="#">PHP</a></li>
                  <li><a href="#">Python</a></li>
                  <li><a href="#">Scala</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server//connectors/intro.html">Connectors</a></li>
                  <li><a href="#">Elasticsearch</a></li>
                  <li><a href="../../server//connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="#">Kafka</a></li>
                  <li><a href="#">Spark</a></li>
                  <li><a href="#">Talend</a></li>
                  <li><a href="../../server//connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <a class="navbar-item component" href="index.html"><span class="title">Sync Gateway</span> <span class="version">2.7</span></a>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Introduction</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="introduction.html">Introduction</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="index.html">What&#8217;s New</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="data-modeling.html">Data Modeling</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Access Control</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="users-and-roles.html">Users and Roles</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="authentication.html">Authentication</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="sync-gateway-channels.html">Sync Gateway Channels</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="read-access.html">Read Access</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="write-access.html">Write Access</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="sync-function.html">Sync Function</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Learn</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="config-properties.html">Configuration File</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="command-line-options.html">CLI</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="shared-bucket-access.html">Mobile-Server Data Sync</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-tombstones.html">Tombstones</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="indexing.html">Indexing</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="server-integration.html">Webhooks and Changes Feed</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="resolving-conflicts.html">Resolving Conflicts</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="integrating-external-stores.html">Integrating External Stores</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="running-replications.html">Inter-cluster Replication</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="rest-api-client.html">REST API Client</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Manage</span>
    </span>
<ul class="nav-list">
  <li class="nav-item is-current-page is-active" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="logging.html">Logging</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="stats-monitoring.html">Stats Monitoring</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="sgcollect-info.html">SGCollect Info</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="deployment.html">Deployment</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Sync Gateway on Kubernetes</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="kubernetes/deploy-cluster.html">Deploy a Cluster</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="kubernetes/manage-cluster.html">Manage a Cluster</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="upgrade.html">Upgrade</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="security.html">Security</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="load-balancer.html">Load Balancer</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="database-offline.html">Taking Databases Offline and Online</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="os-level-tuning.html">OS Level Tuning</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">API References</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="rest-api.html">Public REST API</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="admin-rest-api.html">Admin REST API</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Release Notes &amp; Compatibility</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="release-notes.html">Release Notes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="supported-os.html">Supported OS</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="compatibility-matrix.html">Compatibility Matrix</a>
    </span>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Sync Gateway</a></li>
    <li class="crumb">Manage</li>
    <li class="crumb"><a href="logging.html">Logging</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="file:///Users/ianbridge/Documents/CouchbaseDocs/sg/modules/ROOT/pages/logging.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">Logging</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This page describes the Sync Gateway logging API and how to enable different log settings.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="continuous-logging"><a class="anchor" href="#continuous-logging"></a>Continuous Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Continuous logging is a new feature in Sync Gateway 2.1 that provides more flexibility in how logs are generated and retained, whilst maintaining the level of logging required by Couchbase Support for investigation of issues.</p>
</div>
<div class="paragraph">
<p>Sync Gateway logging is now written to <a href="#log-file-outputs">separate files</a> by log level, with each log level supporting individual retention policies.</p>
</div>
<div class="paragraph">
<p>Console logging can also be configured independently, providing additional flexibility for system administrators depending on their needs.
This allows system administrators running Sync Gateway to tweak the log level, and log keys for the console output to suit their needs, whilst maintaining the level of logging required by Couchbase Support for investigation of issues.</p>
</div>
<div class="paragraph">
<p>The previous logging configuration (<code>logging.default</code>) is being deprecated, and Sync Gateway 2.1 will display warnings on startup of what is required to update your configuration.</p>
</div>
<div class="sect2">
<h3 id="console-log-output"><a class="anchor" href="#console-log-output"></a>Console Log Output</h3>
<div class="paragraph">
<p>The console output of Sync Gateway can be filtered down via <a href="#log-levels">Log Levels</a> and <a href="#log-keys">Log Keys</a>, and you can tweak this as much as you like without impacting Support&#8217;s ability to analyze the log files.</p>
</div>
<div class="sect3">
<h4 id="log-levels"><a class="anchor" href="#log-levels"></a>Log Levels</h4>
<div class="paragraph">
<p>The console log output can be configured with the following log levels, ordered from least verbose, to most.
Note that log levels are additive, so if you enable <code>info</code> level, <code>warn</code> and <code>error</code> logs are also enabled.
By default, the log level is set to <code>info</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log Level</th>
<th class="tableblock halign-left valign-top">Appearance</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables log output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[ERR]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays errors that need urgent attention</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>warn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[WRN]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays warnings that need some attention</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[INF]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays information about normal operations that don&#8217;t need attention</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[DBG]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays verbose output that might be useful when debugging</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[TRC]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays extremely verbose output that might be useful when debugging</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Log levels can be set in the configuration file (see the <a href="config-properties.html#logging-$level" class="page"><code>logging.$level</code></a> reference).</p>
</div>
</div>
<div class="sect3">
<h4 id="log-keys"><a class="anchor" href="#log-keys"></a>Log Keys</h4>
<div class="paragraph">
<p>Log keys are used to provide finer-grained control over what is logged.
By default, only <code>HTTP</code> is enabled.</p>
</div>
<div class="paragraph">
<p>All log keys and descriptions are described in the <a href="config-properties.html#logging-console-log_keys" class="page"><code>logging.console.log_level</code></a> property reference.</p>
</div>
</div>
<div class="sect3">
<h4 id="console-output-color"><a class="anchor" href="#console-output-color"></a>Console Output Color</h4>
<div class="paragraph">
<p>There is an option to color log output based on log level if <a href="config-properties.html#logging-console-color_enabled" class="page"><code>logging.console.color_enabled</code></a> is set to <code>true</code>.
Note: this setting is always disabled on Windows for compatibility reasons.</p>
</div>
</div>
<div class="sect3">
<h4 id="console-output-redirection"><a class="anchor" href="#console-output-redirection"></a>Console Output Redirection</h4>
<div class="paragraph">
<p>The log files described below are intended for Couchbase Support, and users are urged not to rely on these.</p>
</div>
<div class="paragraph">
<p>If you have special requirements for logs, such as centralized logging, you can redirect the console output to a file, and apply your own log collection mechanism to feed that data elsewhere.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Start Sync Gateway and redirect console output to a file
./sync-gateway &gt; my_sg_logs.txt 2&gt;&amp;1

# Start log collection to send to a centralized log aggregator.
logcollector my_sg_logs.txt</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="log-file-outputs"><a class="anchor" href="#log-file-outputs"></a>Log File Outputs</h3>
<div class="paragraph">
<p>These are 4 log files split by log level, with a guaranteed retention period for each.
The log files can be collected with <a href="sgcollect-info.html" class="page">SGCollect Info</a>, and can be analyzed by Couchbase Support for diagnosing issues in Sync Gateway.
As described above, it is recommended to use
<a href="index.html#console-output-redirection">Console Output redirection</a> if you require special handling of log files from Sync Gateway, as these files are intended for Couchbase Support.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log File</th>
<th class="tableblock halign-left valign-top">Default enabled</th>
<th class="tableblock halign-left valign-top">Default max_age</th>
<th class="tableblock halign-left valign-top">Minimum max_age</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sg_error.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">360 Days</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">180 Days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sg_warn.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">180 Days</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90 Days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sg_info.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6 Days</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 Days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sg_debug.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 Days</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 Day</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each log level and its parameters are described in the <a href="config-properties.html#logging-$level" class="page">logging.$level</a> property reference.</p>
</div>
<div class="sect3">
<h4 id="log-file-rotation"><a class="anchor" href="#log-file-rotation"></a>Log File Rotation</h4>
<div class="paragraph">
<p>These four log files will be rotated once each exceeds a threshold size, defined by <code>max_size</code> in megabytes.
Once rotated, the log files will be compressed with gzip, to reduce the disk space taken up by older logs.
These old logs will then be cleaned up once the age exceeds <code>max_age</code> in days.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="log-redaction"><a class="anchor" href="#log-redaction"></a>Log Redaction</h3>
<div class="paragraph">
<p>All log outputs can be redacted, this means that user-data, considered to be private, is removed.
This feature is optional and can be enabled in the configuration with the <a href="config-properties.html#logging-redaction_level" class="page"><code>logging.redaction_level</code></a> property.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="log-rotation-deprecated"><a class="anchor" href="#log-rotation-deprecated"></a>Log Rotation [DEPRECATED]</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="built-in-log-rotation"><a class="anchor" href="#built-in-log-rotation"></a>Built-in log rotation</h3>
<div class="paragraph">
<p>By default, Sync Gateway outputs the logs to standard out with the "HTTP" log key and can also output logs to a file.
Prior to 1.4, the two main configuration options were <code>log</code> and <code>logFilePath</code> at the root of the configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
    "log": ["*"],
    "logFilePath": "/var/log/sync_gateway/sglogfile.log"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Couchbase Mobile 1.4, Sync Gateway can now be configured to perform log rotation in order to minimize disk space usage.</p>
</div>
<div class="sect3">
<h4 id="log-rotation-configuration"><a class="anchor" href="#log-rotation-configuration"></a>Log rotation configuration</h4>
<div class="paragraph">
<p>The log rotation configuration is specified under the <code>logging</code> key.
The following example demonstrates where the log rotation properties reside in the configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
  "logging": {
    "default": {
      "logFilePath": "/var/log/sync_gateway/sglogfile.log",
      "logKeys": ["*"],
      "logLevel": "debug",
      "rotation": {
        "maxsize": 1,
        "maxage": 30,
        "maxbackups": 2,
        "localtime": true
      }
    }
  },
  "databases": {
    "db": {
      "server": "http://localhost:8091",
      "bucket": "default",
      "users": {"GUEST": {"disabled": false,"admin_channels": ["*"]}}
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown above, the <code>logging</code> property must contain a single named logging appender called <code>default</code>.
Note that if the "logging" property is specified, it will override the top level <code>log</code> and <code>logFilePath</code> properties.</p>
</div>
<div class="paragraph">
<p>The descriptions and default values for each logging property can be found on the <a href="config-properties.html" class="page">Sync Gateway configuration</a> page.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-output"><a class="anchor" href="#example-output"></a>Example Output</h4>
<div class="paragraph">
<p>If Sync Gateway is running with the configuration shown above, after a total of 3.5 MB of log data, the contents of the <code>/var/log/sync_gateway</code> directory would have 3 files because <code>maxsize</code> is set to 1 MB.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/var/log/sync_gateway
├── sglogfile.log
├── sglogfile-2017-01-25T23-35-23.671.log
└── sglogfile-2017-01-25T22-25-39.662.log</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="windows-configuration"><a class="anchor" href="#windows-configuration"></a>Windows Configuration</h4>
<div class="paragraph">
<p>On MS Windows <code>logFilePath</code> supports the following path formats.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">"C:/var/tmp/sglogfile.log"
`C:\var\tmp\sglogfile.log`
`/var/tmp/sglogfile.log`
"/var/tmp/sglogfile.log"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Log rotation will not work if <code>logFilePath</code> is set to the path below as it is reserved for use by the Sync Gateway Windows service wrapper.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">C:\Program Files (x86)\Couchbase\var\lib\couchbase\logs\sync_gateway_error.log</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deprecation-notice"><a class="anchor" href="#deprecation-notice"></a>Deprecation notice</h4>
<div class="paragraph">
<p>The current proposal is to remove the top level <code>log</code> and <code>logFilePath</code> properties in Sync Gateway 2.0.
For users that want to migrate to the new logging config to write to a log file but do not need log rotation they should use a default logger similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
    "logging": {
        "default": {
            "logFilePath": "/var/log/sync_gateway/sglogfile.log",
            "logKeys": ["*"],
            "logLevel": "debug"
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="os-log-rotation"><a class="anchor" href="#os-log-rotation"></a>OS log rotation</h3>
<div class="paragraph">
<p>In production environments it is common to rotate log files to prevent them from taking too much disk space, and to support log file archival.</p>
</div>
<div class="paragraph">
<p>By default Sync gateway will write log statements to stderr, normally stderr is redirected to a log file by starting Sync Gateway with a command similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sync_gateway sync_gateway.json 2&gt;&gt; sg_error.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Linux the logrotate tool can be used to monitor log files and rotate them at fixed time intervals or when they reach a certain size.
Below is an example of a logrotate configuration that will rotate the Sync Gateway log file once a day or if it reaches 10M in size.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/home/sync_gateway/logs/*.log {
    daily
    rotate 1
    size 10M
    delaycompress
    compress
    notifempty
    missingok</code></pre>
</div>
</div>
<div class="paragraph">
<p>The log rotation is achieved by renaming the log file with an appended timestamp.
The idea is that Sync Gateway should recreate the default log file and start writing to it again.
The problem is Sync Gateway will follow the renamed file and keep writing to it until Sync gateway is restarted.
By adding the copy truncate option to the logrotate configuration, the log file will be rotated by making a copy of the log file, and then truncating the original log file to zero bytes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/home/sync_gateway/logs/*.log {
    daily
    rotate 1
    size 10M
    copytruncate
    delaycompress
    compress
    notifempty
    missingok
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this approach there is a possibility of loosing log entries between the copy and the truncate, on a busy Sync Gateway instance or when verbose logging is configured the number of lost entries could be large.</p>
</div>
<div class="paragraph">
<p>In Sync Gateway 1.1.0 a new configuration option has been added that gives Sync Gateway control over the log file rather than relying on <strong>stderr</strong>.
To use this option call Sync Gateway as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sync_gateway -logFilePath=sg_error.log sync_gateway.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>logFilePath</strong> property can also be set in the configuration file at the <a href="config-properties.html#server-configuration" class="page">server level</a>.</p>
</div>
<div class="paragraph">
<p>If the option is not used then Sync Gateway uses the existing stderr logging behavior.
When the option is passed Sync Gateway will attempt to open and write to a log file at the path provided.
If a Sync Gateway process is sent the <code>SIGHUP</code> signal it will close the open log file and then reopen it, on Linux the <code>SIGHUP</code> signal can be manually sent using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pkill -HUP sync_gateway</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command can be added to the logrotate configuration using the 'postrotate' option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/home/sync_gateway/logs/*.log {
    daily
    rotate 1
    size 10M
    delaycompress
    compress
    notifempty
    missingok
    postrotate
        /usr/bin/pkill -HUP sync_gateway &gt; /dev/null
    endscript
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After renaming the log file logrotate will send the <code>SIGHUP</code> signal to the <code>sync_gateway</code> process, Sync Gateway will close the existing log file and open a new file at the original path, no log entries will be lost.</p>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">3250 Olcott Street
Santa Clara, CA 95054
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://learn.couchbase.com/store" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
