<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Couchbase Lite Java (Android) framework | Couchbase Docs</title>
<link rel="canonical" href="http://127.0.0.1:5000/couchbase-lite/2.7/java-android.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="couchbase-lite">
<meta name="dcterms.identifier" content="2.7">
<meta name="page-url" content="/couchbase-lite/2.7/java-android.html">
<meta name="generator" content="Antora 3.0.0-alpha.6">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="http://127.0.0.1:5000/home/index.html">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="http://127.0.0.1:5000/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../tutorials/index.html">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a href="https://cloud.couchbase.com/sign-up" class="free-trial-link" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  <i class="fas fa-cloud"></i>
                  Free Trial
                </a>
                <a class="btn btn-primary try-btn"  onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
<div class="components">
  <div class="components_group-title">
    <a href="../../home/mobile.html">Mobile</a>
  </div>
  <ul class="components_list">
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Couchbase Lite</span>
        <select class="version_list" data-component="couchbase-lite">
          <option value="2.8" data-url="../current/index.html">2.8</option>
          <option value="2.7" data-url="index.html" selected>2.7</option>
        </select>
      </div>
      <div class="version_items hide" data-version="2.8">
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../current/index.html">Introduction</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-whatsnew}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../current/android/quickstart.html">Android</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-prereqs}">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-install}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-build}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-database}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-database-prebuilt}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-document}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-blob}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{querybuilder&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-live}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-predictive}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-troubleshooting}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-fts}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{indexing&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-landing-replications}">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-dbreplica}">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-replication}">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-p2psync-websocket}">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dbo-p2psync-websocket-using-passive}</span>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dbo-p2psync-websocket-using-active}</span>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-p2psync-custom}">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-conflict}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{url-api-references}[API&#160;References]</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dep-upgrade}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-logs}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-queries}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{release-notes&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-compatibility}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-supported-os}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-refer-glossary}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../current/csharp/quickstart.html">C#.Net</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-install}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-build}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-database}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-database-prebuilt}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-document}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-blob}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{querybuilder&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-live}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-predictive}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-troubleshooting}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-fts}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{indexing&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-landing-replications}">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-dbreplica}">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-replication}">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-p2psync-websocket}">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dbo-p2psync-websocket-using-passive}</span>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dbo-p2psync-websocket-using-active}</span>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-p2psync-custom}">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-conflict}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{url-api-references}[API&#160;References]</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dep-upgrade}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-logs}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-queries}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{release-notes&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-compatibility}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-supported-os}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-refer-glossary}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../current/java/quickstart.html">Java</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-prereqs}">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-install}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-build}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-database}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-database-prebuilt}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-document}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-blob}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{querybuilder&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-live}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-predictive}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-troubleshooting}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-fts}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{indexing&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-landing-replications}">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-dbreplica}">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-replication}">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-p2psync-websocket}">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dbo-p2psync-websocket-using-passive}</span>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dbo-p2psync-websocket-using-active}</span>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-p2psync-custom}">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-conflict}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{url-api-references}[API&#160;References]</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dep-upgrade}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-logs}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-queries}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{release-notes&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-compatibility}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-supported-os}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-refer-glossary}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../current/objc/quickstart.html">Objective-C</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-prereqs}">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-install}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-build}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-database}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-database-prebuilt}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-document}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-blob}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{querybuilder&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-live}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-predictive}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-troubleshooting}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-fts}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{indexing&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-landing-replications}">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-dbreplica}">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-replication}">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-p2psync-websocket}">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dbo-p2psync-websocket-using-passive}</span>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dbo-p2psync-websocket-using-active}</span>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-p2psync-custom}">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-conflict}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{url-api-references}[API&#160;References]</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dep-upgrade}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-logs}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-queries}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-crashes}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{release-notes&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-compatibility}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-supported-os}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-refer-glossary}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../current/swift/quickstart.html">Swift</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-prereqs}">Start Here!</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-install}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-build}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-database}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-database-prebuilt}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-document}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-blob}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{querybuilder&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-live}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-predictive}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-query-troubleshooting}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-fts}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{indexing&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-landing-replications}">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-dbreplica}">Intra-Device</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-replication}">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#{cbl-pg-p2psync-websocket}">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dbo-p2psync-websocket-using-passive}</span>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dbo-p2psync-websocket-using-active}</span>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#{cbl-pg-p2psync-custom}">Integrate a Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-conflict}</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{url-api-references}[API&#160;References]</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-dep-upgrade}</span>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-logs}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-queries}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-troubleshooting-crashes}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{release-notes&#8212;&#8203;xref}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-compatibility}</span>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-supported-os}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">{xref-cbl-pg-refer-glossary}</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../current/javascript.html">JavaScript</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../current/javascript.html">JavaScript</a>
  </span>
</li>
</ul>
</li>
</ul>
      </div>
      <div class="version_items hide" data-version="2.7">
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Couchbase Lite</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="introduction.html">Introduction</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="index.html">What&#8217;s New</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="swift.html">Swift</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="java-platform.html">Java</a>
  </span>
</li>
<li class="menu_list is-current-page" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link is-current-page" href="java-android.html">Java (Android)</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="csharp.html">C#</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="objc.html">Objective-C</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="javascript.html">JavaScript</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../tutorials/index.html">Tutorials</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="compatibility.html">Compatibility</a>
  </span>
</li>
</ul>
</li>
</ul>
      </div>
    </li>
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Sync Gateway</span>
        <select class="version_list" data-component="sync-gateway">
          <option value="3.0 BETA" data-url="../../sync-gateway/current/index.html" selected>3.0 BETA</option>
        </select>
      </div>
      <div class="version_items hide" data-version="3.0 BETA">
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/introduction.html">Introduction</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/whatsnew.html"><strong><em>New in 3.0 BETA</em></strong></a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/get-started-prepare.html">Prepare</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/get-started-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/get-started-verify-install.html">Verify</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/data-modeling.html">Data Modeling</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Configuration</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/configuration-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/configuration-schema-bootstrap.html">Bootstrap</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/configuration-schema-database.html">Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/configuration-schema-db-security.html">Database Security</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/configuration-schema-access-control.html">Access Control</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/configuration-schema-import-filter.html">Import Filter</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/configuration-schema-isgr.html">Inter-Sync&#160;Gateway Replication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/configuration-properties.html">Legacy Pre-3.0 BETA Configuration</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/configuration-javascript-functions.html">Javascript Functions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/configuration-environment-variables.html">Environment Variables</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Security</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/secure-sgw-access.html">Secure Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/authentication-users.html">User Authentication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/authentication-certs.html">TLS Cert Authetnication</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Access Control</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../sync-gateway/current/access-control-concepts.html">Concepts</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/access-control-model.html">Access Control Model</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/channels.html">Channels</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/roles.html">Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/users.html">Users</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function.html">Sync Function</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function-api.html">API Reference</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function-api-access-cmd.html">access()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function-api-channel-cmd.html">channel()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function-api-expiry-cmd.html">expiry()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function-api-require-access-cmd.html">requireAccess()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function-api-require-admin-cmd.html">requireAdmin()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function-api-require-role-cmd.html">requireRole()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function-api-require-user-cmd.html">requireUser()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function-api-role-cmd.html">role()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-function-api-throw-cmd.html">throw()</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../sync-gateway/current/access-control-how.html">How-to</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/access-control-how-create-users.html">Create Users</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/access-control-how-create-roles.html">Create Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/access-control-how-assign-users-to-roles.html">Assign User to Role</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/access-control-how-control-document-access.html">Control Document Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/access-control-how-verify-access.html">Verify Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/access-control-how-use-xattrs-for-access-grants.html">Use XATTRS for Access Grants</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/auto-purge-channel-access-revocation.html">Auto-Purge Channel Access Revocation</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">REST API</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/rest-api-access.html">Secure Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/rest-api-admin.html">Admin REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/rest-api-metrics.html">Metrics REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/rest-api.html">Public REST API</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-with-couchbase-server.html">Sync with Server</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-using-app.html">Sync with Application</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Inter-Sync Gateway Replication</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-inter-syncgateway-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-inter-syncgateway-run.html">Initialize</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-inter-syncgateway-manage.html">Manage</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-inter-syncgateway-monitor.html">Monitor</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sync-inter-syncgateway-conflict-resolution.html">Inter Syncgateway Conflict Resolution</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/revisions.html">Revisions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/what-are-tombstones.html">Tombstones</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/managing-tombstones.html">Managing Tomstones</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/delta-sync.html">Delta Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/resync.html">Resync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/import-filter.html">Import Filter</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Manage</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/stats-monitoring.html">Stats Monitoring</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Logging and Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/logging.html">Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/sgcollect-info.html">SG Collect Info</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/database-offline.html">Database Offline</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Deploy</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/deployment.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/command-line-options.html">Command Line Options</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/load-balancer.html">Load Balancer</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/os-level-tuning.html">OS Level Tuning</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/webhooks.html">Webhooks</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/changes-feed.html">Changes Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/integrating-external-stores.html">External Stores</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/stats-prometheus.html">Prometheus Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/setting-up-dr-cluster.html">Disaster Recovery</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/upgrading.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Use Kubernetes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/deploy-cluster-to-kubernetes.html">Deploy</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#operator::{cao-pg-manage-sgw&amp;.adoc#8212;&amp;#8203;page">Manage a Sync Gateway Cluster</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#operator::{cao-pg-clients-sgw&amp;.adoc#8212;&amp;#8203;page">Expose Sync Gateway to Couchbase Lite clients</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Server Compatibility</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/server-compatibility-collections.html">Collections</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/server-compatibility-eventing.html">Eventing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/server-compatibility-transactions.html">Transactions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/server-compatibility-xdcr.html">XDCR</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/supported-environments.html">Supported Environments</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/compatibility.html">Compatibility Matrix</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Legacy Features</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/legacy-sg-replicate.html">SG Replicate</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/legacy-sgreplicate-resolving-conflicts.html">SG Replicate - Resolving Conflicts (depr)</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/legacy-logging-pre2-1.html">Legacy Pre-2.1 Logging</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../sync-gateway/current/glossary.html">Glossary</a>
  </span>
</li>
</ul>
      </div>
    </li>
  </ul>
</div>
  </div>
</aside>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/ROOT/pages/java-android.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb">Couchbase Lite</li>
<li class="crumb"><a href="java-android.html">Java (Android)</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Couchbase Lite Java (Android) framework</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create or open an existing Android Studio project and install Couchbase Lite using the following method.</p>
</div>
<div class="paragraph">
<p>Make the following additions to the module-level <code>build.gradle</code> file (typically in the <strong>app</strong> folder).</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_community"></a>Community</p>
</li>
<li>
<p><a id="tabset1_enterprise"></a>Enterprise</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_community">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Include the following in the <code>android {}</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">android {
    // Required only if your project has some Kotlin source code
    kotlinOptions { jvmTarget = '1.8' }

    // Set minimum JVM level to ensure availability of, for example, lambda expressions
    compileOptions {
        targetCompatibility 1.8
        sourceCompatibility 1.8
    }

//   ... other section content as required by user
}</code></pre>
</div>
</div>
</li>
<li>
<p>Include the following in the <code>dependencies{}</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    implementation "com.couchbase.lite:couchbase-lite-android:${version}"

//   ... other section content as required by user
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_enterprise">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Include the following in the <code>android {}</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">android {
    // Required only if your project has some Kotlin source code
    kotlinOptions { jvmTarget = '1.8' }

    // Set minimum JVM level to ensure availability of, for example, lambda expressions
    compileOptions {
        targetCompatibility 1.8
        sourceCompatibility 1.8
    }

//   ... other section content as required by user
}</code></pre>
</div>
</div>
</li>
<li>
<p>Include the following in the <code>dependencies{}</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    implementation "com.couchbase.lite:couchbase-lite-android-ee:${version}"

//   ... other section content as required by user
}</code></pre>
</div>
</div>
</li>
<li>
<p>Include the following in the <code>repositories {}</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">repositories {
    maven { url 'https://mobile.maven.couchbase.com/maven2/dev/' }
    google()
    jcenter()

//   ... other section content as required by user
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="starter-code"><a class="anchor" href="#starter-code"></a>Starter code</h3>
<div class="sect3">
<h4 id="minification"><a class="anchor" href="#minification"></a>Minification</h4>
<div class="paragraph">
<p>An application that enables minification must ensure that certain pieces of Couchbase Lite library code are not changed&#8201;&#8212;&#8201;see <a href="#ruleset">Example 1</a> for a near-minimal rule set that retains the needed code:</p>
</div>
<div id="ruleset" class="exampleblock">
<div class="title">Example 1. Ruleset</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">-keep class com.couchbase.lite.ConnectionStatus { &lt;init&gt;(...); }
-keep class com.couchbase.lite.LiteCoreException { static &lt;methods&gt;; }
-keep class com.couchbase.lite.internal.core.C4* {
    static &lt;methods&gt;;
    &lt;fields&gt;;
    &lt;init&gt;(...);
 }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running"><a class="anchor" href="#running"></a>Running</h4>
<div class="paragraph">
<p>Open <strong>MainActivity.java</strong> in Android Studio and copy the following code in the <code>onCreate</code> method.
This snippet demonstrates how to run basic CRUD operations, a simple Query and running bi-directional replications with Sync Gateway.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L109-L161">
// Initialize the Couchbase Lite system
CouchbaseLite.init(context);

// Get the database (and create it if it doesnt exist).
DatabaseConfiguration config = new DatabaseConfiguration();
Database database = new Database("getting-started", config);

// Create a new document (i.e. a record) in the database.
MutableDocument mutableDoc = new MutableDocument()
    .setFloat("version", 2.0F)
    .setString("type", "SDK");

// Save it to the database.
database.save(mutableDoc);

// Update a document.
mutableDoc = database.getDocument(mutableDoc.getId()).toMutable();
mutableDoc.setString("language", "Java");
database.save(mutableDoc);
Document document = database.getDocument(mutableDoc.getId());
// Log the document ID (generated by the database) and properties
Log.i(TAG, "Document ID :: " + document.getId());
Log.i(TAG, "Learning " + document.getString("language"));

// Create a query to fetch documents of type SDK.
Query query = QueryBuilder.select(SelectResult.all())
    .from(DataSource.database(database))
    .where(Expression.property("type").equalTo(Expression.string("SDK")));
ResultSet result = query.execute();
Log.i(TAG, "Number of rows ::  " + result.allResults().size());

// Create replicators to push and pull changes to and from the cloud.
Endpoint targetEndpoint = new URLEndpoint(new URI("ws://localhost:4984/getting-started-db"));
ReplicatorConfiguration replConfig = new ReplicatorConfiguration(database, targetEndpoint);
replConfig.setReplicatorType(ReplicatorConfiguration.ReplicatorType.PUSH_AND_PULL);

// Add authentication.
replConfig.setAuthenticator(new BasicAuthenticator("sync-gateway", "password"));

// Create replicator (be sure to hold a reference somewhere that will prevent the Replicator from being GCed)
Replicator replicator = new Replicator(replConfig);

// Listen to replicator change events.
replicator.addChangeListener(change -&gt; {
    if (change.getStatus().getError() != null) {
        Log.i(TAG, "Error code ::  " + change.getStatus().getError().getCode());
    }
});

// Start replication.
replicator.start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build and run.
You should see the document ID and property printed to the console.
The document was successfully persisted to the database.</p>
</div>
<div class="paragraph">
<p><a href="../../sync-gateway/current/get-started-install.html#installation" class="page">Installing Sync Gateway &#8594;</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="supported-versions"><a class="anchor" href="#supported-versions"></a>Supported Versions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The operating systems listed below refer to "Certified" versions of Android.
We do not test against, nor guarantee support for, uncertified Android versions such as versions built from source.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Deprecation Notice</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Support for API 19 and 21
was deprecated in release 2.6
and will be removed in
 a future release</p>
</div>
<div class="paragraph">
<p><em>Action:</em> Please plan to migrate your apps to use API versions greater than API 21</p>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Platform</th>
<th class="tableblock halign-left valign-top">Runtime architectures</th>
<th class="tableblock halign-left valign-top">Minimum API Level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Android</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">armeabi-v7a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Android</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">arm64-v8a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Android</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Android</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="api-references"><a class="anchor" href="#api-references"></a>API References</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://docs.couchbase.com/mobile/2.7.0/couchbase-lite-android/" target="_blank" rel="noopener">Java SDK API References</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrading"><a class="anchor" href="#upgrading"></a>Upgrading</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="android-studio"><a class="anchor" href="#android-studio"></a>Android Studio</h3>
<div class="paragraph">
<p>The API changed in Couchbase Lite 2.0 and you will need to port any application that is using Couchbase Lite 1.x API to the latest Couchbase Lite API.
To update an Android project built with Couchbase Lite 1.x:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove the existing Couchbase Lite dependency from the Android Studio project.</p>
</li>
<li>
<p>Install the Couchbase Lite framework in your project (see the <a href="#getting-started">Getting Started</a> section).
At this point, there will be many compiler warnings.
Refer to the examples on this page to learn about the new API.</p>
</li>
<li>
<p>Build &amp; run your application.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="database-upgrade"><a class="anchor" href="#database-upgrade"></a>Database Upgrade</h3>
<div class="paragraph">
<p>Databases created using Couchbase Lite 1.2 or later can still be used with Couchbase Lite 2.x; but will be automatically updated to the  current 2.x version.
This feature is only available for the default storage type (i.e., not a ForestDB database).
Additionally, the automatic migration feature does not support encrypted databases, so if the 1.x database is encrypted you will first need to disable encryption using the Couchbase Lite 1.x API (see the <a href="#1.4@java.adoc#database-encryption" class="page unresolved">1.x Database Guide</a>).</p>
</div>
<div class="sect3">
<h4 id="handling-of-existing-conflicts"><a class="anchor" href="#handling-of-existing-conflicts"></a>Handling of Existing Conflicts</h4>
<div class="paragraph">
<p>If there are existing conflicts in the 1.x database, the automatic upgrade process copies the default winning revision to the new database and does NOT copy any conflicting revisions.
This functionality is related to the way conflicts are now being handled in Couchbase Lite (see <a href="#java.adoc#handling-conflicts" class="page unresolved">Handling Conflicts</a>).
Optionally, existing conflicts in the 1.x database can be resolved with the <a href="#1.4@java.adoc#resolving-conflicts" class="page unresolved">1.x API</a> prior to the database being upgraded.</p>
</div>
</div>
<div class="sect3">
<h4 id="handling-of-existing-attachments"><a class="anchor" href="#handling-of-existing-attachments"></a>Handling of Existing Attachments</h4>
<div class="paragraph">
<p>Attachments persisted in a 1.x database are copied to the new database.
NOTE: The relevant Couchbase Lite API is now called the <code>Blob</code> API not the <code>Attachments</code> API.</p>
</div>
<div class="paragraph">
<p>The functionally is identical but the internal schema for attachments has changed.
Blobs are stored anywhere in the document, just like other value types, whereas in 1.x they were stored under the <code>_attachments</code> field.
The automatic upgrade functionality <strong>does not</strong> update the internal schema for attachments, so they remain accessible under the <code>_attachments</code> field.
The following example shows how to retrieve an attachment that was created in a 1.x database with a 2.x API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L197-L199">Dictionary attachments = document.getDictionary("_attachments");
Blob blob = attachments != null ? attachments.getBlob("avatar") : null;
byte[] content = blob != null ? blob.getContent() : null;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="replication-compatibility"><a class="anchor" href="#replication-compatibility"></a>Replication Compatibility</h3>
<div class="paragraph">
<p>The current replication protocol is not backwards compatible with the 1.x replication protocol.
Therefore, to use replication with Couchbase Lite 2.x, the target Sync Gateway instance must also be upgraded to 2.x.</p>
</div>
<div class="paragraph">
<p>Sync Gateway 2.x will continue to accept clients that connect through the 1.x protocol.
It will automatically use the 1.x replication protocol when a Couchbase Lite 1.x client connects through http://localhost:4984/db and the 2.0 replication protocol when a Couchbase Lite 2.0 client connects through ws://localhost:4984/db.
This allows for a smoother transition to get all your user base onto a version of your application built with Couchbase Lite 2.x.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="initializer"><a class="anchor" href="#initializer"></a>Initializer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Your first step in using the API must be to call its initializer.
An exception is raised if any other API method is invoked before the  initializer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L206-L207">// Initialize the Couchbase Lite system
CouchbaseLite.init(context);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="database"><a class="anchor" href="#database"></a>Database</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="new-database"><a class="anchor" href="#new-database"></a>New Database</h3>
<div class="paragraph">
<p>As the top-level entity in the API, new databases can be created using the <code>Database</code> class by passing in a name, configuration, or both.
The following example creates a database using the <code>Database(String name, DatabaseConfiguration config)</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L214-L215">DatabaseConfiguration config = new DatabaseConfiguration();
Database database = new Database("my-database", config);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as before, the database will be created in a default location.
Alternatively, the <code>Database(string name, DatabaseConfiguration config)</code> initializer can be used to provide specific options in the <a href="https://docs.couchbase.com/mobile/2.7.0/couchbase-lite-android//com/couchbase/lite/DatabaseConfiguration.html"><code>DatabaseConfiguration</code></a> object such as the database directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="database-encryption"><a class="anchor" href="#database-encryption"></a>Database Encryption</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Enterprise Edition only</div>
Database encryption is an <a href="https://www.couchbase.com/products/editions">Enterprise Edition</a> feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Couchbase Lite 2.1 release includes the ability to encrypt Couchbase Lite databases.
This allows mobile applications to secure the data at rest, when it is being stored on the device.
The algorithm used to encrypt the database is 256-bit AES.</p>
</div>
<div class="paragraph">
<p>To enable encryption, you must set the <code>DatabaseConfiguration.encryptionKey</code> property with the encryption key of your choice.
The encryption key is then required every time the database is opened.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L224-L226">DatabaseConfiguration config = new DatabaseConfiguration();
config.setEncryptionKey(new EncryptionKey("PASSWORD"));
Database database = new Database("mydb", config);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Couchbase Lite does not persist the key.
It is the application&#8217;s responsibility to manage the key and store it in a platform specific secure store such as Apple&#8217;s <a href="https://developer.apple.com/documentation/security/keychain_services">Keychain</a> or Android&#8217;s <a href="https://developer.android.com/training/articles/keystore">Keystore</a>.</p>
</div>
<div class="paragraph">
<p>An encrypted database can only be opened with the same language SDK that was used to encrypt it in the first place (Swift, C#, Java or Objective-C).
For example, if a database is encrypted with the Swift SDK and then exported, it will only be readable with the Swift SDK.</p>
</div>
<div class="sect3">
<h4 id="upgrading-from-1-x-when-encryption-is-enabled"><a class="anchor" href="#upgrading-from-1-x-when-encryption-is-enabled"></a>Upgrading from 1.x when Encryption is Enabled</h4>
<div class="paragraph">
<p>If you&#8217;re migrating an application from Couchbase Lite 1.x to 2.x, note that the <a href="#database-upgrade">automatic database upgrade</a> functionality is <strong>not supported</strong> for encrypted databases.
Thus, to upgrade an encrypted 1.x database, you should do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable encryption using the Couchbase Lite 1.x framework (see <a href="#1.4@java.adoc#database-encryption" class="page unresolved">1.x encryption guide</a>)</p>
</li>
<li>
<p>Open the database file with encryption enabled using the Couchbase Lite 2.x framework (see <a href="#database-encryption">database encryption</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Since it is not possible to package Couchbase Lite 1.x and Couchbase Lite 2.x in the same application this upgrade path would require two successive upgrades.
If you are using Sync Gateway to synchronize the database content, it may be preferable to run a pull replication from a new 2.x database with encryption enabled and delete the 1.x local database.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="finding-a-database-file"><a class="anchor" href="#finding-a-database-file"></a>Finding a Database File</h3>
<div class="paragraph">
<p>When the application is running on the Android emulator, you can locate the application&#8217;s data folder and access the database file by using the <strong>adb</strong> CLI tools.
For example, to list the different databases on the emulator, you can run the following commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ adb shell
$ su
$ cd /data/data/{APPLICATION_ID}/files
$ ls</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>adb pull</strong> command can be used to pull a specific database to your host machine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ adb root
$ adb pull /data/data/{APPLICATION_ID}/files/{DATABASE_NAME}.cblite2 .</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cli-tool"><a class="anchor" href="#cli-tool"></a>CLI tool</h3>
<div class="paragraph">
<p><code>cblite</code> is a command-line tool for inspecting and querying Couchbase Lite 2.x databases.</p>
</div>
<div class="paragraph">
<p>You can download and build it from the couchbaselabs <a href="https://github.com/couchbaselabs/couchbase-mobile-tools/blob/master/README.cblite.md">GitHub repository</a>.
Note that the <code>cblite</code> tool is not supported by the <a href="https://www.couchbase.com/support-policy">Couchbase Support Policy</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="logging"><a class="anchor" href="#logging"></a>Logging</h3>
<div class="paragraph">
<p>If you are using a Couchbase Lite release prior to 2.5 see <a href="#logging-functionality-prior-to-release-2-5">Deprecated functionality</a></p>
</div>
<div class="paragraph">
<p>From version 2.5, Couchbase Lite provides a logging API that unifies the logging behavior across all platforms, making debugging and troubleshooting easier during development and in production.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The retrieval of logs from the device is out of scope of this feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Available logging features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Console based logging</p>
</li>
<li>
<p>File based logging</p>
</li>
<li>
<p>Custom logging</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="console-based-logging"><a class="anchor" href="#console-based-logging"></a>Console based logging</h4>
<div class="paragraph">
<p>Default: Enabled.</p>
</div>
<div class="paragraph">
<p>Console based logging is often used to facilitate troubleshooting during development.</p>
</div>
</div>
<div class="sect3">
<h4 id="file-based-logging"><a class="anchor" href="#file-based-logging"></a>File based logging</h4>
<div class="paragraph">
<p>Default: Disabled.</p>
</div>
<div class="paragraph">
<p>Available file based logging formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Binary&#8201;&#8212;&#8201;most efficient for storage and performance. It is the default for file based logging.</p>
</li>
<li>
<p>Plaintext</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We recommend using the binary log format and
a decoder, such as <strong>cbl-log</strong>, to view them. Download <strong>cbl-log</strong> from <a href="https://github.com/couchbaselabs/couchbase-mobile-tools/blob/master/README.cbl-log.md" target="_blank" rel="noopener">couchbaselabs/couchbase-mobile-tools</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See  <a href="#decoding-binary-logs">Decoding binary logs</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example enables file based logging.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L250-L252">final File path = context.getCacheDir();
Database.log.getFile().setConfig(new LogFileConfiguration(path.toString()));
Database.log.getFile().setLevel(LogLevel.INFO);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-logging"><a class="anchor" href="#custom-logging"></a>Custom logging</h4>
<div class="paragraph">
<p>Default: Disabled.</p>
</div>
<div class="paragraph">
<p>Allows registration of a callback function to receive Couchbase Lite log messages, which may be logged using any external logging framework.</p>
</div>
<div class="paragraph">
<p>Apps must implement the <code>Logger</code> interface, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1268-L1283">class LogTestLogger implements Logger {
    @NonNull
    private final LogLevel level;

    public LogTestLogger(@NonNull LogLevel level) { this.level = level; }

    @NonNull
    @Override
    public LogLevel getLevel() { return level; }

    @Override
    public void log(@NonNull LogLevel level, @NonNull LogDomain domain, @NonNull String message) {
        // this method will never be called if param level &lt; this.level
        // handle the message, for example piping it to a third party framework
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And set it on the <code>custom</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L240-L242">// this custom logger will never be asked to log an event
// with a log level &lt; WARNING
Database.log.setCustom(new LogTestLogger(LogLevel.WARNING));</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong> the number returned by <code>LogLevel.getValue()</code> is not the Android log level and should not be used</p>
</div>
</div>
<div class="sect3">
<h4 id="decoding-binary-logs"><a class="anchor" href="#decoding-binary-logs"></a>Decoding binary logs</h4>
<div class="paragraph">
<p>The <strong>cbl-log</strong> tool should be used to decode binary log files as shown in these examples.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_macos"></a>macOS</p>
</li>
<li>
<p><a id="tabset2_centos"></a>CentOS</p>
</li>
<li>
<p><a id="tabset2_windows"></a>Windows</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_macos">
<div class="paragraph">
<p>Download the <strong>cbl-log</strong> tool using <code>wget</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">wget https://packages.couchbase.com/releases/couchbase-lite-log/2.7.0/couchbase-lite-log-2.7.0-macos.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Navigate to the <strong>bin</strong> directory and run the <code>cbl-log</code> executable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ ./cbl-log logcat LOGFILE &lt;OUTPUT_PATH&gt;</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_centos">
<div class="paragraph">
<p>Download the <strong>cbl-log</strong> tool using <code>wget</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">wget https://packages.couchbase.com/releases/couchbase-lite-log/2.7.0/couchbase-lite-log-2.7.0-centos.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Navigate to the <strong>bin</strong> directory and run the <code>cbl-log</code> executable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">cbl-log logcat LOGFILE &lt;OUTPUT_PATH&gt;</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_windows">
<div class="paragraph">
<p>Download the <strong>cbl-log</strong> tool using PowerShell.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-powershell hljs" data-lang="powershell">Invoke-WebRequest https://packages.couchbase.com/releases/couchbase-lite-log/2.7.0/couchbase-lite-log-2.7.0-windows.zip -OutFile couchbase-lite-log-2.7.0-windows.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the <code>cbl-log</code> executable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-powershell hljs" data-lang="powershell">$ .\cbl-log.exe logcat LOGFILE &lt;OUTPUT_PATH&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="logging-functionality-prior-to-release-2-5"><a class="anchor" href="#logging-functionality-prior-to-release-2-5"></a>Logging functionality prior to Release 2.5</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This Logging functionality is deprecated. It was replaced by the current Logging API in release 2.5 and so this information is included for completeness only.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The log messages are split into different domains (<code>LogDomains</code>) which can be tuned to different log levels.
The following example enables <code>verbose</code> logging for the <code>replicator</code> and <code>query</code> domains.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java">Database.setLogLevel(LogDomain.REPLICATOR, LogLevel.VERBOSE);
Database.setLogLevel(LogDomain.QUERY, LogLevel.VERBOSE);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="loading-a-pre-built-database"><a class="anchor" href="#loading-a-pre-built-database"></a>Loading a pre-built database</h3>
<div class="paragraph">
<p>If your app needs to sync a lot of data initially, but that data is fairly static and won&#8217;t change much, it can be a lot more efficient to bundle a database in your application and install it on the first launch.
Even if some of the content changes on the server after you create the app, the app&#8217;s first pull replication will bring the database up to date.</p>
</div>
<div class="paragraph">
<p>To use a prebuilt database, you need to set up the database, build the database into your app bundle as a resource, and install the database during the initial launch.
After your app launches, it needs to check whether the database exists.
If the database does not exist, the application should copy it from the assets folder to the app&#8217;s files directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L259-L271">// Note: Getting the path to a database is platform-specific.
// For Android you need to extract it from your
// assets to a temporary directory and then pass that path to Database.copy()
DatabaseConfiguration configuration = new DatabaseConfiguration();
if (!Database.exists("travel-sample", context.getFilesDir())) {
    ZipUtils.unzip(getAsset("travel-sample.cblite2.zip"), context.getFilesDir());
    File path = new File(context.getFilesDir(), "travel-sample");
    try {
        Database.copy(path, "travel-sample", configuration);
    } catch (CouchbaseLiteException e) {
        e.printStackTrace();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example below, the <code>ZipUtils.unzip</code> method copies the zipped pre-built database from the APK&#8217;s <strong>assets</strong> directory to the <strong>files</strong> directory.
This method is provided below for reference as it isn&#8217;t included in the Couchbase Lite library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/ZipUtils.java#L11-L36">public class ZipUtils {
    public static void unzip(InputStream in, File destination) throws IOException {
        byte[] buffer = new byte[1024];
        ZipInputStream zis = new ZipInputStream(in);
        ZipEntry ze = zis.getNextEntry();
        while (ze != null) {
            String fileName = ze.getName();
            File newFile = new File(destination, fileName);
            if (ze.isDirectory()) {
                newFile.mkdirs();
            } else {
                new File(newFile.getParent()).mkdirs();
                FileOutputStream fos = new FileOutputStream(newFile);
                int len;
                while ((len = zis.read(buffer)) &gt; 0) {
                    fos.write(buffer, 0, len);
                }
                fos.close();
            }
            ze = zis.getNextEntry();
        }
        zis.closeEntry();
        zis.close();
        in.close();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document"><a class="anchor" href="#document"></a>Document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Couchbase Lite, a document&#8217;s body takes the form of a JSON object&#8201;&#8212;&#8201;a collection of key/value pairs where the values can be different types of data such as numbers, strings, arrays or even nested objects.
Every document is identified by a document ID, which can be automatically generated (as a UUID) or specified programmatically;
the only constraints are that it must be unique within the database, and it can&#8217;t be changed.</p>
</div>
<div class="sect2">
<h3 id="initializers"><a class="anchor" href="#initializers"></a>Initializers</h3>
<div class="paragraph">
<p>The following methods/initializers can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>MutableDocument()</code> initializer can be used to create a new document where the document ID is randomly generated by the database.</p>
</li>
<li>
<p>The <code>MutableDocument(withID: String)</code> initializer can be used to create a new document with a specific ID.</p>
</li>
<li>
<p>The <code>database.getDocument(String id)</code> method can be used to get a document.
If it doesn&#8217;t exist in the database, it will return <code>null</code>.
This method can be used to check if a document with a given ID already exists in the database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code example creates a document and persists it to the database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L297-L305">MutableDocument newTask = new MutableDocument();
newTask.setString("type", "task");
newTask.setString("owner", "todo");
newTask.setDate("createdAt", new Date());
try {
    database.save(newTask);
} catch (CouchbaseLiteException e) {
    Log.e(TAG, e.toString());
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mutability"><a class="anchor" href="#mutability"></a>Mutability</h3>
<div class="paragraph">
<p>By default, when a document is read from the database it is immutable.
The <code>document.toMutable()</code> method should be used to create an instance of the document which can be updated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L315-L322">Document document = database.getDocument("xyz");
MutableDocument mutableDocument = document.toMutable();
mutableDocument.setString("name", "apples");
try {
    database.save(mutableDocument);
} catch (CouchbaseLiteException e) {
    Log.e(TAG, e.toString());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Changes to the document are persisted to the database when the <code>save</code> method is called.</p>
</div>
</div>
<div class="sect2">
<h3 id="typed-accessors"><a class="anchor" href="#typed-accessors"></a>Typed Accessors</h3>
<div class="paragraph">
<p>The <code>Document</code> class now offers a set of <a href="https://docs.couchbase.com/mobile/2.7.0/couchbase-lite-android//com/couchbase/lite/Dictionary.html"><code>property accessors</code></a> for various scalar types, including boolean, integers, floating-point and strings.
These accessors take care of converting to/from JSON encoding, and make sure you get the type you&#8217;re expecting.</p>
</div>
<div class="paragraph">
<p>In addition, as a convenience we offer <code>Date</code> accessors.
Dates are a common data type, but JSON doesn&#8217;t natively support them, so the convention is to store them as strings in ISO-8601 format.
The following example sets the date on the <code>createdAt</code> property and reads it back using the <code>document.getDate(String key)</code> accessor method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L331-L332">newTask.setValue("createdAt", new Date());
Date date = newTask.getDate("createdAt");</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the property doesn&#8217;t exist in the document it will return the default value for that getter method (0 for <code>getInt</code>, 0.0 for <code>getFloat</code> etc.).
To check whether a given property exists in the document, you should use the <a href="https://docs.couchbase.com/mobile/2.7.0/couchbase-lite-android//com/couchbase/lite/Document.html#contains-java.lang.String-"><code>Document.Contains(String key)</code></a> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="batch-operations"><a class="anchor" href="#batch-operations"></a>Batch operations</h3>
<div class="paragraph">
<p>If you&#8217;re making multiple changes to a database at once, it&#8217;s faster to group them together.
The following example persists a few documents in batch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L339-L356">try {
    database.inBatch(() -&gt; {
        for (int i = 0; i &lt; 10; i++) {
            MutableDocument doc = new MutableDocument();
            doc.setValue("type", "user");
            doc.setValue("name", "user " + i);
            doc.setBoolean("admin", false);
            try {
                database.save(doc);
            } catch (CouchbaseLiteException e) {
                Log.e(TAG, e.toString());
            }
            Log.i(TAG, String.format("saved user document %s", doc.getString("name")));
        }
    });
} catch (CouchbaseLiteException e) {
    Log.e(TAG, e.toString());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the <strong>local</strong> level this operation is still transactional: no other <code>Database</code> instances, including ones managed by the replicator can make changes during the execution of the block, and other instances will not see partial changes.
But Couchbase Mobile is a distributed system, and due to the way replication works, there&#8217;s no guarantee that Sync Gateway or other devices will receive your changes all at once.</p>
</div>
</div>
<div class="sect2">
<h3 id="document-change-events"><a class="anchor" href="#document-change-events"></a>Document change events</h3>
<div class="paragraph">
<p>It&#8217;s also possible to register for document changes.
The following example registers for changes to the document with ID <code>user.john</code> and prints the <code>verified_account</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L381-L388">database.addDocumentChangeListener(
    "user.john",
    change -&gt; {
        Document doc = database.getDocument(change.getDocumentID());
        if (doc != null) {
            Toast.makeText(context, "Status: " + doc.getString("verified_account"), Toast.LENGTH_SHORT).show();
        }
    });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="document-constraints"><a class="anchor" href="#document-constraints"></a>Document Constraints</h3>
<div class="paragraph">
<p>Couchbase Lite APIs do not explicitly disallow the use of attributes with the underscore prefix at the top level of document.
This is to facilitate the creation of documents for use either in <em>local only</em> mode where documents are not synced, or when used exclusively in peer-to-peer sync.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
"_id", :"_rev" and "_sequence" are reserved keywords and must not be used as top-level attributes&#8201;&#8212;&#8201;see <a href="#res-keys">Example 2</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Users are cautioned that any attempt to sync such documents to Sync Gateway will result in an error.
To be future proof, you are advised to avoid creating such documents.
Use of these attributes for user-level data may result in undefined system behavior.</p>
</div>
<div class="paragraph">
<p>For more guidance&#8201;&#8212;&#8201;see: <a href="../../sync-gateway/current/data-modeling.html" class="page">Sync Gateway - data modeling guidelines</a></p>
</div>
<div id="res-keys" class="exampleblock">
<div class="title">Example 2. Reserved Keys List</div>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>_attachments</p>
</li>
<li>
<p>_id</p>
</li>
<li>
<p>_deleted</p>
</li>
<li>
<p>_removed</p>
</li>
<li>
<p>_rev</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="document-expiration"><a class="anchor" href="#document-expiration"></a>Document Expiration</h3>
<div class="paragraph">
<p>Document expiration allows users to set the expiration date to a document.
When the document is expired, the document will be purged from the database.
The purge will not be replicated to Sync Gateway.</p>
</div>
<div class="paragraph">
<p>The following example sets the TTL for a document to 5 minutes from the current time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L363-L375">// Purge the document one day from now
Instant ttl = Instant.now().plus(1, ChronoUnit.DAYS);
database.setDocumentExpiration("doc123", new Date(ttl.toEpochMilli()));

// Reset expiration
database.setDocumentExpiration("doc1", null);

// Query documents that will be expired in less than five minutes
Instant fiveMinutesFromNow = Instant.now().plus(5, ChronoUnit.MINUTES);
Query query = QueryBuilder
    .select(SelectResult.expression(Meta.id))
    .from(DataSource.database(database))
    .where(Meta.expiration.lessThan(Expression.doubleValue(fiveMinutesFromNow.toEpochMilli())));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="blobs"><a class="anchor" href="#blobs"></a>Blobs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ve renamed "attachments" to "blobs".
The new behavior should be clearer too: a <code>Blob</code> is now a normal object that can appear in a document as a property value.
In other words, you just instantiate a <code>Blob</code> and set it as the value of a property, and then later you can get the property value, which will be a <code>Blob</code> object.
The following code example adds a blob to the document under the <code>avatar</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L397-L411">InputStream is = getAsset("avatar.jpg");
if (is == null) { return; }
try {
    Blob blob = new Blob("image/jpeg", is);
    newTask.setBlob("avatar", blob);
    database.save(newTask);

    Blob taskBlob = newTask.getBlob("avatar");
    byte[] bytes = taskBlob.getContent();
} catch (CouchbaseLiteException e) {
    Log.e(TAG, e.toString());
} finally {
    try { is.close(); }
    catch (IOException ignore) { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Blob</code> API lets you access the contents as in-memory data (a <code>Data</code> object) or as a <code>InputStream</code>.
It also supports an optional <code>type</code> property that by convention stores the MIME type of the contents.</p>
</div>
<div class="paragraph">
<p>In the example above, "image/jpeg" is the MIME type and "avatar" is the key which references that <code>Blob</code>.
That key can be used to retrieve the <code>Blob</code> object at a later time.</p>
</div>
<div class="paragraph">
<p>When a document is synchronized, the Couchbase Lite replicator will add an <code>_attachments</code> dictionary to the document&#8217;s properties if it contains a blob.
A random access name will be generated for each <code>Blob</code> which is different to the "avatar" key that was used in the example above.
On the image below, the document now contains the <code>_attachments</code> dictionary when viewed in the Couchbase Server Admin Console.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/attach_replicated.png" alt="attach replicated">
</div>
</div>
<div class="paragraph">
<p>A blob also has properties such as <code>"digest"</code> (a SHA-1 digest of the data), <code>"length"</code> (the length in bytes), and optionally <code>"content_type"</code> (the MIME type).
The data is not stored in the document, but in a separate content-addressable store, indexed by the digest.</p>
</div>
<div class="paragraph">
<p>This <code>Blob</code> can be retrieved on the Sync Gateway REST API at http://localhost:4984/justdoit/user.david/blob_1.
Notice that the blob identifier in the URL path is "blob_1" (not "avatar").</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query"><a class="anchor" href="#query"></a>Query</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Database queries have changed significantly.
Instead of the map/reduce views used in 1.x, they&#8217;re now based on expressions, of the form "return ____ from documents where ____, ordered by ____", with semantics based on Couchbase&#8217;s N1QL query language.</p>
</div>
<div class="paragraph">
<p>There are several parts to specifying a query:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SELECT</dt>
<dd>
<p>Specifies the projection, which is the part of the document that is to be returned.</p>
</dd>
<dt class="hdlist1">FROM</dt>
<dd>
<p>Specifies the database to query the documents from.</p>
</dd>
<dt class="hdlist1">JOIN</dt>
<dd>
<p>Specifies the matching criteria in which to join multiple documents.</p>
</dd>
<dt class="hdlist1">WHERE</dt>
<dd>
<p>Specifies the query criteria that the result must satisfy.</p>
</dd>
<dt class="hdlist1">GROUP BY</dt>
<dd>
<p>Specifies the query criteria to group rows by.</p>
</dd>
<dt class="hdlist1">ORDER BY</dt>
<dd>
<p>Specifies the query criteria to sort the rows in the result.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="select-statement"><a class="anchor" href="#select-statement"></a>SELECT statement</h3>
<div class="paragraph">
<p>With the SELECT statement, you can query and manipulate JSON data.
With projections, you retrieve just the fields that you need and not the entire document.</p>
</div>
<div class="paragraph">
<p>A SelectResult represents a single return value of the query statement.
You can specify a comma separated list of <code>SelectResult</code> expressions in the select statement of your query.
For instance the following select statement queries for the document <code>_id</code> as well as the <code>type</code> and <code>name</code> properties of all documents in the database.
In the query result, we print the <code>_id</code> and <code>name</code> properties of each row using the property name getter method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "_id": "hotel123",
    "type": "hotel",
    "name": "Apple Droid"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L433-L450">Query query = QueryBuilder
    .select(
        SelectResult.expression(Meta.id),
        SelectResult.property("name"),
        SelectResult.property("type"))
    .from(DataSource.database(database))
    .where(Expression.property("type").equalTo(Expression.string("hotel")))
    .orderBy(Ordering.expression(Meta.id));

try {
    ResultSet rs = query.execute();
    for (Result result : rs) {
        Log.i("Sample", String.format("hotel id -&gt; %s", result.getString("id")));
        Log.i("Sample", String.format("hotel name -&gt; %s", result.getString("name")));
    }
} catch (CouchbaseLiteException e) {
    Log.e("Sample", e.getLocalizedMessage());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SelectResult.all()</code> method can be used to query all the properties of a document.
In this case, the document in the result is embedded in a dictionary where the key is the database name.
The following snippet shows the same query using <code>SelectResult.all()</code> and the result in JSON.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L477-L480">Query query = QueryBuilder
    .select(SelectResult.all())
    .from(DataSource.database(database))
    .where(Expression.property("type").equalTo(Expression.string("hotel")));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    {
        "travel-sample": {
            "callsign": "MILE-AIR",
            "country": "United States",
            "iata": "Q5",
            "icao": "MLA",
            "id": 10,
            "name": "40-Mile Air",
            "type": "airline"
        }
    },
    {
        "travel-sample": {
            "callsign": "TXW",
            "country": "United States",
            "iata": "TQ",
            "icao": "TXW",
            "id": 10123,
            "name": "Texas Wings",
            "type": "airline"
        }
    }
]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="where-statement"><a class="anchor" href="#where-statement"></a>WHERE statement</h3>
<div class="paragraph">
<p>Similar to SQL, you can use the where clause to filter the documents to be returned as part of the query.
The select statement takes in an <code>Expression</code>.
You can chain any number of Expressions in order to implement sophisticated filtering capabilities.</p>
</div>
<div class="sect3">
<h4 id="comparison"><a class="anchor" href="#comparison"></a>Comparison</h4>
<div class="paragraph">
<p>The <a href="https://docs.couchbase.com/mobile/2.7.0/couchbase-lite-android//com/couchbase/lite/Expression.html">comparison operators</a> can be used in the WHERE statement to specify on which property to match documents.
In the example below, we use the <code>equalTo</code> operator to query documents where the <code>type</code> property equals "hotel".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "_id": "hotel123",
    "type": "hotel",
    "name": "Apple Droid"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L519-L529">Query query = QueryBuilder
    .select(SelectResult.all())
    .from(DataSource.database(database))
    .where(Expression.property("type").equalTo(Expression.string("hotel")))
    .limit(Expression.intValue(10));
ResultSet rs = query.execute();
for (Result result : rs) {
    Dictionary all = result.getDictionary(DATABASE_NAME);
    Log.i("Sample", String.format("name -&gt; %s", all.getString("name")));
    Log.i("Sample", String.format("type -&gt; %s", all.getString("type")));
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collection-operators"><a class="anchor" href="#collection-operators"></a>Collection Operators</h4>
<div class="paragraph">
<p><a href="https://docs.couchbase.com/mobile/2.7.0/couchbase-lite-android//com/couchbase/lite/ArrayFunction.html">Collection operators</a> are useful to check if a given value is present in an array.</p>
</div>
<div class="sect4">
<h5 id="contains-operator"><a class="anchor" href="#contains-operator"></a>CONTAINS Operator</h5>
<div class="paragraph">
<p>The following example uses the <code>ArrayFunction.contains</code> to find documents whose <code>public_likes</code> array property contain a value equal to "Armani Langworth".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "_id": "hotel123",
    "name": "Apple Droid",
    "public_likes": ["Armani Langworth", "Elfrieda Gutkowski", "Maureen Ruecker"]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L550-L564">Query query = QueryBuilder
    .select(
        SelectResult.expression(Meta.id),
        SelectResult.property("name"),
        SelectResult.property("public_likes"))
    .from(DataSource.database(database))
    .where(Expression.property("type").equalTo(Expression.string("hotel"))
        .and(ArrayFunction
            .contains(Expression.property("public_likes"), Expression.string("Armani Langworth"))));
ResultSet rs = query.execute();
for (Result result : rs) {
    Log.i(
        "Sample",
        String.format("public_likes -&gt; %s", result.getArray("public_likes").toList()));
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="in-operator"><a class="anchor" href="#in-operator"></a>IN Operator</h5>
<div class="paragraph">
<p>The <code>IN</code> operator is useful when you need to explicitly list out the values to test against.
The following example looks for documents whose <code>first</code>, <code>last</code> or <code>username</code> property value equals "Armani".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L574-L582">Expression[] values = new Expression[] {
    Expression.property("first"),
    Expression.property("last"),
    Expression.property("username")
};

Query query = QueryBuilder.select(SelectResult.all())
    .from(DataSource.database(database))
    .where(Expression.string("Armani").in(values));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="like-operator"><a class="anchor" href="#like-operator"></a>Like Operator</h4>
<div class="paragraph">
<p>The <a href="https://docs.couchbase.com/mobile/2.7.0/couchbase-lite-android//com/couchbase/lite/Expression.html#like-com.couchbase.lite.Expression-"><code>like</code></a> operator can be used for string matching.</p>
</div>
<div class="paragraph">
<p>The <code>like</code> operator performs <strong>case sensitive</strong> matches.
So if you want to make the string matching case insensitive, you would have to use <code>Function.lower</code> or <code>Function.upper</code> to transform the matched string to lowercase or uppercase equivalents.</p>
</div>
<div class="paragraph">
<p>In the example below, we are looking for documents of type <code>landmark</code> where the name property exactly matches the string "Royal engineers museum".
Note that since <code>like</code> does a case sensitive match, we use <code>Function.lower</code> to transform the matched string to the lowercase equivalent.
So the following query will return "landmark" type documents with the name matching "Royal Engineers Museum", "royal engineers museum", "ROYAL ENGINEERS MUSEUM" and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L595-L604">Query query = QueryBuilder
    .select(
        SelectResult.expression(Meta.id),
        SelectResult.property("country"),
        SelectResult.property("name"))
    .from(DataSource.database(database))
    .where(Expression.property("type").equalTo(Expression.string("landmark"))
        .and(Function.lower(Expression.property("name")).like(Function.Expression.string("royal engineers museum")))));
ResultSet rs = query.execute();
for (Result result : rs) { Log.i("Sample", String.format("name -&gt; %s", result.getString("name"))); }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="wildcard-match"><a class="anchor" href="#wildcard-match"></a>Wildcard Match</h4>
<div class="paragraph">
<p>We can use <code>%</code> sign within a <code>like</code> expression to do a wildcard match against zero or more characters.
Using wildcards allows you to have some fuzziness in your search string.</p>
</div>
<div class="paragraph">
<p>In the example below, we are looking for documents of <code>type</code> "landmark" where the name property matches any string that begins with "eng" followed by zero or more characters, the letter "e", followed by zero or more characters.
Once again, we are using <code>Function.lower</code> to make the search case insensitive.</p>
</div>
<div class="paragraph">
<p>The following query will return "landmark" <code>type</code> documents with name matching "Engineers", "engine", "english egg" , "England Eagle" and so on.
Notice that the matches may span word boundaries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L614-L623">Query query = QueryBuilder
    .select(
        SelectResult.expression(Meta.id),
        SelectResult.property("country"),
        SelectResult.property("name"))
    .from(DataSource.database(database))
    .where(Expression.property("type").equalTo(Expression.string("landmark"))
        .and(Function.lower(Expression.property("name")).like(Expression.string("eng%e%"))));
ResultSet rs = query.execute();
for (Result result : rs) { Log.i("Sample", String.format("name -&gt; %s", result.getString("name"))); }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="wildcard-character-match"><a class="anchor" href="#wildcard-character-match"></a>Wildcard Character Match</h4>
<div class="paragraph">
<p>We can use an <code>_</code> sign within a like expression to do a wildcard match against a single character.</p>
</div>
<div class="paragraph">
<p>In the example below, we are looking for documents of type "landmark" where the <code>name</code> property matches any string that begins with "eng" followed by exactly 4 wildcard characters and ending in the letter "r".
The following query will return "landmark" <code>type</code> documents with the <code>name</code> matching "Engineer", "engineer" and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L633-L642">Query query = QueryBuilder
    .select(
        SelectResult.expression(Meta.id),
        SelectResult.property("country"),
        SelectResult.property("name"))
    .from(DataSource.database(database))
    .where(Expression.property("type").equalTo(Expression.string("landmark"))
        .and(Function.lower(Expression.property("name")).like(Expression.string("eng____r"))));
ResultSet rs = query.execute();
for (Result result : rs) { Log.i("Sample", String.format("name -&gt; %s", result.getString("name"))); }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="regex-operator"><a class="anchor" href="#regex-operator"></a>Regex Operator</h4>
<div class="paragraph">
<p>Similar to wildcard <code>like</code> expressions, <code>regex</code> expressions based pattern matching allow you to have some fuzziness in your search string.</p>
</div>
<div class="paragraph">
<p>The <code>regex</code> operator is case sensitive.</p>
</div>
<div class="paragraph">
<p>In the example below, we are looking for documents of <code>type</code> "landmark" where the name property matches any string (on word boundaries) that begins with "eng" followed by exactly 4 wildcard characters and ending in the letter "r".
The following query will return "landmark" type documents with name matching "Engine", "engine" and so on.
Note that the <code>\b</code> specifies that the match must occur on word boundaries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L652-L661">Query query = QueryBuilder
    .select(
        SelectResult.expression(Meta.id),
        SelectResult.property("country"),
        SelectResult.property("name"))
    .from(DataSource.database(database))
    .where(Expression.property("type").equalTo(Expression.string("landmark"))
        .and(Function.lower(Expression.property("name")).regex(Expression.string("\\beng.*r\\b"))));
ResultSet rs = query.execute();
for (Result result : rs) { Log.i("Sample", String.format("name -&gt; %s", result.getString("name"))); }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deleted-document"><a class="anchor" href="#deleted-document"></a>Deleted Document</h4>
<div class="paragraph">
<p>Starting in Couchbase Lite 2.5, you can query documents that have been deleted (tombstones).
The following example shows how to query deleted documents in the database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L536-L540">// Query documents that have been deleted
Where query = QueryBuilder
    .select(SelectResult.expression(Meta.id))
    .from(DataSource.database(database))
    .where(Meta.deleted);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="join-statement"><a class="anchor" href="#join-statement"></a>JOIN statement</h3>
<div class="paragraph">
<p>The JOIN clause enables you to create new input objects by combining two or more source objects.</p>
</div>
<div class="paragraph">
<p>The following example uses a JOIN clause to find the airline details which have routes that start from RIX.
This example JOINS the document of type "route" with documents of type "airline" using the document ID (<code>_id</code>) on the "airline" document and <code>airlineid</code> on the "route" document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L671-L684">Query query = QueryBuilder.select(
    SelectResult.expression(Expression.property("name").from("airline")),
    SelectResult.expression(Expression.property("callsign").from("airline")),
    SelectResult.expression(Expression.property("destinationairport").from("route")),
    SelectResult.expression(Expression.property("stops").from("route")),
    SelectResult.expression(Expression.property("airline").from("route")))
    .from(DataSource.database(database).as("airline"))
    .join(Join.join(DataSource.database(database).as("route"))
        .on(Meta.id.from("airline").equalTo(Expression.property("airlineid").from("route"))))
    .where(Expression.property("type").from("route").equalTo(Expression.string("route"))
        .and(Expression.property("type").from("airline").equalTo(Expression.string("airline")))
        .and(Expression.property("sourceairport").from("route").equalTo(Expression.string("RIX"))));
ResultSet rs = query.execute();
for (Result result : rs) { Log.w("Sample", String.format("%s", result.toMap().toString())); }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="group-by-statement"><a class="anchor" href="#group-by-statement"></a>GROUP BY statement</h3>
<div class="paragraph">
<p>You can perform further processing on the data in your result set before the final projection is generated.
The following example looks for the number of airports at an altitude of 300 ft or higher and groups the results by country and timezone.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "_id": "airport123",
    "type": "airport",
    "country": "United States",
    "geo": { "alt": 456 },
    "tz": "America/Anchorage"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L694-L714">Query query = QueryBuilder.select(
    SelectResult.expression(Function.count(Expression.string("*"))),
    SelectResult.property("country"),
    SelectResult.property("tz"))
    .from(DataSource.database(database))
    .where(Expression.property("type").equalTo(Expression.string("airport"))
        .and(Expression.property("geo.alt").greaterThanOrEqualTo(Expression.intValue(300))))
    .groupBy(
        Expression.property("country"),
        Expression.property("tz"))
    .orderBy(Ordering.expression(Function.count(Expression.string("*"))).descending());
ResultSet rs = query.execute();
for (Result result : rs) {
    Log.i(
        "Sample",
        String.format(
            "There are %d airports on the %s timezone located in %s and above 300ft",
            result.getInt("$1"),
            result.getString("tz"),
            result.getString("country")));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">There are 138 airports on the Europe/Paris timezone located in France and above 300 ft
There are 29 airports on the Europe/London timezone located in United Kingdom and above 300 ft
There are 50 airports on the America/Anchorage timezone located in United States and above 300 ft
There are 279 airports on the America/Chicago timezone located in United States and above 300 ft
There are 123 airports on the America/Denver timezone located in United States and above 300 ft</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="order-by-statement"><a class="anchor" href="#order-by-statement"></a>ORDER BY statement</h3>
<div class="paragraph">
<p>It is possible to sort the results of a query based on a given expression result.
The example below returns documents of type equal to "hotel" sorted in ascending order by the value of the title property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L724-L733">Query query = QueryBuilder
    .select(
        SelectResult.expression(Meta.id),
        SelectResult.property("name"))
    .from(DataSource.database(database))
    .where(Expression.property("type").equalTo(Expression.string("hotel")))
    .orderBy(Ordering.property("name").ascending())
    .limit(Expression.intValue(10));
ResultSet rs = query.execute();
for (Result result : rs) { Log.i("Sample", String.format("%s", result.toMap())); }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Aberdyfi
Achiltibuie
Altrincham
Ambleside
Annan
Ardche
Armagh
Avignon</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="datetime-functions"><a class="anchor" href="#datetime-functions"></a>Date/Time Functions</h3>
<div class="paragraph">
<p>Couchbase Lite documents support a <a href="#initializers">date type</a> that internally stores dates in ISO 8601 with the GMT/UTC timezone.</p>
</div>
<div class="paragraph">
<p>Couchbase Lite 2.5 adds the ability to run date comparisons in your Couchbase Lite queries.
To do so, four functions have been added to the Query Builder API:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Function.StringToMillis(Expression.Property("date_time"))</code></dt>
<dd>
<p>The input to this will be a validly formatted ISO 8601 <code>date_time</code> string.
The end result will be an expression (with a numeric content) that can be further input into the query builder.</p>
</dd>
<dt class="hdlist1"><code>Function.StringToUTC(Expression.Property("date_time"))</code></dt>
<dd>
<p>The input to this will be a validly formatted ISO 8601 <code>date_time</code> string.
The end result will be an expression (with string content) that can be further input into the query builder.</p>
</dd>
<dt class="hdlist1"><code>Function.MillisToString(Expression.Property("date_time"))</code></dt>
<dd>
<p>The input for this is a numeric value representing milliseconds since the Unix epoch.
The end result will be an expression (with string content representing the date and time as an ISO 8601 string in the devices timezone) that can be further input into the query builder.</p>
</dd>
<dt class="hdlist1"><code>Function.MillisToUTC(Expression.Property("date_time"))</code></dt>
<dd>
<p>The input for this is a numeric value representing milliseconds since the Unix epoch.
The end result will be an expression (with string content representing the date and time as a UTC ISO 8601 string) that can be further input into the query builder.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="live-query"><a class="anchor" href="#live-query"></a>Live Query</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A live query stays active and monitors the database for changes.
A live query is a great way to build reactive user interfaces, especially table/list views, that keep themselves up to date.
For example, as the replicator runs and pulls new data from the server, a live query-driven UI will automatically update to show the data without the user having to manually refresh.
This helps your app feel quick and responsive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L484-L498">Query query = QueryBuilder
    .select(SelectResult.all())
    .from(DataSource.database(database));

// Adds a query change listener.
// Changes will be posted on the main queue.
ListenerToken token = query.addChangeListener(change -&gt; {
    for (Result result : change.getResults()) {
        Log.d(TAG, "results: " + result.getKeys());
        /* Update UI */
    }
});

// Start live query.
query.execute(); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To start a live query, you must call <code>query.execute()</code>.
This will immediately execute the query and post the result to the change listener.
When there&#8217;s a change it re-runs itself automatically, and posts the new query result to any observers (change listeners).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example stops the live query with the token from the previous example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L502">query.removeChangeListener(token);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="predictive-query"><a class="anchor" href="#predictive-query"></a>Predictive Query</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Enterprise Edition only</div>
Predictive Query is an <a href="https://www.couchbase.com/products/editions">Enterprise Edition</a> feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Predictive Query enables Couchbase Lite queries to use machine learning, by providing query functions that can process document data (properties or blobs) via trained ML models.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider an image classifier model that takes a picture as input and outputs a label and probability.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/predictive-diagram.png" alt="predictive diagram">
</div>
</div>
<div class="paragraph">
<p>To run a predictive query with a model as the one shown above, you must implement the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#integrate-the-model">Integrate the Model</a></p>
</li>
<li>
<p><a href="#register-the-model">Register the Model</a></p>
</li>
<li>
<p><a href="#create-an-index">Create an Index (Optional)</a></p>
</li>
<li>
<p><a href="#run-a-prediction-query">Run a Prediction Query</a></p>
</li>
<li>
<p><a href="#unregister-the-model">Unregister the Model</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="integrate-the-model"><a class="anchor" href="#integrate-the-model"></a>Integrate the Model</h3>
<div class="paragraph">
<p>To integrate a model with Couchbase Lite, you must implement the <code>PredictiveModel</code> interface which has only one function called <code>predict()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1246-L1264">// `tensorFlowModel` is a fake implementation
// this would be the implementation of the ml model you have chosen
class ImageClassifierModel implements PredictiveModel {
    @Override
    public Dictionary predict(@NonNull Dictionary input) {
        Blob blob = input.getBlob("photo");
        if (blob == null) { return null; }

        // `tensorFlowModel` is a fake implementation
        // this would be the implementation of the ml model you have chosen
        return new MutableDictionary(TensorFlowModel.predictImage(blob.getContent())); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}

class TensorFlowModel {
    public static Map&lt;String, Object&gt; predictImage(byte[] data) {
        return null;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>predict(input) -&gt; output</code> method provides the input and expects the result of using the machine learning model.
The input and output of the predictive model is a <code>DictionaryObject</code>.
Therefore, the supported data type will be constrained by the data type that the <code>DictionaryObject</code> supports.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="register-the-model"><a class="anchor" href="#register-the-model"></a>Register the Model</h3>
<div class="paragraph">
<p>To register the model you must create a new instance and pass it to the <code>Database.prediction.registerModel</code> static method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L965">Database.prediction.registerModel("ImageClassifier", new ImageClassifierModel());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-an-index"><a class="anchor" href="#create-an-index"></a>Create an Index</h3>
<div class="paragraph">
<p>Creating an index for a predictive query is highly recommended.
By computing the predictions during writes and building a prediction index, you can significantly improve the speed of prediction queries (which would otherwise have to be computed during reads).</p>
</div>
<div class="paragraph">
<p>There are two types of indexes for predictive queries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#value-index">Value Index</a></p>
</li>
<li>
<p><a href="#predictive-index">Predictive Index</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="value-index"><a class="anchor" href="#value-index"></a>Value Index</h4>
<div class="paragraph">
<p>The code below creates a value index from the "label" value of the prediction result.
When documents are added or updated, the index will call the prediction function to update the city value in the index.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L969-L970">ValueIndex index = IndexBuilder.valueIndex(ValueIndexItem.expression(Expression.property("label")));
database.createIndex("value-index-image-classifier", index);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="predictive-index"><a class="anchor" href="#predictive-index"></a>Predictive Index</h4>
<div class="paragraph">
<p>Predictive Index is a new index type used for predictive query.
The Predictive Index is different from the value index in that the Predictive Index caches the predictive result and creates the value index from the cached predictive result when the predictive results values are specified.</p>
</div>
<div class="paragraph">
<p>The code below creates a predictive index from the "label" value of the prediction result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L983-L988">Map&lt;String, Object&gt; inputMap = new HashMap&lt;&gt;();
inputMap.put("numbers", Expression.property("photo"));
Expression input = Expression.map(inputMap);

PredictiveIndex index = IndexBuilder.predictiveIndex("ImageClassifier", input, null);
database.createIndex("predictive-index-image-classifier", index);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="run-a-prediction-query"><a class="anchor" href="#run-a-prediction-query"></a>Run a Prediction Query</h3>
<div class="paragraph">
<p>The code below creates a query that calls the prediction function to return the "label" value for the first 10 results in the database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L997-L1010">Map&lt;String, Object&gt; inputProperties = new HashMap&lt;&gt;();
inputProperties.put("photo", Expression.property("photo"));
Expression input = Expression.map(inputProperties);
PredictionFunction prediction = PredictiveModel.predict("ImageClassifier", input); <i class="conum" data-value="1"></i><b>(1)</b>

Query query = QueryBuilder
    .select(SelectResult.all())
    .from(DataSource.database(database))
    .where(Expression.property("label").equalTo(Expression.string("car"))
        .and(Expression.property("probability").greaterThanOrEqualTo(Expression.doubleValue(0.8))));

// Run the query.
ResultSet result = query.execute();
Log.d(TAG, "Number of rows: " + result.allResults().size());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>PredictiveModel.predict()</code> method returns a constructed Prediction Function object which can be used further to specify a property value extracted from the output dictionary of the <code>PredictiveModel.predict()</code> function.
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The null value returned by the prediction method will be interpreted as MISSING value in queries.
</td>
</tr>
</table>
</div></td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="unregister-the-model"><a class="anchor" href="#unregister-the-model"></a>Unregister the Model</h3>
<div class="paragraph">
<p>To unregister the model you must call the <code>Database.prediction.unregisterModel</code> static method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L974">Database.prediction.unregisterModel("ImageClassifier");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="indexing"><a class="anchor" href="#indexing"></a>Indexing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Creating indexes can speed up the performance of queries.
While indexes make queries faster, they also make writes slightly slower, and the Couchbase Lite database file slightly larger.
As such, it is best to only create indexes when you need to optimize a specific case for better query performance.</p>
</div>
<div class="paragraph">
<p>The following example creates a new index for the <code>type</code> and <code>name</code> properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "_id": "hotel123",
    "type": "hotel",
    "name": "Apple Droid"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L420-L424">database.createIndex(
    "TypeNameIndex",
    IndexBuilder.valueIndex(
        ValueIndexItem.property("type"),
        ValueIndexItem.property("name")));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Every index has to be updated whenever a document is updated, so too many indexes can hurt performance.
Thus, good performance depends on designing and creating the <em>right</em> indexes to go along with your queries.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="full-text-search"><a class="anchor" href="#full-text-search"></a>Full-Text Search</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run a full-text search (FTS) query, you must have created a full-text index on the expression being matched.
Unlike regular queries, the index is not optional.
The following example inserts documents and creates an FTS index on the <code>name</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L740-L742">database.createIndex(
    "nameFTSIndex",
    IndexBuilder.fullTextIndex(FullTextIndexItem.property("name")).ignoreAccents(false));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple properties to index can be specified in the index creation method.</p>
</div>
<div class="paragraph">
<p>With the index created, an FTS query on the property that is being indexed can be constructed and ran.
The full-text search criteria is defined as a <code>FullTextExpression</code>.
The left-hand side is the full-text index to use and the right-hand side is the pattern to match.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L748-L757">Expression whereClause = FullTextExpression.index("nameFTSIndex").match("buy");
Query ftsQuery = QueryBuilder.select(SelectResult.expression(Meta.id))
    .from(DataSource.database(database))
    .where(whereClause);
ResultSet ftsQueryResult = ftsQuery.execute();
for (Result result : ftsQueryResult) {
    Log.i(
        TAG,
        String.format("document properties %s", result.getString(0)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the pattern to match is a word, the full-text search query matches all documents that contain the word "buy" in the value of the <code>doc.name</code> property.</p>
</div>
<div class="paragraph">
<p>Search is supported for all languages that use whitespace to separate words.</p>
</div>
<div class="paragraph">
<p>Stemming, which is the process of fuzzy matching parts of speech, like "fast" and "faster", is supported in the following languages: danish, dutch, english, finnish, french, german, hungarian, italian, norwegian, portuguese, romanian, russian, spanish, swedish and turkish.</p>
</div>
<div class="paragraph">
<p>The pattern to match can also be in the following forms:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">prefix queries</dt>
<dd>
<p>The query expression used to search for a term prefix is the prefix itself with a "*" character appended to it.
For example:</p>
<div class="literalblock">
<div class="content">
<pre>"'lin*'"
-- Query for all documents containing a term with the prefix "lin". This will match
-- all documents that contain "linux", but also those that contain terms "linear",
--"linker", "linguistic" and so on.</pre>
</div>
</div>
</dd>
<dt class="hdlist1">overriding the property name that is being indexed</dt>
<dd>
<p>Normally, a token or token prefix query is matched against the document property specified as the left-hand side of the <code>match</code> operator.
This may be overridden by specifying a property name followed by a ":" character before a basic term query.
There may be space between the ":" and the term to query for, but not between the property name and the ":" character.
For example:</p>
<div class="literalblock">
<div class="content">
<pre>'title:linux problems'
-- Query the database for documents for which the term "linux" appears in
-- the document title, and the term "problems" appears in either the title
-- or body of the document.</pre>
</div>
</div>
</dd>
<dt class="hdlist1">phrase queries</dt>
<dd>
<p>A phrase query is a query that retrieves all documents that contain a nominated set of terms or term prefixes in a specified order with no intervening tokens.
Phrase queries are specified by enclosing a space separated sequence of terms or term prefixes in double quotes (").
For example:</p>
<div class="literalblock">
<div class="content">
<pre>"'"linux applications"'"
-- Query for all documents that contain the phrase "linux applications".</pre>
</div>
</div>
</dd>
<dt class="hdlist1">NEAR queries</dt>
<dd>
<p>A NEAR query is a query that returns documents that contain a two or more nominated terms or phrases within a specified proximity of each other (by default with 10 or less intervening terms).
A NEAR query is specified by putting the keyword "NEAR" between two phrase, token or token prefix queries.
To specify a proximity other than the default, an operator of the form "NEAR/" may be used, where is the maximum number of intervening terms allowed.
For example:</p>
<div class="literalblock">
<div class="content">
<pre>"'database NEAR/2 "replication"'"
-- Search for a document that contains the phrase "replication" and the term
-- "database" with not more than 2 terms separating the two.</pre>
</div>
</div>
</dd>
<dt class="hdlist1">AND, OR &amp; NOT query operators</dt>
<dd>
<p>The enhanced query syntax supports the AND, OR and NOT binary set operators.
Each of the two operands to an operator may be a basic FTS query, or the result of another AND, OR or NOT set operation.
Operators must be entered using capital letters.
Otherwise, they are interpreted as basic term queries instead of set operators.
For example:</p>
<div class="literalblock">
<div class="content">
<pre>'couchbase AND database'
-- Return the set of documents that contain the term "couchbase", and the
-- term "database". This query will return the document with docid 3 only.</pre>
</div>
</div>
<div class="paragraph">
<p>When using the enhanced query syntax, parenthesis may be used to specify the precedence of the various operators.
For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>'("couchbase database" OR "sqlite library") AND linux'
-- Query for the set of documents that contains the term "linux", and at least
-- one of the phrases "couchbase database" and "sqlite library".</pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="ordering-results"><a class="anchor" href="#ordering-results"></a>Ordering results</h3>
<div class="paragraph">
<p>It&#8217;s very common to sort full-text results in descending order of relevance.
This can be a very difficult heuristic to define, but Couchbase Lite comes with a ranking function you can use.
In the <code>OrderBy</code> array, use a string of the form <code>Rank(X)</code>, where <code>X</code> is the property or expression being searched, to represent the ranking of the result.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replication"><a class="anchor" href="#replication"></a>Replication</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="endpoints"><a class="anchor" href="#endpoints"></a>Endpoints</h3>
<div class="paragraph">
<p>Couchbase Mobile&#8217;s replication protocol id based on WebSockets <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>The replicator is designed to send documents from a source to a target database.
The target can be one of the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#starting-sync-gateway">URLEndpoint</a></dt>
<dd>
<p>To replicate data between a local Couchbase Lite database and remote Sync Gateway database.</p>
</dd>
<dt class="hdlist1"><a href="#database-replicas">DatabaseEndpoint</a></dt>
<dd>
<p>To replicate data between two local Couchbase Lite databases to store data on secondary storage.</p>
</dd>
<dt class="hdlist1"><a href="#peer-to-peer-sync">MessageEndpoint</a></dt>
<dd>
<p>To replicate with another Couchbase Lite database via a custom transportation protocol such iOS Multipeer Connectivity, Android WiFi Direct, Android NearByConnection, socket based transportation etc.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Replications can be run in one of two modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one shot - single exchange of data</p>
</li>
<li>
<p>continuous - a continual replication of data changes as they occur</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="permitting-continuous-mode"><a class="anchor" href="#permitting-continuous-mode"></a>Permitting Continuous Mode</h3>
<div class="paragraph">
<p>When running in continuous mode (<code>continuous=true</code>) the replicator monitors the network so it can quickly recover from disruption.
This monitoring relies on <em>ACCESS_NETWORK_STATE</em> permission, without it recovery could take up to 10 minutes longer.</p>
</div>
<div class="olist arabic">
<div class="title">Get Permission</div>
<ol class="arabic">
<li>
<p>Include a <code>&lt;uses-permission&gt;</code> element in the <em>manifest</em></p>
<div class="listingblock">
<div class="title">Example manifest entry</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!--  ... other manifest content ... --&gt;
&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt;
&lt;!--  ... other manifest content ... --&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Request user permission explicitly</p>
<div class="paragraph">
<p>You should <em>explicitly</em> request permission from the user, explaining why it&#8217;s needed.
Otherwise, Android OS requests permission the first time replicator needs it, but gives no reason.</p>
</div>
</li>
<li>
<p>Check permission on each use</p>
<div class="paragraph">
<p>Users can revoke permission at any time.
So your app must verify it has permission before each use.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Further Information - <a href="https://developer.android.com/training/permissions/requesting" target="_blank" rel="noopener">Requesting App Permissions</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="compatibility"><a class="anchor" href="#compatibility"></a>Compatibility</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The new protocol is <strong>incompatible</strong> with CouchDB-based databases.
And since Couchbase Lite 2 only supports the new protocol, you will need to run a version of Sync Gateway that <a href="#sync-gateway::compatibility-matrix.adoc" class="page unresolved">supports it</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use this protocol with Couchbase Lite 2.0, the replication URL should specify WebSockets as the URL scheme (see the <a href="#starting-a-replication">Starting a Replication</a> section below).
Mobile clients using Couchbase Lite 1.x can continue to use <strong>http</strong> as the URL scheme.
Sync Gateway 2.0 will automatically use the 1.x replication protocol when a Couchbase Lite 1.x client connects through http://localhost:4984/db and the 2.0 replication protocol when a Couchbase Lite 2.0 client connects through "ws://localhost:4984/db".</p>
</div>
</div>
<div class="sect2">
<h3 id="starting-sync-gateway"><a class="anchor" href="#starting-sync-gateway"></a>Starting Sync Gateway</h3>
<div class="paragraph">
<p><a href="https://www.couchbase.com/downloads">Download Sync Gateway</a> and start it from the command line with the configuration file created above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">~/Downloads/couchbase-sync-gateway/bin/sync_gateway</code></pre>
</div>
</div>
<div class="paragraph">
<p>For platform specific installation instructions, refer to the Sync Gateway <a href="../../sync-gateway/current/get-started-install.html#installation" class="page">installation guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="starting-a-replication"><a class="anchor" href="#starting-a-replication"></a>Starting a Replication</h3>
<div class="paragraph">
<p>Replication can be bidirectional, this means you can start a <code>push</code>/<code>pull</code> replication with a single instance.
The replication&#8217;s parameters can be specified through the <a href="https://docs.couchbase.com/mobile/2.7.0/couchbase-lite-android//index.html?com/couchbase/lite/ReplicatorConfiguration.html"><code>ReplicatorConfiguration</code></a> object;
for example, if you wish to start a <code>push</code> only or <code>pull</code> only replication.</p>
</div>
<div class="paragraph">
<p>The following example creates a <code>pull</code> replication with Sync Gateway.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class MyClass {
    Database database;
    Replicator replicator; <i class="conum" data-value="1"></i><b>(1)</b>

    void startReplication() {
        URI uri = null;
        try {
            uri = new URI("wss://10.0.2.2:4984/db"); <i class="conum" data-value="2"></i><b>(2)</b>
        } catch (URISyntaxException e) {
            e.printStackTrace();
        }
        Endpoint endpoint = new URLEndpoint(uri);
        ReplicatorConfiguration config = new ReplicatorConfiguration(database, endpoint);
        config.setReplicatorType(ReplicatorConfiguration.ReplicatorType.PULL);
        this.replicator = new Replicator(config);
        this.replicator.start();
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A replication is an asynchronous operation.
To keep a reference to the <code>replicator</code> object, you can set it as an instance property.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The URL scheme for remote database URLs has changed in Couchbase Lite 2.0.
You should now use <code>ws:</code>, or <code>wss:</code> for SSL/TLS connections.
In this example the hostname is <code>10.0.2.2</code> because the Android emulator runs in a VM that is generally accessible on <code>10.0.2.2</code> from the host machine (see <a href="https://developer.android.com/studio/run/emulator-networking">Android Emulator networking</a> documentation).
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of Android Pie, version 9, API 28, cleartext support is disabled, by default.
Although <code>wss:</code> protocol URLs are not affected, in order to use the <code>ws:</code> protocol, applications must target API 27 or lower, or must configure application network security as described <a href="https://developer.android.com/training/articles/security-config#CleartextTrafficPermitted">here</a>.
</td>
</tr>
</table>
</div></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To verify that documents have been replicated, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Monitor the Sync Gateway sequence number returned by the database endpoint (<a href="../../sync-gateway/current/rest-api.html#/database/get__db__" class="page"><code>GET /{db}/</code></a>).
The sequence number increments for every change that happens on the Sync Gateway database.</p>
</li>
<li>
<p>Query a document by ID on the Sync Gateway REST API (<a href="../../sync-gateway/current/rest-api.html#/document/get__db___doc_" class="page"><code>GET /{db}/{id}</code></a>).</p>
</li>
<li>
<p>Query a document from the Query Workbench on the Couchbase Server Console.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Couchbase Lite 2.0 uses WebSockets as the communication protocol to transmit data.
Some load balancers are not configured for WebSocket connections by default (NGINX for example);
so it might be necessary to explicitly enable them in the load balancer&#8217;s configuration (see <a href="../../sync-gateway/current/load-balancer.html" class="page">Load Balancers</a>).</p>
</div>
<div class="paragraph">
<p>By default, the WebSocket protocol uses compression to optimize for speed and bandwidth utilization.
The level of compression is set on Sync Gateway and can be tuned in the configuration file (<a href="../../sync-gateway/current/configuration-properties.html#replicator_compression" class="page"><code>replicator_compression</code></a>).</p>
</div>
<div class="sect3">
<h4 id="replication-ordering"><a class="anchor" href="#replication-ordering"></a>Replication Ordering</h4>
<div class="paragraph">
<p>To optimize for speed, the replication protocol doesn&#8217;t guarantee that documents will be received in a particular order.
So we don&#8217;t recommend to rely on that when using the replication or database change listeners for example.</p>
</div>
</div>
<div class="sect3">
<h4 id="replicator-notifications-on-a-custom-executor"><a class="anchor" href="#replicator-notifications-on-a-custom-executor"></a>Replicator Notifications on a Custom Executor</h4>
<div class="paragraph">
<p>Prior to version 2.6, Couchbase Lite spun up multiple executors.
This policy could result in too many threads being spun up.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no listeners are registered to listen to a replicator at the time of the most recent <code>start(&#8230;&#8203;)</code>, then no subsequently registered listeners will receive notifications.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An executor manages a pool of threads and, perhaps, a queue in front of the executor, to handle the asynchronous callbacks.
Couchbase Lite API calls which are processed by an executor are listed below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Query.addChangeListener
MessageEndpointListerner.addChangeListener
LiveQuery.addChangeListener
AbstractReplicator.addDocumentReplicationListener
AbstractReplicator.addChangeListener
Database.addChangeListener
Database.addDocumentChangeListener
Database.addDatabaseChangeListener
Database.addChangeListener</code></pre>
</div>
</div>
<div class="paragraph">
<p>As of version 2.6, Couchbase sometimes uses its own internal executor to run asynchronous client code.
While this is fine for small tasks, larger tasks&#8201;&#8212;&#8201;those that take significant compute time, or that perform I/O&#8201;&#8212;&#8201;can block Couchbase processing.
If this happens your application will fail with a <code>RejectedExecutionException</code> and it may be necessary to create a separate executor on which to run the large tasks.</p>
</div>
<div class="paragraph">
<p>The following examples show how to specify a separate executor in the client code.
The client code executor can enforce an application policy for delivery ordering and the number of threads.</p>
</div>
<div class="paragraph">
<p><strong>Guaranteed Order Delivery</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * This version guarantees in order delivery and is parsimonious with space
 * The listener does not need to be thread safe (at least as far as this code is concerned).
 * It will run on only thread (the Executor's thread) and must return from a given call
 * before the next call commences.  Events may be delivered arbitrarily late, though,
 * depending on how long it takes the listener to run.
 */
public class InOrderExample {
    private static final ExecutorService IN_ORDER_EXEC = Executors.newSingleThreadExecutor();

    public Replicator runReplicator(Database db1, Database db2, ReplicatorChangeListener listener)
        throws CouchbaseLiteException {
        ReplicatorConfiguration config = new ReplicatorConfiguration(db1, new DatabaseEndpoint(db2));
        config.setReplicatorType(ReplicatorConfiguration.ReplicatorType.PUSH_AND_PULL);
        config.setContinuous(false);

        Replicator repl = new Replicator(config);
        ListenerToken token = repl.addChangeListener(IN_ORDER_EXEC, listener::changed);

        repl.start();

        return repl;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Maximum Throughput</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * This version maximizes throughput.  It will deliver change notifications as quickly
 * as CPU availability allows. It may deliver change notifications out of order.
 * Listeners must be thread safe because they may be called from multiple threads.
 * In fact, they must be re-entrant because a given listener may be running on mutiple threads
 * simultaneously.  In addition, when notifications swamp the processors, notifications awaiting
 * a processor will be queued as Threads, (instead of as Runnables) with accompanying memory
 * and GC impact.
 */
public class MaxThroughputExample {
    private static final ExecutorService MAX_THROUGHPUT_EXEC = Executors.newCachedThreadPool();

    public Replicator runReplicator(Database db1, Database db2, ReplicatorChangeListener listener)
        throws CouchbaseLiteException {
        ReplicatorConfiguration config = new ReplicatorConfiguration(db1, new DatabaseEndpoint(db2));
        config.setReplicatorType(ReplicatorConfiguration.ReplicatorType.PUSH_AND_PULL);
        config.setContinuous(false);

        Replicator repl = new Replicator(config);
        ListenerToken token = repl.addChangeListener(MAX_THROUGHPUT_EXEC, listener::changed);

        repl.start();

        return repl;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Extreme Configurability</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * This version demonstrates the extreme configurability of the CouchBase Lite replicator callback system.
 * It may deliver updates out of order and does require thread-safe and re-entrant listeners
 * (though it does correctly synchronizes tasks passed to it using a SynchronousQueue).
 * The thread pool executor shown here is configured for the sweet spot for number of threads per CPU.
 * In a real system, this single executor might be used by the entire application and be passed to
 * this module, thus establishing a reasonable app-wide threading policy.
 * In an emergency (Rejected Execution) it lazily creates a backup executor with an unbounded queue
 * in front of it.  It, thus, may deliver notifications late, as well as out of order.
 */
public class PolicyExample {
    private static final int CPUS = Runtime.getRuntime().availableProcessors();

    private static ThreadPoolExecutor BACKUP_EXEC;

    private static final RejectedExecutionHandler BACKUP_EXECUTION
        = new RejectedExecutionHandler() {
        public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {
            synchronized (this) {
                if (BACKUP_EXEC == null) { BACKUP_EXEC = createBackupExecutor(); }
            }
            BACKUP_EXEC.execute(r);
        }
    };

    private static ThreadPoolExecutor createBackupExecutor() {
        ThreadPoolExecutor exec
            = new ThreadPoolExecutor(CPUS + 1, 2 * CPUS + 1, 30, TimeUnit.SECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());
        exec.allowCoreThreadTimeOut(true);
        return exec;
    }

    private static final ThreadPoolExecutor STANDARD_EXEC
        = new ThreadPoolExecutor(CPUS + 1, 2 * CPUS + 1, 30, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;());

    static { STANDARD_EXEC.setRejectedExecutionHandler(BACKUP_EXECUTION); }

    public Replicator runReplicator(Database db1, Database db2, ReplicatorChangeListener listener)
        throws CouchbaseLiteException {
        ReplicatorConfiguration config = new ReplicatorConfiguration(db1, new DatabaseEndpoint(db2));
        config.setReplicatorType(ReplicatorConfiguration.ReplicatorType.PUSH_AND_PULL);
        config.setContinuous(false);

        Replicator repl = new Replicator(config);
        ListenerToken token = repl.addChangeListener(STANDARD_EXEC, listener::changed);

        repl.start();

        return repl;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a>Troubleshooting</h3>
<div class="paragraph">
<p>As always, when there is a problem with replication, logging is your friend.
The following example increases the log output for activity related to replication with Sync Gateway.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L765">Database.setLogLevel(LogDomain.REPLICATOR, LogLevel.VERBOSE);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="authentication"><a class="anchor" href="#authentication"></a>Authentication</h3>
<div class="paragraph">
<p>By default, Sync Gateway does not enable authentication.
This is to make it easier to get up and running with synchronization.
You can enable authentication with the following properties in the configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "databases": {
    "mydatabase": {
      "users": {
        "GUEST": {"disabled": true}
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To authenticate with Sync Gateway, an associated user must first be created.
Sync Gateway users can be created through the <a href="#sync-gateway::admin-rest-api.adoc#/user/post__db___user_" class="page unresolved"><code>POST /{db}/_user</code></a> endpoint on the Admin REST API.
Provided that the user exists on Sync Gateway, there are two ways to authenticate from a Couchbase Lite client: Basic Authentication or Session Authentication.</p>
</div>
<div class="sect3">
<h4 id="basic-authentication"><a class="anchor" href="#basic-authentication"></a>Basic Authentication</h4>
<div class="paragraph">
<p>You can provide a user name and password to the basic authenticator class method.
Under the hood, the replicator will send the credentials in the first request to retrieve a <code>SyncGatewaySession</code> cookie and use it for all subsequent requests during the replication.
This is the recommended way of using basic authentication.
The following example initiates a one-shot replication as the user <strong>username</strong> with the password <strong>password</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L771-L778">URLEndpoint target = new URLEndpoint(new URI("ws://localhost:4984/mydatabase"));

ReplicatorConfiguration config = new ReplicatorConfiguration(database, target);
config.setAuthenticator(new BasicAuthenticator("username", "password"));

// Create replicator (be sure to hold a reference somewhere that will prevent the Replicator from being GCed)
replicator = new Replicator(config);
replicator.start();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="session-authentication"><a class="anchor" href="#session-authentication"></a>Session Authentication</h4>
<div class="paragraph">
<p>Session authentication is another way to authenticate with Sync Gateway.
A user session must first be created through the <a href="../../sync-gateway/current/rest-api.html#/session/post__db___session" class="page"><code>POST /{db}/_session</code></a> endpoint on the Public REST API.
The HTTP response contains a session ID which can then be used to authenticate as the user it was created for.
The following example initiates a one-shot replication with the session ID that is returned from the <code>POST /{db}/_session</code> endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L784-L791">URLEndpoint target = new URLEndpoint(new URI("ws://localhost:4984/mydatabase"));

ReplicatorConfiguration config = new ReplicatorConfiguration(database, target);
config.setAuthenticator(new SessionAuthenticator("904ac010862f37c8dd99015a33ab5a3565fd8447"));

// Create replicator (be sure to hold a reference somewhere that will prevent the Replicator from being GCed)
replicator = new Replicator(config);
replicator.start();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="replication-status"><a class="anchor" href="#replication-status"></a>Replication Status</h3>
<div class="paragraph">
<p>The <code>replication.Status.Activity</code> property can be used to check the status of a replication.
For example, when the replication is actively transferring data and when it has stopped.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L804-L808">replicator.addChangeListener(change -&gt; {
    if (change.getStatus().getActivityLevel() == Replicator.ActivityLevel.STOPPED) {
        Log.i(TAG, "Replication stopped");
    }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table lists the different activity levels in the API and the meaning of each one.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">State</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STOPPED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication is finished or hit a fatal error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OFFLINE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replicator is offline as the remote host is unreachable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONNECTING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replicator is connecting to the remote host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IDLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication caught up with all the changes available from the server.
The <code>IDLE</code> state is only used in continuous replications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BUSY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication is actively transferring data.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The replication change object also has properties to track the progress (<code>change.status.completed</code> and <code>change.status.total</code>).
But since the replication occurs in batches and the total count can vary through the course of a replication, those progress indicators are not very useful from the standpoint of an app user.
Hence, these should not be used for tracking the actual progress of the replication.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a id="repstatus-and-lifecycle"></a></p>
</div>
<div class="sect3">
<h4 id="replication-status-and-app-lifecycle"><a class="anchor" href="#replication-status-and-app-lifecycle"></a>Replication Status and App Lifecycle</h4>
<div class="paragraph">
<p>Couchbase Lite replications will continue running until the app terminates, unless the remote system, or the application, terminates the connection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Recall that the Android OS may kill an application without warning.
You should explicitly stop replication processes when they are no longer useful (for example, when they are <code>suspended</code> or <code>idle</code>) to avoid socket connections being closed by the OS, which may interfere with the replication process.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handling-network-errors"><a class="anchor" href="#handling-network-errors"></a>Handling Network Errors</h3>
<div class="paragraph">
<p>If an error occurs, the replication status will be updated with an <code>Error</code> which follows the standard HTTP error codes.
The following example monitors the replication for errors and logs the error code to the console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L820-L824">replicator.addChangeListener(change -&gt; {
    CouchbaseLiteException error = change.getStatus().getError();
    if (error != null) { Log.w(TAG, "Error code:: %d", error); }
});
replicator.start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a permanent error occurs (i.e., <code>404</code>: not found, <code>401</code>: unauthorized), the replicator (continuous or one-shot) will stop permanently.
If the error is temporary (i.e., waiting for the network to recover), a continuous replication will retry to connect indefinitely and if the replication is one-shot it will retry for a limited number of times.
The following error codes are considered temporary by the Couchbase Lite replicator and thus will trigger a connection retry.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>408</code>: Request Timeout</p>
</li>
<li>
<p><code>429</code>: Too Many Requests</p>
</li>
<li>
<p><code>500</code>: Internal Server Error</p>
</li>
<li>
<p><code>502</code>: Bad Gateway</p>
</li>
<li>
<p><code>503</code>: Service Unavailable</p>
</li>
<li>
<p><code>504</code>: Gateway Timeout</p>
</li>
<li>
<p><code>1001</code>: DNS resolution error</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="replication-events"><a class="anchor" href="#replication-events"></a>Replication Events</h3>
<div class="paragraph">
<p>You can choose to register for document updates during a replication.</p>
</div>
<div class="paragraph">
<p>For example, the code snippet below registers a listener to monitor document replication performed by the replicator referenced by the variable <code>replicator</code>. It prints the document ID of each document received and sent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L838-L857">ListenerToken token = replicator.addDocumentReplicationListener(replication -&gt; {

    Log.i(TAG, "Replication type: " + ((replication.isPush()) ? "Push" : "Pull"));
    for (ReplicatedDocument document : replication.getDocuments()) {
        Log.i(TAG, "Doc ID: " + document.getID());

        CouchbaseLiteException err = document.getError();
        if (err != null) {
            // There was an error
            Log.e(TAG, "Error replicating document: ", err);
            return;
        }

        if (document.flags().contains(DocumentFlag.DocumentFlagsDeleted)) {
            Log.i(TAG, "Successfully replicated a deleted document");
        }
    }
});

replicator.start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example stops the change listener with the token from the previous example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L861">replicator.removeChangeListener(token);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="document-access-removal-behavior"><a class="anchor" href="#document-access-removal-behavior"></a>Document Access Removal Behavior</h4>
<div class="paragraph">
<p>When <a href="../../sync-gateway/current/sync-function-api.html" class="page">access to a document is removed</a> on Sync Gateway, the document replication listener sends a notification with the <code>AccessRemoved</code> flag set to <code>true</code> and subsequently purges the document from the database.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-headers"><a class="anchor" href="#custom-headers"></a>Custom Headers</h3>
<div class="paragraph">
<p>Custom headers can be set on the configuration object.
And the replicator will send those header(s) in every request.
As an example, this feature can be useful to pass additional credentials when there is an authentication or authorization step being done by a proxy server (between Couchbase Lite and Sync Gateway).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L870-L873">ReplicatorConfiguration config = new ReplicatorConfiguration(database, endpoint);
Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();
headers.put("CustomHeaderName", "Value");
config.setHeaders(headers);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="replication-checkpoint-reset"><a class="anchor" href="#replication-checkpoint-reset"></a>Replication Checkpoint Reset</h3>
<div class="paragraph">
<p>Replicators use checkpoints to keep track of documents sent to the target database.
Without checkpoints, Couchbase Lite would replicate the entire database content to the target database on each connection, even though previous replications may already have replicated some or all of that content.</p>
</div>
<div class="paragraph">
<p>This functionality is generally not a concern to application developers.
However, if you do want to force the replication to start again from zero, use the checkpoint reset method <code>replicator.resetCheckpoint()</code> <strong>before</strong> starting the replicator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L907-L908">replicator.resetCheckpoint();
replicator.start();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="replication-filters"><a class="anchor" href="#replication-filters"></a>Replication Filters</h3>
<div class="paragraph">
<p>Replication Filters allow you to have quick control over which documents are stored as the result of a push and/or pull replication.</p>
</div>
<div class="sect3">
<h4 id="push-filter"><a class="anchor" href="#push-filter"></a>Push Filter</h4>
<div class="paragraph">
<p>A push filter allows an app to push a subset of a database to the server, which can be very useful in some circumstances.
For instance, high-priority documents could be pushed first, or documents in a "draft" state could be skipped.</p>
</div>
<div class="paragraph">
<p>The following example filters out documents whose <code>type</code> property is equal to <code>draft</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L916-L923">URLEndpoint target = new URLEndpoint(new URI("ws://localhost:4984/mydatabase"));

ReplicatorConfiguration config = new ReplicatorConfiguration(database, target);
config.setPushFilter((document, flags) -&gt; flags.contains(DocumentFlag.DocumentFlagsDeleted)); <i class="conum" data-value="1"></i><b>(1)</b>

// Create replicator (be sure to hold a reference somewhere that will prevent the Replicator from being GCed)
replicator = new Replicator(config);
replicator.start();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The callback should follow the semantics of a <a href="https://en.wikipedia.org/wiki/Pure_function" target="_blank" rel="noopener">pure function</a>.
Otherwise, long running functions would slow down the replicator considerably.
Furthermore, your callback should not make assumptions about what thread it is being called on.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="pull-filter"><a class="anchor" href="#pull-filter"></a>Pull Filter</h4>
<div class="paragraph">
<p>A pull filter gives an app the ability to validate documents being pulled, and skip ones that fail.
This is an important security mechanism in a peer-to-peer topology with peers that are not fully trusted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Pull replication filters are not a substitute for channels.
Sync Gateway <a href="../../sync-gateway/current/channels.html" class="page">channels</a> are designed to be scalable (documents are filtered on the server) whereas a pull replication filter is applied to a document once it has been downloaded.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L929-L936">URLEndpoint target = new URLEndpoint(new URI("ws://localhost:4984/mydatabase"));

ReplicatorConfiguration config = new ReplicatorConfiguration(database, target);
config.setPullFilter((document, flags) -&gt; "draft".equals(document.getString("type"))); <i class="conum" data-value="1"></i><b>(1)</b>

// Create replicator (be sure to hold a reference somewhere that will prevent the Replicator from being GCed)
replicator = new Replicator(config);
replicator.start();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The callback should follow the semantics of a <a href="https://en.wikipedia.org/wiki/Pure_function" target="_blank" rel="noopener">pure function</a>.
Otherwise, long running functions would slow down the replicator considerably.
Furthermore, your callback should not make assumptions about what thread it is being called on.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Losing access to a document (via the Sync Function) also triggers the pull replication filter.
Filtering out such an event would retain the document locally.
As a result, there would be a local copy of the document disjointed from the one that resides on Couchbase Server.
Further updates to the document stored on Couchbase Server would not be received in pull replications and further local edits could be potentially pushed, which would result in 409 errors since access has been revoked.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="handling-conflicts"><a class="anchor" href="#handling-conflicts"></a>Handling Conflicts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Document conflicts can occur if multiple changes are made to the same version of a document by multiple peers in a distributed system. For Couchbase Mobile, this can be a Couchbase Lite or Sync Gateway database instance.</p>
</div>
<div class="paragraph">
<p>Such conflicts can occur after either of the following events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>A replication saves a document change</strong>&#8201;&#8212;&#8201;in which case the change with the <em>most-revisions wins</em> (unless one change is a delete). See the example <a href="#case-1-conflicts-when-a-replication-is-in-progress">Case 1: Conflicts when a replication is in progress</a></p>
</li>
<li>
<p><strong>An application saves a document change directly to a database instance</strong>&#8201;&#8212;&#8201;in which case, <em>last write wins</em>, unless one change is a delete&#8201;&#8212;&#8201;see <a href="#case-2-conflicts-when-saving-a-document">Case 2: Conflicts when saving a document</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>Deletes</em> always win.</strong> So, in either of the above cases, if one of the changes was a <em>Delete</em> then that change wins.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections discuss each scenario in more detail.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Dive deeper &#8230;&#8203;</div>
Read more about <a href="https://blog.couchbase.com/document-conflicts-couchbase-mobile">Document Conflicts and Automatic Conflict Resolution in Couchbase Mobile</a> on <a href="https://blog.couchbase.com">The Couchbase Blog</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="case-1-conflicts-when-a-replication-is-in-progress"><a class="anchor" href="#case-1-conflicts-when-a-replication-is-in-progress"></a>Case 1: Conflicts when a replication is in progress</h3>
<div class="paragraph">
<p>There&#8217;s no practical way to prevent a conflict when incompatible changes to a document are be made in multiple instances of an app.
The conflict is realized only when replication propagates the incompatible changes to each other.
<a id="bmkRepConScene"></a></p>
</div>
<div class="exampleblock">
<div class="title">Example 3. A typical replication conflict scenario:</div>
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Molly uses her device to create <em>DocumentA</em>.</p>
</li>
<li>
<p>Replication syncs <em>DocumentA</em> to Naomi&#8217;s device.</p>
</li>
<li>
<p>Molly uses her device to apply <em>ChangeX</em> to <em>DocumentA</em>.</p>
</li>
<li>
<p>Naomi uses her device to make a different change, <em>ChangeY</em>, to <em>DocumentA</em>.</p>
</li>
<li>
<p>Replication syncs <em>ChangeY</em> to Molly&#8217;s device.</p>
<div class="paragraph">
<p>This device already has <em>ChangeX</em> putting the local document in conflict.</p>
</div>
</li>
<li>
<p>Replication syncs <em>ChangeX</em> to Naomi&#8217;s device.</p>
<div class="paragraph">
<p>This device already has <em>ChangeY</em> and now Naomi&#8217;s local document is in conflict.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="automatic-conflict-resolution"><a class="anchor" href="#automatic-conflict-resolution"></a>Automatic Conflict Resolution</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These rules apply only to conflicts arising from replication.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Couchbase Lite uses the following rules to handle conflicts such as those described in <a href="#bmkRepConScene">A typical replication conflict scenario</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If one of the changes is a deletion:</p>
<div class="paragraph">
<p>A deleted document (that is, a <em>tombstone</em>) always wins over a document update.</p>
</div>
</li>
<li>
<p>If both changes are document changes:</p>
<div class="paragraph">
<p>The change with the most revisions will win.</p>
</div>
<div class="paragraph">
<p>Since each change creates a revision with an ID prefixed by an incremented version number, the winner is the change with the highest version number.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The result is saved internally by the Couchbase Lite replicator.
Those rules describe the internal behavior of the replicator.
For additional control over the handling of conflicts, including when a replication is in progress, see <a href="#custom-conflict-resolution">Custom Conflict Resolution</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-conflict-resolution"><a class="anchor" href="#custom-conflict-resolution"></a>Custom Conflict Resolution</h4>
<div class="paragraph">
<p>Starting in Couchbase Lite 2.6, application developers who want more control over how document conflicts are handled can use custom logic to select the winner between conflicting revisions of a document.</p>
</div>
<div class="paragraph">
<p>If a custom conflict resolver is not provided, the system will automatically resolve conflicts as discussed in <a href="#automatic-conflict-resolution">Automatic Conflict Resolution</a>, and as a consequence there will be no conflicting revisions in the database.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
While this is true of any user defined functions, app developers must be strongly cautioned against writing sub-optimal custom conflict handlers that are time consuming and could slow down the client&#8217;s save operations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To implement custom conflict resolution during replication, you must implement the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#conflict-resolver">Conflict Resolver</a></p>
</li>
<li>
<p><a href="#configure-the-replicator">Configure the Replicator</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="conflict-resolver"><a class="anchor" href="#conflict-resolver"></a>Conflict Resolver</h5>
<div class="paragraph">
<p>Apps have the following strategies for resolving conflicts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Local Wins:</strong> The current revision in the database wins.</p>
</li>
<li>
<p><strong>Remote Wins:</strong> The revision pulled from the remote endpoint through replication wins.</p>
</li>
<li>
<p><strong>Merge:</strong> Merge the content bodies of the conflicting revisions.</p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_local-wins"></a>Local Wins</p>
</li>
<li>
<p><a id="tabset3_remote-wins"></a>Remote Wins</p>
</li>
<li>
<p><a id="tabset3_merge"></a>Merge</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_local-wins">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1047-L1051">class LocalWinConflictResolver implements ConflictResolver {
    public Document resolve(Conflict conflict) {
        return conflict.getLocalDocument();
    }
}</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_remote-wins">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1055-L1059">class RemoteWinConflictResolver implements ConflictResolver {
    public Document resolve(Conflict conflict) {
        return conflict.getRemoteDocument();
    }
}</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_merge">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1063-L1069">class MergeConflictResolver implements ConflictResolver {
    public Document resolve(Conflict conflict) {
        Map&lt;String, Object&gt; merge = conflict.getLocalDocument().toMap();
        merge.putAll(conflict.getRemoteDocument().toMap());
        return new MutableDocument(conflict.getDocumentId(), merge);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When a null document is returned by the resolver, the conflict will be resolved as a document deletion.</p>
</div>
</div>
<div class="sect4">
<h5 id="important-guidelines-and-best-practices"><a class="anchor" href="#important-guidelines-and-best-practices"></a>Important Guidelines and Best Practices</h5>
<div class="paragraph">
<p>There are some important points to be noted:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have multiple replicators, it is recommended that instead of distinct resolvers, you should use a unified conflict resolver across all replicators.
Failure to do so could potentially lead to data loss under exception cases or if the app is terminated (by the user or an app crash) while there are pending conflicts.</p>
</li>
<li>
<p>If the document ID of the document returned by the resolver does not correspond to the document that is in conflict then the replicator will log a warning message.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Developers are encouraged to review the warnings and fix the resolver to return a valid document ID.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If a document from a different database is returned, the replicator will treat it as an error.
A <a href="#replication-events">document replication event</a> will be posted with an error and an error message will be logged.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Apps are encouraged to observe such errors and take appropriate measures to fix the resolver function.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>When the replicator is stopped, the system will attempt to resolve outstanding and pending conflicts before stopping.
Hence apps should expect to see some delay when attempting to stop the replicator depending on the number of outstanding documents in the replication queue and the complexity of the resolver function.</p>
</li>
<li>
<p>If there is an exception thrown in the <code>resolve()</code> method, the exception will be caught and handled:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The conflict to resolve will be skipped.
The pending conflicted documents will be resolved when the replicator is restarted.</p>
</li>
<li>
<p>The exception will be reported in the warning logs.</p>
</li>
<li>
<p>The exception will be reported in the <a href="#replication-events">document replication event</a>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
While the system will handle exceptions in the manner specified above, it is strongly encouraged for the resolver function to catch exceptions and handle them in a way appropriate to their needs.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="configure-the-replicator"><a class="anchor" href="#configure-the-replicator"></a>Configure the Replicator</h5>
<div class="paragraph">
<p>The implemented custom conflict resolver can be registered on the replicator configuration object.
The default value of the conflictResolver is <code>null</code>.
When the value is <code>null</code>, the default conflict resolution will be applied.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1016-L1022">URLEndpoint target = new URLEndpoint(new URI("ws://localhost:4984/mydatabase"));

ReplicatorConfiguration config = new ReplicatorConfiguration(database, target);
config.setConflictResolver(new LocalWinConflictResolver());

Replicator replication = new Replicator(config);
replication.start();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="case-2-conflicts-when-saving-a-document"><a class="anchor" href="#case-2-conflicts-when-saving-a-document"></a>Case 2: Conflicts when saving a document</h3>
<div class="paragraph">
<p>When updating a document, you need to consider the possibility of update conflicts.
Update conflicts can occur when you try to update a document thats been updated since you read it.
Here&#8217;s a typical sequence of events that would create an update conflict:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Your code reads the document&#8217;s current properties, and constructs a modified copy to save.</p>
</li>
<li>
<p>Another thread (perhaps the replicator) updates the document, creating a new revision with different properties.</p>
</li>
<li>
<p>Your code updates the document with its modified properties, for example using <code>db.save( mutableDocumentName)</code>.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="automatic-conflict-resolution-2"><a class="anchor" href="#automatic-conflict-resolution-2"></a>Automatic Conflict Resolution</h4>
<div class="paragraph">
<p>In Couchbase Lite 2.0, by default, the conflict is automatically resolved and only one document update is stored in the database.
The Last-Write-Win (LWW) algorithm is used to pick the winning update.
So in effect, the changes from step 2 would be overwritten and lost.</p>
</div>
<div class="paragraph">
<p>If the probability of update conflicts is high in your app and you wish to avoid the possibility of overwritten data, the <code>save</code> and <code>delete</code> APIs provide additional method signatures with concurrency control:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>save(document: MutableDocument, concurrencyControl: ConcurrencyControl)</code>: attempts to save the document with a concurrency control.
The concurrency control parameter has two possible values:</p>
<div class="ulist">
<ul>
<li>
<p><code>lastWriteWins</code> (default): The last operation wins if there is a conflict.</p>
</li>
<li>
<p><code>failOnConflict</code>: The operation will fail if there is a conflict.
In this case, the app can detect the error that is being thrown, and handle it by re-reading the document, making the necessary conflict resolution, then trying again.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similarly to the save operation, the delete operation also has two method signatures to specify how to handle a possible conflict:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>delete(document: Document)</code>: The last write will win if there is a conflict.</p>
</li>
<li>
<p><code>delete(document: Document, concurrencyControl: ConcurrencyControl)</code>: attempts to delete the document with a concurrency control.
The concurrency control parameter has two possible values:</p>
<div class="ulist">
<ul>
<li>
<p><code>lastWriteWins</code> (default): The last operation wins if there is a conflict.</p>
</li>
<li>
<p><code>failOnConflict</code>: The operation will fail if there is a conflict.
In this case, the app can detect the error that is being thrown, and handle it by re-reading the document, making the necessary conflict resolution, then trying again.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="custom-conflict-resolution-2"><a class="anchor" href="#custom-conflict-resolution-2"></a>Custom Conflict Resolution</h4>
<div class="paragraph">
<p>Starting in Couchbase Lite 2.6, we allow developers to hook a conflict handler when saving a document so that developers can easily handle the conflict in a single save method call.</p>
</div>
<div class="paragraph">
<p>To implement custom conflict resolution when saving a document, apps must call the <code>save()</code> method with a conflict handler.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows an example of merging properties from the existing document (<code>current</code>) into the one being saved (<code>new</code>).
In the event of conflicting keys, it will pick the key value from <code>new</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1028-L1041">Document doc = database.getDocument("xyz");
if (doc == null) { return; }
MutableDocument mutableDocument = doc.toMutable();
mutableDocument.setString("name", "apples");

database.save(
    mutableDocument,
    (newDoc, curDoc) -&gt; {
        if (curDoc == null) { return false; }
        Map&lt;String, Object&gt; dataMap = curDoc.toMap();
        dataMap.putAll(newDoc.toMap());
        newDoc.setData(dataMap);
        return true;
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Important points to be noted:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Within the conflict handler, you can modify the <code>document</code> parameter which is the same instance of <code>Document</code> that is passed to the <code>save()</code> method.
So in effect, you will be directly modifying the document that is being saved.</p>
</li>
<li>
<p>When handling is done, the method must return <code>true</code>.</p>
</li>
<li>
<p>If the handler could not resolve the conflict, it can return <code>false</code>.
In this case, the save method will cancel the save operation and return <code>false</code> the same way as using the <code>save()</code> method with the <code>failOnConflict</code> concurrency control.</p>
</li>
<li>
<p>If there is an exception thrown in the <code>handle()</code> method, the exception will be caught and rethrown in the <code>save()</code> method.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="database-replicas"><a class="anchor" href="#database-replicas"></a>Database Replicas</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Enterprise Edition ONLY</div>
Database replicas are available only in <strong>CouchbaseLite Enterprise Edition</strong> (<a href="https://www.couchbase.com/downloads" class="bare">https://www.couchbase.com/downloads</a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Couchbase Lite supports replication between two local databases, which allows a Couchbase Lite replicator to store data on secondary storage.
This is especially useful in scenarios where a user&#8217;s device may be damaged and its data moved to a different device.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L950-L956">DatabaseEndpoint targetDatabase = new DatabaseEndpoint(database2);
ReplicatorConfiguration replicatorConfig = new ReplicatorConfiguration(database1, targetDatabase);
replicatorConfig.setReplicatorType(ReplicatorConfiguration.ReplicatorType.PUSH);

// Create replicator (be sure to hold a reference somewhere that will prevent the Replicator from being GCed)
replicator = new Replicator(replicatorConfig);
replicator.start();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="certificate-pinning"><a class="anchor" href="#certificate-pinning"></a>Certificate Pinning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite supports certificate pinning.
Certificate pinning is a technique that can be used by applications to "pin" a host to its certificate.
The certificate is typically delivered to the client by an out-of-band channel and bundled with the client.
In this case, Couchbase Lite uses this embedded certificate to verify the trustworthiness of the server and no longer needs to rely on a trusted third party for that (commonly referred to as the Certificate Authority).</p>
</div>
<div class="paragraph">
<p>The following steps describe how to configure certificate pinning between Couchbase Lite and Sync Gateway.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="../../sync-gateway/current/authentication-certs.html#creating-your-own-self-signed-certificate" class="page">Create your own self-signed certificate</a> with the <code>openssl</code> command.
After completing this step, you should have 3 files: <code>cert.pem</code>, <code>cert.cer</code> and <code>privkey.pem</code>.</p>
</li>
<li>
<p><a href="../../sync-gateway/current/authentication-certs.html#installing-the-certificate" class="page">Configure Sync Gateway</a> with the <code>cert.pem</code> and <code>privkey.pem</code> files.
After completing this step, Sync Gateway is reachable over <code>https</code>/<code>wss</code>.</p>
</li>
<li>
<p>On the Couchbase Lite side, the replication must point to a URL with the <code>wss</code> scheme and configured with the <code>cert.cer</code> file created in step 1.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L885-L892">InputStream is = getAsset("cert.cer");
byte[] cert = IOUtils.toByteArray(is);
if (is != null) {
    try { is.close(); }
    catch (IOException ignore) {}
}

config.setPinnedServerCertificate(cert);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example loads the certificate from the application sandbox, then converts it to the appropriate type to configure the replication object.</p>
</div>
</li>
<li>
<p>Build and run your app.
The replication should now run successfully over https with certificate pinning.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="troubleshooting-2"><a class="anchor" href="#troubleshooting-2"></a>Troubleshooting</h3>
<div class="paragraph">
<p>If Sync Gateway is configured with a self signed certificate but your app points to a <code>ws</code> scheme instead of <code>wss</code> you will encounter an error with status code <code>11006</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">CouchbaseLite Replicator ERROR: {Repl#2} Got LiteCore error: WebSocket error 1006 "connection closed abnormally"</code></pre>
</div>
</div>
<div class="paragraph">
<p>If Sync Gateway is configured with a self signed certificate, and your app points to a <code>wss</code> scheme but the replicator configuration isn&#8217;t using the certificate you will encounter an error with status code <code>5011</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">CouchbaseLite Replicator ERROR: {Repl#2} Got LiteCore error: Network error 11 "server TLS certificate is self-signed or has unknown root cert"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="peer-to-peer-sync"><a class="anchor" href="#peer-to-peer-sync"></a>Peer-to-Peer Sync</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Enterprise Edition only</div>
Peer-to-peer sync is an <a href="https://www.couchbase.com/products/editions">Enterprise Edition</a> feature.
You must purchase the Enterprise License which includes official <a href="https://www.couchbase.com/support-policy">Couchbase Support</a> to use it in production (also see the <a href="https://www.couchbase.com/licensing-and-support-faq">FAQ</a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Peer-to-peer sync allows devices running Couchbase Lite to directly sync data with each other.
As part of this, Couchbase Lite is responsible for storing the data and keeping track of the data exchange, but isn&#8217;t responsible for the data transfer itself.
Sending and receiving data must be handled by the platform APIs or a third party framework.
In this section, we will refer to these third party frameworks as communication frameworks.</p>
</div>
<div class="paragraph">
<p>On Android, the <a href="https://developers.google.com/nearby/messages/overview">Nearby Messages API</a> would be a good choice for the Communication Framework.
This framework will handle sending and receiving messages and supports multiple transport technologies&#8201;&#8212;&#8201;WiFi and Bluetooth and uses whichever is available to establish a connection between devices.</p>
</div>
<div class="paragraph">
<p>Thus, to enable peer-to-peer sync with Couchbase Lite, the application must use the Communication Framework with Couchbase Lite.
The following sections describe a typical peer-to-peer workflow.
Where applicable, we discuss how to integrate Couchbase Lite into the workflow.</p>
</div>
<div class="paragraph">
<p>In Couchbase Lite, a peer can take on one of these two roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Active Peer:</strong> The peer that initializes the connection and replication (i.e the "client" side).</p>
</li>
<li>
<p><strong>Passive Peer:</strong> The passive side reacts to things that it receives but does not initiate any communication on its own (i.e. the "server" side).</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="peer-discovery"><a class="anchor" href="#peer-discovery"></a>Peer Discovery</h3>
<div class="paragraph">
<p>Peer discovery is the first step.
The communication framework will generally include a peer discovery API for devices to advertise themselves on the network and to browse for other peers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/discovery.png" alt="discovery">
</div>
</div>
<div class="sect3">
<h4 id="active-peer"><a class="anchor" href="#active-peer"></a>Active Peer</h4>
<div class="paragraph">
<p>The first step is to initialize the Couchbase Lite database.</p>
</div>
</div>
<div class="sect3">
<h4 id="passive-peer"><a class="anchor" href="#passive-peer"></a>Passive Peer</h4>
<div class="paragraph">
<p>In addition to initializing the database, the passive peer must initialize the <code>MessageEndpointListener</code>.
The <code>MessageEndpointListener</code> acts as as a listener for incoming connections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1178-L1183">DatabaseConfiguration databaseConfiguration = new DatabaseConfiguration();
Database database = new Database("mydb", databaseConfiguration);
MessageEndpointListenerConfiguration listenerConfiguration = new MessageEndpointListenerConfiguration(
    database,
    ProtocolType.MESSAGE_STREAM);
this.messageEndpointListener = new MessageEndpointListener(listenerConfiguration);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="peer-selection-and-connection-setup"><a class="anchor" href="#peer-selection-and-connection-setup"></a>Peer Selection and Connection Setup</h3>
<div class="paragraph">
<p>Once a peer device is found, it is the application code&#8217;s responsibility to decide whether it should establish a connection with that peer.
This step includes inviting a peer to a session and peer authentication.</p>
</div>
<div class="paragraph">
<p>This is handled by the Communication Framework.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/selection.png" alt="selection">
</div>
</div>
<div class="paragraph">
<p>Once the remote peer has been authenticated, the next step is to connect with that peer and initialize the Message Endpoint API.</p>
</div>
</div>
<div class="sect2">
<h3 id="replication-setup"><a class="anchor" href="#replication-setup"></a>Replication Setup</h3>
<div class="imageblock">
<div class="content">
<img src="_images/connection.png" alt="connection">
</div>
</div>
<div class="sect3">
<h4 id="active-peer-2"><a class="anchor" href="#active-peer-2"></a>Active Peer</h4>
<div class="paragraph">
<p>When the connection is established, the active peer must instantiate a <code>MessageEndpoint</code> object corresponding to the remote peer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1085-L1093">DatabaseConfiguration databaseConfiguration = new DatabaseConfiguration(context);
Database database = new Database("mydb", databaseConfiguration);

// The delegate must implement the `MessageEndpointDelegate` protocol.
MessageEndpoint messageEndpointTarget = new MessageEndpoint(
    "UID:123",
    "active",
    ProtocolType.MESSAGE_STREAM,
    this);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>MessageEndpoint</code> initializer takes the following arguments.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>uid</code>: a unique ID that represents the remote active peer.</p>
</li>
<li>
<p><code>target</code>: This represents the remote passive peer and could be any suitable representation of the remote peer.
It could be an Id, URL etc.
If using the MultiPeerConnectivity Framework, this could be the MCPeerID.</p>
</li>
<li>
<p><code>protocolType</code>: specifies the kind of transport you intend to implement.
There are two options.</p>
<div class="ulist">
<ul>
<li>
<p>The default (<code>MessageStream</code>) means that you want to "send a series of messages", or in other words the Communication Framework will control the formatting of messages so that there are clear boundaries between messages.</p>
</li>
<li>
<p>The alternative (<code>ByteStream</code>) means that you just want to send raw bytes over the stream and Couchbase should format for you to ensure that messages get delivered in full.</p>
<div class="paragraph">
<p>Typically, the Communication Framework will handle message assembly and disassembly so you would use the <code>MessageType</code> option in most cases.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>delegate</code>: the delegate that will implement the <code>MessageEndpointDelegate</code> protocol, which is a factory for <code>MessageEndpointConnection</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Then, a <code>Replicator</code> is instantiated with the initialized <code>MessageEndpoint</code> as the target.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1097-L1102">ReplicatorConfiguration config = new ReplicatorConfiguration(database, messageEndpointTarget);

// Create the replicator object.
replicator = new Replicator(config);
// Start the replication.
replicator.start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, Couchbase Lite will call back the application code through the <code>MessageEndpointDelegate.createConnection</code> interface method.
When the application receives the callback, it must create an instance of <code>MessageEndpointConnection</code> and return it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1107-L1112">/* implementation of MessageEndpointDelegate */
@NonNull
@Override
public MessageEndpointConnection createConnection(@NonNull MessageEndpoint endpoint) {
    return new ActivePeerConnection(); /* implements MessageEndpointConnection */
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, Couchbase Lite will call back the application code through the <code>MessageEndpointConnection.open</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1127-L1132">/* implementation of MessageEndpointConnection */
@Override
public void open(@NonNull ReplicatorConnection connection, @NonNull MessagingCompletion completion) {
    replicatorConnection = connection;
    completion.complete(true, null);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The connection argument is then set on an instance variable.
The application code must keep track of every <code>ReplicatorConnection</code> associated with every <code>MessageEndpointConnection</code>.</p>
</div>
<div class="paragraph">
<p>The <code>MessageError</code> argument in the completion block is used to specify if the error is recoverable or not.
If it is a recoverable error, the replicator will kick off a retry process which will result to creating a new <code>MessageEndpointConnection</code> instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="passive-peer-2"><a class="anchor" href="#passive-peer-2"></a>Passive Peer</h4>
<div class="paragraph">
<p>The first step after connection establishment on the passive peer is to initialize a new <code>MessageEndpointConnection</code> and pass it to the listener.
This tells the listener to accept incoming data from that peer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1195-L1197">PassivePeerConnection connection = new PassivePeerConnection(context); /* implements
MessageEndpointConnection */
messageEndpointListener.accept(connection);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>messageEndpointListener</code> is the instance of the <code>MessageEndpointListener</code> that was created in the first step (<a href="#peer-discovery">Peer Discovery</a>)</p>
</div>
<div class="paragraph">
<p>Couchbase Lite will then call back the application code through the <code>MessageEndpointConnection.open</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1208-L1213">/* implementation of MessageEndpointConnection */
@Override
public void open(@NonNull ReplicatorConnection connection, @NonNull MessagingCompletion completion) {
    replicatorConnection = connection;
    completion.complete(true, null);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>connection</code> argument is then set on an instance variable.
The application code must keep track of every <code>ReplicatorConnection</code> associated with every <code>MessageEndpointConnection</code>.</p>
</div>
<div class="paragraph">
<p>At this point, the connection is established and both peers are ready to exchange data.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pushpull-replication"><a class="anchor" href="#pushpull-replication"></a>Push/Pull Replication</h3>
<div class="paragraph">
<p>Typically, an application needs to send data and receive data.
Directionality of the replication could be any of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Push only:</strong> The data is pushed from the local database to the remote database.</p>
</li>
<li>
<p><strong>Pull only:</strong> The data is pulled from the remote database to the local database.</p>
</li>
<li>
<p><strong>Push and Pull:</strong> The data is exchanged both ways.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Usually, the remote is a Sync Gateway database which is identified through a URL.
In the context of peer-to-peer syncing, the remote is another Couchbase Lite database.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/replication.png" alt="replication">
</div>
</div>
<div class="paragraph">
<p>The replication lifecycle is handled through the <code>MessageEndpointConnection</code>.</p>
</div>
<div class="sect3">
<h4 id="active-peer-3"><a class="anchor" href="#active-peer-3"></a>Active Peer</h4>
<div class="paragraph">
<p>When Couchbase Lite calls back the application code through the <code>MessageEndpointConnection.send</code> method, you should send that data to the other peer using the communication framework.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1146-L1153">/* implementation of MessageEndpointConnection */
@Override
public void send(@NonNull Message message, @NonNull MessagingCompletion completion) {
    /* send the data to the other peer */
    /* ... */
    /* call the completion handler once the message is sent */
    completion.complete(true, null);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the data is sent, call the completion block to acknowledge the completion.
You can use the <code>MessageError</code> in the completion block to specify if the error is recoverable or not.
If it is a recoverable error, the replicator will kick off a retry process which will result to creating a new <code>MessageEndpointConnection</code>.</p>
</div>
<div class="paragraph">
<p>When data is received from the passive peer via the Communication Framework, you call the <code>ReplicatorConnection.receive</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1158">replicatorConnection.receive(message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The replication connection&#8217;s <code>receive</code> method is called which then processes the data in order to persist it to the local database.</p>
</div>
</div>
<div class="sect3">
<h4 id="passive-peer-3"><a class="anchor" href="#passive-peer-3"></a>Passive Peer</h4>
<div class="paragraph">
<p>As in the case of the active peer, the passive peer must implement the <code>MessageEndpointConnection.send</code> method to send data to the other peer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1228-L1235">/* implementation of MessageEndpointConnection */
@Override
public void send(@NonNull Message message, @NonNull MessagingCompletion completion) {
    /* send the data to the other peer */
    /* ... */
    /* call the completion handler once the message is sent */
    completion.complete(true, null);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the data is sent, call the completion block to acknowledge the completion.
You can use the <code>MessageError</code> in the completion block to specify if the error is recoverable or not.
If it is a recoverable error, the replicator will kick off a retry process which will result to creating a new <code>MessageEndpointConnection</code>.</p>
</div>
<div class="paragraph">
<p>When data is received from the active peer via the Communication Framework, you call the <code>ReplicatorConnection.receive</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1240">replicatorConnection.receive(message);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="connection-teardown"><a class="anchor" href="#connection-teardown"></a>Connection Teardown</h3>
<div class="paragraph">
<p>When a peer disconnects from a peer-to-peer network, all connected peers are notified.
The disconnect notification is a good opportunity to close and remove a replication connection.
The steps to teardown the connection are slightly different depending on whether it is the active or passive peer that disconnects first.
We will cover each case below.</p>
</div>
<div class="sect3">
<h4 id="initiated-by-active-peer"><a class="anchor" href="#initiated-by-active-peer"></a>Initiated by Active Peer</h4>
<div class="imageblock">
<div class="content">
<img src="_images/dis-active.png" alt="dis active">
</div>
</div>
<div class="sect4">
<h5 id="active-peer-4"><a class="anchor" href="#active-peer-4"></a>Active Peer</h5>
<div class="paragraph">
<p>When an active peer disconnects, it must call the <code>ReplicatorConnection.close</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1122">replicatorConnection.close(null);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, Couchbase Lite will call back your code through the <code>MessageEndpointConnection.close</code> to give the application a chance to disconnect with the Communication Framework.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1136-L1142">@Override
public void close(Exception error, @NonNull MessagingCloseCompletion completion) {
    /* disconnect with communications framework */
    /* ... */
    /* call completion handler */
    completion.complete();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="passive-peer-4"><a class="anchor" href="#passive-peer-4"></a>Passive Peer</h5>
<div class="paragraph">
<p>When the passive peer receives the corresponding disconnect notification from the Communication Framework, it must call the <code>ReplicatorConnection.close</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1203">replicatorConnection.close(null);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, Couchbase Lite will call back your code through the <code>MessageEndpointConnection.close</code> to give the application a chance to disconnect with the Communication Framework.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1217-L1224">/* implementation of MessageEndpointConnection */
@Override
public void close(Exception error, @NonNull MessagingCloseCompletion completion) {
    /* disconnect with communications framework */
    /* ... */
    /* call completion handler */
    completion.complete();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="initiated-by-passive-peer"><a class="anchor" href="#initiated-by-passive-peer"></a>Initiated by Passive Peer</h4>
<div class="imageblock">
<div class="content">
<img src="_images/dis-passive.png" alt="dis passive">
</div>
</div>
<div class="sect4">
<h5 id="passive-peer-5"><a class="anchor" href="#passive-peer-5"></a>Passive Peer</h5>
<div class="paragraph">
<p>When the passive disconnects, it must class the <code>MessageEndpointListener.closeAll</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1189">messageEndpointListener.closeAll();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, Couchbase Lite will call back your code through the <code>MessageEndpointConnection.close</code> to give the application a chance to disconnect with the Communication Framework.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1217-L1224">/* implementation of MessageEndpointConnection */
@Override
public void close(Exception error, @NonNull MessagingCloseCompletion completion) {
    /* disconnect with communications framework */
    /* ... */
    /* call completion handler */
    completion.complete();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="active-peer-5"><a class="anchor" href="#active-peer-5"></a>Active Peer</h5>
<div class="paragraph">
<p>When the active peer receives the corresponding disconnect notification from the Communication Framework, it must call the <code>ReplicatorConnection.close</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1122">replicatorConnection.close(null);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, Couchbase Lite will call back your code through the <code>MessageEndpointConnection.close</code> to give the application a chance to disconnect with the Communication Framework.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/ROOT/examples/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java#L1136-L1142">@Override
public void close(Exception error, @NonNull MessagingCloseCompletion completion) {
    /* disconnect with communications framework */
    /* ... */
    /* call completion handler */
    completion.complete();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="thread-safety"><a class="anchor" href="#thread-safety"></a>Thread Safety</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Couchbase Lite API is thread safe except for calls to mutable objects: <code>MutableDocument</code>, <code>MutableDictionary</code> and <code>MutableArray</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release-notes"><a class="anchor" href="#release-notes"></a>Release Notes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="2-7-1"><a class="anchor" href="#2-7-1"></a>2.7.1</h3>
<div class="paragraph">
<p>Note: Support notices remain in force for this maintenance release&#8201;&#8212;&#8201;see <a href="#support-notices">Support Notices</a> below.</p>
</div>
<div class="sect3">
<h4 id="fixed-at-this-release"><a class="anchor" href="#fixed-at-this-release"></a>Fixed at this Release</h4>
<div class="paragraph">
<p>This maintenance release fixes the following issues:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-799"><strong>CBL-799</strong></a> Crash calling pull validator callback</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-789"><strong>CBL-789</strong></a> Crash when accessing <code>connection&#8594;name()</code></p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-701"><strong>CBL-701</strong></a> Pending Document IDs not working correctly</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-698"><strong>CBL-698</strong></a> Wrong query evaluation using expression values instead of expression properties</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-657"><strong>CBL-657</strong></a> LIKE and CONTAINS are much slower in 2.7</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-581"><strong>CBL-581</strong></a> Native memory leak when save document repeatedly</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-579"><strong>CBL-579</strong></a> SDK fails for opening Database files over 2GB</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="known-issues"><a class="anchor" href="#known-issues"></a>Known issues</h4>
<div class="paragraph">
<p>The following issues document known errors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-608"><strong>CBL-608</strong></a> Ordering null values inconsistent with N1QL expectations</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-370"><strong>CBL-370</strong></a> 370	Broken API, Kotlin: Unable to import ReplicatorType</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-216"><strong>CBL-216</strong></a> Ordering null values inconsistent with N1QL expectations</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-95"><strong>CBL-95</strong></a> Pending conflicts could be resolved by a wrong replicator</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-49"><strong>CBL-49</strong></a> Need a way to distinguish boolean types</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="2-7-0"><a class="anchor" href="#2-7-0"></a>2.7.0</h3>
<div class="paragraph">
<p><strong>New Features</strong></p>
</div>
<div class="paragraph">
<p>New at this release is the Java Platform, which enables development of Java apps on any platform that supports the JVM model</p>
</div>
<div class="paragraph">
<p><a href="index.html" class="page">Read More</a></p>
</div>
<div id="support-notices" class="paragraph">
<p><strong>Support Notices</strong></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Deprecation Notice</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Support for API 19 and 21
was deprecated in release 2.6
and will be removed in
 release 2.9</p>
</div>
<div class="paragraph">
<p><em>Action:</em> Please plan to migrate your apps to use API versions greater than API 21</p>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See also <a href="#supported-versions">Supported Versions</a></p>
</div>
<div class="paragraph">
<p><strong>Known issues</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-608"><strong>CBL-608</strong></a>	Blob missing content file</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-564"><strong>CBL-564</strong></a>	Property alias not working under certain cases</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-370"><strong>CBL-370</strong></a> Broken API, Kotlin: Unable to import ReplicatorType</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-216"><strong>CBL-216</strong></a> Ordering null values inconsistent with N1QL expectations</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-95"><strong>CBL-95</strong></a> Pending conflicts could be resolved by a wrong replicator</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-49"><strong>CBL-49</strong></a> Need a way to distinguish boolean types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Fixed at this Release</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-478"><strong>CBL-478</strong></a> Better handling of RejectedExecutionExceptions</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-469"><strong>CBL-469</strong></a> Infinite loop parsing a URL</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-463"><strong>CBL-463</strong></a> Attempt to log strings that are not Modified UTF-8</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-444"><strong>CBL-444</strong></a> Purging documents does not fire events in a QueryChangeListener</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-436"><strong>CBL-436</strong></a> Crash finding keys in and empty dictionary</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-404"><strong>CBL-404</strong></a> Static maps in C4Socket are gigantic memory leaks</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-402"><strong>CBL-402</strong></a> Back-tag recent releases</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-392"><strong>CBL-392</strong></a> Incorrect data sent for attachment with digest&#8230;&#8203;</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-355"><strong>CBL-355</strong></a> Queries silently ignore Collation Locale</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-346"><strong>CBL-346</strong></a> Creating revisions out-of-orders sequence numbers</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-324"><strong>CBL-324</strong></a> Function.upper() failed to operate non-ASCII characters</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-272"><strong>CBL-272</strong></a> MessageSocketFactory.socket_open() is not accessible by C4Socket</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-242"><strong>CBL-242</strong></a> Inconsistent revision hash length</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-221"><strong>CBL-221</strong></a> "mutex lock failed" during initial pull replication of large # of docs</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-218"><strong>CBL-218</strong></a> FTS indexing an array-valued property is unreliable</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-207"><strong>CBL-207</strong></a> Replicator change event has idle with timeout error</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-205"><strong>CBL-205</strong></a> Crash when stopping replication during sync</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-174"><strong>CBL-174</strong></a> Local reference table overflow</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-172"><strong>CBL-172</strong></a> Live Query initial delay</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-171"><strong>CBL-171</strong></a> CBL replication never finishes for replication filtering when doc count is 1000</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-144"><strong>CBL-144</strong></a> Incorrect log level passed to custom logger</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-143"><strong>CBL-143</strong></a> Default logging flooded with C4Socket warning messages</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-106"><strong>CBL-106</strong></a> Replicator C++ exception: "properties excessively large"</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-52"><strong>CBL-52</strong></a> LIKE, "CONTAINS", "REGEX_LIKE" operators ignore collations</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-34"><strong>CBL-34</strong></a> Replicator crash</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-13"><strong>CBL-13</strong></a> Native crash</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="2-6-2"><a class="anchor" href="#2-6-2"></a>2.6.2</h3>
<div class="paragraph">
<p>This maintenance release for Android includes important bug fixes.</p>
</div>
<div class="paragraph">
<p><strong>Bugs</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-468"><strong>CBL-468</strong></a> Null dereference during pull-only replication.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-467"><strong>CBL-467</strong></a> Replication listener sometimes crashed on NPE.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-436"><strong>CBL-436</strong></a> An attempt to get the keys from an empty dictionary caused a crash.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-324"><strong>CBL-324</strong></a> Function.upper() failed to operate non-ASCII characters.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-172"><strong>CBL-172</strong></a> Initial delay observed when starting a liveQuery has been fixed.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-34"><strong>CBL-34</strong></a> Fixed a replicator crash issue.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="2-6-0"><a class="anchor" href="#2-6-0"></a>2.6.0</h3>
<div class="paragraph">
<p><strong>New Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Custom Conflict Resolution</p>
<div class="paragraph">
<p><a href="index.html" class="page">Read More</a></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Enhancements</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Expose the Document Revision ID: the <code>revisionID</code> property on a <code>Document</code> instance now returns the current revision identifier.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Android API Support</strong></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Deprecation Notice</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Support for API 19 and 21
was deprecated in release 2.6
and will be removed in
 a future release</p>
</div>
<div class="paragraph">
<p><em>Action:</em> Please plan to migrate your apps to use API versions greater than API 21</p>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>API Changes</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The constructor <code>DatabaseConfiguration(Context)</code> no longer exists.  It has been replaced by <code>DatabaseConfiguration()</code>.</p>
</li>
<li>
<p>The static method <code>CouchbaseLite.init(Context)</code> must be called before <strong>any</strong> other method in the Couchbase Lite API.
Applications upgrading from earlier versions to 2.6 must invoke this method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Read More in the <a href="#initializer">Initializer</a> section.</p>
</div>
<div class="paragraph">
<p><strong>Bugs</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-48"><strong>CBL-48</strong></a> Copy method of Database class is not able to copy encrypted db.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-86"><strong>CBL-86</strong></a> Race condition on SharedKeys causes silent error.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-71"><strong>CBL-71</strong></a> LiteCore database alias clashes with select all alias.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-88"><strong>CBL-88</strong></a> Calling Replicator#getStatus() on a replicator that hasn&#8217;t started throws NPE.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-89"><strong>CBL-89</strong></a> Calling Replicator#stop() on a replicator that hasn&#8217;t started throws NPE.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-130"><strong>CBL-130</strong></a> Crash: Possible memory corruption.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-165"><strong>CBL-165</strong></a> Replication failed due to unauthorized(401) error.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Known issues</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-324"><strong>CBL-324</strong></a> Function.upper() failed to operate non-ASCII characters</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-95"><strong>CBL-95</strong></a> Pending conflicts could be resolved by a wrong replicator</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-49"><strong>CBL-49</strong></a> Need a way to distinguish boolean types</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="2-5-3"><a class="anchor" href="#2-5-3"></a>2.5.3</h3>
<div class="paragraph">
<p><strong>Enhancements</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-142"><strong>CBL-142</strong></a> Added native support for x86_64.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Fixed at this Release</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-176"><strong>CBL-176</strong></a> Reduce replication timeouts.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-110"><strong>CBL-110</strong></a> Delta sync on top of a deletion caused data discrepancy between Couchbase Sync Gateway and Couchbase Lite.</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-131"><strong>CBL-131</strong></a> Continuous replicator does not back off retries.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="2-5-2"><a class="anchor" href="#2-5-2"></a>2.5.2</h3>
<div class="paragraph">
<p>Fixed at this Release</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/couchbase/couchbase-lite-core/issues/776"><strong>#776</strong></a> <code>c4db_endTransaction</code> sometimes results in invalid memory access.</p>
</li>
<li>
<p><a href="https://github.com/couchbase/couchbase-lite-core/issues/787"><strong>#787</strong></a> Fleece error when querying array property.</p>
</li>
<li>
<p><a href="https://github.com/couchbase/couchbase-lite-core/issues/792"><strong>#792</strong></a> DBWorker crashes in Fleece Encoder (writePointer).</p>
</li>
<li>
<p><a href="https://issues.couchbase.com/browse/CBL-5"><strong>CBL-5</strong></a> Excessive synchronization is stalling Live Query notification.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="2-5-0"><a class="anchor" href="#2-5-0"></a>2.5.0</h3>
<div class="paragraph">
<p><strong>New Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Delta Sync</p>
</li>
<li>
<p>Replication Filters</p>
</li>
<li>
<p>Continuous Logging</p>
</li>
<li>
<p>Predictive Query</p>
<div class="paragraph">
<p><a href="index.html" class="page">Read More</a></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Enhancements</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>TBA/1779[<strong>#1779</strong>]
Replication Filters</p>
</li>
<li>
<p>TBA/1821[<strong>#1821</strong>]
Remove log rotation change batching</p>
</li>
<li>
<p>TBA/1845[<strong>#1845</strong>]
Annotate @NonNull to public API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Fixed at this Release</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TBA/1523[<strong>#1523</strong>]
2.0: ``isOldAttachment'' check is incorrect</p>
</li>
<li>
<p>TBA/1755[<strong>#1755</strong>]
Query enumeration error: LiteCoreException</p>
</li>
<li>
<p>TBA/1756[<strong>#1756</strong>]
2.0 Replicator does not work with TLS 1.2 when using Android API &#8656; 19</p>
</li>
<li>
<p>TBA/1785[<strong>#1785</strong>]
Result.toMap() does not return boolean values</p>
</li>
<li>
<p>TBA/1814[<strong>#1814</strong>]
Change domains type of the Console Logger to EnumSet</p>
</li>
<li>
<p>TBA/1818[<strong>#1818</strong>]
Crash on document save with 2.1.2</p>
</li>
<li>
<p>TBA/1872[<strong>#1872</strong>]
Logging messages CBL code are not shown up in console</p>
</li>
<li>
<p>TBA/1899[<strong>#1899</strong>]
Signal 11 SIGSEGV with current iridium Branch</p>
</li>
<li>
<p>TBA/1900[<strong>#1900</strong>]
BlobInputStream does not return -1 when finished reading</p>
</li>
<li>
<p>TBA/1904[<strong>#1904</strong>]
Signal 11 SIGSEGV when initiating Dictionary Iterator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Known issues</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>TBA/1773[<strong>#1773</strong>]
Client Proxy Support</p>
</li>
<li>
<p>TBA/1888[<strong>#1888</strong>]
Memory Leak: Database reference held by a ReplicatorListenerThread after
close</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="2-1-2"><a class="anchor" href="#2-1-2"></a>2.1.2</h3>
<div class="ulist">
<div class="title">Fixed at this Release</div>
<ul>
<li>
<p>TBA/1760[<strong>#1760</strong>] Warning about CBLWebSocket failed to shutdown the web socket</p>
</li>
<li>
<p>TBA/1761[<strong>#1761</strong>] Could not find class `android.system.ErrnoException' error</p>
</li>
<li>
<p>TBA/1762[<strong>#1762</strong>] Potential memory leak in replicator</p>
</li>
<li>
<p>TBA/1763[<strong>#1763</strong>] Log from replicators native code shouldnt be shown unless the logging is enabled</p>
</li>
<li>
<p>TBA/1766[<strong>#1766</strong>] Auth Header from BasicAuthenticator not getting sent if SG Guest user is enabled</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="2-1"><a class="anchor" href="#2-1"></a>2.1</h3>
<div class="ulist">
<div class="title">Enhancements</div>
<ul>
<li>
<p>TBA/1678[<strong>#1678</strong>] Support Peer-to-Peer replication through MessageEndpoint API (EE Feature)</p>
</li>
<li>
<p>TBA/1683[<strong>#1683</strong>] Support Database Encryption (EE feature)</p>
</li>
<li>
<p>TBA/1696[<strong>#1696</strong>] Support replicator reset checkpoint</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Fixed at this Release</div>
<ul>
<li>
<p>TBA/1510[<strong>#1510</strong>] 2.0: Crash with DB21 - in c4doc_update()</p>
</li>
<li>
<p>TBA/1665[<strong>#1665</strong>] Exception thrown openDatabase (Proguard strips methods that CBL uses)</p>
</li>
<li>
<p>TBA/1676[<strong>#1676</strong>] 2.0: Replicator Error misses the error message.</p>
</li>
<li>
<p>TBA/1702[<strong>#1702</strong>] 2.x: ValueIndexItem.expression(Expression) is missing</p>
</li>
<li>
<p>TBA/1725[<strong>#1725</strong>] 2.1: Android : Replication does not start</p>
</li>
<li>
<p>TBA/1727[<strong>#1727</strong>] Dead lock occurs - DB 2.0.0</p>
</li>
<li>
<p>TBA/1742[<strong>#1742</strong>] Couchbase mobile 2.0.2 Emoji Support</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Known issues</div>
<ul>
<li>
<p>TBA/1743[<strong>#1743</strong>] HTTP Proxy Support</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="2-0-2"><a class="anchor" href="#2-0-2"></a>2.0.2</h3>
<div class="ulist">
<ul>
<li>
<p>Support for Log redaction of sensitive information when <a href="#logging">logging is enabled</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="2-0-0"><a class="anchor" href="#2-0-0"></a>2.0.0</h3>
<div class="ulist">
<div class="title">Enhancements</div>
<ul>
<li>
<p>TBA/1264[<strong>#1264</strong>] 2.0 migration from Forest back to SQlite</p>
</li>
<li>
<p>TBA/1577[<strong>#1577</strong>] 2.1: Eliminate CouchbaseLiteRuntimeExecption, convert it to CouchbaseLiteExecption</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Fixed at this Release</div>
<ul>
<li>
<p>TBA/1217[<strong>#1217</strong>] 2.0: Todo Sample bug Fix and implement remaining features</p>
</li>
<li>
<p>TBA/1234[<strong>#1234</strong>] 2.0: Replicator continuous pull status completed and total number out of sync</p>
</li>
<li>
<p>TBA/1247[<strong>#1247</strong>] 2.0: Push Replication Causing Errors</p>
</li>
<li>
<p>TBA/1273[<strong>#1273</strong>] 2.0: Replicator Activity Level stays in Busy state</p>
</li>
<li>
<p>TBA/1347[<strong>#1347</strong>] 2.0: How do we properly stop puller Replicator and delete database ?</p>
</li>
<li>
<p>TBA/1470[<strong>#1470</strong>] 2.0: In My App with CB Lite DB020(Android), ConflictResolver is called endless loop during three device or much more!</p>
</li>
<li>
<p>TBA/1499[<strong>#1499</strong>] 2.0: Repl Bad URL returns 19 instead of 15 on API 24 ARM emulator</p>
</li>
<li>
<p>TBA/1500[<strong>#1500</strong>] 2.0: LoadTest.testUpdate() causes memory error with Android API 19 Arm Emulator</p>
</li>
<li>
<p>TBA/1501[<strong>#1501</strong>] 2.0: ReplicatorTest &gt; testPushDoc fails</p>
</li>
<li>
<p>TBA/1512[<strong>#1512</strong>] 2.0: ReplicatorTest &gt; testPullDoc fails</p>
</li>
<li>
<p>TBA/1581[<strong>#1581</strong>] 2.0 : LiveQuery threading issue</p>
</li>
<li>
<p>TBA/1609[<strong>#1609</strong>] 2.0: testSelfSignedSSLPinned() unit test failure</p>
</li>
<li>
<p>TBA/1610[<strong>#1610</strong>] Exception from the cpp layer in my android app on load tests</p>
</li>
<li>
<p>TBA/1615[<strong>#1615</strong>] 2.0: NullPointerException: Attempt to invoke virtual method 'boolean com.couchbase.litecore.C4QueryEnumerator.next()' on a null object reference</p>
</li>
<li>
<p>TBA/1620[<strong>#1620</strong>] NOT operator not working for FTS</p>
</li>
<li>
<p>TBA/1630[<strong>#1630</strong>] 2.0: make public Index interface</p>
</li>
<li>
<p>TBA/1651[<strong>#1651</strong>] 2.0: C4DocumentTest.testPut() fails</p>
</li>
<li>
<p>TBA/1652[<strong>#1652</strong>] App crash with deleteDocument with concurrencyControl</p>
</li>
<li>
<p>TBA/1693[<strong>#1693</strong>] DB023 - Crazy amount of dbListenerTokens - makes the DB run slow</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Known issues</div>
<ul>
<li>
<p>TBA/1685[<strong>#1685</strong>] Replicator in Android get stuck at busy state when it goes back to online from offline (Genymotion)</p>
</li>
<li>
<p>TBA/1702[<strong>#1702</strong>] ValueIndexItem.expression(Expression) is implemented with CBL Android 2.0.0 release.
This API will be available with 2.1.0 release</p>
</li>
<li>
<p>TBA/1665[<strong>#1665</strong>]: it is currently not possible to enable <a href="https://developer.android.com/studio/build/shrink-code.html">code shrinking</a> (<code>minifyEnabled: true</code>) in an Android Studio project that uses Couchbase Lite 2.0.
As a workaround, code shrinking can be disabled for Couchbase Lite classes and its dependencies by adding the following in <strong>proguard-rules.pro</strong>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy"># OkHttp3
-dontwarn okhttp3.**
-dontwarn okio.**
-dontwarn javax.annotation.**
-dontwarn org.conscrypt.**
# A resource is loaded with a relative path so the package of this class must be preserved.
-keepnames class okhttp3.internal.publicsuffix.PublicSuffixDatabase

# CBL2.x
-keep class com.couchbase.litecore.**{ *; }
-keep class com.couchbase.lite.**{ *; }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. from version 2.0
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span> 2021 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../_/js/vendor/fontawesome.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
