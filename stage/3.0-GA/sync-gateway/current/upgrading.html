<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Upgrading Sync Gateway | Couchbase Docs</title>
<link rel="canonical" href="https://ibsoln.github.io/stage/3.0-GA/sync-gateway/current/upgrading.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<meta name="description" content="This page documents various implementation details and functionalities to consider when performing an upgrade to Sync Gateway 3.0.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="sync-gateway">
<meta name="dcterms.identifier" content="3.0">
<meta name="page-url" content="/sync-gateway/current/upgrading.html">
<meta name="generator" content="Antora 3.0.0-alpha.5">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://ibsoln.github.io/stage/3.0-GA/home/index.html">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://ibsoln.github.io/stage/3.0-GA/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile Stage
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../tutorials/index.html">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a href="https://cloud.couchbase.com/sign-up" class="free-trial-link" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  <i class="fas fa-cloud"></i>
                  Free Trial
                </a>
                <a class="btn btn-primary try-btn"  onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
<div class="components">
  <div class="components_group-title">
    <a href="../../home/mobile.html">Mobile Stage</a>
  </div>
  <ul class="components_list">
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Couchbase Lite</span>
        <select class="version_list" data-component="couchbase-lite">
          <option value="3.0" data-url="../../couchbase-lite/current/index.html" selected>3.0</option>
        </select>
      </div>
      <div class="version_items hide" data-version="3.0">
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/index.html">Introduction</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/cbl-whatsnew.html">New in 3.0</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/quickstart.html">Android</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/kotlin.html">Kotlin</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Data Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0-{releasetag}/couchbase-lite-android/">API References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0-{releasetag}/couchbase-lite-android-ktx">Kotlin Extensions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/dep-upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/android/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/quickstart.html">C</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/gs-downloads.html">Download</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/c_fleece.html">Fleece API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/field-level-encryption.html">Field Level Encryption</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/replication.html">Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0-{releasetag}/couchbase-lite-c/">API&#160;References</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/c/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/quickstart.html">.Net</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/query-n1ql-mobile-server-diffs.html">N1QL Mobile - Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Data Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0-{releasetag}/couchbase-lite-net/index.html">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/dep-upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/csharp/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/quickstart.html">Java</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Data Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0-{releasetag}/couchbase-lite-java/">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/dep-upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/java/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/quickstart.html">Objective-C</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/landing-replications.html">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0-{releasetag}/couchbase-lite-objc/index.html">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/dep-upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/troubleshooting-crashes.html">Troubleshooting Crashes</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/objc/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/quickstart.html">Swift</a>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/gs-prereqs.html">Prerequisites</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/gs-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/gs-build.html">Build and Run</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/database.html">Databases</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/prebuilt-database.html">Pre-built Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/document.html">Documents</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/blob.html">Blobs</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Queries</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/querybuilder.html">Querybuilder</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/query-n1ql-mobile.html">N1QL for Mobile</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/query-n1ql-mobile-server-diffs.html">N1QL Server Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/query-n1ql-mobile-querybuilder-diffs.html">N1QL Querybuilder Differences</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/query-resultsets.html">Query Resultsets</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/query-live.html">Live Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/query-troubleshooting.html">Query Troubleshooting</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/fts.html">Full Text Search</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="#swift:landing-replications.adoc">Data Sync</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/dbreplica.html">Intra-device Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/replication.html">Remote Sync Gateway</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/p2psync-websocket.html">Peer-to-Peer</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/p2psync-websocket-using-passive.html">Passive Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/p2psync-websocket-using-active.html">Active Peer</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/p2psync-custom.html">Integrate Custom Listener</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/conflict.html">Handling Data Conflicts</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="https://docs.couchbase.com/mobile/3.0.0-{releasetag}/couchbase-lite-swift/index.html">API&#160;References</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/dep-upgrade.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/troubleshooting-logs.html">Using Logs</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/troubleshooting-queries.html">Troubleshooting Queries</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/troubleshooting-crashes.html">Troubleshooting Crashes</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/releasenotes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/compatibility.html">Compatibility</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/swift/supported-os.html">Supported Platforms</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../couchbase-lite/current/javascript.html">JavaScript</a>
  </span>
</li>
</ul>
      </div>
    </li>
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Sync Gateway</span>
        <select class="version_list" data-component="sync-gateway">
          <option value="3.0" data-url="index.html" selected>3.0</option>
        </select>
      </div>
      <div class="version_items hide" data-version="3.0">
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="introduction.html">Introduction</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="whatsnew.html"><strong><em>New in 3.0</em></strong></a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Start Here!</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="index.html">Quick Links</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="get-started-prepare.html">Prepare</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="get-started-install.html">Install</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="get-started-verify-install.html">Verify</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="data-modeling.html">Data Modeling</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Configuration</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="configuration-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="configuration-schema-bootstrap.html">Bootstrap</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="configuration-schema-database.html">Database</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="configuration-schema-db-security.html">Database Security</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="configuration-schema-access-control.html">Access Control</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="configuration-schema-import-filter.html">Import Filter</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="configuration-schema-isgr.html">Inter-Sync&#160;Gateway Replication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="configuration-properties-legacy.html">Legacy Pre-3.0&#160;BETA Configuration</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="configuration-javascript-functions.html">Javascript Functions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="configuration-environment-variables.html">Environment Variables</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Security</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="secure-sgw-access.html">Secure Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="authentication-users.html">User Authentication</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="authentication-certs.html">TLS Cert Authentication</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Access Control</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="access-control-concepts.html">Concepts</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="access-control-model.html">Access Control Model</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="channels.html">Channels</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="roles.html">Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="users.html">Users</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="sync-function.html">Sync Function</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-function-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="sync-function-api.html">API Reference</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-function-api-access-cmd.html">access()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-function-api-channel-cmd.html">channel()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-function-api-expiry-cmd.html">expiry()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-function-api-require-access-cmd.html">requireAccess()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-function-api-require-admin-cmd.html">requireAdmin()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-function-api-require-role-cmd.html">requireRole()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-function-api-require-user-cmd.html">requireUser()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-function-api-role-cmd.html">role()</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-function-api-throw-cmd.html">throw()</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="access-control-how.html">How-to</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="access-control-how-create-users.html">Create Users</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="access-control-how-create-roles.html">Create Roles</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="access-control-how-assign-users-to-roles.html">Assign User to Role</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="access-control-how-control-document-access.html">Control Document Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="access-control-how-verify-access.html">Verify Access</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="access-control-how-use-xattrs-for-access-grants.html">Use XATTRS for Access Grants</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="auto-purge-channel-access-revocation.html">Auto-Purge Channel Access Revocation</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">REST API</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="rest-api-access.html">Secure Access</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="rest-api-admin.html">Admin REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="rest-api-metrics.html">Metrics REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="rest-api.html">Public REST API</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="rest-api-access-rbac-roles.html">RBAC Role - Endpoint Cross-Reference</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Sync</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-with-couchbase-server.html">Sync with Server</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-using-app.html">Sync with Application</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Inter-Sync Gateway Replication</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-inter-syncgateway-overview.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-inter-syncgateway-run.html">Initialize</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-inter-syncgateway-manage.html">Manage</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-inter-syncgateway-monitor.html">Monitor</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sync-inter-syncgateway-conflict-resolution.html">Inter Syncgateway Conflict Resolution</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="delta-sync.html">Delta Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="import-filter.html">Import Filter</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Manage</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="revisions.html">Revisions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="managing-tombstones.html">Tombstones</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="resync.html">Resync</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="stats-monitoring.html">Stats Monitoring</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="database-offline.html">Database Offline</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Logging and Troubleshooting</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="logging.html">Logging</a>
  </span>
</li>
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="sgcollect-info.html">SG Collect Info</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Deploy</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="deployment.html">Overview</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="command-line-options.html">Command Line Options</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="load-balancer.html">Load Balancer</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="os-level-tuning.html">OS Level Tuning</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="webhooks.html">Webhooks</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="changes-feed.html">Changes Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="integrating-external-stores.html">External Stores</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="stats-prometheus.html">Prometheus Feed</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="indexing.html">Indexing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="setting-up-dr-cluster.html">Disaster Recovery</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-current-page" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link is-current-page" href="upgrading.html">Upgrade</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Use Kubernetes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="deploy-cluster-to-kubernetes.html">Deploy</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#couchbase-operator::tutorial-sync-gateway-manage.adoc">Manage a Sync Gateway Cluster</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#couchbase-operator::tutorial-sync-gateway-clients.adoc">Expose Sync Gateway to Couchbase Lite clients</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Server Compatibility</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="server-compatibility-collections.html">Collections</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="server-compatibility-eventing.html">Eventing</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="server-compatibility-transactions.html">Transactions</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="server-compatibility-xdcr.html">XDCR</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Product Notes</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="release-notes.html">Release Notes</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="supported-environments.html">Supported Environments</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="compatibility.html">Compatibility Matrix</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Legacy Features</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="legacy-sg-replicate.html">SG Replicate</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="legacy-sgreplicate-resolving-conflicts.html">SG Replicate - Resolving Conflicts (depr)</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="legacy-logging-pre2-1.html">Legacy Pre-2.1 Logging</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="glossary.html">Glossary</a>
  </span>
</li>
</ul>
      </div>
    </li>
  </ul>
</div>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ianbridge/CouchbaseDocs/bau/sgw/modules/ROOT/pages/upgrading.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="index.html">Sync Gateway</a></li>
<li class="crumb"><a href="upgrading.html">Upgrade</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Upgrading Sync Gateway</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>This page documents various implementation details and functionalities to consider when performing an upgrade to Sync Gateway 3.0.<br></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Related <em>Application Deployment</em> topics: <a href="get-started-prepare.html" class="page">Prepare</a> | <a href="get-started-install.html" class="page">Install</a> | <a href="release-notes.html" class="page">Release Notes</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrade-approaches"><a class="anchor" href="#upgrade-approaches"></a>Upgrade Approaches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A rolling upgrade is the recommended method to upgrade a Sync Gateway cluster.
At a high level, a rolling upgrade consists of the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The load balancer configuration is updated to stop any HTTP traffic going to the node that will be upgraded.</p>
</li>
<li>
<p>The upgrade is performed on the given node</p>
</li>
<li>
<p>The load balancer configuration is updated to re-balance the HTTP traffic across all nodes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Those steps are then repeated for each node in the sync&#160;gateway cluster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrade-to-3-0-beta"><a class="anchor" href="#upgrade-to-3-0-beta"></a>Upgrade to 3.0 BETA</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="using-persistent-configuration"><a class="anchor" href="#using-persistent-configuration"></a>Using Persistent Configuration</h3>
<div class="paragraph">
<p>The use of 3.0 BETA&#8217;s Persistent Configuration feature is strongly recommended.
It is the default operational mode when starting sync&#160;gateway.</p>
</div>
<div class="paragraph">
<p>The feature provides a smooth upgrade path for existing users by automatically converting their existing configuration files to the new persistent configuration format.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">One Way Upgrade</div>
<div class="paragraph">
<p>The migration to 3.0 BETA configuration is a ONE WAY process; to continue using legacy-mode configuration see: <a href="#lbl-3-0-upgrade-opt-out">Continue to use Legacy-mode Configuration File</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just startup a sync&#160;gateway node using your existing configuration properties file.
Sync&#160;Gateway will take the appropriate upgrade path as shown in <a href="#tbl-enhancedcfg">Table 1</a>.</p>
</div>
<div class="paragraph">
<p>Before commencing your upgrade consider your requirements for
<a href="#lbl-3-0-config-grps">Configuration Groups</a>,
<a href="#lbl-3-0-config-tls">Secure Server Connection</a> and
<a href="#lbl-3-0-config-adm">Secure Administration</a>.</p>
</div>
<div class="paragraph">
<p>Also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sync&#160;Gateway must have write access to the directory containing the existing configuration (the one to be converted).
It will be used to backup the existing configuration, and to write the upgraded config.</p>
</li>
<li>
<p>If your existing configuration has multiple databases, all of the <strong>server</strong> fields used to connect to <em>Couchbase Server</em> must match. Whilst the connection credentials used may differ between databases,
Sync&#160;Gateway will only use the first set of credentials for the bootstrap configuration file.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Automatic upgrade cannot be done if you have multiple distinct server fields within the configuration file and you will need to manually create their own bootstrap configuration.
</td>
</tr>
</table>
</div>
<table id="tbl-enhancedcfg" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Upgrade Paths</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Configuration exists in Server bucket&#8201;&#8212;&#8201;a node with this <em>group ID</em> has already started</th>
<th class="tableblock halign-center valign-top">No configuration exists&#8201;&#8212;&#8201;this is first node with this <em>group ID</em> to start</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Sync&#160;gateway ignores the configuration file and uses the configuration associated with the <em>group ID</em> provided (or the default group if no <em>group ID</em> is provided).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Sync&#160;gateway uses the configuration file to derive and persist a configuration for this node.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="lbl-3-0-config-grps"><a class="anchor" href="#lbl-3-0-config-grps"></a>Configuration Groups</h3>
<div class="paragraph">
<p>Before commencing your upgrade consider your requirements for grouping sync&#160;gateway nodes within your sync&#160;gateway cluster&#8201;&#8212;&#8201;see: <a href="configuration-overview.html#lbl-config-grp" class="page">Configuration Groups</a></p>
</div>
<div class="paragraph">
<p>If you want the sync&#160;gateway to associate with a specific configuration group Id, you must add the <code>bootstrap_group_id</code> value to the configuration file prior to startup&#8201;&#8212;&#8201;see: <a href="configuration-schema-bootstrap.html#bootstrap-group_id" class="page">bootstrap.group_id</a></p>
</div>
<div class="paragraph">
<p>Failing to do so may result in the configuration being overridden by one configured on a different sync&#160;gateway node that has already started and registered its own configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-3-0-config-tls"><a class="anchor" href="#lbl-3-0-config-tls"></a>Secure Server Connection</h3>
<div class="paragraph">
<p>Secure TLS Connection to Couchbase Server is enabled out-of-the-box in 3.0 BETA.</p>
</div>
<div class="paragraph">
<p>If you wish to use non-secure connection, perhaps in a test environment, you need to run sync&#160;gateway with
<a href="configuration-schema-bootstrap.html#bootstrap-use_tls_server" class="page">bootstrap.use_tls_server</a> set to <code>false</code>&#8201;&#8212;&#8201;see: <a href="secure-sgw-access.html" class="page">Secure Sync Gateway Access</a></p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-3-0-config-adm"><a class="anchor" href="#lbl-3-0-config-adm"></a>Secure Administration</h3>
<div class="paragraph">
<p>Secure Administration is under-pinned by the use of Couchbase Server RBAC-users to authenticate and authorize access to Admin (and Metrics) API functionality.
This requires you set-up and configure appropriate users&#8201;&#8212;&#8201;see: <a href="rest-api-access.html" class="page">REST API Access</a>.</p>
</div>
<div class="paragraph">
<p>To opt out of this, you can configure  <a href="configuration-schema-bootstrap.html#api-admin_interface_authentication" class="page">api.api.admin_interface_authentication</a> and-or <a href="configuration-schema-bootstrap.html#api-metrics_interface_authentication" class="page">api.metrics_interface_authentication</a> as <code>false</code></p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-3-0-upgrade-opt-out"><a class="anchor" href="#lbl-3-0-upgrade-opt-out"></a>Continue to use Legacy-mode Configuration File</h3>
<div class="paragraph">
<p>To continue using legacy Pre-3.0 BETA configuration you should start sync&#160;gateway with <a href="configuration-properties-legacy.html#disable_persistent_config" class="page">disable-persistent-config</a> set <code>true</code> either in the configuration file or in <a href="command-line-options.html" class="page">Command Line Options</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="1-x-to-2-x-no-views"><a class="anchor" href="#1-x-to-2-x-no-views"></a>1.x to 2.x No Views</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From: <strong>Sync Gateway 1.x, 2.0</strong><br>
To: <strong>Sync Gateway 2.1+ (<code>use_views: false</code>)</strong><br>
Downtime: No&#8201;&#8212;&#8201;a rolling upgrade<br></p>
</div>
<div class="sect2">
<h3 id="steps"><a class="anchor" href="#steps"></a>Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Upgrade one node in the cluster, and wait for it to be reachable via the REST API (for example, at http://localhost:4985/).</p>
</li>
<li>
<p>Upgrade the rest of the nodes in the cluster.</p>
</li>
<li>
<p>Clean up obsolete views:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Optional</strong> Issue a call to <code>/_post_upgrade?preview=true</code> on any node to preview which design documents will be removed.</p>
</li>
<li>
<p>Issue a call to <code>/post_upgrade</code> to remove the obsolete design documents.
The response should indicate that "sync_gateway" and "sync_housekeeping" were removed.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="upgrade-notes"><a class="anchor" href="#upgrade-notes"></a>Upgrade Notes</h3>
<div class="paragraph">
<p>The upgrade, from using views to using Global Secondary Indexes and N1QL, happens automatically when starting a Sync Gateway 2.1 or above node in a cluster that was previously using views.</p>
</div>
<div class="paragraph">
<p>By default, Sync Gateway requires the Couchbase Server cluster to be running Couchbase Server 5.5, with at least two nodes running the Index and Query Services.
If this is not the case, users must configure the <code>use_views</code> and/or <code>num_index_replicas</code> properties in their Sync Gateway configuration during upgrade.</p>
</div>
<div class="paragraph">
<p>Installation follows the same general approach used in 2.0.
On startup, Sync Gateway will check for the existence of the required indexes, and only attempt to create them if they do not already exist.</p>
</div>
<div class="paragraph">
<p>Then, Sync Gateway will wait until indexes are available before starting to serve requests.</p>
</div>
</div>
<div class="sect2">
<h3 id="tidy-up"><a class="anchor" href="#tidy-up"></a>Tidy-up</h3>
<div class="paragraph">
<p>Sync Gateway 2.1 or above will <strong>not</strong> automatically remove the previously used design documents.</p>
</div>
<div class="paragraph">
<p>Removal of the obsolete design documents is done via a call to the <a href="rest-api-admin.html#/server/post__post_upgrade" class="page">/_post_upgrade</a> endpoint in Sync Gateway&#8217;s Admin REST API.
This endpoint can be run in preview mode (<code>?preview=true</code>) to see which design documents would be removed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="1-x-to-2-x-using-views"><a class="anchor" href="#1-x-to-2-x-using-views"></a>1.x to 2.x Using Views</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From: <strong>Sync Gateway 1.x</strong><br>
To: <strong>Sync Gateway 2.x (<code>use_views: true</code>)</strong><br>
Downtime: No&#8201;&#8212;&#8201;a rolling upgrade</p>
</div>
<div class="sect2">
<h3 id="steps-2"><a class="anchor" href="#steps-2"></a>Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Upgrade one node in the cluster to 2.0, and wait for it to be reachable via the REST API (for example at http://localhost:4985/).</p>
</li>
<li>
<p>Upgrade the rest of the nodes in the cluster.</p>
</li>
<li>
<p>Clean up obsolete views:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Optional</strong> Issue a call to <code>_post_upgrade?preview=true</code> on any node to preview which design documents will be removed.
To upgrade to 2.0, expect to see "sync_gateway" and "sync_housekeeping" listed.</p>
</li>
<li>
<p>Issue a call to <code>_post_upgrade</code> to remove the obsolete design documents.
The response should indicate that "sync_gateway" and "sync_housekeeping" were removed.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="notes"><a class="anchor" href="#notes"></a>Notes</h3>
<div class="paragraph">
<p>In 2.0, Sync Gateway&#8217;s design documents include the version number in the design document name.
In this release for example, the design documents are named <code>_design/sync_gateway_2.0</code> and <code>_design/sync_housekeeping_2.0</code>.</p>
</div>
<div class="paragraph">
<p>On startup, Sync Gateway will check for the existence of these design documents, and only attempt to create them if they do not already exist.
Then, Sync Gateway will wait until views are available and indexed before starting to serve requests.
To evaluate this, Sync Gateway will issue a <code>stale=false&amp;limit=1</code> query against the Sync Gateway views (channels, access and role_access).</p>
</div>
<div class="paragraph">
<p>If the view request exceeds the default timeout of 75s (which would be expected when indexing large buckets), Sync Gateway will log additional messages and retry&#8201;&#8212;&#8201;see <a href="#log-output">[log-output]</a>.</p>
</div>
<div id="lo-output" class="exampleblock">
<div class="title">Example 1. Logging output</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">14:26:41.039-08:00 Design docs for current SG view version (2.0) found.
14:26:41.039-08:00 Verifying view availability for bucket default...
14:26:42.045-08:00 Timeout waiting for view "access" to be ready for bucket "default" - retrying...
14:26:42.045-08:00 Timeout waiting for view "channels" to be ready for bucket "default" - retrying...
14:26:42.045-08:00 Timeout waiting for view "role_access" to be ready for bucket "default" - retrying...
14:26:44.065-08:00 Timeout waiting for view "access" to be ready for bucket "default" - retrying...
14:26:44.065-08:00 Timeout waiting for view "role_access" to be ready for bucket "default" - retrying...
14:26:44.065-08:00 Timeout waiting for view "channels" to be ready for bucket "default" - retrying...
14:26:44.072-08:00 Views ready for bucket default.</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tidy-up-2"><a class="anchor" href="#tidy-up-2"></a>Tidy-up</h3>
<div class="paragraph">
<p>Sync Gateway 2.0 will <strong>not</strong> automatically remove the previous design documents.</p>
</div>
<div class="paragraph">
<p>Removal of the obsolete design documents is done via a call to the new <a href="rest-api-admin.html#/server/post\__post_upgrade" class="page"><code>_post_upgrade</code></a> endpoint in Sync Gateway&#8217;s Admin REST API.
This endpoint can be run in preview mode (<code>?preview=true</code>) to see which design documents would be removed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="1-x-to-1-5"><a class="anchor" href="#1-x-to-1-5"></a>1.x to 1.5</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From: <strong>Sync Gateway 1.1, 1.2, 1.3, 1.4</strong><br>
To:  <strong>Sync Gateway 1.5</strong><br>
Downtime: Possible downtime in a rolling upgrade; follow the steps below to avoid any downtime.</p>
</div>
<div class="sect2">
<h3 id="steps-3"><a class="anchor" href="#steps-3"></a>Steps</h3>

</div>
<div class="sect2">
<h3 id="upgrade-notes-2"><a class="anchor" href="#upgrade-notes-2"></a>Upgrade Notes</h3>
<div class="paragraph">
<p>In this upgrade path, the upgrade process will trigger views in Couchbase Server to be re-indexed.
During the re-indexing, operations that are dependent on those views will not be available.
The main operations relying on views to be indexed are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A user requests data that doesn&#8217;t reside in the <a href="configuration-properties-legacy.html#databases-this_db-cache-channel_cache_max_length" class="page">channel cache</a>.</p>
</li>
<li>
<p>A new channel or role is granted to a user in the <a href="sync-function.html" class="page">Sync Function</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The unavailability of those operations may result in some requests not being processed.
The duration of the downtime will depend on the data set and frequency of replications with mobile clients.
To avoid this downtime, it is possible to pre-build the view index before directing traffic to the upgraded node.</p>
</div>
<div class="paragraph">
<p>Sync Gateway uses Couchbase Server views to index and query documents.
When Sync Gateway starts, it will publish a Design Document which contains the View definitions (map/reduce functions)&#8201;&#8212;&#8201;see <a href="#des-doc">Example 2</a>.</p>
</div>
<div id="des-doc" class="exampleblock">
<div class="title">Example 2. Design Document</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "views":{
      "access":{
         "map":"function (doc, meta) { ... }"
      },
      "channels":{
         "map":"function (doc, meta) { ... }"
      },
      ...
   },
   "index_xattr_on_deleted_docs":true
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="avoiding-downtime"><a class="anchor" href="#avoiding-downtime"></a>Avoiding Downtime</h3>
<div class="paragraph">
<p><strong>Potential Downtime</strong>: Following the Design Document creation, it must run against all the documents in the Couchbase Server bucket to build the index. An index rebuild may also be required during a Sync Gateway upgrade, if the Design Document definition has changed.</p>
</div>
<div class="paragraph">
<p>To avoid this downtime, you can publish the Design Document and build the index before starting Sync Gateway by using the Couchbase Server REST API.
The following curl commands refer to a Sync Gateway 1.3 &#8594; Sync Gateway 1.4 upgrade but they apply to any upgrade of Sync Gateway or Accelerator.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start Sync Gateway 1.4 with Couchbase Server instance that <strong>isn&#8217;t</strong> your production environment.
Then, copy the Design Document to a file with the following.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl localhost:8092/&lt;BUCKET_NAME&gt;/_design/sync_gateway/ &gt; ddoc.json</code></pre>
</div>
</div>
</li>
<li>
<p>Create a Development Design Document on the cluster where Sync Gateway is going to be upgraded from 1.3:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X PUT http://localhost:8092/&lt;BUCKET_NAME&gt;/_design/dev_sync_gateway/ -d @ddoc.json -H "Content-Type: application/json"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should return:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">{"ok":true,"id":"_design/dev_sync_gateway"}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Run a View Query against the Development Design Document.
By default, a Development Design Document will index one vBucket per node, however we can force it to index the whole bucket using the <code>full_set</code> parameter:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl "http://localhost:8092/sync_gateway/_design/dev_sync_gateway/_view/role_access_vbseq?full_set=true&amp;stale=false&amp;limit=1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This may take some time to return, and you can track the index&#8217;s progress in the Couchbase Server UI.
Note that this will consume disk space to build an almost duplicate index until the switch is made.</p>
</div>
</div>
</div>
</li>
<li>
<p>Upgrade Sync Gateway. When Sync Gateway 1.4 starts, it will publish the new Design Document to Couchbase Server.
This will match the Development Design Document we just indexed, so will be available immediately.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="couchbase-server-upgrade-paths"><a class="anchor" href="#couchbase-server-upgrade-paths"></a>Couchbase Server Upgrade Paths</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When upgrading your Couchbase Server from 4.x to 5.x, remember to create a Sync Gateway RBAC user on the server&#8201;&#8212;&#8201;see: <a href="get-started-prepare.html#configure-server.html" class="page">Configure Server for Sync Gateway</a>&#8201;&#8212;&#8201;and to include the user&#8217;s credentials username/password in you Sync-Gateway-Config.json file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All of the different upgrade paths mentioned above assume that you are running a compatible Couchbase Server version&#8201;&#8212;&#8201;see <a href="compatibility.html" class="page">Compatibility Matrix</a>.</p>
</div>
<div class="paragraph">
<p>There are three commonly used upgrade approaches for Couchbase Server.
Depending on the one you choose, there may be additional consideration to keep in mind when using Sync Gateway:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Approach</th>
<th class="tableblock halign-left valign-top">Downtime</th>
<th class="tableblock halign-left valign-top">Additional Machine Requirements</th>
<th class="tableblock halign-left valign-top">Impact when using Sync Gateway</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rolling Online Upgrade</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Low</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Potential transient connection errors:</strong> The Couchbase Server re-balance operations can result in transient connection errors between Couchbase Server and Sync Gateway, which could result in Sync Gateway performance degradation.</p>
</div>
<div class="paragraph">
<p><strong>Potential for unexpected server errors during re-balance:</strong> There is an increased potential to lose in-flight ops during a fail-over.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upgrade Using Inter-Sync Gateway Replication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Small amount during switchover</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High - duplicate entire cluster</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Using an XDCR (Cross Data Center Replication) approach will incur some Sync Gateway downtime, but less than other approaches where Sync Gateway is shutdown during the entire Couchbase Server upgrade.</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to note that the XDCR replication must be a <strong>one way</strong> replication from the existing (source) Couchbase Server cluster to the new (target) Couchbase Server cluster, and that no other writes can happen on the new (target) Couchbase Server cluster other than the writes from the XDCR replication, and no Sync Gateway instances should be configured to use the new (target) Couchbase Server cluster until the last step in the process.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start XDCR to do a one way replication from the existing (source) Couchbase Server cluster to the new (target) Couchbase Server cluster running the newer version.</p>
</li>
<li>
<p>Wait until the target Couchbase Server has caught up to all the writes in the source Couchbase Server cluster.</p>
</li>
<li>
<p>Shutdown Sync Gateway to prevent any new writes from coming in.</p>
</li>
<li>
<p>Wait until the target Couchbase Server has caught up to all the writes in the source Couchbase Server cluster&#8201;&#8212;&#8201;this should happen very quickly, since it will only be the residual writes in transit before the Sync Gateway shutdown.</p>
</li>
<li>
<p>Reconfigure Sync Gateway to point to the target cluster.</p>
</li>
<li>
<p>Restart Sync Gateway.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Caveats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Small amount of downtime during switchover:</strong> Since there may be writes still in transit after Sync Gateway has been shutdown, there will need to be some downtime until the target Couchbase Server cluster is completely caught up.</p>
</li>
<li>
<p><strong>XDCR should be monitored:</strong> Make sure to monitor the XDCR relationship as per <a href="../../server/current/manage/manage-xdcr/xdcr-management-overview.html" class="page">XDCR docs</a>.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Offline Upgrade</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">During entire upgrade</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Take Sync Gateway offline</p>
</li>
<li>
<p>Upgrade Couchbase Server using any of the options mentioned in the <a href="../../server/current/install/upgrade.html" class="page">Upgrading Couchbase Server</a> documentation.</p>
</li>
<li>
<p>Bring Sync Gateway online</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="sg-replicate-to-inter-sync-gateway"><a class="anchor" href="#sg-replicate-to-inter-sync-gateway"></a>SG Replicate to Inter-Sync Gateway</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="out-of-the-box-behavior"><a class="anchor" href="#out-of-the-box-behavior"></a>Out of the box behavior</h3>
<div class="paragraph">
<p>Any <a href="configuration-properties-legacy.html#databases-this_db-replications-this_rep" class="page">replications</a> (<a href="configuration-properties-legacy.html#databases-this_db-replications-this_rep-continuous" class="page">continuous</a> or ad-hoc) pre-configured in the configuration file&#8217;s <a href="configuration-properties-legacy.html#databases" class="page">databases</a> section will run using the SG&#160;Replicate protocol.
This is subject to any compatibility constraints defined in the <a href="compatibility.html" class="page">Compatibility Matrix</a>.</p>
</div>
<div class="paragraph">
<p>Existing replications implementing custom <a href="legacy-sgreplicate-resolving-conflicts.html" class="page">SG-Replicate - Resolving Conflicts (depr)</a> strategies (via the REST endpoint) will continue to function in the same manner as for SG&#160;Replicate replications after upgrade</p>
</div>
</div>
<div class="sect2">
<h3 id="upgrading-existing-replications"><a class="anchor" href="#upgrading-existing-replications"></a>Upgrading existing replications</h3>
<div class="paragraph">
<p>To upgrade existing SG&#160;Replicate replications to Inter-Sync Gateway Replication, reconfigure them using Inter-Sync Gateway Replication&#8217;s <a href="configuration-properties-legacy.html#databases-this_db-replications-this_rep" class="page">replications</a> property in the configuration file or the REST API&#8201;&#8212;&#8201;see <a href="#upgrade-strategies">[upgrade-strategies]</a> for more.</p>
</div>
</div>
<div class="sect2">
<h3 id="post-upgrade-behavior"><a class="anchor" href="#post-upgrade-behavior"></a>Post-upgrade behavior</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">General</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The system supports a rolling upgrade from SG Replicate to inter-Sync Gateway replication.</p>
</li>
<li>
<p>One-shot replications configured at database level will continue as SG Replicate replications.</p>
</li>
<li>
<p>Any configured SG Replicate replications that you want to upgrade to Inter-Sync Gateway must be re-configured using the Inter-Sync Gateway configuration (at database rather than global level) or REST API endpoint (<code>_replication</code>).</p>
</li>
<li>
<p>An pre-2.8 systems using their own custom resolution strategy (via the REST endpoint) will function as they did for SG Replicate replications after upgrading.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Restarting Replications</dt>
<dd>
<p>The <code>replicationId</code> is used to ensure that any replications previously setup with SG&#160;Replicate, automatically restart using inter-Sync Gateway replication.
The restart point will be the last checkpoint used, unless over-ridden.</p>
</dd>
<dt class="hdlist1">Over-riding restart point</dt>
<dd>
<p>To restart a sync from zero: After the upgrade reconfigure the inter-Sync Gateway replication <a href="configuration-properties-legacy.html#databases-this_db-replications-this_rep" class="page">replications</a> to use a different <a href="configuration-properties-legacy.html#databases-this_db-replications-this_rep-replication_id" class="page">replication_id</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="constraints"><a class="anchor" href="#constraints"></a>Constraints</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Minimum Version for Inter-Sync Gateway Replication</dt>
<dd>
<p>In order to support Inter-Sync Gateway Replication, all active nodes in active cluster must be running Sync Gateway 2.8+.</p>
</dd>
<dt class="hdlist1">Replication between two remote databases</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Replication between two remote databases is no longer supported.</p>
</div>
<div class="paragraph">
<p>Sync Gateway will log an error and fail to start if a replication defined at the configuration&#8217;s root level does not involve at least one local database (source or target).</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Pushing to SG Replicate targets</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Push replications do not support SG Replicate targets with <code>"allow_conflicts": false</code> set; the target must use <code>"allow_conflicts": true</code> for a replication to work.</p>
</li>
<li>
<p>Push replications do not use Delta Sync when pushing to a SG Replicate targets</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="upgrade-scenarios"><a class="anchor" href="#upgrade-scenarios"></a>Upgrade Scenarios</h3>
<div class="paragraph">
<p>This section describes recommended upgrade strategies for implementing Inter-Sync Gateway Replication</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sc1">Scenario 1</a>&#8201;&#8212;&#8201;Continue with SG Replicate (no conflict resolution)</p>
</li>
<li>
<p><a href="#sc2">Scenario 2</a>&#8201;&#8212;&#8201;Continue with SG Replicate (custom conflict resolution)</p>
</li>
<li>
<p><a href="#sc3">Scenario 3</a>&#8201;&#8212;&#8201;Change to SGR-Replicate 2.0 (default conflict resolution)</p>
</li>
<li>
<p><a href="#sc4">Scenario 4</a>&#8201;&#8212;&#8201;Change to SGR-Replicate 2.0 (custom conflict resolution)</p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_a-href-sc1-scenario-1-a"></a><a href="#sc1">Scenario 1</a></p>
</li>
<li>
<p><a id="tabset1_a-href-sc2-scenario-2-a"></a><a href="#sc2">Scenario 2</a></p>
</li>
<li>
<p><a id="tabset1_a-href-sc3-scenario-3-a"></a><a href="#sc3">Scenario 3</a></p>
</li>
<li>
<p><a id="tabset1_a-href-sc4-scenario-4-a"></a><a href="#sc4">Scenario 4</a></p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_a-href-sc1-scenario-1-a">
<div id="sc1" class="exampleblock">
<div class="title">Scenario 1. Continue with SG Replicate (no conflict resolution)</div>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">From</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source Cluster&#8201;&#8212;&#8201;Active peer running Sync Gateway 2.x or 1.5 (Pre-Hydrogen)</p>
</li>
<li>
<p>Target Cluster&#8201;&#8212;&#8201;Passive peer running Sync Gateway 2.x or 1.5 (Pre-Hydrogen)</p>
</li>
<li>
<p>Replication - SG Replicate configured in continuous or one-shot mode</p>
</li>
<li>
<p>Conflict resolution&#8201;&#8212;&#8201;Not implemented</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">To</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source Cluster&#8201;&#8212;&#8201;Active node running Sync Gateway 2.8+</p>
</li>
<li>
<p>Target Cluster&#8201;&#8212;&#8201;Passive node running Sync Gateway 2.8+</p>
</li>
<li>
<p>Replication&#8201;&#8212;&#8201;SG&#160;Replicate configured in continuous or one-shot mode</p>
</li>
<li>
<p>Conflict resolution&#8201;&#8212;&#8201;Not implemented</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Strategy</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Upgrade sequence&#8201;&#8212;&#8201;Either cluster can be upgraded first</p>
</li>
<li>
<p>Restart point&#8201;&#8212;&#8201;When the active node restarts it will use SG&#160;Replicate and will continue from where it last left off</p>
</li>
<li>
<p>Upgrade Constraint&#8201;&#8212;&#8201;Replication will be down for the duration of the active node restart</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_a-href-sc2-scenario-2-a">
<div id="sc2" class="exampleblock">
<div class="title">Scenario 2. Continue with SG Replicate (custom conflict resolution)</div>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">From</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source Cluster&#8201;&#8212;&#8201;Active peer running Sync Gateway 2.x or 1.5 (Pre-Hydrogen)</p>
</li>
<li>
<p>Target Cluster&#8201;&#8212;&#8201;Passive peer running Sync Gateway 2.x or 1.5 (Pre-Hydrogen)</p>
</li>
<li>
<p>Replication&#8201;&#8212;&#8201;SG&#160;Replicate configured in continuous or one-shot mode</p>
</li>
<li>
<p>Conflict resolution&#8201;&#8212;&#8201;Custom conflict resolution with <code>allow_conflicts=true</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">To</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source Cluster&#8201;&#8212;&#8201;Active node running Sync Gateway 2.8+</p>
</li>
<li>
<p>Target Cluster&#8201;&#8212;&#8201;Passive node running Sync Gateway 2.8+</p>
</li>
<li>
<p>Replication&#8201;&#8212;&#8201;SG&#160;Replicate configured in continuous or one-shot mode</p>
</li>
<li>
<p>Conflict resolution&#8201;&#8212;&#8201;Custom conflict resolution with <code>allow_conflicts=true</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Strategy</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Upgrade sequence&#8201;&#8212;&#8201;Either cluster can be upgraded first</p>
</li>
<li>
<p>Restart point&#8201;&#8212;&#8201;When the active node restarts it will use SG&#160;Replicate and will continue from where it last left off</p>
</li>
<li>
<p>Conflict Resolution&#8201;&#8212;&#8201;Will continue to be handled by the app</p>
</li>
<li>
<p>Upgrade Constraints</p>
<div class="ulist">
<ul>
<li>
<p>Replication will be down for the duration of the active node restart</p>
</li>
<li>
<p>The <code>allow_conflicts</code> flag is ignored for any inter-Sync Gateway replication replications configured.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_a-href-sc3-scenario-3-a">
<div id="sc3" class="exampleblock">
<div class="title">Scenario 3. Change to SGR-Replicate 2.0 (default conflict resolution)</div>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">From</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source Cluster&#8201;&#8212;&#8201;Active peer running Sync Gateway 2.x or 1.5 (Pre-Hydrogen)</p>
</li>
<li>
<p>Target Cluster&#8201;&#8212;&#8201;Passive peer running Sync Gateway 2.x or 1.5 (Pre-Hydrogen)</p>
</li>
<li>
<p>Replication&#8201;&#8212;&#8201;SG&#160;Replicate configured in continuous or one-shot mode</p>
</li>
<li>
<p>Conflict resolution&#8201;&#8212;&#8201;Not implemented</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">To</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source Cluster&#8201;&#8212;&#8201;Active node running Sync Gateway 2.8+</p>
</li>
<li>
<p>Target Cluster&#8201;&#8212;&#8201;Passive node running Sync Gateway 2.8+</p>
</li>
<li>
<p>Replication&#8201;&#8212;&#8201;Inter-Sync Gateway replication configured in continuous or one-shot mode</p>
</li>
<li>
<p>Conflict resolution&#8201;&#8212;&#8201;Not implemented</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Strategy</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Upgrade sequence</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Stop SG&#160;Replicate replications</p>
</li>
<li>
<p>Upgrade each cluster to Hydrogen.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Restart Outcomes</p>
<div class="ulist">
<ul>
<li>
<p>When The active cluster is restarted it will automatically switch to Inter-Sync Gateway Replication</p>
</li>
<li>
<p>Replication will continue from the last checkpoint, unless over-ridden.</p>
</li>
<li>
<p><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a> The replication will distribute automatically</p>
</li>
</ul>
</div>
</li>
<li>
<p>Conflict resolution&#8201;&#8212;&#8201;Default</p>
</li>
<li>
<p>Upgrade Constraint&#8201;&#8212;&#8201;The <code>allow_conflicts</code> flag is ignored for any inter-Sync Gateway replication replications configured.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_a-href-sc4-scenario-4-a">
<div id="sc4" class="exampleblock">
<div class="title">Scenario 4. {sc4-title}</div>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">From</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source Cluster&#8201;&#8212;&#8201;Active peer running Sync Gateway 2.x or 1.5 (Pre-Hydrogen)</p>
</li>
<li>
<p>Target Cluster&#8201;&#8212;&#8201;Passive peer running Sync Gateway 2.x or 1.5 (Pre-Hydrogen)</p>
</li>
<li>
<p>Replication&#8201;&#8212;&#8201;SG&#160;Replicate configured in continuous or one-shot mode</p>
</li>
<li>
<p>Conflict resolution&#8201;&#8212;&#8201;Custom conflict resolution with <code>allow_conflicts=true</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">To</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Source Cluster&#8201;&#8212;&#8201;Active node running Sync Gateway 2.8+</p>
</li>
<li>
<p>Target Cluster&#8201;&#8212;&#8201;Passive node running Sync Gateway 2.8+</p>
</li>
<li>
<p>Replication&#8201;&#8212;&#8201;inter-Sync Gateway replication configured in continuous or one-shot mode</p>
</li>
<li>
<p>Conflict resolution&#8201;&#8212;&#8201;Apply custom conflict resolution</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Strategy</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Upgrade sequence</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Stop SG&#160;Replicate replications</p>
</li>
<li>
<p>Add the Inter-Sync Gateway replication configuration, including Javascript function as <a href="configuration-properties-legacy.html#databases-this_db-replications-this_rep-custom_conflict_resolver" class="page">custom_conflict_resolver</a></p>
</li>
<li>
<p>Upgrade each cluster to Hydrogen</p>
</li>
</ol>
</div>
</li>
<li>
<p>Restart Outcomes</p>
<div class="ulist">
<ul>
<li>
<p>When the active cluster is restarted it will automatically switch to Inter-Sync Gateway Replication</p>
</li>
<li>
<p>Replication will continue from the last checkpoint, unless over-ridden.</p>
</li>
<li>
<p><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a> The replication will distribute automatically</p>
</li>
</ul>
</div>
</li>
<li>
<p>Conflict resolution&#8201;&#8212;&#8201;Conflicts will be handled by the function  specified as the as <a href="configuration-properties-legacy.html#databases-this_db-replications-this_rep-custom_conflict_resolver" class="page">custom_conflict_resolver</a></p>
</li>
<li>
<p>Upgrade Constraint&#8201;&#8212;&#8201;The <code>allow_conflicts</code> flag is ignored for any inter-Sync Gateway replication replications configured.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="re-using-sg-replicate-checkpoints"><a class="anchor" href="#re-using-sg-replicate-checkpoints"></a>Re-using SG Replicate Checkpoints</h3>
<div class="paragraph">
<p>You are able to use SG Replicate <a href="#refer-sgw-glossary.adoc#checkpoint" class="page unresolved">checkpoint<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> as a starting point for Inter-Sync Gateway replications.
This can save time on larger buckets by avoiding re-processing documents that have previously been replicated.</p>
</div>
<div class="paragraph">
<p>To be eligible for re-use use in this way</p>
</div>
<div class="ulist">
<ul>
<li>
<p>These replication parameters MUST match:</p>
<div class="ulist">
<ul>
<li>
<p>Replication ID</p>
</li>
<li>
<p>Direction (push or pull only)</p>
</li>
<li>
<p>Previous Source/Target URLs match Remote URL</p>
</li>
<li>
<p>Channel filters</p>
</li>
<li>
<p>DocID filters</p>
</li>
</ul>
</div>
</li>
<li>
<p>The new replication must be configured to be unidirectional (there was no bidirectional support prior to 2.8)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="upgrade-steps"><a class="anchor" href="#upgrade-steps"></a>Upgrade Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Have both SG Replicate and Inter-Sync Gateway replications defined in the same config file.</p>
</li>
<li>
<p>Ensure prerequisites from previous slide are fulfilled (matching IDs, params, etc.)</p>
</li>
<li>
<p>On startup, Sync Gateway will determine if replications match, and log:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[DBG] Replicate+: Matched replication IDs for SGR1 checkpoint fallback: &amp;{...}
[INF] Replicate: Got SGR1 checkpoint ID for fallback in replication "repl1-push": b8da8486df3093141f7ed225eb2b2afae88ca9ce</code></pre>
</div>
</div>
</li>
<li>
<p>This prevents the SG Replicate replication from running, even though its configured.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[INF] Replicate: Replication "repl1-push" was upgraded, preventing startup of SG Replicate replication.
[INF] Replicate: Replication "repl1-pull" was upgraded, preventing startup of SG Replicate replication.
[INF] Replicate: Starting sg-replicate replications...</code></pre>
</div>
</div>
</li>
<li>
<p>When the Inter-Sync Gateway replication is assigned (even on a different node), the SG Replicate checkpoint is used if no Inter-Sync Gateway checkpoint can be found. Logs:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[DBG] SGCluster+: Replication repl1-pull is assigned to node debbc9ed92243c01 (local node is debbc9ed92243c01)
[INF] Replicate: Initializing replication repl1-pull
[INF] Replicate: Attempting to fetch SGR1 checkpoint as fallback: 58782a013091ffc0e7e4ae3c4b6abd8baa7149c6
[INF] Replicate: c:repl1-pull-pull using checkpointed seq from SGR1: "3"</code></pre>
</div>
</div>
</li>
<li>
<p>Once the SG Replicate checkpoint is used, it is deleted to ensure it cannot be used as a fallback again in the event Inter-Sync Gateway replication <a href="#refer-sgw-glossary.adoc#checkpoint" class="page unresolved">checkpoints<span class="image"><img src="_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> are removed.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrade-from-views-to-gsi"><a class="anchor" href="#upgrade-from-views-to-gsi"></a>Upgrade from Views to GSI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Prior to 2.1, Sync Gateway used system views for a variety of internal operations, including authentication and replication.
Starting in 2.1, Sync Gateway will use GSI and N1QL to perform those tasks.</p>
</div>
<div class="paragraph">
<p>The upgrade, from using views to using Global Secondary Indexes and N1QL, happens automatically when starting a Sync Gateway 2.1 or above node in a cluster that was previously using views.</p>
</div>
<div class="paragraph">
<p>Use of GSI requires Couchbase Server 5.5, with at least one node running the Query and Index Services.
Users wanting to run Sync Gateway 2.1 or above with an older version of Couchbase Server will need to continue to use views, by setting the <code>use_views</code> property.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrade-to-shared-bucket"><a class="anchor" href="#upgrade-to-shared-bucket"></a>Upgrade to Shared Bucket</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="implementation-notes-for-xattrs"><a class="anchor" href="#implementation-notes-for-xattrs"></a>Implementation notes for XATTRs:</h3>
<div class="paragraph">
<p>Mobile applications require additional metadata in order to manage security and replication. In previous versions of Sync Gateway, this information has always been stored in the document body. Sync Gateway 1.5 utilizes a new feature of Couchbase Server 5.0 called XATTRs (x-attributes) to store that metadata into an external document fragment.</p>
</div>
<div class="paragraph">
<p>Extended attributes (xattrs) are JSON objects that can be associated with Couchbase documents. Each document can be associated with zero or more extended attributes. There are currently three types (user, system, virtual). Mobile Convergence uses a system extended attribute, which has the following characteristics central to convergence:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Shares lifetime with the document metadata - when a document is deleted, system xattrs are preserved with the tombstone.</p>
</li>
<li>
<p>Allocated 1MB of storage, independent of the 20MB available for the document</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Extended attributes are stored as part of the document, and are replicated with the document (both intra-cluster replication and XDCR).</p>
</div>
<div class="paragraph">
<p>Extended attributes can be accessed via the SDKs using the sub-document API, via command-line tools, and via views.</p>
</div>
<div class="paragraph">
<p>They are also accessible from N1QL in Couchbase Server 5.5 or above with the <code>().xattrs</code> property. For example, <code>SELECT meta().xattrs._sync from travel-sample where Meta().id = "user::demo";</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The sync metadata is maintained internally by Sync Gateway and its structure can change at any time. It should not be used to drive business logic of applications. The direct use of the N1QL query is unsupported and must not be used in production environments.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="rest-api-admin.html#/document/get<em>db</em><em>raw__doc</em>" class="page">raw</a>
 endpoint on Sync Gateway&#8217;s Admin REST API returns both the document and its associated mobile metadata.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration-changes"><a class="anchor" href="#configuration-changes"></a>Configuration Changes</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Sync Gateway 1.5 or above</strong>
<code>shared_bucket_access: false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Sync Gateway 1.5 or above</strong>
<code>shared_bucket_access: true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p>After restarting Sync Gateway with the updated configuration file, the mobile metadata for existing documents is automatically migrated.
To enable shared bucket on incoming documents, one Sync Gateway node in the cluster must also have the <code>import_docs: continuous</code> property in the configuration file.</p>
</div>
<div class="paragraph">
<p>Enabling shared bucket access on your existing deployment is <strong>not</strong> reversible.
It is recommended to test the upgrade on a staging environment before upgrading the production environment.</p>
</div>
<div class="paragraph">
<p>The known issue <a href="release-notes.html#2-5-0" class="page">CBG-394</a>, means that the upgrade will <strong>require downtime</strong> when enabling shared bucket access on an existing deployment that is running with GSI indexing. This is to allow all documents to migrate, using index-based data requests whilst migration is in progress could result in an incomplete data set being returned (containing only those docs migrated at the time of the request). You are advised to schedule a maintenance window to allow time for migration to complete.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Sync Gateway 2.1 or above</strong>
<code>num_index_replicas: 1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Sync Gateway 2.1 or above</strong>
<code>num_index_replicas: 2</code> (or n)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">After restarting Sync Gateway with the updated configuration file, the number of Index Replicas in the Couchbase Server cluster is automatically updated.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-from-bucket-shadowing"><a class="anchor" href="#migrating-from-bucket-shadowing"></a>Migrating from Bucket Shadowing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As of Sync Gateway 1.5, the Bucket Shadowing feature is deprecated and no longer supported.
The following steps outline a recommended method for migrating from Bucket Shadowing to the latest version with interoperability between Couchbase Server SDKs and Couchbase Mobile.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the recommendations in the <a href="#server:install:upgrade-online.adoc" class="page unresolved">Couchbase Server documentation</a> to upgrade all instances to 5.0.</p>
</li>
<li>
<p>Create a new bucket on Couchbase Server (<strong>bucket 2</strong>).</p>
</li>
<li>
<p>Install Sync Gateway 1.5 on a separate node with shared access enabled and connect it to the new bucket (<strong>bucket 2</strong>).</p>
</li>
<li>
<p>Setup a <a href="legacy-sg-replicate.html" class="page">push replication</a> from the Sync Gateway instance used for Bucket Shadowing to the Sync Gateway 1.5 instance.</p>
</li>
<li>
<p>Once the replication has completed, test your application is performing as expected.</p>
</li>
<li>
<p>Update the load balancer to direct incoming traffic to the Sync Gateway 1.5 instance when you are ready to upgrade.</p>
</li>
<li>
<p>Delete the first bucket (<strong>bucket 1</strong>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/bucket-shadowing-migration.png" alt="bucket shadowing migration"></span></p>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id=""><a class="anchor" href="#"></a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Getting Started</div>
<ul>
<li>
<p><a href="get-started-prepare.html" class="page">Prepare</a></p>
</li>
<li>
<p><a href="get-started-install.html" class="page">Install</a></p>
</li>
<li>
<p><a href="get-started-verify-install.html" class="page">Verify</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="ulist">
<div class="title">Product Information</div>
<ul>
<li>
<p><a href="release-notes.html" class="page">Release Notes</a></p>
</li>
<li>
<p><a href="compatibility.html" class="page">Compatibility Matrix</a></p>
</li>
<li>
<p><a href="#pn-supported-os.adoc" class="page unresolved">Supported OS</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-4"><a class="anchor" href="#-4"></a></h6>
<div class="paragraph">
<div class="title">Community</div>
<p><a href="https://forums.couchbase.com/c/mobile/14">Mobile Forum</a> |
<a href="https://blog.couchbase.com/category/couchbase-mobile/?ref=blog-menu">Blog</a> |
<a href="https://docs.couchbase.com/tutorials/">Tutorials</a></p>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span> 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../_/js/site.js"></script>
<script defer src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
