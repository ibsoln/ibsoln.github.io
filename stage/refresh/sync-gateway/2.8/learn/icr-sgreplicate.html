<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Inter-Sync Gateway Replication | Couchbase Docs</title>
<link rel="canonical" href="https://ibsoln.github.io/stage/refresh/sync-gateway/2.8/learn/icr-sgreplicate.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Use inter-Sync Gateway replication to keep clusters in different mobile data centers in sync.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="sync-gateway">
<meta name="dcterms.identifier" content="2.8">
<meta name="generator" content="Antora 2.3.3">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">

              <a class="navbar-brand" href="../../..">
                <img src="../../../_/img/couchbase-documentation-logo.svg" alt="Couchbase" />
              </a>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <form class="navbar-item search">
                  <input type="text" placeholder="Search Docs" class="query" id="search-query" />
                  <button type="button" class="search-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </form>
                <div class="parent-site">
                  <a href="https://www.couchbase.com">
                    Couchbase.com
                  </a>
                </div>
                <a class="btn btn-primary try-btn" href="https://www.couchbase.com/downloads">
                  Try Free
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container conceptual">
<nav class="nav">
<div class="left-sidebar-menu">
<div class="version-control-box">
<div class="component-frame">
<div class="frame-icon">
<img src="../../../_/img/server-icon.png" alt="">
</div>
<div class="frame-body">
<h4 class="title"><span class="">Sync Gateway</span></h4>
<a class="frame-link component" href="../index.html"> <span class="version">2.8</span></a>
</div>
</div>
</div>
<div class="nav-menu">
<ul class="nav-list">
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../index.html">Sync Gateway</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../sgw-whatsnew.html">What&#8217;s New</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../introduction.html">Fundamentals</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Key Concepts</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../data-modeling.html">Data Modeling</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="concept-fundamentals-data.html">Documents</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="concept-fundamentals-data-tombstones.html">Tombstones</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../managing-tombstones.html">Tombstones</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="nav-text ">Bare-Bones Config</span>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="nav-text ">Rest API</span>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../start/gs-sgw-prereqs.html">Get Started</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../start/gs-sgw-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../start/gs-sgw-config.html">Verify</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../shared-bucket-access.html">Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../advance/conflict-resolution.html">Conflict Resolution</a>
</span>
</li>
</ul>
</li>
<li class="nav-item is-current-page is-active is-active-depth-2  " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="icr-sgreplicate.html">Inter-Sync Gateway Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="icr-running.html">Initialize</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="icr-admin.html">Manage</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="icr-monitoring.html">Monitor</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="icr-conflict-resolution.html">Enhanced Conflict Resolution</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../security.html">Security</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="authentication.html">Authentication</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Data Access</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="users-and-roles.html">Users</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="read-access.html">Read Access</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="write-access.html">Write Access</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Data Routing</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="sync-gateway-channels.html">Channels</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../advance/adv-sgw-cfg-sync-function.html">Sync Functions</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="defining-sync-functions.html">Sync Functions</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../advance/adv-sgw-cfg-import-filter.html">Import Filters</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../stats-monitoring.html">Monitor</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../sgcollect-info.html">SG Collect</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../advance/logging.html">Logging</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-fundamentals-logging.html">Logging</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../deployment.html">Deploy</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../command-line-options.html">Command-line Options</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../load-balancer.html">Load Balancer</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../os-level-tuning.html">OS-level Tuning</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../database-offline.html">Change Database State</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../advance/adv-rest-api-client.html">REST API Client</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../integrating-external-stores.html">External Stores</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../server-integration.html">Webhooks and Changes Feed</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../indexing.html">Indexing</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../advance/deploy/upgrade.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Kubernetes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../advance/kubernetes/deploy-cluster.html">Deploy</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="#operator::tutorial-sync-gateway-manage.adoc">Manage a Sync Gateway Cluster</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="#operator::tutorial-sync-gateway-clients.adoc">Expose Sync Gateway to Couchbase Lite clients</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Legacy Features</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../resolving-conflicts.html">Conflict Resolution 1.x Clients</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="icr-sgreplicate-sgr1.html">Inter-Sync Gateway Replication pre-2.8</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="logging-legacy-pre2-1.html">Log Rotation pre-2.1</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<span class="nav-text ">Refer</span>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../refer/config-properties.html">Configuration Details</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../refer/rest-api-public.html">Public REST API</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../refer/rest-api-admin.html">Admin REST API</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../refer/rest-api-metrics.html">Metrics REST API</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../refer/refer-sgw-glossary.html">Sync Gateway Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../prodnotes/pn-release-notes.html">Release Notes</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../prodnotes/pn-supported-os.html">Supported OS</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../prodnotes/pn-compatibility.html">Compatibility Matrix</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../../couchbase-lite/2.8/introduction.html">Couchbase Lite</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../../couchbase-lite/2.8/android/quickstart.html">Android (Java)</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../../couchbase-lite/2.8/csharp/quickstart.html">C#</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../../couchbase-lite/2.8/java/quickstart.html">Java</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../../couchbase-lite/2.8/objc/quickstart.html">Objective-C</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../../couchbase-lite/2.8/swift/quickstart.html">Swift</a>
</span>
</li>
</ul>
</li>
</ul>
</div>
<a href="#" class="menu-expand-toggle"> <span>Navigation</span> <i class="fas fa-times-circle"></i> <i class="fas fa-chevron-circle-left"></i></a>
</div></nav>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ianbridge/CouchbaseDocs/bau/sgw/modules/ROOT/pages/learn/icr-sgreplicate.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">Sync Gateway</a></li>
<li class="crumb"><a href="icr-sgreplicate.html">Inter-Sync Gateway Sync</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Inter-Sync Gateway Replication</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Description&#8201;&#8212;&#8201;<em>Use inter-Sync Gateway replication to keep clusters in different mobile data centers in sync.</em><br>
<em>Abstract&#8201;&#8212;&#8201;Inter-Sync Gateway replication supports resilient, secure, scalable bidirectional synchronization of data between cloud and edge data centers. It incorporates content presented under Manage&gt;Replicate&gt;Inter-Sync Gateway to give an integrated view.</em><br>
Related Content&#8201;&#8212;&#8201;<a href="../refer/config-properties.html" class="page">Configuration Details</a> | <a href="../refer/rest-api-admin.html" class="page">Admin REST API</a> | <a href="icr-running.html" class="page">Initialize Inter-Sync Gateway Replications</a></p>
</div>
</blockquote>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Context Clarification</div>
<div class="paragraph">
<p>This content relates only to inter-Sync Gateway replication in Sync Gateway 2.8+.
For documentation on pre-2.8 inter-Sync Gateway replication (also known as SG Replicate)&#8201;&#8212;&#8201;see <a href="icr-sgreplicate-sgr1.html" class="page">Inter-Sync Gateway Replication pre-2.8</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Sync Gateway&#8217;s <em><a href="../refer/refer-sgw-glossary.html#inter-sync-gateway-replication" class="page">Inter-Sync Gateway Replication<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a></em> feature supports <em><a href="../refer/refer-sgw-glossary.html#cloud-to-edge" class="page">cloud-to-edge<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> synchronization</em> use cases, where data changes must be synchronized between a centralized cloud cluster and a large number of edge clusters whilst still enforcing fine grained access control.
This is an increasingly important enterprise-level requirement.</p>
</div>
<div class="paragraph">
<p>In the architecture diagram (<a href="#icr-architecture">Figure 1</a>), the replicator on the active Sync Gateway node ensures that any database changes made to documents in either <a href="../refer/refer-sgw-glossary.html#sync-gateway-database" class="page">Sync Gateway database<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> instance are replicated to the other Sync Gateway instance, in accordance with the replication&#8217;s configuration&#8201;&#8212;&#8201;see <a href="../refer/config-properties.html#databases-this_db-replications-this_rep" class="page">replications</a> for configuration details.</p>
</div>
<div id="icr-architecture" class="imageblock">
<div class="content">
<img src="../_images/icr-replication-overview.svg" alt="icr replication overview">
</div>
<div class="title">Figure 1. Inter-Sync Gateway Replication architecture</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-cases"><a class="anchor" href="#use-cases"></a>Use Cases</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cloud-to-edge-synchronization"><a class="anchor" href="#cloud-to-edge-synchronization"></a>Cloud-to-edge synchronization</h3>
<div class="paragraph">
<p>In this multi-cloud deployment mode large numbers of multiple edge clusters sync with one or more clusters in cloud data centers. Each edge can operate autonomously without network connectivity to the cloud data centers <sup class="footnote" id="_footnote_arch">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>A typical architecture for this use cases is shown in <a href="#icr-cloud-to-edge">Figure 2</a></p>
</div>
<div id="icr-cloud-to-edge" class="imageblock">
<div class="content">
<img src="../_images/icr-cloud-to-edge200712.svg" alt="icr cloud to edge200712" width="600">
</div>
<div class="title">Figure 2. Cloud-to-edge synchronization</div>
</div>
</div>
<div class="sect2">
<h3 id="active-to-active-mobile-synchronization"><a class="anchor" href="#active-to-active-mobile-synchronization"></a>Active-to-active Mobile Synchronization</h3>
<div class="paragraph">
<p>Here edge clusters containing active Sync&#160;Gateway nodes are replicated between geographically separate cloud-based Sync Gateway deployments.
An ideal use-case for inter-Sync&#160;Gateway replication, which was designed to keep clusters in different data centers in sync.</p>
</div>
<div class="paragraph">
<p>The Couchbase Server Cross Data Center Replication API (<a href="#server:manage:manage-xdcr/xdcr-management-overview.adoc" class="page unresolved">XDCR</a>) is similarly used to replicate between Couchbase Server clusters.
<strong>However</strong>, the inter-Sync&#160;Gateway replication feature is specifically designed for Sync Gateway deployments and it <strong>must</strong> be used for replication between clusters containing an <a href="../refer/refer-sgw-glossary.html#active-sgnode" class="page">active Sync Gateway node<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a>.</p>
</div>
<div class="paragraph">
<p>A typical architecture for this use case is shown in <a href="#icr-active-mobile">Figure 3</a></p>
</div>
<div id="icr-active-mobile" class="imageblock">
<div class="content">
<img src="../_images/icr-active-mobile-sync200713.svg" alt="icr active mobile sync200713" width="600">
</div>
<div class="title">Figure 3. Active-to-active mobile synchronization</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replication-characteristics"><a class="anchor" href="#replication-characteristics"></a>Replication Characteristics</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>In this section</em>:  <a href="#context">Context</a>  |  <a href="#protocol">Protocol</a>  |  <a href="#types-of-replication">Types of Replication</a>  |  <a href="#delta-sync">Delta Sync</a>  |  <a href="#directionality">Directionality</a>  |  <a href="#security">Security</a></p>
</div>
<div class="sect2">
<h3 id="context"><a class="anchor" href="#context"></a>Context</h3>
<div class="paragraph">
<p>Sync Gateway supports the ability to run replications between Sync Gateway clusters using a new websockets based protocol, with the <a href="../refer/refer-sgw-glossary.html#active-replicator" class="page">active replicator<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> <a href="../refer/refer-sgw-glossary.html#sync-function" class="page">synchronizing<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> changes between two <a href="../refer/refer-sgw-glossary.html#sync-gateway-database" class="page">Sync Gateway databases<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a>.</p>
</div>
<div class="paragraph">
<p>All replications are based on a <a href="../refer/refer-sgw-glossary.html#replication-definition" class="page">replication definition<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> provided either to the Admin REST API or in Sync Gateway&#8217;s configuration file (JSON).</p>
</div>
<div class="paragraph">
<p>Replications always involve at least one local database.
Sync Gateway does not enable replication between two <em>remote</em> nodes, because replications are defined at database level and so at least one database will be local.</p>
</div>
<div class="paragraph">
<p>All replications take place at the document level (but see also, <a href="#delta-sync">Delta Sync</a>).</p>
</div>
<div class="paragraph">
<p>Sync Gateway nodes can opt-out of participating in the replication process using the database-level parameter <a href="../refer/config-properties.html#databases-this_db-sgreplicate_enabled" class="page">sgreplicate_enabled</a>.</p>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>:  <a href="../refer/config-properties.html#databases" class="page">databases</a>  |  <a href="../refer/config-properties.html#databases-this_db-replications-this_rep" class="page">replications</a>  |  <a href="../refer/config-properties.html#databases-this_db-replications-this_rep-remote" class="page">remote</a> |  <a href="../refer/config-properties.html#databases-this_db-sgreplicate_enabled" class="page">sgreplicate_enabled</a></p>
</div>
</div>
<div class="sect2">
<h3 id="protocol"><a class="anchor" href="#protocol"></a>Protocol</h3>
<div class="paragraph">
<p>Inter-Sync&#160;Gateway replications are based on websockets. This is the exact same protocol that is used for replication with Couchbase Lite 2.x clients.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For users on releases prior to 2.8, SG Replicate provides a HTTP-based replication&#8201;&#8212;&#8201;see the appropriate documentation here&#8201;&#8212;&#8201;<a href="icr-sgreplicate-sgr1.html" class="page">Inter-Sync Gateway Replication pre-2.8</a> (deprecated).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The bi-directional, persistent, nature of websocket connections is ideal for applications such as a <em>continuous</em> Sync Gateway replication, which is constantly waiting-for and synchronizing change events.</p>
</div>
</div>
<div class="sect2">
<h3 id="types-of-replication"><a class="anchor" href="#types-of-replication"></a>Types of Replication</h3>
<div class="paragraph">
<p>Replications are either: <a href="../refer/refer-sgw-glossary.html#adhoc-replication" class="page">adhoc replication<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> (REST API only) or <a href="../refer/refer-sgw-glossary.html#persistent-replication" class="page">persistent replication<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a>.
They can also be configured to run in one of two-modes:
<a href="../refer/refer-sgw-glossary.html#rep-continuous" class="page">continuous<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> or <a href="../refer/refer-sgw-glossary.html#rep-oneshot" class="page">one-shot<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistent</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Persistent replications survive Sync Gateway node restarts and continue running automatically unless configured not to.
They can be configured to run in either <a href="../refer/refer-sgw-glossary.html#rep-continuous" class="page">continuous<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> or <a href="../refer/refer-sgw-glossary.html#rep-oneshot" class="page">one-shot<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> mode.</p>
</div>
</div>
</div>
</li>
<li>
<p>Ad hoc</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Ad hoc replications are transient, existing only for the period of the replication.
They provide a convenient way to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run one off replications (for example, when troubleshooting)</p>
</li>
<li>
<p>Run on-demand replications after Sync Gateway is started.
For instance a replication that needs to be to be run only periodically can be configured as an ad hoc replication by an automated script scheduled to run when needed.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>:  <a href="../refer/config-properties.html#databases-this_db-replications-this_rep" class="page">replications</a>  |  <a href="../refer/config-properties.html#databases-this_db-replications-this_rep-continuous" class="page">continuous</a> |  <a href="../refer/config-properties.html#databases-this_db-replications-this_rep-adhoc" class="page">adhoc</a></p>
</div>
</div>
<div class="sect2">
<h3 id="delta-sync"><a class="anchor" href="#delta-sync"></a>Delta Sync</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This content relates only to <a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With delta-sync enabled on the replication and both databases involved, only the changed data items are transferred.</p>
</div>
<div class="paragraph">
<p>You can configure replications to use delta-sync by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting <code>"enable_delta_sync": true</code> in the <em>replication definition</em></p>
</li>
<li>
<p>Setting <code>"delta-sync": { "enabled": true}</code> on both databases in their respective <em>database definitions</em>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Push replications to pre-2.8 targets do not use Delta Sync
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>:  <a href="../refer/config-properties.html#databases" class="page">databases</a>  |  <a href="../refer/config-properties.html#databases-this_db-replications-this_rep" class="page">replications</a>  |
<a href="../refer/config-properties.html#databases-this_db-delta_sync" class="page">delta_sync</a>  |  <a href="../refer/config-properties.html#databases-this_db-replications-this_rep-enable_delta_sync" class="page">enable_delta_sync</a></p>
</div>
</div>
<div class="sect2">
<h3 id="directionality"><a class="anchor" href="#directionality"></a>Directionality</h3>
<div class="paragraph">
<p>Replications are bi-directional.
You can <em>push</em>, <em>pull</em> or <em>push and pull</em> between the two database endpoints.</p>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>:  <a href="../refer/config-properties.html#databases-this_db-replications-this_rep" class="page">replications</a>  |  <a href="../refer/config-properties.html#databases-this_db-replications-this_rep-direction" class="page">direction</a></p>
</div>
</div>
<div class="sect2">
<h3 id="security"><a class="anchor" href="#security"></a>Security</h3>
<div class="paragraph">
<p>Transport level security is provided for. Use the appropriate prefix in URL (WSS for websockets).</p>
</div>
<div class="sect3">
<h4 id="authentication"><a class="anchor" href="#authentication"></a>Authentication</h4>
<div class="paragraph">
<p>Support for Basic Authentication using username and password credentials is provided</p>
</div>
</div>
<div class="sect3">
<h4 id="access-control"><a class="anchor" href="#access-control"></a>Access Control</h4>
<div class="paragraph">
<p>Data access control is provided by Sync Gateway&#8217;s <a href="../refer/refer-sgw-glossary.html#sync-function" class="page">sync function<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> and the username/password credentials.
All replicated documents pass through this function ensuring that access permissions are adhered to.</p>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>:  <a href="../refer/config-properties.html#databases" class="page">databases</a>  |  <a href="../refer/config-properties.html#databases-this_db-sync" class="page">sync</a><br>
<em>Related how-to</em>: <a href="defining-sync-functions.html" class="page">Defining Sync Functions</a>  |  <a href="../advance/adv-sgw-cfg-sync-function.html" class="page">Use Sync functions?</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="network-resilience"><a class="anchor" href="#network-resilience"></a>Network Resilience</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inter-Sync Gateway replications will automatically attempt to restart whenever the node restarts.</p>
</div>
<div class="paragraph">
<p>Network resiliency is built-in for <em>continuous</em> replications.
They respond to network issues such as lost connections, by applying a <a href="../refer/refer-sgw-glossary.html#persistent-exponential-backoff" class="page">persistent exponential backoff<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> policy to attempt reconnection.</p>
</div>
<div class="paragraph">
<p>The <a href="../refer/config-properties.html#databases-this_db-replications-this_rep-max_backoff_time" class="page">max_backoff_time</a> determines the maximum wait time between retries.
When the limit is reached retries are made every <code>max_backoff_time</code> minutes.
Set <code>"max_backoff_time": 0</code> to prevent indefinite retries. Exponential backoff retries will be attempted for up to 5 minutes and then stop if the connection has not been re-established</p>
</div>
<div class="paragraph">
<p><br>
<em>Related replication definition elements</em>:  <a href="../refer/config-properties.html#databases-this_db-replications-this_rep-max_backoff_time" class="page">max_backoff_time</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="high-availability"><a class="anchor" href="#high-availability"></a>High Availability</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong><em>In this section</em></strong>: <a href="#node-distribution">Node Distribution</a>  | <a href="#configuration-requirements">Configuration Requirements</a>  |  <a href="#expected-failure-behavior">Expected Failure Behavior</a>  |  <a href="#examples-of-expected-behavior">Examples of Expected behavior</a>  |  <a href="#monitoring-node-distribution">Monitoring Node Distribution</a></p>
</div>
<div class="sect2">
<h3 id="overview"><a class="anchor" href="#overview"></a>Overview</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This content relates only to <a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a>
</td>
</tr>
</table>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_enterprise"></a>Enterprise</p>
</li>
<li>
<p><a id="tabset1_community"></a>Community</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_enterprise">
<div class="paragraph">
<p>Inter-Sync Gateway Replication provides built-in High Availability (HA) support.
It uses <em>node distribution</em> to ensure all running replications are uniformly distributed across all available nodes, regardless of their originating node.</p>
</div>
<div class="paragraph">
<p>A replication runs on only one node at any given time.
When a node fails, the system automatically distributes that node&#8217;s replications across any available alternative nodes (providing the replication has been configured on multiple nodes).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To use high-availability, configure the same replication on at least two Sync Gateway nodes.
</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_community">
<div class="paragraph">
<p>Even though automatic node-distribution is not available in <a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a>, you can make your replications more highly-available.</p>
</div>
<div class="paragraph">
<p>Simply define the same replication on multiple nodes. They will then run on each of those nodes.</p>
</div>
<div class="paragraph">
<p>This redundancy provides some resiliency if a node fails.
As, although no automatic distribution of replications is done,if the replication is running on multiple nodes then it will continue running on any surviving nodes.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#examples-of-expected-behavior">Examples of Expected behavior</a> below.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="node-distribution"><a class="anchor" href="#node-distribution"></a>Node Distribution</h3>
<div class="paragraph">
<p>The goal of node distribution is to maintain an optimal balance of replications across the cluster.,with any given replication runs on only one node at any give time.</p>
</div>
<div class="paragraph">
<p>To achieve this Sync Gateway automatically balances, as equally as possible, the number of replications running on each node.</p>
</div>
<div class="paragraph">
<p>Where multiple replications are configured on multiple nodes, Sync Gateway automatically distributes these replications across all the available nodes for which the replications are configured.
It continually monitors and redistributes replications as the number of available nodes and the number of running replications in a cluster changes.</p>
</div>
<div class="paragraph">
<p>The nodes' processing load and bandwidth usage is minimized by ensuring that a replicator runs on only one node at any given time&#8201;&#8212;&#8201;even where it has been configured to run on multiple nodes.
This avoids the redundant exchange of data arising from duplicate replication.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration-requirements"><a class="anchor" href="#configuration-requirements"></a>Configuration Requirements</h3>
<div class="paragraph">
<p>To configure a replication to be highly available, include its database and replication definition in the sync gateway configuration on each node in the cluster that you want to be able to run it.
<em>At least two nodes are required.</em></p>
</div>
<div class="paragraph">
<p>Node distribution will automatically elect an appropriate node to run them on and take care of redistributing them if a node fails.</p>
</div>
<div class="paragraph">
<p><em>Related configuration elements</em>`:  <a href="../refer/config-properties.html" class="page">Configuration Details</a>  |  <a href="../refer/rest-api-admin.html" class="page">Admin REST API</a></p>
</div>
</div>
<div class="sect2">
<h3 id="expected-failure-behavior"><a class="anchor" href="#expected-failure-behavior"></a>Expected Failure Behavior</h3>
<div class="paragraph">
<p>If a node fails, then Sync Gateway will take any replications configured on multiple nodes, redistribute them across all available remaining nodes and restart them.
Node distribution will continually seek to maintain an optimal distribution of replications across available nodes.</p>
</div>
<div class="sect3">
<h4 id="examples-of-expected-behavior"><a class="anchor" href="#examples-of-expected-behavior"></a>Examples of Expected behavior</h4>
<div class="paragraph">
<p>This section provides examples of expected behavior in differing scenarios.
It provides a comparison of how behavior differs between <a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a> and <a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a>.</p>
</div>
<div class="paragraph">
<p>The following scenarios are covered, each involves a sync gateway cluster with multiple nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Homogenous configuration&#8201;&#8212;&#8201;see <a href="#homogenous-config">Example 1</a></p>
</li>
<li>
<p>Homogenous configuration with non-replicating node&#8201;&#8212;&#8201;see <a href="#homogenous-non-rep-node">Example 2</a></p>
</li>
<li>
<p>Heterogenous configuration&#8201;&#8212;&#8201;see <a href="#hetero-config">Example 3</a></p>
</li>
<li>
<p>Adding more nodes&#8201;&#8212;&#8201;see <a href="#adding-more-nodes">Example 4</a></p>
</li>
<li>
<p>Failing node&#8201;&#8212;&#8201;see <a href="#failing-node">Example 5</a></p>
</li>
</ul>
</div>
<div id="homogenous-config" class="exampleblock">
<div class="title">Example 1. Homogenous configuration</div>
<div class="content">
<div class="ulist">
<div class="title">Scenario</div>
<ul>
<li>
<p>The cluster comprises three Sync Gateway nodes</p>
</li>
<li>
<p>The same sync gateway configuration is applied across all nodes</p>
</li>
<li>
<p>All nodes are configured to run <em>Replication Id 1</em></p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a"></a><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></p>
</li>
<li>
<p><a id="tabset2_a-href-https-www-couchbase-com-products-editions-community-edition-a"></a><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a></p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway automatically designates one of the three nodes to run <em>Replication Id 1</em>.</p>
</li>
<li>
<p>If a node goes down, Sync Gateway elects one of the remaining nodes to continue <em>Replication Id 1</em>.</p>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_a-href-https-www-couchbase-com-products-editions-community-edition-a">
<div class="paragraph">
<p>Sync Gateway runs <em>Replication  Id 1</em> on all nodes in the cluster.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="homogenous-non-rep-node" class="exampleblock">
<div class="title">Example 2. Homogenous configuration with non-replicating node</div>
<div class="content">
<div class="ulist">
<div class="title">Scenario</div>
<ul>
<li>
<p>The cluster comprises three Sync Gateway nodes.</p>
</li>
<li>
<p>Each node has the same sync gateway configuration, with one exception. The configuration on <em>Node 3</em> has opted out of replication (<code>sgreplicate_enabled=false</code>)</p>
</li>
<li>
<p>All Three nodes are configured to run <em>Replication Id 1</em>.</p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a"></a><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></p>
</li>
<li>
<p><a id="tabset3_a-href-https-www-couchbase-com-products-editions-community-edition-a"></a><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a></p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway automatically designates either <em>Node 1</em> or <em>Node 2</em> to run the <em>Replication Id 1</em>.</p>
</li>
<li>
<p>If either <em>Node 1</em> or <em>Node 2</em> fails, Sync Gateway elects the non-failing node.</p>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_a-href-https-www-couchbase-com-products-editions-community-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway runs <em>Replication Id 1</em> on all nodes in cluster.</p>
</li>
<li>
<p>The system ignores the opt-out flag (<code>sgreplicate_enabled</code>).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="hetero-config" class="exampleblock">
<div class="title">Example 3. Heterogenous configuration</div>
<div class="content">
<div class="ulist">
<div class="title">Scenario</div>
<ul>
<li>
<p>The cluster comprises three Sync Gateway nodes</p>
</li>
<li>
<p>Both <em>Node 1</em> and <em>Node 2</em> are configured to run <em>Replication Id 1</em></p>
</li>
<li>
<p><em>Node 3</em> is configured to run <em>Replication Id 2</em> but <strong>not</strong> <em>Replication Id 1</em></p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a"></a><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></p>
</li>
<li>
<p><a id="tabset4_a-href-https-www-couchbase-com-products-editions-community-edition-a"></a><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a></p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway automatically distributes <em>Replication Id 1</em> and <em>Replication Id 2</em> so that each runs on <strong>one</strong> of <em>Node 1</em>, <em>Node 2</em> or <em>Node 3</em>, with no node running both replications simultaneously.</p>
</li>
<li>
<p>If any node fails whilst running either replication, Sync Gateway elects a non-failing node to continue that replication on.
Where two nodes remain the node not running a replication will be chosen.</p>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset4_a-href-https-www-couchbase-com-products-editions-community-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway runs <em>Replication  Id1</em> on <em>Node 1</em> and <em>Node 2</em>  in the cluster</p>
</li>
<li>
<p>Sync Gateway runs <em>Replication Id 2</em> on <em>Node 3</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <em>Node 3</em> fails, then <em>Replication Id 2</em> will not be continued on either of the remaining nodes as it is not configured on them</p>
</li>
<li>
<p>Similarly, if either or both of the other nodes (<em>Node 1</em> and <em>Node 2</em>) fails, <em>Node 3</em> will not be a candidate to run the corresponding replication.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="adding-more-nodes" class="exampleblock">
<div class="title">Example 4. Adding more nodes</div>
<div class="content">
<div class="ulist">
<div class="title">Scenario</div>
<ul>
<li>
<p>The cluster comprises a single Sync Gateway node</p>
</li>
<li>
<p><em>Node 1</em> is configured to run <em>Replication Id 1</em> and <em>Replication Id 2</em></p>
</li>
<li>
<p>LATER . . . <em>Node 2</em> is added to the cluster to run <em>Replication Id 1</em> and <em>Replication Id 2</em>.</p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset5_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a"></a><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></p>
</li>
<li>
<p><a id="tabset5_a-href-https-www-couchbase-com-products-editions-community-edition-a"></a><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a></p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset5_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway designates <em>Node 1</em> run both <em>Replication Id 1</em> and <em>Replication Id 2</em></p>
</li>
<li>
<p>LATER . . . when <em>Node 2</em> is added . . .</p>
<div class="ulist">
<ul>
<li>
<p>Sync Gateway select one of the <em>Node 1</em> replications to run on <em>Node 2</em>; let&#8217;s say it chooses <em>Replication Id 2</em></p>
</li>
<li>
<p>Sync Gateway stops <em>Replication Id 2</em> on <em>Node 1</em></p>
</li>
<li>
<p>Sync Gateway starts <em>Replication Id 2</em> on <em>Node 2</em>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset5_a-href-https-www-couchbase-com-products-editions-community-edition-a">
<div class="ulist">
<ul>
<li>
<p>Sync Gateway designates <em>Node 1</em> to run both <em>Replication Id 1</em> and <em>Replication Id 2</em></p>
</li>
<li>
<p>WHEN . . . <em>Node 2</em> is added . . . Sync Gateway  designates it to run both <em>Replication Id 1</em> and <em>Replication Id 2</em></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="failing-node" class="exampleblock">
<div class="title">Example 5. Failing node</div>
<div class="content">
<div class="ulist">
<div class="title">Scenario</div>
<ul>
<li>
<p>The cluster comprises three Sync Gateway nodes with a homogeneous configuration</p>
</li>
<li>
<p>All three nodes are configured to run <em>Replication Id 1</em>, <em>Replication Id 2</em> and <em>Replication Id 3</em></p>
</li>
<li>
<p>LATER . . . <em>Node 3</em> goes down</p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset6_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a"></a><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></p>
</li>
<li>
<p><a id="tabset6_a-href-https-www-couchbase-com-products-editions-community-edition-a"></a><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a></p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset6_a-href-https-www-couchbase-com-products-editions-enterprise-edition-a">
<div class="paragraph">
<p>Sync Gateway automatically distributes the replications, one to each of the nodes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lets assume the following distribution:</p>
<div class="ulist">
<ul>
<li>
<p><em>Node 1</em> runs <em>Replication Id 1</em></p>
</li>
<li>
<p><em>Node 2</em> runs <em>Replication Id 2</em></p>
</li>
<li>
<p><em>Node 3</em> runs <em>Replication Id 3</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>WHEN . . . <em>Node 3</em>  goes down . . . Sync Gateway elects either <em>Node 1</em> or <em>Node 2</em> to continue running <em>Replication Id 3</em></p>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset6_a-href-https-www-couchbase-com-products-editions-community-edition-a">
<div class="paragraph">
<p>Sync Gateway runs all three replications (<em>Replication Id 1</em> , <em>Replication Id 2</em> and <em>Replication Id 3</em>) on all three nodes in the cluster (<em>Node 1</em>, <em>Node 2</em> and <em>Node 3</em>)</p>
</div>
<div class="paragraph">
<p>WHEN . . . <em>Node 3</em> goes down . . . <em>Node 1</em> and <em>Node 2</em> continue to run <em>Replication Id 1</em>, <em>Replication Id 2</em> and <em>Replication Id 3</em></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="monitoring-node-distribution"><a class="anchor" href="#monitoring-node-distribution"></a>Monitoring Node Distribution</h3>
<div class="paragraph">
<p>Use the <em>_replicationStatus</em> endpoint to access information about which replications are running on which nodes&#8201;&#8212;&#8201;see: <a href="../refer/rest-api-admin.html#/replication/get__db___replicationStatus__replicationID_" class="page">_replicationStatus(replicationID)</a>
  |  <a href="../refer/rest-api-admin.html#/replication/put__db___replicationStatus__replicationID__action__action_" class="page">_replicationStatus(replicationID)?action=&#123;action&#125;</a></p>
</div>
<div class="paragraph">
<p>This information is also collected and available in the log files.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conflict-resolution"><a class="anchor" href="#conflict-resolution"></a>Conflict Resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong><em>In this Section</em></strong>: <a href="#automatic-conflict-resolution">Automatic Conflict Resolution</a>  |  <a href="#how-resolution-works">How Resolution Works</a>  |  <a href="#configure-conflict-resolution">Configure Conflict Resolution</a>  |  <a href="#build-a-conflict-resolution-policy-ee">Build a Conflict Resolution Policy [EE]</a></p>
</div>
<div class="sect2">
<h3 id="automatic-conflict-resolution"><a class="anchor" href="#automatic-conflict-resolution"></a>Automatic Conflict Resolution</h3>
<div class="paragraph">
<p>Inter-Sync Gateway replication supports automatic conflict resolution to resolve conflicting document changes.</p>
</div>
<div class="paragraph">
<p>It delivers this by applying one of its built-in <a href="../refer/refer-sgw-glossary.html#conflict-resolver-policies" class="page">conflict resolver policies<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a>, which can be easily included in your own replications.</p>
</div>
<div class="paragraph">
<p>The goal of automatic conflict resoluton is to return a winning revision based on the consistent application of the configured  <a href="../refer/refer-sgw-glossary.html#conflict-resolver-policies" class="page">conflict resolver policy<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a>.</p>
</div>
<div class="paragraph">
<p>The default <em>conflict resolver policy</em> is to always returns a winner determined by the <a href="../refer/refer-sgw-glossary.html#auto-conflict-resolution-policy" class="page">automatic conflict resolution policy<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a>.</p>
</div>
<div class="paragraph">
<p>For <a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a>, a <a href="#custom-conflict-resolution-ee">Custom Conflict Resolver</a> policy is available, providing additional flexibility by allowing users to provide their own conflict resolution logic.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Conflict Response on Active Replicator</dt>
<dd>
<p>As soon as the <em>active</em> Sync Gateway database detects a conflict in a replicated document revision, it initiates its configured <em>conflict resolver policy</em> to determine a <em>winning</em> revision.
This policy assesses the conflicting revisions and either determines the winning revision or returns an error if it fails while doing so.</p>
</dd>
<dt class="hdlist1">Conflict Response by Passive Replicator</dt>
<dd>
<p>When a passive Sync Gateway database detects a conflict it responds to the active with a <code>409</code> response and rejects the revision.
It is expected that the active Sync Gateway will pull the conflicting revision from the passive, resolve it on the active, and then subsequently push the resolved conflict back up.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="how-resolution-works"><a class="anchor" href="#how-resolution-works"></a>How Resolution Works</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Pull Replications</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For <em>Pull</em> replications the <em>active</em> Sync Gateway is responsible for detecting and resolving conflicts based on the configured <em>conflict_resolution_type</em> &#8201;&#8212;&#8201;see configuration item: <a href="../refer/config-properties.html#databases-this_db-replications-this_rep-conflict_resolution_type" class="page">conflict_resolution_type</a>.</p>
</div>
<div class="paragraph">
<p>This is also how conflicts are handled when Couchbase Lite clients pull down documents to Sync Gateway.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Resolved conflicts are only transferred from active to passive Sync Gateways if a replication is setup between them.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Push Replications</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">Passive Sync Gateway</dt>
<dd>
<p>The <em>passive</em> Sync Gateway will automatically detect and reject conflicting revisions being <em>pushed</em> to it.</p>
<div class="paragraph">
<p>Note that conflicts are not resolved.
The revision is rejected and the document returned&#8201;&#8212;&#8201;with a <code>409 Conflict</code>&#8201;&#8212;&#8201;response to the active Sync Gateway.</p>
</div>
</dd>
<dt class="hdlist1">Active Sync Gateway</dt>
<dd>
<p>It is  the responsibility of the active sync Gateway to address rejected revisions in accordance with its specified <em>conflict_resolution_type</em>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>This approach is the same as that adopted when Couchbase Lite clients push documents to Sync Gateway.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configure-conflict-resolution"><a class="anchor" href="#configure-conflict-resolution"></a>Configure Conflict Resolution</h3>
<div class="paragraph">
<p>Invoke automatic conflict resolution by specifying the required <em>conflict resolver policy</em> in the <a href="../refer/refer-sgw-glossary.html#replication-definition" class="page">replication definition<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a>.
The specified policy is applied whenever a conflict is detected.</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Using automatic conflict resolution</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset7_default"></a>default</p>
</li>
<li>
<p><a id="tabset7_localwins"></a>localWins</p>
</li>
<li>
<p><a id="tabset7_remotewins"></a>remoteWins</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset7_default">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"databases:"
  // other config as necessary
  "this_db:"
    // other config as necessary
    "sgreplicate_enabled": "true",
    "replications": [
        {
          "replication_id": "replication1",
          "direction": "push_and_pull",
          "continuous": true,
          "filter": "sync_gateway/bychannel",
          "query_params": [
              "channel1",
              "channel2"
          ],
          "conflict_resolution_type": "default",
          // other config as necessary
        }
    ]
// other config as necessary</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset7_localwins">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"databases:"
  // other config as necessary
  "this_db:"
    // other config as necessary
    "sgreplicate_enabled": "true",
    "replications": [
        {
          "replication_id": "replication1",
          "direction": "push_and_pull",
          "continuous": true,
          "filter": "sync_gateway/bychannel",
          "query_params": [
              "channel1",
              "channel2"
          ],
          "conflict_resolution_type": "localWins",
          // other config as necessary
        }
    ]
// other config as necessary</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset7_remotewins">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"databases:"
  // other config as necessary
  "this_db:"
    // other config as necessary
    "sgreplicate_enabled": "true",
    "replications": [
        {
          "replication_id": "replication1",
          "direction": "push_and_pull",
          "continuous": true,
          "filter": "sync_gateway/bychannel",
          "query_params": [
              "channel1",
              "channel2"
          ],
          "conflict_resolution_type": "remoteWins",
          // other config as necessary
        }
    ]
// other config as necessary</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build-a-conflict-resolution-policy-ee"><a class="anchor" href="#build-a-conflict-resolution-policy-ee"></a>Build a Conflict Resolution Policy [EE]</h3>
<div class="paragraph">
<p><em>In this section</em>: <a href="#conflict-resolution-approaches">Conflict Resolution Approaches</a>  |  <a href="#approaches-to-error-handling">Approaches to Error Handling</a>  |  <a href="#conflict-resolver-structure">Conflict Resolver Structure</a>  |  <a href="#sample-conflict-resolvers">Example Conflict Resolvers</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This content relates only to <a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="overview-2"><a class="anchor" href="#overview-2"></a>Overview</h3>
<div class="paragraph">
<p>Custom conflict resolution is handled by the <em>active</em> Sync Gateway using a user-provided <a href="../refer/refer-sgw-glossary.html#custom-conflict-resolver" class="page">custom conflict resolver<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a>. This Javascript function is embedded in the replication configuration.</p>
</div>
<div class="paragraph">
<p>The predefined conflict resolver policies are also available as Javascript functions that you can call from within that <em>custom_conflict_resolver</em> function
This is useful when you want to apply greater selectivity to the automatic conflict resolution process. For example, you want to apply a 'remote wins' policy only for a specific type of document - see the 'Use Policies' tab in <a href="#simple-conflict-resolvers">Example 9</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="conflict-resolution-approaches"><a class="anchor" href="#conflict-resolution-approaches"></a>Conflict Resolution Approaches</h3>
<div class="paragraph">
<p>There are two ways to handle conflicts in your custom_conflict_resolver, you can either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Choose a <em>winning</em> revision from among the conflicting revisions (see <a href="#simple-conflict-resolvers">Example 9</a>), or</p>
</li>
<li>
<p>Merge conflicting revision to create a new <em>winning</em> revision; losing revisions are tomb-stoned.</p>
<div class="paragraph">
<p>However, users should avoid overly-complex resolver logic that may impact performance.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="approaches-to-error-handling"><a class="anchor" href="#approaches-to-error-handling"></a>Approaches to Error Handling</h3>
<div class="paragraph">
<p>Your custom conflict resolver function should not terminate the replication when it encounters exceptions or errors.
Instead, you should log sufficient information to aid troubleshooting and recovery.</p>
</div>
<div class="paragraph">
<p>For example, your custom conflict resolver function should:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Skip the document causing the issue</p>
</li>
<li>
<p>Log a suitable warning level message.
Include at least the skipped document&#8217;s Id and the sequence Id of the revision in error.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to log files when troubleshooting conflict resolution errors, to identify the document id and revision sequence in error.</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Some Error Scenarios and Recommended Resolutions</div>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">Unexpected data in the remote document</dt>
<dd>
<p>You should update the remote document to fix the issue.
Doing so will cause replication of the update.</p>
</dd>
<dt class="hdlist1">Unexpected data in the local document</dt>
<dd>
<p>You should update the local document to fix the issue.
This will not trigger a pull-replication.
Do a no-op-update <sup class="footnote" id="_footnote_fn-1">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> of the remote document, which will trigger replication and conflict resolution.</p>
</dd>
<dt class="hdlist1">Fault in conflict resolution javascript function</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Fix the Javascript logic and then either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do a <em>no op update</em> <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> of the remote document.
This triggers a pull replication and subsequent conflict resolution.</p>
</li>
<li>
<p>Reset the replication (using <code>_replicationstatus/reset</code> endpoint). Not recommended as it introduces significant duplicate processing in re-syncing previously synced documents.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="conflict-resolver-structure"><a class="anchor" href="#conflict-resolver-structure"></a>Conflict Resolver Structure</h3>
<div class="paragraph">
<p>This example shows the basic structure of the conflict resolver function as it would be defined in the configuration file.</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. Conflict resolver structure</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/ibsoln/docs-sync-gateway/blob/undefined/modules/ROOT/examples/configuration/sync-gateway-config.json">
"custom_conflict_resolver": "`function(conflict) { <i class="conum" data-value="1"></i><b>(1)</b>
  //  . . .
  //  . . . application logic to determine winner
  //  . . .
  return conflict.LocalDocument;  <i class="conum" data-value="2"></i><b>(2)</b>
}`" <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>conflict</code> structure comprises both conflicting documents.
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">type Conflict struct {
	LocalDocument  Body `json:"LocalDocument"`
	RemoteDocument Body `json:"RemoteDocument"`
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">LocalDocument</dt>
<dd>
<p>This LocalDocument object encapsulates the body and metadata of the local conflicting document revision being replicated. Its content matches the JSON stored at the local Sync Gateway.</p>
</dd>
<dt class="hdlist1">RemoteDocument</dt>
<dd>
<p>The RemoteDocument object, encapsulates the body and metadata of the remote conflicting document revision being replicated. Its content matches the JSON stored at the remote Sync Gateway.</p>
</dd>
</dl>
</div>
</div>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You should return one of:
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>conflict.LocalDocument</p>
</li>
<li>
<p>conflict.RemoteDocument</p>
</li>
<li>
<p>a new document body comprising the merged local and remote documents</p>
</li>
<li>
<p>a <strong>nil</strong> body, which will be resolved as a <strong>delete</strong></p>
</li>
</ul>
</div>
</div>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The conflict resolver function is enclosed by backticks (<code>``</code>)</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sample-conflict-resolvers"><a class="anchor" href="#sample-conflict-resolvers"></a>Sample Conflict Resolvers</h3>
<div id="simple-conflict-resolvers" class="exampleblock">
<div class="title">Example 9. Simple conflict resolvers</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset8_use-built-in-policies"></a>Use Built-in Policies</p>
</li>
<li>
<p><a id="tabset8_nominate-a-winner"></a>Nominate a Winner</p>
</li>
<li>
<p><a id="tabset8_merge-a-winner"></a>Merge a Winner</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset8_use-built-in-policies">
<div class="paragraph">
<p>This example uses the built-in resolver functions to resolve the conflict based-on the document type.</p>
</div>
<div class="paragraph">
<p>So, documents of type <code>a-doc-type-1</code> are always resolved in favor of the remote revision. All other document types are resolved in accordance with the default resolver policy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/ibsoln/docs-sync-gateway/blob/undefined/modules/ROOT/examples/configuration/sync-gateway-config.json">"replications": [
  {
  "replication_id": "replication1",
  // other config as required
  "conflict_resolution_type": "custom",
  "custom_conflict_resolver": `
    function(conflict) {
      if  (conflict.LocalDocument.type == "a-doctype-1") &amp;&amp;
          (conflict.RemoteDocument.type == "a-doctype-1")
       {
         // Invoke the built in default resolver logic
         return defaultPolicy(conflict);
       }
      else {
        // Otherwise resolve in favor of remote document
          return conflict.RemoteDocument;
        }
    }
    `
  // other config as required
  }
]</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset8_nominate-a-winner">
<div class="paragraph">
<p>This example selects a winner based on relative priorities and builds a return response of its own rather than using either the localWins or remoteWins policy, although it does rely on the default resolver policy as a backstop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/ibsoln/docs-sync-gateway/blob/undefined/modules/ROOT/examples/configuration/sync-gateway-config.json">"replications": [
  {
    // . . . preceding replication details as required
  },
  {
    "replication_id": "replication2",
    // . . .   other config as required
    "conflict_resolution_type": "custom",
    "custom_conflict_resolver": `
      function(conflict) {
        // Custom conflict resolution policy based on priority
        if (conflict.LocalDocument.body.priority &gt; conflict.RemoteDocument.body.priority) {
          // Choose a local winner
          // Optionally apply application logic to manipulate
          // the local object before returning it as the winner
          return conflict.LocalDocument;
        } else if (local.body.priority &lt; remote.body.priority) {
            // Choose a remote winner
            // Optionally apply application logic to manipulate
            // the remote object before returning it as the winner
          return conflict.RemoteDocument;
          }; //end if
        } //end func()
        // Apply the default policy as a catch all
        return defaultPolicy(conflict);
    }` // end resolver property
  }, // end replication2
  {
    // . . . further replication details as required
  }
]
// . . .   other config as required</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset8_merge-a-winner">
<div class="paragraph">
<p>This example creates a winner by merging changes from the local and remote documents to create a new document object, which is returned as the winner.</p>
</div>
<div class="paragraph">
<p>If both document.types are non-null and the local document.type is <code>usedefault</code>, the merge path is overridden and the default resolver policy is applied.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/ibsoln/docs-sync-gateway/blob/undefined/modules/ROOT/examples/configuration/sync-gateway-config.json">"custom_conflict_resolver":`
  function(conflict) {
      if (  (conflict.LocalDocument.type != null) &amp;&amp;
            (conflict.RemoteDocument.type != null) &amp;&amp;
            (conflict.LocalDocument.type == "usedefault"))
      {
          console.log("Will use default policy");
          // Resolve using built-in policy
          return defaultPolicy(conflict);
      }
      else
      {
        // Merge local and remote docs
        var remoteDoc = conflict.RemoteDocument;
        console.log("full remoteDoc doc: "+JSON.stringify(remoteDoc));
        var localDoc = conflict.LocalDocument;
        console.log("full localDoc doc: "+JSON.stringify(localDoc));
        var mergedDoc = extend({}, localDoc, remoteDoc);

        console.log("full mergedDoc doc: "+JSON.stringify(mergedDoc));
        // Resolve using this merged doc as the winner
        return mergedDoc;

        function extend(target) {
            var sources = [].slice.call(arguments, 1);
            sources.forEach(function (source) {
                for (var prop in source) {
                    target[prop] = source[prop];
                }
            });
            return target;
        } // end function extend()
      } // end if
  }` // end function()</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replication-initialization"><a class="anchor" href="#replication-initialization"></a>Replication Initialization</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong><em>In this Section</em></strong>: <a href="#replication-definition">Replication Definition</a>  |  <a href="#generic-constraints">Generic Constraints</a>  |  <a href="#running-admin-rest-api-replications">Running Admin REST API Replications</a></p>
</div>
<div class="sect2">
<h3 id="introduction-2"><a class="anchor" href="#introduction-2"></a>Introduction</h3>
<div class="paragraph">
<p>Replications are initialized by submitting a <a href="../refer/refer-sgw-glossary.html#replication-definition" class="page">replication definition<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> using either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A 'JSON' configuration file (<code>sync-gateway-config.json</code>)</p>
</li>
<li>
<p>The Admin REST API, using a utility such as <code>curl</code>, or an application such as <em>Postman</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wherever they are defined, the elements of a replication definition are the same, with the exception of these Admin REST API only elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>adhoc</code>&#8201;&#8212;&#8201;Use this to specify that the replication is ad hoc <sup class="footnote" id="_footnote_fn-restonly">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>.</p>
</li>
<li>
<p><code>cancel</code>&#8201;&#8212;&#8201;Use this to cancel on-going replications <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>.</p>
</li>
</ul>
</div>
<div id="replication-characteristics-highlights" class="exampleblock">
<div class="title">Example 10. Replication Characteristics Highlights</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset9_replication-highlights"></a>Replication highlights</p>
</li>
<li>
<p><a id="tabset9_running-highlights"></a>Running highlights</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset9_replication-highlights">
<div class="ulist">
<ul>
<li>
<p>There are two types of replication: persistent and ad hoc (REST API only).</p>
</li>
<li>
<p>Replications of both types can run in one-shot or continuous replications modes.</p>
</li>
<li>
<p>All replications involve at least one local database.</p>
</li>
<li>
<p>Replications can be configured to purge documents when channel access is revoked (a removal notification is received).</p>
</li>
<li>
<p>Persistent continuous replications can be:</p>
<div class="ulist">
<ul>
<li>
<p>Reset&#8201;&#8212;&#8201;checkpoints can be reset to zero</p>
</li>
<li>
<p>Updated&#8201;&#8212;&#8201;only the parameter values provided in the PUT request body will be updated</p>
</li>
</ul>
</div>
</li>
<li>
<p>Persistent and ad hoc replications can be:</p>
<div class="ulist">
<ul>
<li>
<p>Removed&#8201;&#8212;&#8201;only the replication_id is needed to delete ongoing continuous or one-shot replications.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a> only:</p>
<div class="ulist">
<ul>
<li>
<p>Replications can use delta-sync mode, whereby only the changed data-items are replicated.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset9_running-highlights">
<div class="ulist">
<ul>
<li>
<p>Multiple identical replicators can be initiated on a Sync Gateway node provided each has a unique <code>replication_Id</code>.</p>
</li>
<li>
<p>inter-Sync&#160;Gateway replications introduced in Sync Gateway 2.8 as well as SG-Replicate can run on the same node, but you must ensure that they each have a different <code>replication_id</code>.</p>
</li>
<li>
<p>The user under which replication is being run must have read and write access to the data being replicated.</p>
</li>
<li>
<p>Exponential backoff when connection lost; this can be customized using the <a href="../refer/config-properties.html#databases-this_db-replications-this_rep-max_backoff_time" class="page">max_backoff_time</a> configuration setting.</p>
</li>
<li>
<p>replications will continue trying to connect for 30 minutes following authentication failure (including user-invalid/doesn&#8217;t exist).</p>
</li>
<li>
<p>Running replications can be stopped. Stopped replications can be (re)Started.</p>
</li>
<li>
<p>If ALL the Sync Gateway nodes in a source or target Sync Gateway cluster go down in the middle of continuous replication, by default, the system should pick up from the last document that was successfully processed by both sides when the replication/cluster is restarted</p>
</li>
<li>
<p>REST ONLY</p>
<div class="ulist">
<ul>
<li>
<p>POST databases/&#123;db&#125;/_replication creates a replication using the {rep-id} specified in the body or if none specified, a unique UUID.</p>
</li>
<li>
<p>PUT databases/&#123;db&#125;/_replication/{rep-id} upserts replication {rep-id}.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a> only:</p>
<div class="ulist">
<ul>
<li>
<p>Replications are distributed even across all available Sync Gateway nodes and so are not guaranteed to run on their originating node.</p>
</li>
<li>
<p>If a multi-node Sync Gateway cluster loses a subset of sync gateway nodes, the remaining nodes continue replication uninterrupted IF they have been configured to handle the replication (continuous and one-shot replications).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="replication-definition"><a class="anchor" href="#replication-definition"></a>Replication Definition</h3>
<div class="paragraph">
<p>All replications are 'initialized' by a <a href="../refer/refer-sgw-glossary.html#replication-definition" class="page">replication definition<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> in the configuration file or Admin REST API and operate within the context of a local database.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configured replications use the <code>database.{db-name}.replications</code> property to add a replication definition to a local database.</p>
</li>
<li>
<p>REST API replications specify the local database and replication identity in the API POST/PUT request.
Providing the replication definition parameters in the request body as a JSON string.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both scenarios are covered in <a href="#replication-properties">Example 11</a>.
It summarizes the <a href="../refer/refer-sgw-glossary.html#replication-definition" class="page">replication definition<span class="image"><img src="../_images/icons/glossaryIconImage2.png" alt="glossary icon" width="14"></span></a> elements<sup class="footnote" id="_footnote_fn-repdef-both">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup>, which are covered in more detail in <a href="../refer/config-properties.html" class="page">Configuration Details</a>.</p>
</div>
<div class="sect3">
<h4 id="database-level-settings"><a class="anchor" href="#database-level-settings"></a>Database-level Settings</h4>
<div class="paragraph">
<p>A number of database-level options are also especially relevant to Inter-Sync&#160;Gateway Replication, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../refer/config-properties.html#databases-this_db-sgreplicate_enabled" class="page">sgreplicate_enabled</a>&#8201;&#8212;&#8201;use this <a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a> setting to allow the database to participate in Inter-Sync&#160;Gateway Replications.</p>
</li>
<li>
<p><a href="../refer/config-properties.html#databases-this_db-delta_sync" class="page">delta_sync</a>&#8201;&#8212;&#8201;use this setting to enable delta-sync replication on the database, it must be set if you want to use delta-sync in your <em>replication definition</em>.</p>
</li>
<li>
<p><a href="../refer/config-properties.html#databases-this_db-sgreplicate_websocket_heartbeat_secs" class="page">sgreplicate_websocket_heartbeat_secs</a>&#8201;&#8212;&#8201;use this setting to override the default (5 minute) heartbeat interval for websocket ping frames for this database.</p>
</li>
<li>
<p><a href="../refer/config-properties.html#databases-this_db-sync" class="page">sync</a>&#8201;&#8212;&#8201;use this setting to specify the sync function logic&#8201;&#8212;&#8201;this is an essential part of access-control.</p>
</li>
<li>
<p><a href="../refer/config-properties.html#databases-this_db-unsupported-sgr_tls_skip_verify" class="page">unsupported.sgr_tls_skip_verify</a>&#8201;&#8212;&#8201;use this unsupported option to make development an testing easier by skipping verification of TLS certificates.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="replication-level-settings"><a class="anchor" href="#replication-level-settings"></a>Replication-level Settings</h4>
<div id="replication-properties" class="exampleblock">
<div class="title">Example 11. Replication Definition</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset10_summary-of-parameters"></a>Summary of Parameters</p>
</li>
<li>
<p><a id="tabset10_configured-example"></a>Configured Example</p>
</li>
<li>
<p><a id="tabset10_rest-api-example"></a>REST API Example</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset10_summary-of-parameters">
<div class="paragraph">
<p>This table summarize all the available configurable items. It includes a link to a detailed description of each.</p>
</div>
<table id="replication-definiton-summary" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name and Link</th>
<th class="tableblock halign-left valign-top">Summary</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-adhoc" class="page">adhoc</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>REST API ONLY<br>
Use the Admin REST API&#8217;s <code>adhoc</code> parameter to specify that a replication is ad hoc rather than persistent.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-batch_size" class="page">batch_size</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>batch_size</code> to specify the number of changes to be included in a single batch during replication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-cancel" class="page">cancel</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>REST API ONLY<br>
Use the Admin REST API&#8217;s <code>cancel</code> parameter only when you want to want to cancel an existing active replication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-conflict_resolution_type" class="page">conflict_resolution_type</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>conflict_resolution_type</code> to specify how Sync Gateway should resolve conflicts. By default the automatic conflict resolution policy is applied.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-continuous" class="page">continuous</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>continuous</code> to specify whether this replication will run continuously, or be one-shot.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-custom_conflict_resolver" class="page">custom_conflict_resolver</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>custom_conflict_resolver</code> to provide the Javascript function used to resolve conflicts if <code>"conflict_resolution_type": "custom"</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-direction" class="page">direction</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>direction</code> to specify the replication is <strong>push</strong>, <strong>pull</strong> or <strong>pushAndPull</strong> relative to this node.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-enable_delta_sync" class="page">enable_delta_sync</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>enable_delta_sync</code> to specify use of delta sync for a replication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-filter" class="page">filter</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>filter</code> to specify the name of the function to be used to filter documents.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-max_backoff_time" class="page">max_backoff_time</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>max_backoff_time</code> to specify the number of minutes Sync Gateway will spend trying to reconnect lost or unreachable <code>remote</code> targets.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-purge_on_removal" class="page">purge_on_removal</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>purge_on_removal</code> to specify (per replication) whether removing a <code>channel</code> should trigger a purge.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-query_params" class="page">query_params</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>query_params</code> to specify the key/value pairs to be passed to the filter named in <code>filter</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-remote" class="page">remote</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>remote</code> to specify the database endpoint on the remote Sync Gateway custer.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-replication_id" class="page">replication_id</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>replication_id</code> to specify an identifying name for the replication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="../refer/config-properties.html#databases-this_db-replications-this_rep-initial_state" class="page">initial_state</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use <code>initial_state</code> to specify the state in which to launch the replication.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="tab-pane" aria-labelledby="tabset10_configured-example">
<div class="paragraph">
<p>This is an example of a replication definition. Its purpose is to illustrate all configurable items in use and so should not be considered a working example.</p>
</div>
<div class="paragraph">
<p>It creates a replication with the replication_ID of <code>db1-rep-id1-pull-oneshot</code> on a local database <code>db1-local_</code>, pulling data from a remote database <code>db1-remote</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/ibsoln/docs-sync-gateway/blob/undefined/modules/ROOT/examples/configuration/sync-gateway-config.json#L932-L957">"databases": {
 " db1": {                                                <i class="conum" data-value="1"></i><b>(1)</b>
    "bucket":"db1",
    "server": "couchbase://cb-server",
    // ... other DB config ..
    "sgreplicate_enabled": true,                          <i class="conum" data-value="2"></i><b>(2)</b>
    "replications":
      "db1-rep-id1-pull-oneshot":                         <i class="conum" data-value="3"></i><b>(3)</b>
        "direction": "pull",                              <i class="conum" data-value="4"></i><b>(4)</b>
        "remote": "https://example.com:4984/remote_db1",
        "user": "user1",                                  <i class="conum" data-value="5"></i><b>(5)</b>
        "password": "password",
        "batch_size": 1000,                               <i class="conum" data-value="6"></i><b>(6)</b>
        "conflict_resolution_type": "custom",             <i class="conum" data-value="7"></i><b>(7)</b>
        "custom_conflict_resolver": "",                   <i class="conum" data-value="8"></i><b>(8)</b>
        "continuous": false,                              <i class="conum" data-value="9"></i><b>(9)</b>
        "enable_delta_sync": false,                       <i class="conum" data-value="10"></i><b>(10)</b>
        "filter": "sync_gateway/bychannel",               <i class="conum" data-value="11"></i><b>(11)</b>
        "query_params": ["channel.user1"]                 <i class="conum" data-value="12"></i><b>(12)</b>
        "max_backoff_time": 5,                            <i class="conum" data-value="13"></i><b>(13)</b>
        "purge_on_removal": false                         <i class="conum" data-value="14"></i><b>(14)</b>
        "state": "running"                                <i class="conum" data-value="15"></i><b>(15)</b>
    }
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All replications are defined at database level within the context of a local database (e.g. <code>DB1</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Opt in to replication</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the <code>replication_id</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Pull changes from the <code>remote</code> database at the specified url.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Authenticate with the provided credentials. This user must have read and write access to both the local and remote databases.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Batch together up to 1000 revisions at a time. This improve replication performance but consumes more memory resources.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Apply a custom conflict resolution policy.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Provide a working Javascript function to apply the required resolution policy.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>By setting continuous=false, we are creating a one-shot replication. We could also have omitted this parameter as it defaults to <code>false</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Don&#8217;t use delta-sync; the default behavior.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Filter documents by channel.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Replicate only those documents tagged with the channel names "user1".<br></td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>Wait no more than 5 minutes between retries after network failure; default behavior.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Don&#8217;t purge following removal of a channel; the default behavior.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td>Start the replicator immediately and on Sync Gateway node re(start);. We could also have omitted this parameter as this is the default behavior.</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset10_rest-api-example">
<div class="paragraph">
<p>This is an example of a replication definition as you might submit it to the Admin REST API.using <code>curl</code>.
Its purpose is to illustrate all configurable items in use and so should not be considered a working example.</p>
</div>
<div class="paragraph">
<p>It creates a replication with the replication_ID of <code>db1-rep-id1-pull-oneshot</code> on a local database <code>db1-local_</code>, pulling data from a remote database <code>db1-remote</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request POST 'http://localhost:4985/db1-local/_replication/db1-rep-id1-pull-oneshot' \ <i class="conum" data-value="1"></i><b>(1)</b>
--header 'Content-Type: application/json' \
--dataraw '{
"replication_id": "db1-rep-id1-pull-oneshot" <i class="conum" data-value="2"></i><b>(2)</b>
        "direction": "pull",                              <i class="conum" data-value="3"></i><b>(3)</b>
        "remote": "https://example.com:4984/remote_db1",
        "user": "user1",                                  <i class="conum" data-value="4"></i><b>(4)</b>
        "password": "password",
        "batch_size": 1000,                               <i class="conum" data-value="5"></i><b>(5)</b>
        "conflict_resolution_type": "custom",             <i class="conum" data-value="6"></i><b>(6)</b>
        "custom_conflict_resolver": "",                   <i class="conum" data-value="7"></i><b>(7)</b>
        "continuous": false,                              <i class="conum" data-value="8"></i><b>(8)</b>
        "enable_delta_sync": false,                       <i class="conum" data-value="9"></i><b>(9)</b>
        "filter": "sync_gateway/bychannel",               <i class="conum" data-value="10"></i><b>(10)</b>
        "query_params": ["channel.user1"]                 <i class="conum" data-value="11"></i><b>(11)</b>
        "max_backoff_time": 5,                            <i class="conum" data-value="12"></i><b>(12)</b>
        "purge_on_removal": false                         <i class="conum" data-value="13"></i><b>(13)</b>
        "state": "running"                                <i class="conum" data-value="14"></i><b>(14)</b>
  "adhoc": false, <i class="conum" data-value="15"></i><b>(15)</b>
  "cancel": false <i class="conum" data-value="16"></i><b>(16)</b>
}'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All replications take place at database level and in the context of a local database. Here we are setting the replication in the context of <code>db1-local</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define the <code>replication_id</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Pull changes from the <code>remote</code> database at the specified url.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Authenticate with the provided credentials. This user must have read and write access to both the local and remote databases.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Batch together up to 1000 revisions at a time. This improve replication performance but consumes more memory resources.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Apply a custom conflict resolution policy.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Provide a working Javascript function to apply the required resolution policy.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>By setting continuous=false, we are creating a one-shot replication. We could also have omitted this parameter as it defaults to <code>false</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Don&#8217;t use delta-sync; the default behavior.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Filter documents by channel.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Replicate only those documents tagged with the channel names "user1".<br></td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Wait no more than 5 minutes between retries after network failure; default behavior.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>Don&#8217;t purge following removal of a channel; the default behavior.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Start the replicator immediately and on Sync Gateway node re(start);. We could also have omitted this parameter as this is the default behavior.</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td>Setting <code>adhoc=false</code> marks this as a persistent replication. The definition will survive Sync Gateway node restarts. This the default behaviour if this parameter is omitted.+</td>
</tr>
<tr>
<td><i class="conum" data-value="16"></i><b>16</b></td>
<td>Set <code>cancel=true</code> to cancel an initialized replication; otherwise you can omit this parameter.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generic-constraints"><a class="anchor" href="#generic-constraints"></a>Generic Constraints</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Replication</div>
<div class="paragraph">
<p>All active nodes in an active cluster must be running Sync Gateway version 2.8+.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></dt>
<dd>
<p>All replications are distributed evenly across available nodes. This means they cannot be guaranteed to run on the node from which they originate.</p>
</dd>
<dt class="hdlist1">Access rights</dt>
<dd>
<p>The user running the replication must have read and write access to the data being replicated.
This is not enforced by the system.
Use your <code>sync</code> function to ensure a consistent approach is applied across all clusters.</p>
</dd>
<dt class="hdlist1">Mixing Inter-Sync Gateway Replication Versions</dt>
<dd>
<p>Versions of inter-Sync Gateway replications pre- and post-2.8 can legitimately be in use at the same time, especially during transition.
However, you should avoid initializing identical pre-2.8 (SG Replicate) and 2.8+ replications.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="running-configured-replications"><a class="anchor" href="#running-configured-replications"></a>Running Configured Replications</h3>
<div class="paragraph">
<p>Replications in the configuration file start automatically whenever Sync Gateway is (re)started.
Unless you inhibit this by adding an <code>"initial_state": "stopped"</code> parameter to the replication definition&#8201;&#8212;&#8201;see: <a href="../refer/config-properties.html#databases-this_db-replications-this_rep-initial_state" class="page">initial_state</a>.
You can manually start 'stopped' replication using <a href="icr-admin.html#starting-a-replication" class="page">Starting a replication</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. Configured Replications&#8201;&#8212;&#8201;Continuous and One-shot</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset11_continuous"></a>Continuous</p>
</li>
<li>
<p><a id="tabset11_one-shot"></a>One-shot</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset11_continuous">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/ibsoln/docs-sync-gateway/blob/undefined/modules/ROOT/examples/configuration/sync-gateway-config.json">//  . . . other configuration entries
"db1-rep-id1-pull-cont":
  "replication_id": "db1-rep-id1-pull-cont",
  "direction": "pull",
  "continuous": true <i class="conum" data-value="1"></i><b>(1)</b>
  "purge-on-removal": true,
  "remote": "http://user:password@example.com:4985/db1-remote",
  "filter":"sync_gateway/bychannel",
  "query_params": {
    "channels": ["channel1.user1"]
  }
//  . . . other configuration entries</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Make this a continuous replication that remains running, listening for changes to process.
Because it is also persistent, it will start automatically following Sync Gateway node restarts (<code>state</code> defaults to <code>running</code>).</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset11_one-shot">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/ibsoln/docs-sync-gateway/blob/undefined/modules/ROOT/examples/configuration/sync-gateway-config.json#L874-L883">//. . . other configuration entries
"db1-rep-id3-pull-oneshot":
"replication_id": "db1-rep-id3-pull-oneshot", <i class="conum" data-value="1"></i><b>(1)</b>
"direction": "pull",
"remote": "http://user:password@example.com:4985/db1-remote",
"filter": "sync_gateway/bychannel",
"query_params": { "channels": ["channel1.user1"] }
//  . . . other configuration entries</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This a a one-shot replication because the <code>continuous</code> parameter defaults to <code>false</code>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-admin-rest-api-replications"><a class="anchor" href="#running-admin-rest-api-replications"></a>Running Admin REST API Replications</h3>
<div class="paragraph">
<p>Replications initialized by sending a <code>POST</code>, or <code>PUT</code>, request to the <code>_replication</code> endpoint will start running automatically, unless the <code>"initial_state": "stopped"</code> parameter is specified. with a JSON object defining the replication parameters&#8201;&#8212;&#8201;as shown in  <a href="#submitting-api-requests">Example 13</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can run multiple replications simultaneously with different replication topologies, provided both databases being synchronized have the same sync function.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can submit requests using the <code>curl</code> utility (as in these examples) or an application such as <em>Postman</em>.</p>
</div>
<div id="submitting-api-requests" class="exampleblock">
<div class="title">Example 13. Submitting API Requests</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset12_continuous-pull-replication"></a>Continuous Pull Replication</p>
</li>
<li>
<p><a id="tabset12_one-shot"></a>One-shot</p>
</li>
<li>
<p><a id="tabset12_ad-hoc"></a>Ad-hoc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset12_continuous-pull-replication">
<div class="paragraph">
<p>This example initializes a persistent, continuous, replication between a local database and one on a remote Sync Gateway instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request POST 'http://localhost:4985/db1-local/_replication/' \
--header 'Content-Type: application/json' \
--dataraw '{
  "replication_id": "db1-rep-id1-pull-cont",
  "direction": "pull",
  "continuous": true <i class="conum" data-value="1"></i><b>(1)</b>
  "purge-on-removal": true,
  "remote": "http://user:password@example.com:4985/db1-remote",
  "filter":"sync_gateway/bychannel",
  "query_params": {
    "channels": ["channel1.user1"]
  }
}'</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset12_one-shot">
<div class="paragraph">
<p>This example initializes a persistent, one-shot, replication between a local database and one on a remote Sync Gateway instance.</p>
</div>
<div class="paragraph">
<p>The replication will run once, after a short delay to allow the Rest API to start.
It will then run once after each Sync Gateway restart and-or when manually initiated using the <code>_replicationStatus</code> endpoint&#8201;&#8212;&#8201;see <a href="icr-admin.html" class="page">Manage Inter-Sync Gateway Replications</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request POST 'http://localhost:4985/db1-local/_replication/' \
--header 'Content-Type: application/json' \
--dataraw '{
"replication_id": "db1-rep-id3-pull-oneshot", <i class="conum" data-value="1"></i><b>(1)</b>
"direction": "pull",
"remote": "http://user:password@example.com:4985/db1-remote",
"filter": "sync_gateway/bychannel",
"query_params": { "channels": ["channel1.user1"] }
}'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This a a one-shot replication because the <code>continuous</code> parameter defaults to <code>false</code>.</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset12_ad-hoc">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">curl --location --request POST 'http://localhost:4985/db1-local/_replication/' \
--header 'Content-Type: application/json' \
--dataraw '{
  "replication_id": "db1-rep-id1-pull-adhoc",
  "adhoc": true, <i class="conum" data-value="1"></i><b>(1)</b>
  "direction": "pull",
  "purge-on-removal": true,
  "remote": "http://user:password@example.com:4985/db1-remote",
  "filter":"sync_gateway/bychannel",
  "query_params": {
    "channels": ["channel1.user1"]
  }
}'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Run this replication as an ad hoc one. It will run once only, process all changes but not survive Sync Gateway restarts</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replication-management"><a class="anchor" href="#replication-management"></a>Replication Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong><em>In this Section</em></strong>: <a href="#getting-replication-details">Getting Replication Details</a>  |  <a href="#updating-a-replication">Updating a Replication</a>  |  <a href="#removing-a-replication">Removing a Replication</a></p>
</div>
<div class="sect2">
<h3 id="admin-capabilities"><a class="anchor" href="#admin-capabilities"></a>Admin capabilities</h3>
<div class="paragraph">
<p>The Admin REST API provides two endpoints to assist in the monitoring, administration and management of replications.
These enable users to examine, update, start and stop replications:</p>
</div>
<div class="paragraph">
<p>You can use the endpoints manually or by using automation (for example, scripts or a container orchestration system such as  Kubernetes).</p>
</div>
<div class="paragraph">
<p>The available endpoints used for admin tasks are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>_replication</code>&#8201;&#8212;&#8201;Retrieve, Update or Remove a <em>replication definition</em></p>
</li>
<li>
<p><code>_replicationStatus</code>&#8201;&#8212;&#8201;Stop, Start or Reset a replication</p>
</li>
</ul>
</div>
<div class="admonitionblock tip" style="border-left: 5px solid #0074e0; padding-left: 10px">
<div class="paragraph">
<p><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a> Only</p>
</div>
<div class="paragraph">
<p>This content relates only to <a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></p>
</div>
<div class="paragraph">
<p>Replications always run on the node on which they are configured. Users can only access replications on the node from which they make the request.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-replication-details"><a class="anchor" href="#getting-replication-details"></a>Getting Replication Details</h3>
<div class="paragraph">
<p>You can view the current definition details of a replication.
This includes replications configured in the <code>JSON</code> file and those initialized using the Admin REST API.
You can do this for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Individual replications (<a href="#get-replication-definition">Example 14</a>)</p>
</li>
<li>
<p>All replications defined for a specified database (<a href="#get-replication-definition-all">Example 15</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Replication information is returned a JSON object.</p>
</div>
<div id="get-replication-definition" class="exampleblock">
<div class="title">Example 14. Get a replication definition</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset13_request"></a>Request</p>
</li>
<li>
<p><a id="tabset13_response"></a>Response</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset13_request">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request GET 'http://localhost:4985/db1-local/_replication/db1-rep-id1' \
--header 'Content-Type: application/json' \</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset13_response">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">Success Response::
  Response Status 200 OK
  Payload in body
{
  "db1-rep-id1": {
    "replication_id": "db1-rep-id1",
    "remote": "http://user1:****@example.com:4984/db1-remote",
    "direction": "pull",
    "purge_on_removal": true,
    "continuous": true,
    "filter": "sync_gateway/bychannel",
    "query_params": {
      "channels": [
        "channel.user1"
      ]
    },
    "assigned_node": "1de4994d136b982e"
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following example retrieves definitions for all replications on a specified database, regardless of the node on which it was configured.
The results are returned in an array; one entry per replication.</p>
</div>
<div id="get-replication-definition-all" class="exampleblock">
<div class="title">Example 15. Get all replication definitions (for a database)</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset14_request"></a>Request</p>
</li>
<li>
<p><a id="tabset14_response"></a>Response</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset14_request">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request GET 'http://localhost:4985/db1-local/_replication' \
--header 'Content-Type: application/json' \</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset14_response">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">Success Response::
  Response Status 200 OK
  Payload in body
{
  "db1-rep-id1": {
      "replication_id": "db1-rep-id1",
      "remote": "http://user1:****@example1.com:4984/db1-remote",
      "direction": "pushAndPull",
      "conflict_resolution_type": "remoteWins",
      "purge_on_removal": true,
      "enable_delta_sync": true,
      "initial_state": "stopped",
      "continuous": true,
      "filter": "sync_gateway/bychannel",
      "query_params": {
          "channels": [
              "channel.user1"
          ]
      },
      "batch_size": 1000,
      "assigned_node": "2c9b0d00a4e7c65a"
  },
  "db1-rep-id2": {
      "replication_id": "db1-rep-id2",
      "remote": "http://user1:****@example2.com:4984/db1-remote",
      "direction": "pushAndPull",
      "conflict_resolution_type": "remoteWins",
      "purge_on_removal": true,
      "enable_delta_sync": true,
      "max_backoff_time": 5,
      "initial_state": "running",
      "continuous": true,
      "filter": "sync_gateway/bychannel",
      "query_params": {
          "channels": [
              "channel.user1"
          ]
      },
      "adhoc": true,
      "batch_size": 1000,
      "assigned_node": "2c9b0d00a4e7c65a"
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="updating-a-replication"><a class="anchor" href="#updating-a-replication"></a>Updating a Replication</h3>
<div class="paragraph">
<p>You can update an existing replication&#8217;s definition, whether configured or initialized by Admin Rest API, by providing the details you want to change in an API call  (<a href="#update-replication-definition">Example 16</a>).
Changes will only be made to those parameters provided in the call.</p>
</div>
<div class="paragraph">
<p>If you change the remote URI it must be to a valid URI.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">How do I change an existing replication&#8217;s definition details?</div>
<div class="paragraph">
<p>Send a <code>PUT</code> request to the <code>_replication</code> endpoint.
Specify just the changed items in the JSON body.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="update-replication-definition" class="exampleblock">
<div class="title">Example 16. Update a replication&#8217;s details</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset15_request"></a>Request</p>
</li>
<li>
<p><a id="tabset15_response"></a>Response</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset15_request">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request PUT 'http://localhost:4985/db1-local/_replication/db1-rep-id1 \
--header 'Content-Type: application/json' \
--data-raw '{
  "direction": "push",
  "purge_on_removal":false, // set back to default
  "remote": "http://user1:password1@example.com:4984/db1-remote",
  "filter":"sync_gateway/bychannel",
  "query_params": {
    "channels":["channel.user1"]
  },
  "continuous": false
  }'</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset15_response">
<div class="paragraph">
<p>A successful update will return a 200 response, with the following body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">Success Response::
  Response Status 200 OK
  No payload</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>replication_id</code> in the body does not match that quoted in the URI you will see a 400 response as below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">Bad Request Response::
  Response Status 400 Bad request

{
    "error": "Bad Request",
    "reason": "Replication ID in body \"db1-rep-id1\" does not match request URI"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See: <a href="../refer/rest-api-admin.html" class="page">Admin REST API</a>  |  Endpoint <a href="../refer/rest-api-admin.html#/replication/put__db___replication__replicationID_" class="page">PUT/&#123;url&#125;/&#123;db&#125;/_replication/example-rep-db1</a></p>
</div>
</div>
<div class="sect2">
<h3 id="removing-a-replication"><a class="anchor" href="#removing-a-replication"></a>Removing a Replication</h3>
<div class="paragraph">
<p>Removing a replication will delete:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The persisted replication definition</p>
</li>
<li>
<p>All checkpoints associated with the replication</p>
</li>
<li>
<p>All replication status information associated with the replication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To find the replication_id of an existing replication see <a href="#getting-replication-status-data">Getting Replication Status Data</a>.</p>
</div>
<div class="paragraph">
<p><em>Action</em>: Send a <code>DELETE</code> request to the <code>replication</code> endpoint specifying the replication_id to remove</p>
</div>
<div class="exampleblock">
<div class="title">Example 17. Removing a replication</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset16_request"></a>Request</p>
</li>
<li>
<p><a id="tabset16_response"></a>Response</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset16_request">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request DELETE 'http://localhost:4985/db2-local/_replication/db2-rep-id3' \
--header 'Content-Type: application/json' \</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset16_response">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">Success Response::
  Response Status 200 OK
  No payload</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See: <a href="../refer/rest-api-admin.html" class="page">Admin REST API</a>  |  Endpoint <a href="../refer/rest-api-admin.html#/replication/delete__db___replication__replicationID_" class="page">DELETE/&#123;url&#125;/&#123;db&#125;/_replication/example-rep-db1</a></p>
</div>
</div>
<div class="sect2">
<h3 id="getting-replication-status-data"><a class="anchor" href="#getting-replication-status-data"></a>Getting Replication Status Data</h3>
<div class="paragraph">
<p>Sync Gateway provides easy access to replication status data through the Admin REST API.</p>
</div>
<div class="paragraph">
<p>You can obtain the replication status details for a specific replication, or for all replications across all nodes.
This option can be useful, for example, to find any auto-generated replication_id details needed to enable further replication management activities.</p>
</div>
<div class="admonitionblock tip" style="border-left: 5px solid #0074e0; padding-left: 10px">
<div class="paragraph">
<p><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a> Only</p>
</div>
<div class="paragraph">
<p>Replications always run on the node on which they are configured. Users can only access replications on the node from which they make the request.</p>
</div>
</div>
<div class="paragraph">
<p>For more information on monitoring see: <a href="icr-monitoring.html" class="page">Monitoring Inter-Sync Gateway Replications</a></p>
</div>
<div class="exampleblock">
<div class="title">Example 18. For a Single Replication</div>
<div class="content">
<div class="paragraph">
<p>This example targets a known <code>replication-id</code> and returns its status data.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset17_request"></a>Request</p>
</li>
<li>
<p><a id="tabset17_response"></a>Response</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset17_request">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request GET 'http://localhost:4985/db1/_replicationStatus/db1-rep-id2' \
--header 'Content-Type: application/json' \</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset17_response">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "replication_id": "db1-rep-id2",
    "docs_read": 0,
    "docs_written": 10,
    "doc_write_failures": 0,
    "doc_write_conflict": 0,
    "status": "running",
    "rejected_by_remote": 0,
    "rejected_by_local": 0,
    "last_seq_pull": "8851",
    "last_seq_push": "10402"
}
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 19. For All Replications</div>
<div class="content">
<div class="paragraph">
<p>This example targets all replications across all nodes.
It filters the results using a query string&#8201;&#8212;&#8201;see:
<a href="icr-monitoring.html" class="page">Monitoring Inter-Sync Gateway Replications</a> for more on using this option.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset18_request"></a>Request</p>
</li>
<li>
<p><a id="tabset18_response"></a>Response</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset18_request">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request GET "http://localhost:4985/db1-local/_replicationStatus?activeOnly=false&amp;includeConfig=true&amp;localOnly=false&amp;includeError=true" \ <i class="conum" data-value="1"></i><b>(1)</b>
--header 'Content-Type: application/json' \</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This example&#8217;s criteria selects replications with any status (including errors), on local and remote nodes. The returned status details also include replication definition details.</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset18_response">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "replication_id": "db1-rep-id1-pull",
    "docs_read": 0,
    "docs_written": 0,
    "doc_write_failures": 0,
    "doc_write_conflict": 0,
    "status": "running",
    "rejected_by_remote": 0,
    "rejected_by_local": 0,
    "config": { <i class="conum" data-value="1"></i><b>(1)</b>
        "replication_id": "db1-rep-id1-pull",
        "cancel": true,
        "direction": "pull",
        "purge-on-removal": true,
        "remote": "http://user:****@example.com:4985/db1-remote",
        "filter":"sync_gateway/bychannel",
        "query_params": {
          "channels": ["channel1.user1"]
        },
        "continuous": true
    }
  },
  {
    "replication_id": "db1-rep-id2",
    "docs_read": 0,
    "docs_written": 0,
    "doc_write_failures": 0,
    "doc_write_conflict": 0,
    "status": "stopped",  <i class="conum" data-value="2"></i><b>(2)</b>
    "rejected_by_remote": 0,
    "rejected_by_local": 0,
    "config": {
        "replication_id": "db1-rep-id2",
        "direction": "pull",
        "remote": "http://user:****@example.com:4985/db1-remote",
        "continuous": true
      }
  },
  {
    "replication_id": "db2-rep-id1",
    "docs_read": 0,
    "docs_written": 0,
    "doc_write_failures": 0,
    "doc_write_conflict": 0,
    "status": "error", <i class="conum" data-value="3"></i><b>(3)</b>
    "rejected_by_remote": 0,
    "rejected_by_local": 0,
    "config": {
      "replication_id": "db2-rep-id1",
      "direction": "pull",
      "remote": "http://user:****@example2.com:4985/db2-remote",
      "continuous": true
    }
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The configuration details included because <code>includeConfig=true</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>"Stopped" replications included because <code>activeOnly=false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>"error" replications included because <code>includeError=true</code></td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="starting-a-replication"><a class="anchor" href="#starting-a-replication"></a>Starting a Replication</h3>
<div class="paragraph">
<p>You can start a persistent or ad hoc replication not already in the running state.
You need to specify the <code>replication_id</code>.</p>
</div>
<div class="paragraph">
<p>If the replication is resetting it cannot be started until the reset is complete.</p>
</div>
<div class="paragraph">
<p><em>Action</em>: Send a <code>POST</code> request to the <code>_replicationStatus</code> endpoint with <code>action=start</code></p>
</div>
<div class="exampleblock">
<div class="title">Example 20. Start a replication</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset19_request"></a>Request</p>
</li>
<li>
<p><a id="tabset19_response"></a>Response</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset19_request">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request PUT 'http://localhost:4985/db1-local/_replicationStatus/{{db1-rep-id}}?action=start' \
--header 'Content-Type: application/json' \</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset19_response">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">Success Response::
  Response Status 200 OK
  Payload in body
{
  "replication_id": "db1-rep-id1",
  "docs_read": 0,
  "docs_written": 10,
  "doc_write_failures": 0,
  "doc_write_conflict": 0,
  "status": "running",
  "rejected_by_remote": 0,
  "rejected_by_local": 0,
  "last_seq_pull": "8851",
  "last_seq_push": "10402"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stopping-a-replication"><a class="anchor" href="#stopping-a-replication"></a>Stopping a Replication</h3>
<div class="paragraph">
<p>You can stop a persistent or ad hoc replication not already in the stopped state.
You can use this, for example, to offline an edge cluster without waiting for a long replication to complete.</p>
</div>
<div class="paragraph">
<p><em>Action</em>: Send a <code>POST</code> request to the <code>_replicationStatus</code> endpoint with <code>action=stop</code></p>
</div>
<div class="exampleblock">
<div class="title">Example 21. Stopping replications</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset20_request"></a>Request</p>
</li>
<li>
<p><a id="tabset20_response"></a>Response</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset20_request">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request PUT 'http://localhost:4985/db1-local/_replicationStatus/{{db1-rep-id1}}?action=stop' \
--header 'Content-Type: application/json' \</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset20_response">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">Success Response::
  Response Status 200 OK
  Payload in body
{
  "replication_id": "db1-rep-id1",
  "docs_read": 0,
  "docs_written": 0,
  "doc_write_failures": 0,
  "doc_write_conflict": 0,
  "status": "stopped",
  "rejected_by_remote": 0,
  "rejected_by_local": 0
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resetting-a-replication"><a class="anchor" href="#resetting-a-replication"></a>Resetting a Replication</h3>
<div class="paragraph">
<p>You can reset a persistent replication not in the running state.
This can be useful to escape a system state where one or more documents have failed to sync but where resuming from previous synced checkpoint would skip over those documents.
You need to specify the <code>replication_id</code>.</p>
</div>
<div class="paragraph">
<p>If the replication is resetting it cannot be started until the reset is complete. The replication must be stopped before it can be reset.</p>
</div>
<div class="paragraph">
<p><em>Action</em>: Send a <code>POST</code> request to the <code>_replicationStatus</code> endpoint with <code>action=reset</code></p>
</div>
<div class="exampleblock">
<div class="title">Example 22. Reset a replication</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset21_request"></a>Request</p>
</li>
<li>
<p><a id="tabset21_response"></a>Response</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset21_request">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request PUT 'http://localhost:4985/db1-local/_replicationStatus/{{db1-rep-id2}}?action=reset' \
--header 'Content-Type: application/json' \</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset21_response">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">Success Response::
  Response Status 200 OK
  Payload in body
{
  "replication_id": "db1-rep-id2",
  "docs_read": 0,
  "docs_written": 0,
  "doc_write_failures": 0,
  "doc_write_conflict": 0,
  "status": "stopped",
  "rejected_by_remote": 0,
  "rejected_by_local": 0
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="skipping-tls-certificate-verification"><a class="anchor" href="#skipping-tls-certificate-verification"></a>Skipping TLS Certificate Verification</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Development and Testing Option ONLY</div>
<div class="paragraph">
<p>This is an <strong>unsupported</strong> configuration option. It must not be used in a production environment. Its ongoing availability is not guaranteed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration setting. <code>database.this_db.unsupported.sgr_tls_skip_verify</code>, can be used to skip the validation of TLS certificates, simplifying development and testing&#8201;&#8212;&#8201;see: <a href="#using-sgr-tls-skip-verify">Example 23</a> and the configuration item <a href="../refer/config-properties.html#databases-this_db-unsupported-sgr_tls_skip_verify" class="page">unsupported.sgr_tls_skip_verify</a>.</p>
</div>
<div id="using-sgr-tls-skip-verify" class="exampleblock">
<div class="title">Example 23. Using sgr_tls_skip_verify</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "databases": {
    "db1": {
      "server": "couchbase://localhost",
      "bucket": "db1",
      "username": "Administrator",
      "password": "password",
      "unsupported": {
        "sgr_tls_skip_verify": true
      },
      "replications": {
        "repl1": {
          "direction": "pushAndPull",
          "remote": "https://remotehost:4985/db1",
          "continuous": true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replication-monitoring"><a class="anchor" href="#replication-monitoring"></a>Replication Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong><em>In this Section</em></strong>: <a href="#retrieving-replication-status-data">Retrieving Replication Status Data</a>  |  <a href="#retrieving-sync-gateway-statistics">Retrieving Sync Gateway Statistics</a></p>
</div>
<div class="sect2">
<h3 id="retrieving-replication-status-data"><a class="anchor" href="#retrieving-replication-status-data"></a>Retrieving Replication Status Data</h3>
<div class="paragraph">
<p>Sync Gateway provides easy access to replication status data through the Admin REST API.</p>
</div>
<div class="paragraph">
<p>You can obtain the replication status details for a specific replication, or for all replications across all nodes.
This option can be useful, for example, to find any auto-generated replication_id details needed to enable further replication management activities.</p>
</div>
<div class="admonitionblock tip" style="border-left: 5px solid #0074e0; padding-left: 10px">
<div class="paragraph">
<p><a href="https://www.couchbase.com/products/editions">COMMUNITY EDITION</a> Only</p>
</div>
<div class="paragraph">
<p>Replications always run on the node on which they are configured. Users can only access replications on the node from which they make the request.</p>
</div>
</div>
<div class="sect3">
<h4 id="retrieving-status-data-for-a-specific-replication"><a class="anchor" href="#retrieving-status-data-for-a-specific-replication"></a>Retrieving Status Data for a Specific Replication</h4>
<div class="paragraph">
<p>Use the Admin REST API endpoint <code>replicationStatus</code> to easily access replication status data for a specific replication id.
Status data is returned regardless of the node the replication is running (or ran) on.</p>
</div>
<div class="paragraph">
<p><em>Action</em>: Send a <code>GET</code> request to the <code>_replicationStatus</code> endpoint with the required <code>replication_id</code></p>
</div>
<div class="exampleblock">
<div class="title">Example 24. Get status data for a specified replication</div>
<div class="content">
<div class="paragraph">
<p>This example returns status information for replication id  'db1-rep-id2'.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset22_request"></a>Request</p>
</li>
<li>
<p><a id="tabset22_response"></a>Response</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset22_request">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request GET 'http://localhost:4985/db1/_replicationStatus/db1-rep-id2' \
--header 'Content-Type: application/json' \</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset22_response">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "replication_id": "db1-rep-id2",
    "docs_read": 0,
    "docs_written": 10,
    "doc_write_failures": 0,
    "doc_write_conflict": 0,
    "status": "running",
    "rejected_by_remote": 0,
    "rejected_by_local": 0,
    "last_seq_pull": "8851",
    "last_seq_push": "10402"
}
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="retrieving-status-data-for-all-replications"><a class="anchor" href="#retrieving-status-data-for-all-replications"></a>Retrieving Status Data for All Replications</h4>
<div class="paragraph">
<p>Use the Admin REST API&#8217;s <code>_replicationStatus</code> endpoint to access replication status data for all replications run, or running, on any node within the cluster. The JSON response comprises an array of results, one per replication.</p>
</div>
<div class="paragraph">
<p>You can easily filter the results using the query string: <code>?activeOnly=false&amp;includeConfig=true&amp;localOnly=false&amp;includeError=true`</code></p>
</div>
<div class="paragraph">
<p>Available query string filters comprise:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>activeOnly - return only active replications (default=false)</p>
</li>
<li>
<p>localOnly - return replications from the local node only (default=false)</p>
</li>
<li>
<p>includeError - return replications even if their status is "error" (default=true)</p>
</li>
<li>
<p>includeConfig - return the replication definition details (configuration) as well as the status data.
This will include remote configuration definitions if <code>localOnly=false</code> (default=false)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Action</em>: Send a <code>GET</code> request to the <code>_replicationStatus</code> endpoint with an optional query string</p>
</div>
<div class="exampleblock">
<div class="title">Example 25. Get status data for all replications meeting criteria</div>
<div class="content">
<div class="paragraph">
<p>This example retrieves status data, from across all nodes, for all replications that meet the specified criteria.
The results are returned in an array; one entry per replication.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset23_request"></a>Request</p>
</li>
<li>
<p><a id="tabset23_response"></a>Response</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset23_request">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">curl --location --request GET "http://localhost:4985/db1-local/_replicationStatus?activeOnly=false&amp;includeConfig=true&amp;localOnly=false&amp;includeError=true" \ <i class="conum" data-value="1"></i><b>(1)</b>
--header 'Content-Type: application/json' \</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This example&#8217;s criteria selects replications with any status (including errors), on local and remote nodes. The returned status details also include replication definition details.</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset23_response">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "replication_id": "db1-rep-id1-pull",
    "docs_read": 0,
    "docs_written": 0,
    "doc_write_failures": 0,
    "doc_write_conflict": 0,
    "status": "running",
    "rejected_by_remote": 0,
    "rejected_by_local": 0,
    "config": { <i class="conum" data-value="1"></i><b>(1)</b>
        "replication_id": "db1-rep-id1-pull",
        "cancel": true,
        "direction": "pull",
        "purge-on-removal": true,
        "remote": "http://user:****@example.com:4985/db1-remote",
        "filter":"sync_gateway/bychannel",
        "query_params": {
          "channels": ["channel1.user1"]
        },
        "continuous": true
    }
  },
  {
    "replication_id": "db1-rep-id2",
    "docs_read": 0,
    "docs_written": 0,
    "doc_write_failures": 0,
    "doc_write_conflict": 0,
    "status": "stopped",  <i class="conum" data-value="2"></i><b>(2)</b>
    "rejected_by_remote": 0,
    "rejected_by_local": 0,
    "config": {
        "replication_id": "db1-rep-id2",
        "direction": "pull",
        "remote": "http://user:****@example.com:4985/db1-remote",
        "continuous": true
      }
  },
  {
    "replication_id": "db2-rep-id1",
    "docs_read": 0,
    "docs_written": 0,
    "doc_write_failures": 0,
    "doc_write_conflict": 0,
    "status": "error", <i class="conum" data-value="3"></i><b>(3)</b>
    "rejected_by_remote": 0,
    "rejected_by_local": 0,
    "config": {
      "replication_id": "db2-rep-id1",
      "direction": "pull",
      "remote": "http://user:****@example2.com:4985/db2-remote",
      "continuous": true
    }
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The configuration details included because <code>includeConfig=true</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>"Stopped" replications included because <code>activeOnly=false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>"error" replications included because <code>includeError=true</code></td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="retrieving-sync-gateway-statistics"><a class="anchor" href="#retrieving-sync-gateway-statistics"></a>Retrieving Sync Gateway Statistics</h3>
<div class="paragraph">
<p>Sync Gateway maintains a comprehensive set of metrics covering performance and resource utilization.</p>
</div>
<div class="paragraph">
<p>The statistics schema includes replication metrics collected on a per-replication basis.
These can be especially useful in monitoring the health of Sync Gateway nodes. An increasingly important activity as deployments scale to support cloud-to-edge use cases.</p>
</div>
<div class="paragraph">
<p>Access to this data is provided through the Admin REST API endpoint <code>/_expvars</code>.</p>
</div>
<div class="paragraph">
<p>See: <a href="../stats-monitoring.html" class="page">View Statistics and Metrics</a> for a full description of the available metrics.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id=""><a class="anchor" href="#"></a></h6>
<div class="ulist">
<div class="title">Learn more ...</div>
<ul>
<li>
<p><a href="icr-sgreplicate.html" class="page">Inter-Sync Gateway Replication</a></p>
</li>
<li>
<p><a href="icr-sgreplicate-sgr1.html" class="page">Inter-Sync Gateway Replication pre-2.8</a></p>
</li>
<li>
<p><a href="../shared-bucket-access.html" class="page">Mobile-Server Replication</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Reference material ...</div>
<ul>
<li>
<p><a href="../refer/config-properties.html" class="page">Configuration Details</a></p>
</li>
<li>
<p><a href="../refer/rest-api-public.html" class="page">Public REST API</a></p>
</li>
<li>
<p><a href="../refer/rest-api-admin.html" class="page">Admin REST API</a></p>
</li>
<li>
<p><a href="../refer/rest-api-metrics.html" class="page">Metrics REST API</a></p>
</li>
<li>
<p><a href="../advance/adv-rest-api-client.html" class="page">Use the REST API?</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="ulist">
<div class="title">Community</div>
<ul>
<li>
<p><a href="https://forums.couchbase.com/c/mobile/14">Forum</a>  <strong>|</strong>  <a href="https://blog.couchbase.com/">Blog</a>   <strong>|</strong>  <a href="https://docs.couchbase.com/tutorials/index.html">Tutorials</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Conflict Related Blogs</div>
<ul>
<li>
<p><a href="https://blog.couchbase.com/document-conflicts-couchbase-mobile/">Automatic Conflict Resolution</a></p>
</li>
<li>
<p><a href="https://blog.couchbase.com/conflict-resolution-couchbase-mobile/">Demystifying Conflict Resolution</a></p>
</li>
<li>
<p><a href="https://blog.couchbase.com/tag/conflict-resolution/">Conflict Resolution (category)</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. This architecture is also known as ship-to-shore or hub-and-spoke.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. No-op update&#8201;&#8212;&#8201;refers to a change to the document body that has no impact on the app logic but will trigger an import by the Sync Gateway. One option could be to include a property used specifically for this purpose (i.e. a counter that can be incremented in response to conflict resolver errors).
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. This parameter is not available in the configuration file.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. The definitions apply to configured and API replications).
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase_logo_black.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span> 2020 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../../_/js/vendor/fontawesome.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
