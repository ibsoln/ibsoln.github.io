<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Using the Database | Couchbase Docs</title>
<link rel="canonical" href="http://127.0.0.1:5000/tutorials/todo-app/develop/java/using-the-database.html">
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="tutorials">
<meta name="dcterms.identifier" content="master">
<meta name="page-url" content="/tutorials/todo-app/develop/java/using-the-database.html">
<meta name="generator" content="Antora 3.0.0-alpha.6">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="http://127.0.0.1:5000/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="http://127.0.0.1:5000/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../index.html">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a href="https://cloud.couchbase.com/sign-up" class="free-trial-link" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  <i class="fas fa-cloud"></i>
                  Free Trial
                </a>
                <a class="btn btn-primary try-btn"  onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
<div class="components">
  <div class="components_group-title">
    <a href="../../../index.html">Tutorials</a>
  </div>
  <ul class="components_list">
    <li class="components_list-items">
      <div class="component_list-version">
        <span class="component_list_title">Tutorials</span>
      </div>
      <div class="version_items hide" data-version="master">
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Developer Bootstrap Exercises</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../quick-start/quickstart-docker-image-manual-cb65.html">Couchbase Server Example Configuration</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../quick-start/quickstart-nosdk-webUI-firstquery-cb65.html">SQL JSON Upsert and Lookup via Web UI</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../quick-start/quickstart-java3-native-intellij-firstquery-cb65.html">Java with Couchbase SDK 3 and IntelliJ</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../quick-start/quickstart-java27-native-intellij-firstquery-cb65.html">Java with Couchbase SDK 2.7 and IntelliJ</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../quick-start/quickstart-java27-springdata32-intellij-firstquery-cb65.html">Java with Spring Data Couchbase and IntelliJ</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../quick-start/quickstart-dotnet27-aspnetcore31-visualstudio-firstquery-cb65.html">ASP.NET Core First Query</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../quick-start/quickstart-dotnet27-linq-vscode-firstquery-cb65.html">.NET Core with Linq2Couchbase First Query</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../quick-start/quickstart-nodejs26-ottoman-vscode-firstquery-cb65.html">Upsert and Lookup via Ottoman 2.6 &amp; NodeJS SDK 2.6</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../quick-start/quickstart-python3-native-firstquery-cb65.html">Native Python SDK First Query</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Couchbase Server</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">Session Storage
Unresolved include directive in modules/ROOT/nav.adoc - include::session-storage:partial$nav.adoc[]</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">User Profile Storage
Unresolved include directive in modules/ROOT/nav.adoc - include::profile-store:partial$nav.adoc[]</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Couchbase Mobile</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Travel Sample</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/introduction.html">Introduction</a>
  </span>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Swift</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="3">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/installation/index.html">Backend Installation</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/installation/manual.html">Manual</a>
  </span>
</li>
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/installation/docker.html">Docker (Local)</a>
  </span>
</li>
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/installation/cloud.html">Cloud (RightScale)</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/installation/travel-mobile-app.html">Installation</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/design/data-modeling.html">Data Modeling</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/develop/mvp-architecture.html">MVP Architecture</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/develop/the-basics.html">The Basics</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/develop/security.html">Security</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/develop/sync.html">Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/develop/pre-built-database.html">Pre-built database</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/develop/query.html">Query</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/swift/develop/full-text-search.html">Full Text Search</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Android-Java</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="3">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/installation/index.html">Backend Installation</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/installation/manual.html">Manual</a>
  </span>
</li>
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/installation/docker.html">Docker (Local)</a>
  </span>
</li>
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/installation/cloud.html">Cloud (RightScale)</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/installation/travel-mobile-app.html">Installation</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/design/data-modeling.html">Data Modeling</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/develop/mvp-architecture.html">MVP Architecture</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/develop/the-basics.html">The Basics</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/develop/security.html">Security</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/develop/sync.html">Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/develop/pre-built-database.html">Pre-built database</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/develop/query.html">Query</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/android/develop/full-text-search.html">Full Text Search</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Java</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="3">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/installation/index.html">Backend Installation</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/installation/manual.html">Manual</a>
  </span>
</li>
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/installation/docker.html">Docker (Local)</a>
  </span>
</li>
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/installation/cloud.html">Cloud (RightScale)</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/installation/travel-mobile-app.html">Installation</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/design/data-modeling.html">Data Modeling</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/develop/mvp-architecture.html">MVP Architecture</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/develop/the-basics.html">The Basics</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/develop/security.html">Security</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/develop/sync.html">Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/develop/pre-built-database.html">Pre-built database</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/develop/query.html">Query</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/java/develop/full-text-search.html">Full Text Search</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="2">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">C#</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="3">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/installation/index.html">Backend Installation</a>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/installation/manual.html">Manual</a>
  </span>
</li>
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/installation/docker.html">Docker (Local)</a>
  </span>
</li>
<li class="menu_list" data-depth="4">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/installation/cloud.html">Cloud (RightScale)</a>
  </span>
</li>
</ul>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/installation/travel-mobile-app.html">Installation</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/design/data-modeling.html">Data Modeling</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/develop/mvvm-architecture.html">MVVM Architecture</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/develop/the-basics.html">The Basics</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/develop/security.html">Security</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/develop/sync.html">Sync</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/develop/pre-built-database.html">Pre-built database</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/develop/query.html">Query</a>
  </span>
</li>
<li class="menu_list" data-depth="3">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../mobile-travel-sample/csharp/develop/full-text-search.html">Full Text Search</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#standalone@userprofile-couchbase-mobile:userprofile:userprofile_basic.adoc">Getting Started on iOS</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#standalone@userprofile-couchbase-mobile:userprofile:xamarin/userprofile_basic.adoc">Getting Started on Xamarin</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#standalone@userprofile-couchbase-mobile:userprofile:android/userprofile_basic.adoc">Getting Started on Android</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <a class="menu_title menu_link" href="#tutorials:swift-playground:overview.adoc">Xcode Playground</a>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">Recycler Views with Live Queries
Unresolved include directive in modules/ROOT/nav.adoc - include::university-lister:partial$nav.adoc[]</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">Build a Cordova Plugin
Unresolved include directive in modules/ROOT/nav.adoc - include::hotel-lister:partial$nav.adoc[]</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">Build a React Native Module
Unresolved include directive in modules/ROOT/nav.adoc - include::hotel-finder:partial$nav.adoc[]</span>
  </span>
</li>
<li class="menu_list" data-depth="1">
  <span class="menu_line">
    <span class="menu_title menu_text">OpenID Connect Tutorial
Unresolved include directive in modules/ROOT/nav.adoc - include::openid-connect-implicit-flow:partial$nav.adoc[]</span>
  </span>
</li>
</ul>
</li>
<li class="menu_list is-parent closed" data-depth="0">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Build Your Own</span>
  </span>
<ul class="menu_row">
<li class="menu_list is-parent closed" data-depth="1">
  <span class="menu_line">
    <span class="in-toggle"></span>
    <span class="menu_title menu_text">Tutorial Template</span>
  </span>
<ul class="menu_row">
<li class="menu_list" data-depth="2">
  <span class="menu_line">
    <a class="menu_title menu_link" href="../../../tutorial-template/sample.html">Basic Tutorial Template</a>
  </span>
</li>
</ul>
</li>
</ul>
</li>
</ul>
      </div>
    </li>
  </ul>
</div>
  </div>
</aside>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/couchbaselabs/mobile-training-todo/edit/tutorials/content/modules/todo-app/pages/develop/java/using-the-database.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../../index.html">Tutorials</a></li>
<li class="crumb"><a href="using-the-database.html">Using the Database</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Using the Database</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this lesson you&#8217;ll be introduced to Couchbase Lite, our embedded NoSQL database.
You&#8217;ll learn how to create, read, update, delete, and query data using Couchbase Lite.</p>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> To make things a bit more exciting, you may want to use the pre-built database containing a list of Groceries.
Refer to the <a href="#swift/create-database.adoc" class="page unresolved">Create a Database</a> lesson to learn how to use it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-a-document"><a class="anchor" href="#create-a-document"></a>Create a Document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Couchbase Lite, the primary entity stored in a database is called a document instead of a row or record.
A document&#8217;s body takes the form of a JSON object&#8201;&#8212;&#8201;a collection of key/value pairs where the values can be different types of data such as numbers, strings, arrays or even nested objects.
The code below creates a new list document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-swift hljs" data-lang="swift">// This code can be found in ListsViewController.swift
// in the createTaskList(name:) method
let properties: [String : Any] = [
    type: task-list,
    name: name,
    owner: username
]

let docId = username + . + NSUUID().uuidString
guard let doc = database.document(withID: docId) else {
    Ui.showMessageDialog(onController: self, withTitle: Error,
        withMessage: Couldn't save task list)
    return nil
}

do {
    return try doc.putProperties(properties)
} catch let error as NSError {
    Ui.showMessageDialog(onController: self, withTitle: Error,
        withMessage: Couldn't save task list, withError: error)
    return nil
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">// This code can be found in TaskListsModel.cs
// in the CreateTaskList(string) method
var properties = new Dictionarystring, object {
    [type] = TaskListType,
    [name] = name,
    [owner] = Username
};

var docId = ${Username}.{Guid.NewGuid()};
var doc = default(Document);
try {
    doc = _db.GetDocument(docId);
    return doc.PutProperties(properties);
} catch(Exception e) {
    var newException = new ApplicationException(Couldn't save task list, e);
    throw newException;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// This code can be found in ListsActivity.java
// in the createTaskList(String) method
MapString, Object properties = new HashMapString, Object();
properties.put(type, task-list);
properties.put(name, title);
properties.put(owner, mUsername);

String docId = mUsername + . + UUID.randomUUID();

Document document = mDatabase.getDocument(docId);
document.putProperties(properties);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you&#8217;re creating an unsaved document instance with a pre-defined <strong>document ID</strong> (i.e.
the <strong>_id</strong> property in the document&#8217;s JSON body) using the <code>documentWithID</code> method.
The ID follows the form <code>{username}.{uuid}</code> where username is the name of the user logged in.
Alternatively, you could also use the <code>createDocument</code> method to let the database generate a random <strong>ID</strong> for you.</p>
</div>
<div class="sect2">
<h3 id="try-it-out"><a class="anchor" href="#try-it-out"></a>Try it out</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run.</p>
</li>
<li>
<p>Create a new list using the '+' button on the application&#8217;s 'Task lists' screen.</p>
</li>
<li>
<p>A new list document is saved to the database.</p>
<div class="paragraph">
<p><span class="image"><img src="../../_images/image40.png" alt="image40" width="400"></span></p>
</div>
</li>
<li>
<p>Build and run.</p>
</li>
<li>
<p>Create a new list using the '+' button on the application&#8217;s 'Task lists' screen.</p>
</li>
<li>
<p>A new list document is saved to the database.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>iOS</strong>
<strong>Android</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run</p>
</li>
<li>
<p>Create a new list using the 'Action - Add List&#8230;&#8203;' command.</p>
</li>
<li>
<p>A new list document is saved to the database.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run.</p>
</li>
<li>
<p>Create a new list using the '+' button on the application&#8217;s 'Task lists' screen.</p>
</li>
<li>
<p>A new list document is saved to the database.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Exercise:</strong> Update the code to persist your name as the value for the <code>name</code> field.
Then create a new list and notice that your name is displayed instead of the text input value.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="update-a-document"><a class="anchor" href="#update-a-document"></a>Update a Document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To update a document, you must retrieve it from the database, modify the desired properties and write them back to the database.
The <code>update</code> method does this operation for you in the form of a callback.
The code below updates a list&#8217;s name property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-swift hljs" data-lang="swift">// This code can be found in ListsViewController.swift
// in the updateTaskList(list:withName:) method
do {
    try list.update { newRev in
        newRev[name] = name
        return true
    }
} catch let error as NSError {
    Ui.showMessageDialog(onController: self, withTitle: Error,
        withMessage: Couldn't update task list, withError: error)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">// This code can be found in TaskListModel.cs
// in the Edit(string) method
try {
    _document.Update(rev =
    {
        var props = rev.UserProperties;
        var lastName = props[name];
        props[name] = name;
        rev.SetUserProperties(props);

        return !String.Equals(name, lastName);
    });
} catch(Exception e) {
    throw new ApplicationException(Couldn't edit task list, e);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// This code can be in ListsActivity.java
// in the updateList(Document) method
list.update(new Document.DocumentUpdater() {
    @Override
    public boolean update(UnsavedRevision newRevision) {
        MapString, Object props = newRevision.getUserProperties();
        props.put(name, input.getText().toString());
        newRevision.setUserProperties(props);
        return true;
    }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your callback code can modify this object&#8217;s properties as it sees fit; after it returns, the modified revision is saved and becomes the current one.</p>
</div>
<div class="sect2">
<h3 id="try-it-out-2"><a class="anchor" href="#try-it-out-2"></a>Try it out</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run.</p>
</li>
<li>
<p>Swipe to the left on a row to reveal the <strong>Edit</strong> button and update the List name in the pop-up.</p>
<div class="paragraph">
<p><span class="image"><img src="../../_images/image04.png" alt="image04"></span></p>
</div>
</li>
<li>
<p>Build and run</p>
</li>
<li>
<p>On iOS, swipe to the left, and on Android long press on a row to reveal the <strong>Edit</strong> button and update the List name in the pop-up.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>iOS</strong>
<strong>Android</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run</p>
</li>
<li>
<p>Right click on a row to reveal the <strong>Edit</strong> context action. Click it and update the List name in the pop-up.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run.</p>
</li>
<li>
<p>Long press on a row to reveal the action items. Click the update menu to change title of a list.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Challenge:</strong> Modify the code to uppercase the text inserted before persisting the document to the database.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="delete-a-document"><a class="anchor" href="#delete-a-document"></a>Delete a Document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A document can be deleted using the <code>delete</code> method.
This operation actually creates a new revision in order to propagate the deletion to other clients.
The concept of revisions will be covered in more detail in the next lesson.
The code below deletes a list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-swift hljs" data-lang="swift">// This code can be found in ListsViewController.swift
// in the deleteTaskList(list:) method
do {
    try list.delete()
} catch let error as NSError {
    Ui.showMessageDialog(onController: self, withTitle: Error,
        withMessage: Couldn't delete task list, withError: error)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">// This code can be found in TaskListModel.cs
// in the Delete() method
try {
    _document.Delete();
} catch(Exception e) {
    throw new ApplicationException(Couldn't delete task list, e);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// This code can be found in ListsActivity.java
// in the deleteList(Document) method
try {
    list.delete();
} catch (CouchbaseLiteException e) {
    e.printStackTrace();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Challenge:</strong> Add a document change listener to detect when the document gets deleted.
The <a href="https://docs.couchbase.com/couchbase-lite/1.4/swift.html#document-change-notifications">document change notification</a> documentation will be helpful for this challenge.</p>
</div>
<div class="sect2">
<h3 id="try-it-out-3"><a class="anchor" href="#try-it-out-3"></a>Try it out</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run.</p>
</li>
<li>
<p>Click the <strong>Delete</strong> action to delete a list.</p>
<div class="paragraph">
<p><span class="image"><img src="../../_images/image46.gif" alt="image46" width="400"></span></p>
</div>
</li>
<li>
<p>Build and run.</p>
</li>
<li>
<p>On iOS, swipe to the left, and on Android long press on a row to reveal the <strong>Delete</strong> button.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>iOS</strong>
<strong>Android</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run.</p>
</li>
<li>
<p>Right click on a row to reveal the <strong>Delete</strong> context action.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run.</p>
</li>
<li>
<p>Click the <strong>Delete</strong> action to delete a list.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-documents"><a class="anchor" href="#query-documents"></a>Query Documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The way to query data in Couchbase Lite is by registering a View and then running a Query on it with QueryOptions.
The first thing to know about Couchbase Views is that they have nothing to do with UI views.</p>
</div>
<div class="paragraph">
<p>A <a href="https://docs.couchbase.com/couchbase-lite/1.4/swift.html#view">View</a> in Couchbase is a persistent index of documents in a database, which you then query to find data.
The main component of a View is its map function.
It takes a document&#8217;s JSON as input, and emits (outputs) any number of key/value pairs to be indexed.
First, you will define the view to index the documents of type <strong>task-list</strong>.
The diagram below shows the result of the code you will review shortly.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/img.001.png" alt="img.001"></span></p>
</div>
<div class="paragraph">
<p>So you can remember that a view index is a list of key/value pairs, sorted by key.
In addition, the view&#8217;s logic is written in the native language of the platform you&#8217;re developing on.
The code below indexes documents as shown on the diagram above.
Then it create the Query and monitors the result set using a Live Query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-swift hljs" data-lang="swift">// This code can be found in ListsViewController.swift
// in the setupViewAndQuery method
let listsView = database.viewNamed(list/listsByName)
if listsView.mapBlock == nil {
    listsView.setMapBlock({ (doc, emit) in
        if let type: String = doc[type] as? String, let name = doc[name]
            , type == task-list {
                emit(name, nil)
        }
    }, version: 1.0)
}

listsLiveQuery = listsView.createQuery().asLive()
listsLiveQuery.addObserver(self, forKeyPath: rows, options: .new, context: nil)
listsLiveQuery.start()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">// This code can be found in TaskListsModel.cs
// in the SetupViewAndQuery() method
var view = _db.GetView(list/listsByName);
view.SetMap((doc, emit) =
{
    if(!doc.ContainsKey(type) || doc[type] as string != task-list || !doc.ContainsKey(name)) {
        return;
    }

    emit(doc[name], null);
}, 1.0);

_byNameQuery = view.CreateQuery().ToLiveQuery();

// ...Changed lamdba omitted for brevity

_byNameQuery.Start();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// This code can be found in ListsActivity.java
// in the setupViewAndQuery() method
com.couchbase.lite.View listsView = mDatabase.getView(list/listsByName);
if (listsView.getMap() == null) {
    listsView.setMap(new Mapper() {
        @Override
        public void map(MapString, Object document, Emitter emitter) {
            String type = (String) document.get(type);
            if (task-list.equals(type)) {
                emitter.emit(document.get(name), null);
            }
        }
    }, 1.0);
}

listsLiveQuery = listsView.createQuery().toLiveQuery();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>viewNamed</code> method returns a <code>View</code> object on which the map function can be set.
The map function is indexing documents where the type property is equal to task-list.
Each cell on the screen will contain a list name and nothing else.
For that reason, you can emit the name property as the key and nil is the value.
If you also wanted to display the owner of the list in the row you could emit the <code>owner</code> property as the value.</p>
</div>
<div class="paragraph">
<p>The <code>listsView.createQuery()</code> method returns a <code>Query</code> object which has a <strong>run</strong> method to return the results as a <code>QueryEnumerator</code> object.
However, in this case, you are hooking into a <code>Live
    Query</code> to keep monitoring the database for new results.
Any time the result of that query changes through user interaction or synchronization, it will notify your application via the change event.
A live query provides an easy way to build reactive UIs, which will be especially useful when you enable sync in the <a href="#swift/adding-synchronization.adoc" class="page unresolved">Adding
    Synchronization</a> lesson.
The change event is triggered as a result of user interaction locally as well as during synchronization with Sync Gateway.</p>
</div>
<div class="paragraph">
<p>In the code blow, the notifications are posted to the application code using the KVO observer method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-swift hljs" data-lang="swift">// This code can be found in ListsViewController.swift
// in the observeValue(forKeyPath:of:_:_:) method
override func observeValue(forKeyPath keyPath: String?, of object: Any?, change: [NSKeyValueChangeKey : Any]?, context: UnsafeMutableRawPointer?) {
    if object as? NSObject == listsLiveQuery {
        reloadTaskLists()
    } else if object as? NSObject == incompTasksCountsLiveQuery {
        reloadIncompleteTasksCounts()
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">// This code can be found in TaskListsModel.cs
// in the SetupViewAndQuery()
_byNameQuery.Changed += (sender, args) =
{
    TasksList.Replace(args.Rows.Select(x = new TaskListCellModel(x.DocumentId)));
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Android you are using a utility class named <strong>LiveQueryAdapter</strong> which takes care of reloading the list when changes are received.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// This code can be found in LiveQueryAdapter.java
// in the public constructor
query.addChangeListener(new LiveQuery.ChangeListener() {
    @Override
    public void changed(final LiveQuery.ChangeEvent event) {
        ((Activity) LiveQueryAdapter.this.context).runOnUiThread(new Runnable() {
            @Override
            public void run() {
                enumerator = event.getRows();
                notifyDataSetChanged();
            }
        });
    }
});
query.start();</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="try-it-out-4"><a class="anchor" href="#try-it-out-4"></a>Try it out</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run.</p>
</li>
<li>
<p>Save a new list to the database and the live query will pick it up instantly and reload the table view.</p>
<div class="paragraph">
<p><span class="image"><img src="../../_images/image66.gif" alt="image66"></span></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Challenge:</strong> Update the map function to emit the document ID as the key.
Don&#8217;t forget to bump the view version whenever you change the map function.
The list view should now display the document ID on each row.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aggregating-data"><a class="anchor" href="#aggregating-data"></a>Aggregating Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A problem in typical applications is how to perform data aggregation.
Couchbase Lite lets you run those data queries using the full capabilities of map/reduce.
To run aggregation queries on the rows emitted by the map function, you can use the reduce function which is the part of map/reduce that takes several rows from the index and aggregates them together in a single object.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s write a view to query and display the number of uncompleted tasks for each list.
A task is marked as completed if its <strong>complete</strong> property is true.
You need to define a <strong>map</strong> function which:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Returns the number of uncompleted task documents,</p>
</li>
<li>
<p>Groups them by the list they belong to,</p>
</li>
<li>
<p>Counts the number of rows in each group.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The diagram below shows this process.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/image32.png" alt="image32"></span></p>
</div>
<div class="paragraph">
<p>Notice that <strong>groupingLevel = 1</strong> coalesces the rows in the view index by their key.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.couchbase.com/couchbase-lite/1.4/swift.html#grouping-by-key">Grouping</a> is a powerful feature of Couchbase Lite.
It is available on a <strong>Query</strong> using the <strong>groupLevel</strong> property, which is a number, and it defaults to 0.
It basically takes the entire range of output that the query produces (i.e.
the entire range of rows) and it coalesces together adjacent rows with the same key.</p>
</div>
<div class="paragraph">
<p>The most commonly used aggregation functions are Count and Sum:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Count: A function that counts the number of documents contained in the map (used on the diagram above).</p>
</li>
<li>
<p>Sum: A function that adds all of the items contained in the map.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code below indexes documents as shown on the diagram above.
Then it create the Query and monitors the result set using a Live Query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-swift hljs" data-lang="swift">// This code can be found in ListsViewController.swift
// in the setupViewAndQuery() method
let incompTasksCountView = database.viewNamed(list/incompleteTasksCount)
if incompTasksCountView.mapBlock == nil {
    incompTasksCountView.setMapBlock({ (doc, emit) in
        if let type: String = doc[type] as? String , type == task {
            if let list = doc[taskList] as? [String: AnyObject], let listId = list[id],
                let complete = doc[complete] as? Bool , !complete {
                emit(listId, nil)
            }
        }
        }, reduce: { (keys, values, reredeuce) in
        return values.count
    }, version: 1.0)
}

incompTasksCountsLiveQuery = incompTasksCountView.createQuery().asLive()
incompTasksCountsLiveQuery.groupLevel = 1
incompTasksCountsLiveQuery.addObserver(self, forKeyPath: rows, options: .new, context: nil)
incompTasksCountsLiveQuery.start()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">var incompleteTasksView = _db.GetView(list/incompleteTasksCount);
incompleteTasksView.SetMapReduce((doc, emit) =
{
    if(!doc.ContainsKey(type) || doc[type] as string != task) {
        return;
    }

    if(!doc.ContainsKey(taskList)) {
        return;
    }

    var list = JsonUtility.ConvertToNetObjectIDictionarystring, object(doc[taskList]);
    if(!list.ContainsKey(id) || (doc.ContainsKey(complete)  (bool)doc[complete])) {
        return;
    }

    emit(list[id], null);

 }, BuiltinReduceFunctions.Count, 1.0);

_incompleteQuery = incompleteTasksView.CreateQuery().ToLiveQuery();
_incompleteQuery.GroupLevel = 1;

// ...Changed lambda omitted for brevity

 _incompleteQuery.Start();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// This code can be found in ListsActivity.java
// in the setupViewAndQuery method
com.couchbase.lite.View incompTasksCountView = mDatabase.getView(list/incompleteTasksCount);
if (incompTasksCountView.getMap() == null) {
    incompTasksCountView.setMapReduce(new Mapper() {
        @Override
        public void map(MapString, Object document, Emitter emitter) {
            String type = (String) document.get(type);
            if (task.equals(type)) {
                Boolean complete = (Boolean) document.get(complete);
                if (!complete) {
                    MapString, Object taskList = (MapString, Object) document.get(taskList);
                    String listId = (String) taskList.get(id);
                    emitter.emit(listId, null);
                }
            }
        }
    }, new Reducer() {
        @Override
        public Object reduce(ListObject keys, ListObject values, boolean rereduce) {
            // keys: [0, 0]
            // values: [null, null]
            return values.size();
        }
    }, 1.0);
}

final LiveQuery incompTasksCountLiveQuery = incompTasksCountView.createQuery().toLiveQuery();
incompTasksCountLiveQuery.setGroupLevel(1);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This time, you call emit only if the document <code>type</code> is task and <code>complete</code> is <code>false</code>.
The document ID of the list it belongs to (<strong>doc.taskList._id</strong>) serves as the key and
    the value is nil. The reduce function simply counts the number of
    rows with the same key. Notice that the <strong>groupLevel</strong> is a property on the live query object.</p>
</div>
<div class="paragraph">
<p>Every time there is a change to <code>incompTasksCountsLiveQuery.rows</code> the <code>observeValueForKeyPath</code> method is called which will reload the list count for each row.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-swift hljs" data-lang="swift">// This code can be found in ListsViewController.swift
// in the observeValue(forKeyPath:of:_:_:) method
override func observeValue(forKeyPath keyPath: String?, of object: Any?, change: [NSKeyValueChangeKey : Any]?, context: UnsafeMutableRawPointer?) {
    if object as? NSObject == listsLiveQuery {
        reloadTaskLists()
    } else if object as? NSObject == incompTasksCountsLiveQuery {
        reloadIncompleteTasksCounts()
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#"> _incompleteQuery.Changed += (sender, e) =
{
    var newItems = TasksList.ToList();
    foreach(var row in e.Rows) {
        var item = newItems.FirstOrDefault(x = x.DocumentID == row.Key as string);
        if(item != null) {
            item.IncompleteCount = (int)row.Value;
        }
    }

    TasksList.Replace(newItems);
};</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">incompTasksCountLiveQuery.addChangeListener(new LiveQuery.ChangeListener() {
    @Override
    public void changed(LiveQuery.ChangeEvent event) {
        runOnUiThread(new Runnable() {
            @Override
            public void run() {
                MapString, Object counts = new HashMapString, Object();
                QueryEnumerator rows = incompTasksCountLiveQuery.getRows();
                for (QueryRow row : rows) {
                    String listId = (String) row.getKey();
                    int count = (int) row.getValue();
                    counts.put(listId, count);
                }
                incompCounts = counts;
                mAdapter.notifyDataSetChanged();
            }
        });
    }
});
incompTasksCountLiveQuery.start();</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="try-it-out-5"><a class="anchor" href="#try-it-out-5"></a>Try it out</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and run.</p>
</li>
<li>
<p>You will see the uncompleted task count for each list.</p>
<div class="paragraph">
<p><span class="image"><img src="../../_images/image08.png" alt="image08" width="400"></span></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>iOS</strong>
<strong>Android</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Well done! You&#8217;ve completed this lesson on using CRUD operations with the database and running aggregation queries.
In the next lesson, you&#8217;ll learn how to use Couchbase Lite&#8217;s synchronization APIs with Sync Gateway.
Feel free to share your feedback, findings or ask any questions on the forums.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span> 2021 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../../../_/js/vendor/fontawesome.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
