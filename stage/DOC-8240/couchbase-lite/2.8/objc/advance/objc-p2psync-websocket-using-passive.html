<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Passive Peer | Couchbase Docs</title>
<link rel="canonical" href="https://ibsoln.github.io/stage/DOC-8240/couchbase-lite/2.8/objc/advance/objc-p2psync-websocket-using-passive.html">
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Couchbase Lite&#x27;s Peer-to-Peer Synchronization enables edge devices to synchronize securely without consuming centralized cloud-server resources">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="couchbase-lite">
<meta name="dcterms.identifier" content="2.8">
<meta name="generator" content="Antora 2.3.3">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">

              <a class="navbar-brand" href="../../../..">
                <img src="../../../../_/img/couchbase-documentation-logo.svg" alt="Couchbase" />
              </a>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <form class="navbar-item search">
                  <input type="text" placeholder="Search Docs" class="query" id="search-query" />
                  <button type="button" class="search-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </form>
                <div class="parent-site">
                  <a href="https://www.couchbase.com">
                    Couchbase.com
                  </a>
                </div>
                <a class="btn btn-primary try-btn" href="https://www.couchbase.com/downloads">
                  Try Free
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<nav class="nav">
<div class="left-sidebar-menu">
<div class="version-control-box">
<div class="component-frame">
<div class="frame-icon">
<img src="../../../../_/img/server-icon.png" alt="">
</div>
<div class="frame-body">
<h4 class="title"><span class="">Couchbase Lite</span></h4>
<a class="frame-link component" href="../../index.html"> <span class="version">2.8</span></a>
</div>
</div>
</div>
<div class="nav-menu">
<ul class="nav-list">
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../introduction.html">Introduction</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../cbl-whatsnew.html">What&#8217;s New</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../android/quickstart.html">Android (Java)</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../android/start/java-android-gs-prereqs.html">Start Here!</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/start/java-android-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/start/java-android-gs-build.html">Build and Run</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-database.html">Databases</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/java-android-prebuilt-database.html">Pre-built Database</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-document.html">Documents</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-blob.html">Blobs</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../android/learn/java-android-query.html">Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/learn/java-android-query-live.html">Live Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/learn/java-android-query-predictive.html">Predictive Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/learn/java-android-query-troubleshooting.html">Query Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-fts.html">Full Text Search</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../android/learn/java-android-landing-replications.html">Data Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/learn/java-android-dbreplica.html">Intra-Device</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/learn/java-android-replication.html">Remote Sync Gateway</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="../../android/learn/java-android-p2psync-websocket.html">Peer-to-Peer</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../android/advance/java-android-p2psync-websocket-using-passive.html">Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../android/advance/java-android-p2psync-websocket-using-active.html">Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../android/learn/java-android-p2psync-custom.html">Integrate a Custom Listener</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-conflict.html">Handling Data Conflicts</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-android/">API&#160;References</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/advance/java-android-dep-upgrade.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/java-android-troubleshooting-logs.html">Using Logs</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/java-android-troubleshooting-queries.html">Troubleshooting Queries</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/product/java-android-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/product/java-android-compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/product/java-android-supported-os.html">Supported OS</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/refer/java-android-refer-glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../csharp/quickstart.html">C#.Net</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Start Here!</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/start/csharp-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/start/csharp-gs-build.html">Build and Run</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../csharp/learn/csharp-database.html">Databases</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../csharp/csharp-prebuilt-database.html">Pre-built Database</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../csharp/learn/csharp-document.html">Documents</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../csharp/learn/csharp-blob.html">Blobs</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../csharp/learn/csharp-query.html">Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/learn/csharp-query-live.html">Live Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/learn/csharp-query-predictive.html">Predictive Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/learn/csharp-query-troubleshooting.html">Query Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../csharp/learn/csharp-fts.html">Full Text Search</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../csharp/learn/csharp-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../csharp/learn/csharp-landing-replications.html">Data Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/learn/csharp-dbreplica.html">Intra-Device</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/learn/csharp-replication.html">Remote Sync Gateway</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="../../csharp/learn/csharp-p2psync-websocket.html">Peer-to-Peer</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../csharp/advance/csharp-p2psync-websocket-using-passive.html">Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../csharp/advance/csharp-p2psync-websocket-using-active.html">Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../csharp/learn/csharp-p2psync-custom.html">Integrate a Custom Listener</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../csharp/learn/csharp-conflict.html">Handling Data Conflicts</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net">API&#160;References</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../csharp/advance/csharp-dep-upgrade.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/csharp-troubleshooting-logs.html">Using Logs</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/csharp-troubleshooting-queries.html">Troubleshooting Queries</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/product/csharp-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/product/csharp-compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../csharp/product/csharp-supported-os.html">Supported OS</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../csharp/refer/csharp-refer-glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../java/quickstart.html">Java</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../java/start/java-gs-prereqs.html">Start Here!</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/start/java-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/start/java-gs-build.html">Build and Run</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-database.html">Databases</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/java-prebuilt-database.html">Pre-built Database</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-document.html">Documents</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-blob.html">Blobs</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../java/learn/java-query.html">Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/learn/java-query-live.html">Live Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/learn/java-query-predictive.html">Predictive Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/learn/java-query-troubleshooting.html">Query Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-fts.html">Full Text Search</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../java/learn/java-landing-replications.html">Data Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/learn/java-dbreplica.html">Intra-Device</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/learn/java-replication.html">Remote Sync Gateway</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="../../java/learn/java-p2psync-websocket.html">Peer-to-Peer</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../java/advance/java-p2psync-websocket-using-passive.html">Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../java/advance/java-p2psync-websocket-using-active.html">Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../java/learn/java-p2psync-custom.html">Integrate a Custom Listener</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-conflict.html">Handling Data Conflicts</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-java/index.html?">API&#160;References</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/advance/java-dep-upgrade.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/java-troubleshooting-logs.html">Using Logs</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/java-troubleshooting-queries.html">Troubleshooting Queries</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/product/java-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/product/java-compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/product/java-supported-os.html">Supported OS</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/refer/java-refer-glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../quickstart.html">Objective-C</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../start/objc-gs-prereqs.html">Start Here!</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../start/objc-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../start/objc-gs-build.html">Build and Run</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../learn/objc-database.html">Databases</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../objc-prebuilt-database.html">Pre-built Database</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../learn/objc-document.html">Documents</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../learn/objc-blob.html">Blobs</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../learn/objc-query.html">Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../learn/objc-query-live.html">Live Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../learn/objc-query-predictive.html">Predictive Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../learn/objc-query-troubleshooting.html">Query Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../learn/objc-fts.html">Full Text Search</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../learn/objc-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../learn/objc-landing-replications.html">Data Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../learn/objc-dbreplica.html">Intra-Device</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../learn/objc-replication.html">Remote Sync Gateway</a>
</span>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="../learn/objc-p2psync-websocket.html">Peer-to-Peer</a>
</span>
<ul class="nav-list">
<li class="nav-item is-current-page is-active is-active-depth-2  " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="objc-p2psync-websocket-using-passive.html">Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="objc-p2psync-websocket-using-active.html">Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../learn/objc-p2psync-custom.html">Integrate a Custom Listener</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../learn/objc-conflict.html">Handling Data Conflicts</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc">API&#160;References</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="objc-dep-upgrade.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../objc-troubleshooting-logs.html">Using Logs</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../objc-troubleshooting-queries.html">Troubleshooting Queries</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../objc-troubleshooting-crashes.html">Decoding Crash Logs</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../product/objc-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../product/objc-compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../product/objc-supported-os.html">Supported OS</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../refer/objc-refer-glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../swift/quickstart.html">Swift</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../swift/start/swift-gs-prereqs.html">Start Here!</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/start/swift-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/start/swift-gs-build.html">Build and Run</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-database.html">Databases</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/swift-prebuilt-database.html">Pre-built Database</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-document.html">Documents</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-blob.html">Blobs</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../swift/learn/swift-query.html">Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/learn/swift-query-live.html">Live Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/learn/swift-query-predictive.html">Predictive Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/learn/swift-query-troubleshooting.html">Query Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-fts.html">Full Text Search</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../swift/learn/swift-landing-replications.html">Data Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/learn/swift-dbreplica.html">Intra-Device</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/learn/swift-replication.html">Remote Sync Gateway</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="../../swift/learn/swift-p2psync-websocket.html">Peer-to-Peer</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/advance/swift-p2psync-websocket-using-passive.html">Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/advance/swift-p2psync-websocket-using-active.html">Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/learn/swift-p2psync-custom.html">Integrate a Custom Listener</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-conflict.html">Handling Data Conflicts</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-swift">API&#160;References</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/advance/swift-dep-upgrade.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/swift-troubleshooting-logs.html">Using Logs</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/swift-troubleshooting-queries.html">Troubleshooting Queries</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/swift-troubleshooting-crashes.html">Decoding Crash Logs</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/product/swift-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/product/swift-compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/product/swift-supported-os.html">Supported OS</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/refer/swift-refer-glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../javascript.html">JavaScript</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../javascript.html">JavaScript</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../../../sync-gateway/2.8/introduction.html">Sync&#160;Gateway</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../../../sync-gateway/2.8/refer/config-properties.html">Configure</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../../../sync-gateway/2.8/refer/rest-api-admin.html">REST API</a>
</span>
</li>
</ul>
</li>
</ul>
</div>
<a href="#" class="menu-expand-toggle"> <span>Navigation</span> <i class="fas fa-times-circle"></i> <i class="fas fa-chevron-circle-left"></i></a>
</div></nav>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/objc/pages/advance/objc-p2psync-websocket-using-passive.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../index.html">Couchbase Lite</a></li>
<li class="crumb"><a href="../quickstart.html">Objective-C</a></li>
<li class="crumb"><a href="../learn/objc-landing-replications.html">Data Sync</a></li>
<li class="crumb"><a href="../learn/objc-p2psync-websocket.html">Peer-to-Peer</a></li>
<li class="crumb"><a href="objc-p2psync-websocket-using-passive.html">Passive Peer</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Passive Peer</h1>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise</a></li>
</ul>
</div>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Description&#8201;&#8212;&#8201;<em>Couchbase Lite&#8217;s Peer-to-Peer Synchronization enables edge devices to synchronize securely without consuming centralized cloud-server resources</em><br>
<em>Abstract&#8201;&#8212;&#8201;How to set up a Listener to accept a Replicator connection and sync using peer-to-peer</em><br>
Related Content&#8201;&#8212;&#8201;<a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc">API Reference</a>  |  <a href="objc-p2psync-websocket-using-passive.html" class="page">Passive Peer</a>  |  <a href="objc-p2psync-websocket-using-active.html" class="page">Active Peer</a></p>
</div>
</blockquote>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Enterprise Edition only</div>
This an <a href="https://www.couchbase.com/products/editions">Enterprise Edition</a> feature.
Purchase the <em>Enterprise License</em>, which includes official <a href="https://www.couchbase.com/support-policy">Couchbase Support</a>, to use it in production (see the license and support <a href="https://www.couchbase.com/licensing-and-support-faq" class="bare">https://www.couchbase.com/licensing-and-support-faq</a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">iOS Restrictions</div>
<div class="dlist">
<dl>
<dt class="hdlist1">iOS 14 Applications</dt>
<dd>
<p>When your application attempts to access the user&#8217;s local network, iOS will prompt them to allow (or deny) access.
You can customize the message presented to the user by editing the description for the <code>NSLocalNetworkUsageDescription</code> key in the <code>Info.plist</code>.</p>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Code Snippets</div>
The code examples are indicative only.
They demonstrate basic concepts and approaches to using a feature.
Use them as inspiration and adapt these examples to best practice when developing applications for your platform.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This content provides code and configuration examples covering the implementation of <a href="../refer/objc-refer-glossary.html#peer-to-peer-sync" class="page">Peer-to-Peer Sync</a> over websockets.
Specifically it covers the implementation of a <a href="../refer/objc-refer-glossary.html#passive-peer" class="page">Passive Peer</a>.</p>
</div>
<div class="paragraph">
<p>This <em>passive peer</em> (also referred to as the server, or listener) will accept a connection from an <a href="../refer/objc-refer-glossary.html#active-peer" class="page">Active Peer</a> (also referred to as the client or replicator) and participate in the replication of database changes to synchronize both databases.</p>
</div>
<div class="paragraph">
<p>Subsequent sections provide additional details, and examples for the main configuration options.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Secure Storage</div>
The use of TLS, its associated keys and certificates requires using secure storage to minimize the chances of a security breach.
The implementation of this storage differs from platform to platform&#8201;&#8212;&#8201;see <a href="../learn/objc-p2psync-websocket.html#using-secure-storage" class="page">Using secure storage</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-summary"><a class="anchor" href="#configuration-summary"></a>Configuration Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You should configure and initialize a listener for each Couchbase Lite database instance you want to sync.
There is no limit on the number of listeners you may configure&#8201;&#8212;&#8201;<a href="#simple-listener-initialization">Example 1</a> shows a simple initialization and configuration process.</p>
</div>
<div id="simple-listener-initialization" class="exampleblock">
<div class="title">Example 1. Listener configuration and initialization</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">// Initialize the listener config <i class="conum" data-value="1"></i><b>(1)</b>
CBLURLEndpointListenerConfiguration* thisConfig;
thisConfig =
  [[CBLURLEndpointListenerConfiguration alloc]
    initWithDatabase: database];

  thisConfig.port =  55990; <i class="conum" data-value="2"></i><b>(2)</b>

  NSString *thisURL = @"10.1.1.10";
  thisConfig.networkInterface = thisURL; <i class="conum" data-value="3"></i><b>(3)</b>

  thisConfig.enableDeltaSync = true; <i class="conum" data-value="4"></i><b>(4)</b>

  // Configure server security
  thisConfig.disableTLS  = false; <i class="conum" data-value="5"></i><b>(5)</b>


  // Use an anonymous self-signed cert
  thisConfig.tlsIdentity = nil; <i class="conum" data-value="6"></i><b>(6)</b>

  // Configure Client Security using an Authenticator
  // For example, Basic Authentication <i class="conum" data-value="7"></i><b>(7)</b>
  thisConfig.authenticator =
    [[CBLListenerPasswordAuthenticator alloc]
      initWithBlock: ^BOOL(NSString * validUser, NSString * validPassword) {
        if ([self isValidCredentials: validUser password:validPassword]) {
            return  YES;
        }
        return NO;
    }];

  // Initialize the listener <i class="conum" data-value="8"></i><b>(8)</b>
  CBLURLEndpointListener* thisListener = nil;
  thisListener =
    [[CBLURLEndpointListener alloc] initWithConfig: thisConfig];

  // start the listener <i class="conum" data-value="9"></i><b>(9)</b>
  BOOL success = [thisListener startWithError: &amp;error];
  if (!success) {
      NSLog(@"Cannot start the listener: %@", error);
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on example:</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Identify the local database to be used&#8201;&#8212;&#8201;see: <a href="#initialize-the-listener-configuration">Initialize the Listener Configuration</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optionally, choose a port to use.
By default the system will automatically assign a port&#8201;&#8212;&#8201;to over-ride this, see: <a href="#set-network-and-port">[set-network-and-port]</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Optionally, choose a network-interface to use.
By default the system will listen on all network interfaces&#8201;&#8212;&#8201;to over-ride this see: <a href="#set-network-and-port">[set-network-and-port]</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Optionally, choose to sync only changes, the default is not to enable delta-sync&#8201;&#8212;&#8201;see: <a href="#delta-sync">Delta Sync</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Set server security.
TLS is always enabled out-of-the-box, so you can usually omit this line.
But you <em>can</em>, optionally, disable TLS (<strong>not</strong> advisable in production)&#8201;&#8212;&#8201;see: <a href="#tls-security">TLS Security</a></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Set the credentials this server will present to the client for authentication.
Here we show the default TLS authentication, which is by anonymous self-signed certificate.
The server must always authenticate itself to the client.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Set client security&#8201;&#8212;&#8201;define the credentials the server expects the client to present for authentication.
Here we show how basic authentication is configured to authenticate the client-supplied credentials from the http authentication header against valid credentials&#8201;&#8212;&#8201;see <a href="#authenticating-the-client">Authenticating the Client</a> for more options.
<div class="paragraph">
<p>Note that client authentication is optional.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Initialize the listener using the configuration settings.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td><a href="#start-listener">Start Listener</a></td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api-references"><a class="anchor" href="#api-references"></a>API References</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can find <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc">Objective-C API References</a> here.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="device-discovery"><a class="anchor" href="#device-discovery"></a>Device Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>This phase is optional:</strong> If the listener is initialized on a well known URL endpoint (for example, a static IP Address or well known DNS address) then you can configure active peers to connect to those.</p>
</div>
<div class="paragraph">
<p>Prior to initiating the listener you may execute a peer discovery phase.</p>
</div>
<div class="paragraph">
<p>For the passive peer, this involves advertising the service using, for example
<em>Bonjour</em> (see: <a href="https://developer.apple.com/bonjour/" class="bare">https://developer.apple.com/bonjour/</a>)
 and waiting for an invite from the active peer.</p>
</div>
<div class="paragraph">
<p>The connection is established once the passive peer has authenticated and accepted an active peer&#8217;s invitation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="initialize-the-listener-configuration"><a class="anchor" href="#initialize-the-listener-configuration"></a>Initialize the Listener Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Initialize the listener configuration with the local database.
All other configuration values take their default setting.</p>
</div>
<div class="paragraph">
<p>Each Listener instance serves one Couchbase Lite database.
Couchbase sets no hard limit on the number of listeners you can initialize.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Specify Local Database</div>
<div class="content">
<div class="paragraph">
<p>In this example <code>thisDB</code> has previously been declared as an object of type Database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">// Initialize the listener config <i class="conum" data-value="1"></i><b>(1)</b>
CBLURLEndpointListenerConfiguration* thisConfig;
thisConfig =
  [[CBLURLEndpointListenerConfiguration alloc]
    initWithDatabase: database];</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on example:</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the local database using the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html">URLEndpointListenerConfiguration</a>'s constructor <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html#/c:objc(cs)CBLURLEndpointListenerConfiguration(im)initWithDatabase:">-initWithDatabase:</a>.
<div class="paragraph">
<p>The database must be opened before the listener is started.</p>
</div></td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="set-port-and-network-interface"><a class="anchor" href="#set-port-and-network-interface"></a>Set Port and Network Interface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="port-number"><a class="anchor" href="#port-number"></a>Port number</h3>
<div class="paragraph">
<p>The Listener will automatically select an available port if you do not specify one.</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Specify a Port to Use</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/objc/examples/code_snippets/p2psync-websocket.m">thisConfig.port =  55990; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on example:</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To use a canonical port&#8201;&#8212;&#8201;one known to other applications&#8201;&#8212;&#8201;specify it explicitly using the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html#/c:objc(cs)CBLURLEndpointListenerConfiguration(py)port">port</a> method shown here.
Ensure that any port you do specify is not blocked by firewall rules.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="network-interface"><a class="anchor" href="#network-interface"></a>Network Interface</h3>
<div class="paragraph">
<p>The Listener will listen on all network interfaces by default.</p>
</div>
<div id="specify-a-network-interface-to-use" class="exampleblock">
<div class="title">Example 4. Specify a Network Interface to Use</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/objc/examples/code_snippets/p2psync-websocket.m">NSString *thisURL = @"10.1.1.10";
thisConfig.networkInterface = thisURL; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<div class="title">Notes on <a href="#specify-a-network-interface-to-use">Example 4</a></div>
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To specify an interface&#8201;&#8212;&#8201;one known to other applications&#8201;&#8212;&#8201;identify it explicitly, using the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html#/c:objc(cs)CBLURLEndpointListenerConfiguration(py)networkInterface">networkInterface</a> method shown here.
This must be either an IP Address or network interface name such as <code>en0</code>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="delta-sync"><a class="anchor" href="#delta-sync"></a>Delta Sync</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Delta Sync allows clients to sync only those parts of a document that have changed.
This can result in significant savings in bandwidth consumption as well as throughput improvements.
Both valuable benefits, especially when network bandwidth is constrained.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Enable delta sync</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">thisConfig.enableDeltaSync = true; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on example:</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delta sync replication is not enabled by default.
Use <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html">URLEndpointListenerConfiguration</a>'s <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html#/c:objc(cs)CBLURLEndpointListenerConfiguration(py)enableDeltaSync">enableDeltaSync</a> method to activate or deactivate it.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tls-security"><a class="anchor" href="#tls-security"></a>TLS Security</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="enable-or-disable-tls"><a class="anchor" href="#enable-or-disable-tls"></a>Enable or Disable TLS</h3>
<div class="paragraph">
<p>Define whether the connection is to use TLS or clear text.</p>
</div>
<div class="paragraph">
<p>TLS based encryption is enabled by default and this setting ought to be used in any production environment.
However, it <em>can</em> be disabled, for example for development and-or test environments.</p>
</div>
<div class="paragraph">
<p>When TLS is enabled, Couchbase Lite provides several options on how the Listener may be configured with an appropriate TLS Identity&#8201;&#8212;&#8201;see <a href="#configure-tls-identity-for-listener">Configure TLS Identity for Listener</a>.</p>
</div>
<div class="paragraph">
<p>You can use <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html">URLEndpointListenerConfiguration</a>'s <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html#/c:objc(cs)CBLURLEndpointListenerConfiguration(py)disableTLS">disableTLS</a> method to disable TLS communication if necessary</p>
</div>
<div class="paragraph">
<p>The <code>disableTLS</code> setting must be 'false' when <em>Client Cert Authentication</em> is required.</p>
</div>
<div class="paragraph">
<p>Basic Authentication can be used with, or without, TLS.</p>
</div>
<div class="paragraph">
<p><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html#/c:objc(cs)CBLURLEndpointListenerConfiguration(py)disableTLS">disableTLS</a> works in conjunction with <code>TLSIdentity</code>, to enable developers to define the key and certificate to be used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>disableTLS</code> is true&#8201;&#8212;&#8201;TLS communication is disabled and TLS identity is ignored.
Active peers will use the <code>ws://</code> URL scheme used to connect to the listener.</p>
</li>
<li>
<p>If <code>disableTLS</code> is false or not specified&#8201;&#8212;&#8201;TLS communication is enabled.</p>
<div class="paragraph">
<p>Active peers will use the <code>wss://</code> URL scheme to connect to the listener.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configure-tls-identity-for-listener"><a class="anchor" href="#configure-tls-identity-for-listener"></a>Configure TLS Identity for Listener</h3>
<div class="paragraph">
<p>Define the credentials the server will present to the client for authentication.
Note that the server must always authenticate itself with the client&#8201;&#8212;&#8201;see {xref-cbl-pg-dbo-p2psync-websocket-bmk-using-active-auth-listener} for how the client deals with this.</p>
</div>
<div class="paragraph">
<p>Use <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html">URLEndpointListenerConfiguration</a>'s
<a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html#/c:objc(cs)CBLURLEndpointListenerConfiguration(py)tlsIdentity">tlsIdentity</a> method to configure the TLS Identity used in TLS communication.</p>
</div>
<div class="paragraph">
<p>If <code>TLSIdentity</code> is not set, then the listener uses an auto-generated anonymous self-signed identity (unless <code>disableTLS = true</code>).
Whilst the client cannot use this to authenticate the server, it will use it to encrypt communication, giving a more secure option than non-TLS communication.</p>
</div>
<div class="paragraph">
<p>The auto-generated anonymous self-signed identity is saved in Keychain for future use to obviate the need to re-generate it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Typically, you will configure the listener&#8217;s TLS Identity once during initial launch and re-use it (from Keychain on any subsequent starts.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 6. Set Listener&#8217;s TLS identity</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_import"></a>Import</p>
</li>
<li>
<p><a id="tabset1_create-self-signed-cert"></a>Create Self-Signed Cert</p>
</li>
<li>
<p><a id="tabset1_use-anonymous-self-signed-certificate"></a>Use Anonymous Self-Signed Certificate</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_import">
<div class="paragraph">
<p>Import an identity from a secure key and certificate data source.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">thisConfig.disableTLS  = false; <i class="conum" data-value="1"></i><b>(1)</b>

// Use CA Cert
// Create a TLSIdentity from a key-pair and
// certificate in secure storage
  NSURL *certURL =
    [[NSBundle mainBundle] URLForResource: @"cert" withExtension: @"p12"]; <i class="conum" data-value="2"></i><b>(2)</b>

  NSData *data =
    [[NSData alloc] initWithContentsOfURL: certURL];
  CBLTLSIdentity* thisIdentity =
    [CBLTLSIdentity importIdentityWithData: data
      password: @"123"
      label: @"couchbase-docs-cert"
      error: &amp;error]; <i class="conum" data-value="3"></i><b>(3)</b>

  config.tlsIdentity = thisIdentity; <i class="conum" data-value="4"></i><b>(4)</b>

// set the TLS Identity
thisConfig.tlsIdentity = thisIdentity; <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on example:</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ensure TLS is used</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get key and certificate data</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the retrieved data to create and store the TLS identity</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Set this identity as the one presented in response to the client&#8217;s prompt</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_create-self-signed-cert">
<div class="paragraph">
<p>Create a TLSIdentity for the server using convenience API.
The system generates a self-signed certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">thisConfig.disableTLS  = false; <i class="conum" data-value="1"></i><b>(1)</b>

// Use a self-signed certificate
NSDictionary* attrs =
  @{ kCBLCertAttrCommonName: @"Couchbase Inc" }; <i class="conum" data-value="2"></i><b>(2)</b>

thisIdentity =
  [CBLTLSIdentity createIdentityForServer: YES /* isServer */
      attributes: attrs
      expiration: [NSDate dateWithTimeIntervalSinceNow: 86400]
            label: @" couchbase-docs-cert"
            error: &amp;error]; <i class="conum" data-value="3"></i><b>(3)</b>

// set the TLS Identity
thisConfig.tlsIdentity = thisIdentity; <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on example:</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ensure TLS is used.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Map the required certificate attributes, in this case the common name.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create the required TLS identity using the attributes.
Add to Keychain as 'couchbase-docs-cert'.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Configure the server to present the defined identity credentials when prompted.</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_use-anonymous-self-signed-certificate">
<div class="paragraph">
<p>This examples uses an anonymous self signed certificate.
Generated certificates are held in Keychain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">thisConfig.disableTLS  = false; <i class="conum" data-value="1"></i><b>(1)</b>

// Use an anonymous self-signed cert
thisConfig.tlsIdentity = nil; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on example:</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>These are are the default settings. Authentication using an anonymous self-signed certificate is assumed.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authenticating-the-client"><a class="anchor" href="#authenticating-the-client"></a>Authenticating the Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section: <a href="#use-basic-authentication">Use Basic Authentication</a>  |  <a href="#using-client-certificate-authentication">Using Client Certificate Authentication</a>  |  <a href="#delete-tls-identity">Delete Entry</a>  |  <a href="#the-impact-of-tls-settings">The Impact of TLS Settings</a></p>
</div>
<div class="paragraph">
<p>Define how the server (listener) will authenticate the client as one it is prepared to interact with.</p>
</div>
<div class="paragraph">
<p>Whilst client authentication is optional, Couchbase lite provides the necessary tools to implement it.
Use the
<a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html">URLEndpointListenerConfiguration</a> class&#8217;s <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListenerConfiguration.html#/c:objc(cs)CBLURLEndpointListenerConfiguration(py)authenticator">authenticator</a> method to specify how the client-supplied credentials are to be authenticated.</p>
</div>
<div class="paragraph">
<p>Valid options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No authentication&#8201;&#8212;&#8201;If you do not define an Authenticator then all clients are accepted.</p>
</li>
<li>
<p>Basic Authentication&#8201;&#8212;&#8201;uses the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLListenerPasswordAuthenticator.html">ListenerPasswordAuthenticator</a> to authenticate the client using the client-supplied username and password (from the http authentication header).</p>
</li>
<li>
<p><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLListenerCertificateAuthenticator.html">ListenerCertificateAuthenticator</a>&#8201;&#8212;&#8201;which authenticates the client using a client supplied chain of one or more certificates.
You should initialize the authenticator using one of the following constructors:</p>
<div class="ulist">
<ul>
<li>
<p>A list of one or more root certificates&#8201;&#8212;&#8201;the client supplied certificate must end at a certificate in this list if it is to be authenticated</p>
</li>
<li>
<p>A block of code that assumes total responsibility for authentication&#8201;&#8212;&#8201;it must return a boolean response (true for an authenticated client, or false for a failed authentication).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="use-basic-authentication"><a class="anchor" href="#use-basic-authentication"></a>Use Basic Authentication</h3>
<div class="paragraph">
<p>Define how to authenticate client-supplied username and password credentials.
To use client-supplied certificates instead&#8201;&#8212;&#8201;see: <a href="#using-client-certificate-authentication">Using Client Certificate Authentication</a></p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Password authentication</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">// Configure Client Security using an Authenticator
// For example, Basic Authentication <i class="conum" data-value="1"></i><b>(1)</b>
thisConfig.authenticator =
  [[CBLListenerPasswordAuthenticator alloc]
    initWithBlock: ^BOOL(NSString * validUser, NSString * validPassword) {
      if ([self isValidCredentials: validUser password:validPassword]) {
          return  YES;
      }
      return NO;
  }];</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on example:</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Where 'username'/'password' are the client-supplied values (from the http-authentication header) and <code>validUser</code>/<code>validPassword</code> are the values acceptable to the server.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-client-certificate-authentication"><a class="anchor" href="#using-client-certificate-authentication"></a>Using Client Certificate Authentication</h3>
<div class="paragraph">
<p>Define how the server will authenticate client-supplied certificates.</p>
</div>
<div class="paragraph">
<p>There are two ways to authenticate a client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A chain of one or more certificates that ends at a certificate in the list of certificates supplied to the constructor for  <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLListenerCertificateAuthenticator.html">ListenerCertificateAuthenticator</a>.</p>
</li>
<li>
<p>Application logic: This method assumes complete responsibility for verifying and authenticating the client.</p>
<div class="paragraph">
<p>If the parameter supplied to the constructor for <code>ListenerCertificateAuthenticator</code> is of type  <code>ListenerCertificateAuthenticatorDelegate</code>, all other forms of authentication are bypassed.</p>
</div>
<div class="paragraph">
<p>The client response to the certificate request is passed to the method supplied as the constructor parameter.
The logic should take the form of function or block (such as, a closure expression) where the platform allows.</p>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 8. Set Certificate Authorization</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_root-ca"></a>Root CA</p>
</li>
<li>
<p><a id="tabset2_application-logic"></a>Application Logic</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_root-ca">
<div class="paragraph">
<p>Configure the server (listener) to authenticate the client against a list of one or more certificates provided by the server to the the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLListenerCertificateAuthenticator.html">ListenerCertificateAuthenticator</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">// Configure the client authenticator
NSURL *certURL =
  [[NSBundle mainBundle]
    URLForResource: @"cert" withExtension: @"p12"]; <i class="conum" data-value="1"></i><b>(1)</b>
NSData *data =
  [[NSData alloc]
    initWithContentsOfURL: certURL];
SecCertificateRef rootCertRef =
  SecCertificateCreateWithData(NULL, (__bridge CFDataRef)data);

thisConfig.authenticator =
  [[CBLListenerCertificateAuthenticator alloc]
    initWithRootCerts: @[(id)CFBridgingRelease(rootCertRef)]];  <i class="conum" data-value="2"></i><b>(2)</b> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on example:</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the identity data to authenticate against.
This can be, for example, from a resource file provided with the app, or an identity previously saved in Keychain.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure the authenticator to authenticate the client supplied certificate(s) using these root certs.
A valid client will provide one or more certificates that match a certificate in this list.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add the authenticator to the listener configuration.</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_application-logic">
<div class="paragraph">
<p>Configure the server (listener) to authenticate the client using user-supplied logic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">// Authenticate self-signed cert
// using application logic
CBLListenerCertificateAuthenticator* thisListenerAuth =
  [[CBLListenerCertificateAuthenticator alloc]
    initWithBlock: ^BOOL(NSArray *certs) {
      SecCertificateRef cert =
        (__bridge SecCertificateRef)(certs[0]); <i class="conum" data-value="1"></i><b>(1)</b>
      CFStringRef cnRef;
      OSStatus status = SecCertificateCopyCommonName(cert, &amp;cnRef);
      if (status == errSecSuccess) {
          NSString* cn = (NSString*)CFBridgingRelease(cnRef);
          if ([self._allowlistedCommonNames containsObject: cn])
              return YES;
      }
      return NO;
  }];  <i class="conum" data-value="2"></i><b>(2)</b>

thisConfig.authenticator = thisListenerAuth; <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on example:</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the identity data to authenticate against.
This can be, for example, from a resource file provided with the app, or an identity previously saved in Keychain.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure the Authenticator to pass the root certificates to a user supplied code block.
This code assumes complete responsibility for authenticating the client supplied certificate(s).
It must return a boolean value; with <code>true</code> denoting the client supplied certificate authentic.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add the authenticator to the listener configuration.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="delete-tls-identity"><a class="anchor" href="#delete-tls-identity"></a>Delete Entry</h3>
<div class="paragraph">
<p>You can remove unwanted TLS identities from Keychain using the convenience API.</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Deleting TLS Identities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">[CBLTLSIdentity deleteIdentityWithLabel:thisSecId error: &amp;error];</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-impact-of-tls-settings"><a class="anchor" href="#the-impact-of-tls-settings"></a>The Impact of TLS Settings</h3>
<div class="paragraph">
<p>The table in this section shows the expected system behavior (in regards to security) depending on the TLS configuration settings deployed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Expected system behavior</caption>
<colgroup>
<col style="width: 12%;">
<col style="width: 44%;">
<col style="width: 44%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">disableTLS</th>
<th class="tableblock halign-left valign-top">tlsIdentity (corresponding to server)</th>
<th class="tableblock halign-left valign-top">Expected system behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignored</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>TLS is disabled; all communication is plain text.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>set to nil</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>The system will auto generate an <em>anonymous</em> self signed cert.</p>
</li>
<li>
<p>Active peers (clients) should be configured to accept self-signed certificates.</p>
</li>
<li>
<p>Communication is encrypted</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set to server identity generated from a self- or CA-signed certificate</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On first use&#8201;&#8212;&#8201;Bring your own certificate and private key; for example, using the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLTLSIdentity.html">TLSIdentity</a> class&#8217;s <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLTLSIdentity.html#/c:objc(cs)CBLTLSIdentity(cm)createIdentityForServer:attributes:expiration:label:error:">createIdentity()</a> method to add it to the Keychain.</p>
</li>
<li>
<p>Each time&#8201;&#8212;&#8201;Use the server identity from the certificate stored in the Keychain; for example, using the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLTLSIdentity.html">TLSIdentity</a> class&#8217;s <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLTLSIdentity.html#/c:objc(cs)CBLTLSIdentity(cm)identityWithLabel:error:">identityWithLabel:error</a> method with the alias you want to retrieve..</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>System will use the configured identity.</p>
</li>
<li>
<p>Active peers will validate the server certificate corresponding to the TLSIdentity (as long as they are configured to not skip validation&#8201;&#8212;&#8201;see <a href="#tls-security">TLS Security</a>).</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="start-listener"><a class="anchor" href="#start-listener"></a>Start Listener</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have completed the Listener&#8217;s configuration settings you can initialize the Listener instance and start it running&#8201;&#8212;&#8201;see: <a href="#initialize-and-start-listener">Example 10</a></p>
</div>
<div id="initialize-and-start-listener" class="exampleblock">
<div class="title">Example 10. Initialize and start listener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">// Initialize the listener <i class="conum" data-value="1"></i><b>(1)</b>
CBLURLEndpointListener* thisListener = nil;
thisListener =
  [[CBLURLEndpointListener alloc] initWithConfig: thisConfig];

// start the listener <i class="conum" data-value="2"></i><b>(2)</b>
BOOL success = [thisListener startWithError: &amp;error];
if (!success) {
    NSLog(@"Cannot start the listener: %@", error);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitor-listener"><a class="anchor" href="#monitor-listener"></a>Monitor Listener</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the Listener&#8217;s <code><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/CBLURLEndpointListener.html#/c:objc(cs)CBLURLEndpointListener(py)status">status</a></code> property/method to get counts of total and active connections&#8201;&#8212;&#8201;see: <a href="#get-connection-counts">Example 11</a>.</p>
</div>
<div class="paragraph">
<p>You should note that these counts can be extremely volatile. So, the actual number of active connections may have changed, by the time the <code><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc/Classes/Type%20Definitions/CBLConnectionStatus.html">ConnectionStatus</a></code> class returns a result.</p>
</div>
<div id="get-connection-counts" class="exampleblock">
<div class="title">Example 11. Get connection counts</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/objc/examples/code_snippets/p2psync-websocket.m">NSUInteger totalConnections = thisListener.status.connectionCount;
NSUInteger activeConnections = thisListener.status.activeConnectionCount;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on example:</strong></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stop-listener"><a class="anchor" href="#stop-listener"></a>Stop Listener</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is best practice to check tha status of the listener&#8217;s connections and stop only when you have confirmed that there are no active connections&#8201;&#8212;&#8201;see <a href="#get-connection-counts">Example 11</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. Stop listener using <code>stop</code> method</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/objc/examples/code_snippets/p2psync-websocket.m">[thisListener stop];</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Closing the database will also close the listener.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id=""><a class="anchor" href="#"></a></h6>
<div class="ulist">
<div class="title">How to</div>
<ul>
<li>
<p><a href="objc-p2psync-websocket-using-passive.html" class="page">Passive Peer</a></p>
</li>
<li>
<p><a href="objc-p2psync-websocket-using-active.html" class="page">Active Peer</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Concepts</div>
<ul>
<li>
<p><a href="../learn/objc-p2psync-websocket.html" class="page">Peer-to-Peer Data Sync</a></p>
</li>
<li>
<p><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc">API References</a>
.</p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="ulist">
<div class="title">Community Resources ...</div>
<ul>
<li>
<p><a href="https://forums.couchbase.com/c/mobile/14">Forum</a> <strong>|</strong> <a href="https://blog.couchbase.com/">Blog</a> <strong>|</strong> <a href="https://docs.couchbase.com/tutorials/index.html">Tutorials</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title"></div>
<ul>
<li>
<p><a href="#tutorials:cbl-p2p-sync-websockets:swift/cbl-p2p-sync-websockets.adoc" class="page unresolved">Getting Started with Peer-to-Peer Synchronization</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase_logo_black.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span> 2021 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../../../_/js/vendor/fontawesome.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
