<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Data Sync using Sync Gateway | Couchbase Docs Preview Site</title>
<link rel="canonical" href="https://ibsoln.github.io/couchbase-lite/2.8/csharp/learn/csharp-replication.html">
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Couchbase Lite for C# -- Synchronizing data changes between local and remote databases using Sync Gateway">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="couchbase-lite">
<meta name="dcterms.identifier" content="2.8">
<meta name="generator" content="Antora 2.3.3">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">

              <a class="navbar-brand" href="https://www.couchbase.com">
                <img src="../../../../_/img/couchbase-documentation-logo.svg" alt="Couchbase" />
              </a>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://ibsoln.github.io/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../tutorials/index.html">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <form class="navbar-item search">
                  <input type="text" placeholder="Search Docs" class="query" id="search-query" />
                  <button type="button" class="search-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </form>
                <a class="btn btn-primary try-btn" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<nav class="nav">
<div class="left-sidebar-menu">
<div class="version-control-box">
<div class="component-frame">
<div class="frame-icon">
<img src="../../../../_/img/server-icon.png" alt="">
</div>
<div class="frame-body">
<h4 class="title"><span class="">Couchbase Lite</span></h4>
<a class="frame-link component" href="../../index.html"> <span class="version">2.8</span></a>
</div>
</div>
</div>
<div class="nav-menu">
<ul class="nav-list">
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../introduction.html">Introduction</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../cbl-whatsnew.html">What&#8217;s New</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../android/quickstart.html">Android (Java)</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../android/start/java-android-gs-prereqs.html">Start Here!</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/start/java-android-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/start/java-android-gs-build.html">Build and Run</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-database.html">Databases</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/java-android-prebuilt-database.html">Pre-built Database</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-document.html">Documents</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-blob.html">Blobs</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../android/learn/java-android-query.html">Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/learn/java-android-query-live.html">Live Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/learn/java-android-query-predictive.html">Predictive Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/learn/java-android-query-troubleshooting.html">Query Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-fts.html">Full Text Search</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../android/learn/java-android-landing-replications.html">Data Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/learn/java-android-dbreplica.html">Intra-Device</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/learn/java-android-replication.html">Remote Sync Gateway</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="../../android/learn/java-android-p2psync-websocket.html">Peer-to-Peer</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../android/advance/java-android-p2psync-websocket-using-passive.html">Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../android/advance/java-android-p2psync-websocket-using-active.html">Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../android/learn/java-android-p2psync-custom.html">Integrate a Custom Listener</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/learn/java-android-conflict.html">Handling Data Conflicts</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-android">API&#160;References</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/advance/java-android-dep-upgrade.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/java-android-troubleshooting-logs.html">Using Logs</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/java-android-troubleshooting-queries.html">Troubleshooting Queries</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/product/java-android-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/product/java-android-compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../android/product/java-android-supported-os.html">Supported OS</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../android/refer/java-android-refer-glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../quickstart.html">C#.Net</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Start Here!</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../start/csharp-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../start/csharp-gs-build.html">Build and Run</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="csharp-database.html">Databases</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../csharp-prebuilt-database.html">Pre-built Database</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="csharp-document.html">Documents</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="csharp-blob.html">Blobs</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="csharp-query.html">Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="csharp-query-live.html">Live Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="csharp-query-predictive.html">Predictive Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="csharp-query-troubleshooting.html">Query Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="csharp-fts.html">Full Text Search</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="csharp-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="csharp-landing-replications.html">Data Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="csharp-dbreplica.html">Intra-Device</a>
</span>
</li>
<li class="nav-item is-current-page is-active is-active-depth-2  " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="csharp-replication.html">Remote Sync Gateway</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="csharp-p2psync-websocket.html">Peer-to-Peer</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../advance/csharp-p2psync-websocket-using-passive.html">Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../advance/csharp-p2psync-websocket-using-active.html">Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="csharp-p2psync-custom.html">Integrate a Custom Listener</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="csharp-conflict.html">Handling Data Conflicts</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net">API&#160;References</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../advance/csharp-dep-upgrade.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../csharp-troubleshooting-logs.html">Using Logs</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../csharp-troubleshooting-queries.html">Troubleshooting Queries</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../product/csharp-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../product/csharp-compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../product/csharp-supported-os.html">Supported OS</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../refer/csharp-refer-glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../java/quickstart.html">Java</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../java/start/java-gs-prereqs.html">Start Here!</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/start/java-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/start/java-gs-build.html">Build and Run</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-database.html">Databases</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/java-prebuilt-database.html">Pre-built Database</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-document.html">Documents</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-blob.html">Blobs</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../java/learn/java-query.html">Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/learn/java-query-live.html">Live Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/learn/java-query-predictive.html">Predictive Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/learn/java-query-troubleshooting.html">Query Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-fts.html">Full Text Search</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../java/learn/java-landing-replications.html">Data Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/learn/java-dbreplica.html">Intra-Device</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/learn/java-replication.html">Remote Sync Gateway</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="../../java/learn/java-p2psync-websocket.html">Peer-to-Peer</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../java/advance/java-p2psync-websocket-using-passive.html">Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../java/advance/java-p2psync-websocket-using-active.html">Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../java/learn/java-p2psync-custom.html">Integrate a Custom Listener</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/learn/java-conflict.html">Handling Data Conflicts</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-java">API&#160;References</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/advance/java-dep-upgrade.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/java-troubleshooting-logs.html">Using Logs</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/java-troubleshooting-queries.html">Troubleshooting Queries</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/product/java-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/product/java-compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../java/product/java-supported-os.html">Supported OS</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../java/refer/java-refer-glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../objc/quickstart.html">Objective-C</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../objc/start/objc-gs-prereqs.html">Start Here!</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/start/objc-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/start/objc-gs-build.html">Build and Run</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../objc/learn/objc-database.html">Databases</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../objc/objc-prebuilt-database.html">Pre-built Database</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../objc/learn/objc-document.html">Documents</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../objc/learn/objc-blob.html">Blobs</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../objc/learn/objc-query.html">Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/learn/objc-query-live.html">Live Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/learn/objc-query-predictive.html">Predictive Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/learn/objc-query-troubleshooting.html">Query Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../objc/learn/objc-fts.html">Full Text Search</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../objc/learn/objc-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../objc/learn/objc-landing-replications.html">Data Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/learn/objc-dbreplica.html">Intra-Device</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/learn/objc-replication.html">Remote Sync Gateway</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="../../objc/learn/objc-p2psync-websocket.html">Peer-to-Peer</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../objc/advance/objc-p2psync-websocket-using-passive.html">Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../objc/advance/objc-p2psync-websocket-using-active.html">Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../objc/learn/objc-p2psync-custom.html">Integrate a Custom Listener</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../objc/learn/objc-conflict.html">Handling Data Conflicts</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-objc">API&#160;References</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../objc/advance/objc-dep-upgrade.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/objc-troubleshooting-logs.html">Using Logs</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/objc-troubleshooting-queries.html">Troubleshooting Queries</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/objc-troubleshooting-crashes.html">Decoding Crash Logs</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/product/objc-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/product/objc-compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../objc/product/objc-supported-os.html">Supported OS</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../objc/refer/objc-refer-glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../swift/quickstart.html">Swift</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../swift/start/swift-gs-prereqs.html">Start Here!</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/start/swift-gs-install.html">Install</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/start/swift-gs-build.html">Build and Run</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-database.html">Databases</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/swift-prebuilt-database.html">Pre-built Database</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-document.html">Documents</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-blob.html">Blobs</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../swift/learn/swift-query.html">Queries</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/learn/swift-query-live.html">Live Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/learn/swift-query-predictive.html">Predictive Query</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/learn/swift-query-troubleshooting.html">Query Troubleshooting</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-fts.html">Full Text Search</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-indexing.html">Indexing</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<a class="nav-link" href="../../swift/learn/swift-landing-replications.html">Data Sync</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/learn/swift-dbreplica.html">Intra-Device</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/learn/swift-replication.html">Remote Sync Gateway</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="../../swift/learn/swift-p2psync-websocket.html">Peer-to-Peer</a>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/advance/swift-p2psync-websocket-using-passive.html">Passive Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/advance/swift-p2psync-websocket-using-active.html">Active Peer</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="../../swift/learn/swift-p2psync-custom.html">Integrate a Custom Listener</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/learn/swift-conflict.html">Handling Data Conflicts</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-swift">API&#160;References</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/advance/swift-dep-upgrade.html">Upgrade</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Troubleshooting</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/swift-troubleshooting-logs.html">Using Logs</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/swift-troubleshooting-queries.html">Troubleshooting Queries</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/swift-troubleshooting-crashes.html">Decoding Crash Logs</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Product Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/product/swift-releasenotes.html">Release Notes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/product/swift-compatibility.html">Compatibility</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="../../swift/product/swift-supported-os.html">Supported OS</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../swift/refer/swift-refer-glossary.html">Glossary</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../javascript.html">JavaScript</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../javascript.html">JavaScript</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<a class="nav-link" href="../../../../sync-gateway/2.8/introduction.html">Sync&#160;Gateway</a>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../../../sync-gateway/2.8/refer/config-properties.html">Configure</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="../../../../sync-gateway/2.8/refer/rest-api-admin.html">REST API</a>
</span>
</li>
</ul>
</li>
</ul>
</div>
<a href="#" class="menu-expand-toggle"> <span>Navigation</span> <i class="fas fa-times-circle"></i> <i class="fas fa-chevron-circle-left"></i></a>
</div></nav>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ianbridge/CouchbaseDocs/bau/cbl/modules/csharp/pages/learn/csharp-replication.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../index.html">Couchbase Lite</a></li>
<li class="crumb"><a href="../quickstart.html">C#.Net</a></li>
<li class="crumb"><a href="csharp-landing-replications.html">Data Sync</a></li>
<li class="crumb"><a href="csharp-replication.html">Remote Sync Gateway</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Data Sync using Sync Gateway</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Description&#8201;&#8212;&#8201;<em>Couchbase Lite for C#&#8201;&#8212;&#8201;Synchronizing data changes between local and remote databases using Sync Gateway</em><br>
Related Content&#8201;&#8212;&#8201;<a href="csharp-conflict.html" class="page">Handling Data Conflicts</a> | <a href="csharp-dbreplica.html" class="page">Intra-device Data Sync</a> | <a href="csharp-p2psync-websocket.html" class="page">Peer-to-Peer</a></p>
</div>
</blockquote>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Code Snippets</div>
The code examples are indicative only.
They demonstrate basic concepts and approaches to using a feature.
Use them as inspiration and adapt these examples to best practice when developing applications for your platform.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite for C#.Net provides API support for secure, bi-directional, synchronization of data changes between mobile applications and a central server database.
It does so by using a replicator to interact with Sync Gateway.
Simply put, the replicator is designed to send documents from a source to a target database.
In this case, between a local Couchbase Lite database and remote Sync Gateway database (server or cloud).</p>
</div>
<div class="paragraph">
<p>This content provides sample code and configuration examples covering the implementation of a replication using Sync Gateway.</p>
</div>
<div class="paragraph">
<p>Your application runs a replicator (also referred to here as a client), which  will initiate connection with a Sync Gateway (also referred to here as a server) and participate in the replication of database changes to bring both local and remote databases into sync.</p>
</div>
<div class="paragraph">
<p>Subsequent sections provide additional details and examples for the main configuration options.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replication-protocol"><a class="anchor" href="#replication-protocol"></a>Replication Protocol</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="scheme"><a class="anchor" href="#scheme"></a>Scheme</h3>
<div class="paragraph">
<p>Couchbase Mobile uses a replication protocol based on WebSockets fof replication.
To use this protocol the replication URL should specify WebSockets as the URL scheme (see the <a href="#lbl-cfg-tgt">Configure Target</a> section below).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Incompatibilities</dt>
<dd>
<p>Couchbase Lite&#8217;s replication protocol is <strong>incompatible</strong> with CouchDB-based databases.
And since Couchbase Lite 2.x+ only supports the new protocol, you will need to run a version of Sync Gateway that supports it&#8201;&#8212;&#8201;see: <a href="../product/csharp-compatibility.html" class="page">Compatibility</a>.</p>
</dd>
<dt class="hdlist1">Legacy Compatibility</dt>
<dd>
<p>Clients using Couchbase Lite 1.x can continue to use <code>http</code> as the URL scheme.
Sync Gateway 2.x+ will automatically use:</p>
<div class="ulist">
<ul>
<li>
<p>The 1.x replication protocol when a Couchbase Lite 1.x client connects through <code>http://localhost:4984/db</code></p>
</li>
<li>
<p>The 2.0 replication protocol when a Couchbase Lite 2.0 client connects through <code>ws://localhost:4984/db</code>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can find further information in our blog: <a href="https://blog.couchbase.com/data-replication-couchbase-mobile/" target="_blank" rel="noopener">Introducing the Data Replication Protocol</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-ord"><a class="anchor" href="#lbl-repl-ord"></a>Ordering</h3>
<div class="paragraph">
<p>To optimize for speed, the replication protocol doesn&#8217;t guarantee that documents will be received in a particular order.
So we don&#8217;t recommend to rely on that when using the replication or database change listeners for example.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-summary"><a class="anchor" href="#configuration-summary"></a>Configuration Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You should configure and initialize a replicator for each Couchbase Lite database instance you want to sync.
<a href="#ex-simple-repl">Example 1</a> shows the configuration and initialization process.</p>
</div>
<div id="ex-simple-repl" class="exampleblock">
<div class="title">Example 1. Replication configuration and initialization</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// . . . preceding code. for example . . .
private static ListenerToken _thisListenerToken;
var Database thisDB;
// . . . other code . . .
// initialize the replicator configuration

var thisUrl = new URLEndpoint("wss://listener.com:4984/otherDB"); <i class="conum" data-value="1"></i><b>(1)</b>
var config = new ReplicatorConfiguration(thisDB, thisUrl);


// Set replicator type
thisConfig.ReplicatorType = ReplicatorType.PushAndPull;

// Configure Sync Mode
thisConfig.Continuous = true; // default value

// Configure Server Security -- only accept self-signed certs
thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="2"></i><b>(2)</b>

// Configure Client Security <i class="conum" data-value="3"></i><b>(3)</b>
// Configure basic auth using user credentials
thisConfig.Authenticator = new BasicAuthenticator("Our Username", "Our Password");

/* Optionally set a conflict resolver call back */ <i class="conum" data-value="4"></i><b>(4)</b>
// Use built-in resolver
thisConfig.ConflictResolver = new LocalWinConflictResolver();  //

// optionally use custom resolver
thisConfig.ConflictResolver = new ConflictResolver(
  (conflict) =&gt; {
    /* define resolver function */
  }
); //

// Initialize and start a replicator
// Initialize replicator with configuration data
var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="5"></i><b>(5)</b>

//Optionally add a change listener <i class="conum" data-value="6"></i><b>(6)</b>
_thisListenerToken =
  thisReplicator.AddChangeListener((sender, args) =&gt;
    {
      if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {
          Console.WriteLine("Replication stopped");
      }
    });

// Start replicator
thisReplicator.Start(); <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on Example</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html">ReplicatorConfiguration</a> class&#8217;s constructor&#8201;&#8212;&#8201;<a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html#Couchbase_Lite_Sync_ReplicatorConfiguration__ctor_Couchbase_Lite_Database_Couchbase_Lite_Sync_IEndpoint">ReplicatorConfiguration(Database database, IEndpoint target)</a>&#8201;&#8212;&#8201;to initialize the replicator configuration with the local database&#8201;&#8212;&#8201;see also: <a href="#lbl-cfg-tgt">Configure Target</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure how the client will authenticate the server.
Here we say connect only to servers presenting a self-signed certificate.
By default, clients accept only servers presenting certificates that can be verified using the OS bundled Root CA Certificates&#8201;&#8212;&#8201;see: <a href="#lbl-svr-auth">Server Authentication</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configure the credentials the client will present to the server.
Here we say to provide <em>Basic Authentication</em> credentials. Other options are available&#8201;&#8212;&#8201;see: <a href="#lbl-client-auth">Client Authentication</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Configure how the replication should handle conflict resolution&#8201;&#8212;&#8201;see: <a href="csharp-conflict.html" class="page">Handling Data Conflicts</a> topic for mor on conflict resolution.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Initialize the replicator using your configuration object&#8201;&#8212;&#8201;see: <a href="#lbl-init-repl">Initialization</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Optionally, register an observer, which will notify you of changes to the replication status&#8201;&#8212;&#8201;see: <a href="#lbl-repl-mon">Monitoring</a></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Start the replicator &#8201;&#8212;&#8201;see: <a href="#lbl-repl-start">Start Replicator</a>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-cfg-repl"><a class="anchor" href="#lbl-cfg-repl"></a>Configuration</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-cfg-tgt">Configure Target</a>  |  <a href="#lbl-cfg-sync">Sync Mode</a>  |  <a href="#lbl-cfg-htbt">Heartbeat</a>  |  <a href="#lbl-svr-auth">Server Authentication</a>  | <a href="#lbl-client-auth">Client Authentication</a> | <a href="#lbl-repl-evnts">Monitor Document Changes</a> |  <a href="#lbl-repl-hdrs">Custom&#160;Headers</a> |  <a href="#lbl-repl-ckpt">Checkpoint Starts</a> |  <a href="#lbl-repl-fltrs">Replication Filters</a> | <a href="#lbl-repl-chan">Channels</a> | <a href="#lbl-repl-delta">Delta Sync</a></p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="lbl-cfg-tgt"><a class="anchor" href="#lbl-cfg-tgt"></a>Configure Target</h3>
<div class="paragraph">
<p>Use the
<a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html">ReplicatorConfiguration</a> class and <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html#Couchbase_Lite_Sync_ReplicatorConfiguration__ctor_Couchbase_Lite_Database_Couchbase_Lite_Sync_IEndpoint">ReplicatorConfiguration(Database database, IEndpoint target)</a> constructor to initialize the replication configuration with local and remote database locations.</p>
</div>
<div class="paragraph">
<p>The constructor provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the name of the local database to be sync&#8217;d</p>
</li>
<li>
<p>the server&#8217;s URL (including the port number and the name of the remote database to sync with)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>It is expected that the app will identify the IP address and URL and append the remote database name to the URL endpoint, producing for example: <code>wss://10.0.2.2:4984/travel-sample</code></p>
</div>
<div class="paragraph">
<p>The URL scheme for web socket URLs uses <code>ws:</code> (non-TLS) or <code>wss:</code> (SSL/TLS) prefixes.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 2. Add Target to Configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/p2psync-websocket.cs">// initialize the replicator configuration

var thisUrl = new URLEndpoint("wss://l10.0.2.2:4984/anotherDB"); <i class="conum" data-value="1"></i><b>(1)</b>
var config = new ReplicatorConfiguration(thisDB, thisUrl);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on Example</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note use of the <code>wss://</code> prefix to ensure TLS encryption (strongly recommended in production)</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-cfg-sync"><a class="anchor" href="#lbl-cfg-sync"></a>Sync Mode</h3>
<div class="paragraph">
<p>Here we define the direction and type of replication we want to initiate.</p>
</div>
<div class="paragraph">
<p>We use <code><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html">ReplicatorConfiguration</a></code> class&#8217;s <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html#Couchbase_Lite_Sync_ReplicatorConfiguration_ReplicatorType">ReplicatorType</a> and
<code><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html#Couchbase_Lite_Sync_ReplicatorConfiguration_Continuous">Continuous</a></code> parameters, to tell the replicator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The direction of the replication:
<code><strong>pushAndPull</strong></code>; <code>pull</code>; <code>push</code></p>
</li>
<li>
<p>The type of replication, that is:</p>
<div class="ulist">
<ul>
<li>
<p>Continuous&#8201;&#8212;&#8201;remaining active indefinitely to replicate changed documents (<code>continuous=true</code>).</p>
</li>
<li>
<p>Ad-hoc&#8201;&#8212;&#8201;a one-shot replication of changed documents (<code>continuous=false</code>).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="ex-repl-sync" class="exampleblock">
<div class="title">Example 3. Configure replicator type and mode</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// Set replicator type
thisConfig.ReplicatorType = ReplicatorType.PushAndPull;

// Configure Sync Mode
thisConfig.Continuous = true; // default value</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-cfg-htbt"><a class="anchor" href="#lbl-cfg-htbt"></a>Heartbeat</h3>
<div class="paragraph">
<p>A point to consider when initiating a replication, particularly a continuous replication, is keeping the connection alive.
Couchbase Lite minimizes the chance of dropped connections by having the replicator maintain a heartbeat; essentially pinging the Sync Gateway at a configurable interval.</p>
</div>
<div class="paragraph">
<p>When necessary you can adjust this interval using  <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html#Couchbase_Lite_Sync_ReplicatorConfiguration_Heartbeat">Heartbeat()</a> as shown in&#8201;&#8212;&#8201;<a href="#ex-htbt">Example 4</a>.
You may need to do this when, for example, when the Sync Gateway is behind a load balancer, which may have its own keep-alive parameters&#8201;&#8212;&#8201;see Sync Gateway&#8217;s topic <a href="../../../../sync-gateway/2.8/load-balancer.html#websocket-connection" class="page">Load Balancer - Keep Alive</a>.</p>
</div>
<div class="paragraph">
<p>The default heartbeat value is 300 (5 minutes).</p>
</div>
<div id="ex-htbt" class="exampleblock">
<div class="title">Example 4. Setting heartbeat interval</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#"></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>heartbeat</code> value sets the interval (in seconds) between the heartbeat pulses.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-svr-auth"><a class="anchor" href="#lbl-svr-auth"></a>Server Authentication</h3>
<div class="paragraph">
<p>Define the credentials your app (the client) is expecting to receive from the Sync Gateway (the server) in order to ensure it is prepared to continue with the sync.</p>
</div>
<div class="paragraph">
<p>Note that the client cannot authenticate the server if TLS is turned off.
When TLS is enabled (Sync Gateway&#8217;s default) the client <em>must</em> authenticate the server.
If the server cannot provide acceptable credentials then the connection will fail.</p>
</div>
<div class="paragraph">
<p>Use <code><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html">ReplicatorConfiguration</a></code> properties <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html#Couchbase_Lite_Sync_ReplicatorConfiguration_AcceptOnlySelfSignedServerCertificate">AcceptOnlySelfSignedServerCertificate</a> and <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html#Couchbase_Lite_Sync_ReplicatorConfiguration_PinnedServerCertificate">PinnedServerCertificate</a>, to tell the replicator how to verify server-supplied TLS server certificates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is a pinned certificate, nothing else matters, the server cert must <strong>exactly</strong> match the pinned certificate.</p>
</li>
<li>
<p>If there are no pinned certs and <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html#Couchbase_Lite_Sync_ReplicatorConfiguration_AcceptOnlySelfSignedServerCertificate">AcceptOnlySelfSignedServerCertificate</a> is <code>true</code> then any self-signed certificate is accepted.  Certificates that are not self signed are rejected, no matter who signed them.</p>
</li>
<li>
<p>If there are no pinned certificates and <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorConfiguration.html#Couchbase_Lite_Sync_ReplicatorConfiguration_AcceptOnlySelfSignedServerCertificate">AcceptOnlySelfSignedServerCertificate</a> is <code>false</code> (default), the client validates the servers certificates against the system CA certificates.  The server must supply a chain of certificates whose root is signed by one of the certificates in the system CA bundle.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 5. Set Server TLS security</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_ca-cert"></a>CA Cert</p>
</li>
<li>
<p><a id="tabset1_self-signed-cert"></a>Self Signed Cert</p>
</li>
<li>
<p><a id="tabset1_pinned-certificate"></a>Pinned Certificate</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_ca-cert">
<div class="paragraph">
<p>Set the client to expect and accept only CA attested certificates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// Configure Server Security -- only accept CA certs
thisConfig.AcceptOnlySelfSignedServerCertificate = false; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on Example</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the default.
Only certificate chains with roots signed by a trusted CA are allowed.
Self signed certificates are not allowed.</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_self-signed-cert">
<div class="paragraph">
<p>Set the client to expect and accept only self-signed certificates</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// Configure Server Security -- only accept self-signed certs
thisConfig.AcceptOnlySelfSignedServerCertificate = true; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on Example</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set this to <code>true</code> to accept any self signed cert.
Any certificates that are not self-signed are rejected.</td>
</tr>
</table>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_pinned-certificate">
<div class="paragraph">
<p>Set the client to expect and accept only a pinned certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// Only CA Certs accepted
thisConfig.AcceptOnlySelfSignedServerCertificate =
  false; <i class="conum" data-value="1"></i><b>(1)</b>

var thisCert =
  new X509Certificate2(caData); <i class="conum" data-value="2"></i><b>(2)</b>

thisConfig.PinnedServerCertificate =
  thisCert; <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure to accept only CA certs</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure the pinned certificate using data from the byte array <code>cert</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set the certificate to be compared with that provided by the server</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This all assumes that you have configured the Sync Gateway to provide the appropriate SSL certificates, and have included the appropriate certificate in your app bundle&#8201;&#8212;&#8201;for more on this see: <a href="#lbl-cert-pinning">Certificate Pinning</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-client-auth"><a class="anchor" href="#lbl-client-auth"></a>Client Authentication</h3>
<div class="paragraph">
<p>By default, Sync Gateway does not enable authentication.
This is to make it easier to get up and running with synchronization.
You can enable authentication with the following properties in the configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "databases": {
    "mydatabase": {
      "users": {
        "GUEST": {"disabled": true}
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To authenticate with Sync Gateway, an associated user must first be created.
Sync Gateway users can be created through the <a href="../../../../sync-gateway/2.8/refer/rest-api-admin.html#/user/post__db___user_" class="page"><code>POST /{tkn-db}/_user</code></a> endpoint on the Admin REST API.
Provided that the user exists on Sync Gateway, there are two ways to authenticate from a Couchbase Lite client: Basic Authentication or Session Authentication.</p>
</div>
<div class="sect3">
<h4 id="basic-authentication"><a class="anchor" href="#basic-authentication"></a>Basic Authentication</h4>
<div class="paragraph">
<p>You can provide a user name and password to the basic authenticator class method.
Under the hood, the replicator will send the credentials in the first request to retrieve a <code>SyncGatewaySession</code> cookie and use it for all subsequent requests during the replication.
This is the recommended way of using basic authentication.
The following example initiates a one-shot replication as the user <strong>username</strong> with the password <strong>password</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L997-L1003">var url = new Uri("ws://localhost:4984/mydatabase");
var target = new URLEndpoint(url);
var config = new ReplicatorConfiguration(database, target);
config.Authenticator = new BasicAuthenticator("john", "pass");

var replicator = new Replicator(config);
replicator.Start();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="session-authentication"><a class="anchor" href="#session-authentication"></a>Session Authentication</h4>
<div class="paragraph">
<p>Session authentication is another way to authenticate with Sync Gateway.
A user session must first be created through the <a href="../../../../sync-gateway/2.8/refer/rest-api-public.html#/session/post__db___session" class="page"><code>POST /{tkn-db}/_session</code></a> endpoint on the Public REST API.
The HTTP response contains a session ID which can then be used to authenticate as the user it was created for.
The following example initiates a one-shot replication with the session ID that is returned from the <code>POST /{tkn-db}/_session</code> endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L1012-L1018">var url = new Uri("ws://localhost:4984/mydatabase");
var target = new URLEndpoint(url);
var config = new ReplicatorConfiguration(database, target);
config.Authenticator = new SessionAuthenticator("904ac010862f37c8dd99015a33ab5a3565fd8447");

var replicator = new Replicator(config);
replicator.Start();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-hdrs"><a class="anchor" href="#lbl-repl-hdrs"></a>Custom&#160;Headers</h3>
<div class="paragraph">
<p>Custom headers can be set on the configuration object.
And the replicator will send those header(s) in every request.
As an example, this feature can be useful to pass additional credentials when there is an authentication or authorization step being done by a proxy server (between Couchbase Lite and Sync Gateway).</p>
</div>
<div id="ex-cust-hdr" class="exampleblock">
<div class="title">Example 6. Setting custom headers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L1131-L1137">var config = new ReplicatorConfiguration(database, target)
{
    Headers = new Dictionary&lt;string, string&gt;
    {
        ["CustomHeaderName"] = "Value"
    }
};</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-fltrs"><a class="anchor" href="#lbl-repl-fltrs"></a>Replication Filters</h3>
<div class="paragraph">
<p>Replication Filters allow you to have quick control over which documents are stored as the result of a push and/or pull replication.</p>
</div>
<div class="sect3">
<h4 id="push-filter"><a class="anchor" href="#push-filter"></a>Push Filter</h4>
<div class="paragraph">
<p>A push filter allows an app to push a subset of a database to the server, which can be very useful in some circumstances.
For instance, high-priority documents could be pushed first, or documents in a "draft" state could be skipped.</p>
</div>
<div class="paragraph">
<p>The following example filters out documents whose <code>type</code> property is equal to <code>draft</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L1144-L1159">var url = new Uri("ws://localhost:4984/mydatabase");
var target = new URLEndpoint(url);

var config = new ReplicatorConfiguration(database, target);
config.PushFilter = (document, flags) =&gt; <i class="conum" data-value="1"></i><b>(1)</b>
{
    if (flags.HasFlag(DocumentFlags.Deleted)) {
        return false;
    }

    return true;
};

// Dispose() later
var replicator = new Replicator(config);
replicator.Start();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The callback should follow the semantics of a <a href="https://en.wikipedia.org/wiki/Pure_function" target="_blank" rel="noopener">pure function</a>.
Otherwise, long running functions would slow down the replicator considerably.
Furthermore, your callback should not make assumptions about what thread it is being called on.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="pull-filter"><a class="anchor" href="#pull-filter"></a>Pull Filter</h4>
<div class="paragraph">
<p>A pull filter gives an app the ability to validate documents being pulled, and skip ones that fail.
This is an important security mechanism in a peer-to-peer topology with peers that are not fully trusted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Pull replication filters are not a substitute for channels.
Sync Gateway <a href="../../../../sync-gateway/2.8/learn/sync-gateway-channels.html" class="page">channels</a> are designed to be scalable (documents are filtered on the server) whereas a pull replication filter is applied to a document once it has been downloaded.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L1166-L1181">var url = new Uri("ws://localhost:4984/mydatabase");
var target = new URLEndpoint(url);

var config = new ReplicatorConfiguration(database, target);
config.PullFilter = (document, flags) =&gt; <i class="conum" data-value="1"></i><b>(1)</b>
{
    if (document.GetString("type") == "draft") {
        return false;
    }

    return true;
};

// Dispose() later
var replicator = new Replicator(config);
replicator.Start();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The callback should follow the semantics of a <a href="https://en.wikipedia.org/wiki/Pure_function" target="_blank" rel="noopener">pure function</a>.
Otherwise, long running functions would slow down the replicator considerably.
Furthermore, your callback should not make assumptions about what thread it is being called on.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Losing access to a document (via the Sync Function) also triggers the pull replication filter.
Filtering out such an event would retain the document locally.
As a result, there would be a local copy of the document disjointed from the one that resides on Couchbase Server.
Further updates to the document stored on Couchbase Server would not be received in pull replications and further local edits could be potentially pushed, which would result in 409 errors since access has been revoked.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-chan"><a class="anchor" href="#lbl-repl-chan"></a>Channels</h3>
<div class="paragraph">
<p>By default, Couchbase Lite gets all the channels to which the configured user account has access.
This behavior is suitable for most apps that rely on <a href="../../../../sync-gateway/2.8/learn/authentication.html" class="page">user authentication</a> and the <a href="../../../../sync-gateway/2.8/learn/defining-sync-functions.html" class="page">sync function</a> to specify which data to pull for each user.</p>
</div>
<div class="paragraph">
<p>Optionally, it&#8217;s also possible to specify a comma-separated list of channel names on Couchbase Lite&#8217;s replicator configuration object.
In this case, the replication from Sync Gateway will only pull documents tagged with those channels.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-delta"><a class="anchor" href="#lbl-repl-delta"></a>Delta Sync</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is an <a href="https://www.couchbase.com/products/editions">Enterprise Edition</a> feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With Delta Sync <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>, only the changed parts of a Couchbase document are replicated.
This can result in significant savings in bandwidth consumption as well as throughput improvements, especially when network bandwidth is typically constrained.</p>
</div>
<div class="paragraph">
<p>Replications to a Server (for example, a Sync Gateway, or passive listener) automatically use delta sync if the property is enabled at database level by the server&#8201;&#8212;&#8201;see: <a href="../../../../sync-gateway/2.8/refer/config-properties.html#databases-foo_db-delta_sync" class="page">databases.$db.delta_sync.enabled</a>.</p>
</div>
<div class="paragraph">
<p><a href="csharp-dbreplica.html" class="page">Intra-device Data Sync</a> replications automatically <strong>disable</strong> delta sync, whilst <a href="csharp-p2psync-websocket.html" class="page">Peer-to-Peer</a> replications automatically <strong>enable</strong> delta sync.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-init-repl"><a class="anchor" href="#lbl-init-repl"></a>Initialization</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-repl-start">Start Replicator</a>  | <a href="#lbl-repl-ckpt">Checkpoint Starts</a></p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="lbl-repl-start"><a class="anchor" href="#lbl-repl-start"></a>Start Replicator</h3>
<div class="paragraph">
<p>Use the <code><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.Replicator.html">Replicator</a></code> class&#8217;s <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.Replicator.html#Couchbase_Lite_Sync_Replicator__ctor_Couchbase_Lite_Sync_ReplicatorConfiguration_">(ReplicatorConfiguration config)</a> constructor, to initialize the replicator with the configuration you have defined.
You can, optionally, add a change listener (see <a href="#monitor-sync">[monitor-sync]</a>) before starting the replicator running using <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.Replicator.html#Couchbase_Lite_Sync_Replicator_Start">Start()</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Initialize and run replicator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// Initialize and start a replicator
// Initialize replicator with configuration data
var thisReplicator = new Replicator(thisConfig); <i class="conum" data-value="1"></i><b>(1)</b>

// Start replicator
thisReplicator.Start(); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on Example</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize the replicator with the configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start the replicator</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-ckpt"><a class="anchor" href="#lbl-repl-ckpt"></a>Checkpoint Starts</h3>
<div class="paragraph">
<p>Replicators use <a href="../refer/csharp-refer-glossary.html#checkpoint" class="page">checkpoints</a> to keep track of documents sent to the target database.
Without <a href="../refer/csharp-refer-glossary.html#checkpoint" class="page">checkpoints</a> , Couchbase Lite would replicate the entire database content to the target database on each connection, even though previous replications may already have replicated some or all of that content.</p>
</div>
<div class="paragraph">
<p>This functionality is generally not a concern to application developers.
However, if you do want to force the replication to start again from zero, use the <a href="../refer/csharp-refer-glossary.html#checkpoint" class="page">checkpoint</a> reset method <code>replicator.resetCheckpoint()</code> <strong>before</strong> starting the replicator.</p>
</div>
<div id="ex-repl-ckpt" class="exampleblock">
<div class="title">Example 8. Resetting checkpoints</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L375-L377">// replicator is a Replicator instance
replicator.ResetCheckpoint();
replicator.Start();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-repl-mon"><a class="anchor" href="#lbl-repl-mon"></a>Monitoring</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-repl-chng">Change Listeners</a>  |  <a href="#lbl-repl-status">Replicator Status</a>  |  <a href="#lbl-repl-evnts">Monitor Document Changes</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can monitor a replications status by using a combination of <a href="#lbl-repl-chng">Change Listeners</a> and the <code>replication.status.activity</code> property&#8201;&#8212;&#8201;see; <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorStatus.html#Couchbase_Lite_Sync_ReplicatorStatus_Activity">Activity</a>.
This enables you to know, for example, when the replication is actively transferring data and when it has stopped.</p>
</div>
<div class="paragraph">
<p>You can also choose to monitor document changes&#8201;&#8212;&#8201;see: <a href="#lbl-repl-evnts">Monitor Document Changes</a>.</p>
</div>
<div class="sect2">
<h3 id="lbl-repl-chng"><a class="anchor" href="#lbl-repl-chng"></a>Change Listeners</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You should register the listener before starting your replication, to avoid having to do a restart to activate it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.Replicator.html">Replicator</a> class to add a change listener as a callback to the Replicator (<a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.Replicator.html#Couchbase_Lite_Sync_Replicator_AddChangeListener_System_EventHandler_Couchbase_Lite_Sync_ReplicatorStatusChangedEventArgs__">addChangeListener()</a>)&#8201;&#8212;&#8201;see: <a href="#ex-repl-mon">Example 9</a>.
You will then be asynchronously notified of state changes.</p>
</div>
<div class="paragraph">
<p>Use this to monitor changes and to inform on sync progress; this is an optional step.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-status"><a class="anchor" href="#lbl-repl-status"></a>Replicator Status</h3>
<div class="paragraph">
<p>You can use the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.Replicator.html">Replicator</a> class&#8217;s <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.Replicator.html#Couchbase_Lite_Sync_Replicator_Status">Replicator.Status</a> property to check the replicator status.
That is, whether it is actively transferring data or if it has stopped&#8201;&#8212;&#8201;see: <a href="#ex-repl-mon">Example 9</a>.</p>
</div>
<div class="paragraph">
<p>The returned <em>ReplicationStatus</em> structure comprises:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorStatus.html#Couchbase_Lite_Sync_ReplicatorStatus_Activity">Activity</a>&#8201;&#8212;&#8201;stopped, offline, connecting, idle or busy</p>
</li>
<li>
<p><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorStatus.html#Couchbase_Lite_Sync_ReplicatorStatus_Progress">Progress</a></p>
<div class="ulist">
<ul>
<li>
<p>completed&#8201;&#8212;&#8201;the total number of changes completed</p>
</li>
<li>
<p>total&#8201;&#8212;&#8201;the total number of changes to be processed</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.ReplicatorStatus.html#Couchbase_Lite_Sync_ReplicatorStatus_Error">Error</a>&#8201;&#8212;&#8201;the current error, if any</p>
</li>
</ul>
</div>
<div id="ex-repl-mon" class="exampleblock">
<div class="title">Example 9. Monitor replication</div>
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_adding-a-change-listener"></a>Adding a Change Listener</p>
</li>
<li>
<p><a id="tabset2_using-replicator-status"></a>Using replicator.status</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_adding-a-change-listener">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">_thisListenerToken =
  thisReplicator.AddChangeListener((sender, args) =&gt;
    {
      if (args.Status.Activity == ReplicatorActivityLevel.Stopped) {
          Console.WriteLine("Replication stopped");
      }
    });</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_using-replicator-status">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">_thisReplicator.Stop();
while (_thisReplicator.Status.Activity != ReplicatorActivityLevel.Stopped) {
    // Database cannot close until replicators are stopped
    Console.WriteLine($"Waiting for replicator to stop (currently {_thisReplicator.Status.Activity})...");
    Thread.Sleep(200);
}
_thisDatabase.Close();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="lbl-repl-states"><a class="anchor" href="#lbl-repl-states"></a>Replication States</h4>
<div class="paragraph">
<p>See <a href="#tbl-states">Table 1</a> for a list of the different activity levels reported in the API; and the meaning of each.</p>
</div>
<table id="tbl-states" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Replicator activity levels</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">State</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STOPPED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication is finished or hit a fatal error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OFFLINE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replicator is offline as the remote host is unreachable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONNECTING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replicator is connecting to the remote host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IDLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication caught up with all the changes available from the server.
The <code>IDLE</code> state is only used in continuous replications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BUSY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication is actively transferring data.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The replication change object also has properties to track the progress (<code>change.status.completed</code> and <code>change.status.total</code>).
But since the replication occurs in batches and the total count can vary through the course of a replication, those progress indicators are not very useful from the standpoint of an app user.
Hence, these should not be used for tracking the actual progress of the replication.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="replication-status-and-app-life-cycle"><a class="anchor" href="#replication-status-and-app-life-cycle"></a>Replication Status and App Life Cycle</h3>
<div class="paragraph">
<p>Couchbase Lite doesn&#8217;t react to OS backgrounding or foregrounding events and replication(s) will continue running as long as the remote system does not terminate the connection and the app does not terminate.
It is generally recommended to stop replications before going into the background otherwise socket connections may be closed by the OS and this may interfere with the replication process.</p>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-evnts"><a class="anchor" href="#lbl-repl-evnts"></a>Monitor Document Changes</h3>
<div class="paragraph">
<p>You can choose to register for document updates during a replication.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You should register the listener before starting your replication, to avoid having to do a restart to activate it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the code snippet in <a href="#ex-reg-doc-listener">Example 10</a> registers a listener to monitor document replication performed by the replicator referenced by the variable <code>replicator</code>.
It prints the document ID of each document received and sent.
Stop the listener as shown in <a href="#ex-stop-doc-listener">Example 11</a>.</p>
</div>
<div id="ex-reg-doc-listener" class="exampleblock">
<div class="title">Example 10. Register a document listener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L1041-L1057">var token = replicator.AddDocumentReplicationListener((sender, args) =&gt;
{
    var direction = args.IsPush ? "Push" : "Pull";
    Console.WriteLine($"Replication type :: {direction}");
    foreach (var document in args.Documents) {
        if (document.Error == null) {
            Console.WriteLine($"Doc ID :: {document.Id}");
            if (document.Flags.HasFlag(DocumentFlags.Deleted)) {
                Console.WriteLine("Successfully replicated a deleted document");
            }
        } else {
            // There was an error
        }
    }
});

replicator.Start();</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-stop-doc-listener" class="exampleblock">
<div class="title">Example 11. Stop document listener</div>
<div class="content">
<div class="paragraph">
<p>This code snippet shows how to stop the document listener using the token from the previous example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L1061">replicator.RemoveChangeListener(token);</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Document Access Removal Behavior</div>
<div class="content">
<div class="paragraph">
<p>When access to a document is removed on Sync Gateway (see: Sync Gateway&#8217;s <a href="../../../../sync-gateway/2.8/learn/defining-sync-functions.html" class="page">Sync Function</a>), the document replication listener sends a notification with the <code>AccessRemoved</code> flag set to <code>true</code> and subsequently purges the document from the database.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-repl-stop"><a class="anchor" href="#lbl-repl-stop"></a>Stop Sync</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you added an optional change listener (see <a href="#lbl-repl-chng">Change Listeners</a> for how) you should also remove it using the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.Replicator.html#Couchbase_Lite_Sync_Replicator_RemoveChangeListener_Couchbase_Lite_ListenerToken_">RemoveChangeListener(ListenerToken)</a> method.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 12. Stop replicator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#">// Stop replication.
thisReplicator.Stop(); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notes on Example</strong></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Stopping the replication is straightforward using the <a href="http://docs.couchbase.com/mobile/2.8.0/couchbase-lite-net/api/Couchbase.Lite.Sync.Replicator.html#Couchbase_Lite_Sync_Replicator_Stop">Stop()</a> method.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-nwk-errs"><a class="anchor" href="#lbl-nwk-errs"></a>Error Handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When <em>replicator</em> detects a network error it updates its status depending on the error type (permanent or temporary) and returns an appropriate HTTP error code.</p>
</div>
<div class="paragraph">
<p>The following code snippet adds a <code>Change Listener</code>, which monitors a replication for errors and logs the the returned error code.</p>
</div>
<div class="exampleblock">
<div class="title">Example 13. Monitoring for network errors</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs">replicator.AddChangeListener((sender, args) =&gt;
{
    if (args.Status.Error != null) {
        Console.WriteLine($"Error :: {args.Status.Error}");
    }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>For permanent network errors</strong> (for example, <code>404</code> not found, or <code>401</code> unauthorized):
<em>Replicator</em> will stop permanently, whether <code>setContinuous</code>  is <em>true</em> or <em>false</em>. Of course, it sets its status to <code>STOPPED</code></p>
</div>
<div class="paragraph">
<p><strong>For recoverable or temporary errors:</strong> <em>Replicator</em> sets its status to <code>OFFLINE</code>, then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>setContinuous=<em>true</em></code> it retries the connection indefinitely</p>
</li>
<li>
<p>If <code>setContinuous=<em>false</em></code> (one-shot) it retries the connection a limited number of times.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following error codes are considered temporary by the Couchbase Lite replicator and thus will trigger a connection retry.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>408</code>: Request Timeout</p>
</li>
<li>
<p><code>429</code>: Too Many Requests</p>
</li>
<li>
<p><code>500</code>: Internal Server Error</p>
</li>
<li>
<p><code>502</code>: Bad Gateway</p>
</li>
<li>
<p><code>503</code>: Service Unavailable</p>
</li>
<li>
<p><code>504</code>: Gateway Timeout</p>
</li>
<li>
<p><code>1001</code>: DNS resolution error</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="load-balancers"><a class="anchor" href="#load-balancers"></a>Load Balancers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> uses WebSockets as the communication protocol to transmit data.
Some load balancers are not configured for WebSocket connections by default (NGINX for example);
so it might be necessary to explicitly enable them in the load balancer&#8217;s configuration (see <a href="../../../../sync-gateway/2.8/load-balancer.html" class="page">Load Balancers</a>).</p>
</div>
<div class="paragraph">
<p>By default, the WebSocket protocol uses compression to optimize for speed and bandwidth utilization.
The level of compression is set on Sync Gateway and can be tuned in the configuration file (<a href="../../../../sync-gateway/2.8/refer/config-properties.html#replicator_compression" class="page"><code>replicator_compression</code></a>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-cert-pinning"><a class="anchor" href="#lbl-cert-pinning"></a>Certificate Pinning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Lite for C#.Net supports certificate pinning.</p>
</div>
<div class="paragraph">
<p>Certificate pinning is a technique that can be used by applications to "pin" a host to its certificate.
The certificate is typically delivered to the client by an out-of-band channel and bundled with the client.
In this case, Couchbase Lite uses this embedded certificate to verify the trustworthiness of the server (for example, a Sync Gateway) and no longer needs to rely on a trusted third party for that (commonly referred to as the Certificate Authority).</p>
</div>
<div class="paragraph">
<p>The following steps describe how to configure certificate pinning between Couchbase Lite and Sync Gateway.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="../../../../sync-gateway/2.8/security.html#creating-your-own-self-signed-certificate" class="page">Create your own self-signed certificate</a> with the <code>openssl</code> command.
After completing this step, you should have 3 files: <code>cert.pem</code>, <code>cert.cer</code> and <code>privkey.pem</code>.</p>
</li>
<li>
<p><a href="../../../../sync-gateway/2.8/security.html#installing-the-certificate" class="page">Configure Sync Gateway</a> with the <code>cert.pem</code> and <code>privkey.pem</code> files.
After completing this step, Sync Gateway is reachable over <code>https</code>/<code>wss</code>.</p>
</li>
<li>
<p>On the Couchbase Lite side, the replication must point to a URL with the <code>wss</code> scheme and configured with the <code>cert.cer</code> file created in step 1.</p>
<div id="ex-crt-pinning" class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This example loads the certificate from the application sandbox, then converts it to the appropriate type to configure the replication object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L1111-L1121">// Note: `GetCertificate` is a fake method. This would be the platform-specific method
// to find and load the certificate as an instance of `X509Certificate2`.
// For .NET Core / .NET Framework this can be loaded from the filesystem path.
// For UWP, from the assets directory.
// For iOS, from the main bundle.
// For Android, from the assets directory.
var certificate = GetCertificate("cert.cer");
var config = new ReplicatorConfiguration(db, target)
{
    PinnedServerCertificate = certificate
};</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Build and run your app.
The replication should now run successfully over https/wss with certificate pinning.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more on pinning certificates see the blog entry: <a href="https://blog.couchbase.com/certificate-pinning-android-with-couchbase-mobile/" target="_blank" rel="noopener">Certificate Pinning with Couchbase Mobile</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-trouble"><a class="anchor" href="#lbl-trouble"></a>Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="logs"><a class="anchor" href="#logs"></a>Logs</h3>
<div class="paragraph">
<p>As always, when there is a problem with replication, logging is your friend.
You can increase the log output for activity related to replication with Sync Gateway&#8201;&#8212;&#8201;see <a href="#ex-logs">Example 14</a>.</p>
</div>
<div id="ex-logs" class="exampleblock">
<div class="title">Example 14. Set logging verbosity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C# hljs" data-lang="C#" data-source-url="https://github.com/ibsoln/docs-couchbase-lite/blob/undefined/modules/csharp/examples/code_snippets/Program.cs#L971-L972">Database.SetLogLevel(LogDomain.Replicator, LogLevel.Verbose);
Database.SetLogLevel(LogDomain.Network, LogLevel.Verbose);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more on troubleshooting with logs, see: <a href="../csharp-troubleshooting-logs.html" class="page">Using Logs</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="authentication-errors"><a class="anchor" href="#authentication-errors"></a>Authentication Errors</h3>
<div class="paragraph">
<p>If Sync Gateway is configured with a self signed certificate but your app points to a <code>ws</code> scheme instead of <code>wss</code> you will encounter an error with status code <code>11006</code>&#8201;&#8212;&#8201;see: <a href="#ex-11006">Example 15</a></p>
</div>
<div id="ex-11006" class="exampleblock">
<div class="title">Example 15. Protocol Mismatch</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">CouchbaseLite Replicator ERROR: {Repl#2} Got LiteCore error: WebSocket error 1006 "connection closed abnormally"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If Sync Gateway is configured with a self signed certificate, and your app points to a <code>wss</code> scheme but the replicator configuration isn&#8217;t using the certificate you will encounter an error with status code <code>5011</code>&#8201;&#8212;&#8201;see: <a href="#ex-5011">Example 16</a></p>
</div>
<div id="ex-5011" class="exampleblock">
<div class="title">Example 16. Certificate Mismatch or Not Found</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">CouchbaseLite Replicator ERROR: {Repl#2} Got LiteCore error: Network error 11 "server TLS certificate is self-signed or has unknown root cert"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id=""><a class="anchor" href="#"></a></h6>
<div class="ulist">
<div class="title">How to . . .</div>
<ul>
<li>
<p><a href="../start/csharp-gs-prereqs.html" class="page">Prerequisites</a></p>
</li>
<li>
<p><a href="../start/csharp-gs-install.html" class="page">Install</a></p>
</li>
<li>
<p><a href="../start/csharp-gs-build.html" class="page">Build and Run</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Learn more . . .</div>
<ul>
<li>
<p><a href="csharp-database.html" class="page">Databases</a></p>
</li>
<li>
<p><a href="csharp-document.html" class="page">Documents</a></p>
</li>
<li>
<p><a href="csharp-blob.html" class="page">Blobs</a></p>
</li>
<li>
<p><a href="csharp-replication.html" class="page">Remote Sync using Sync Gateway</a></p>
</li>
<li>
<p><a href="csharp-conflict.html" class="page">Handling Data Conflicts</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="ulist">
<div class="title">Dive Deeper . . .</div>
<ul>
<li>
<p><a href="https://forums.couchbase.com/c/mobile/14">Forum</a> <strong>|</strong> <a href="https://blog.couchbase.com/">Blog</a> <strong>|</strong> <a href="https://docs.couchbase.com/tutorials/index.html">Tutorials</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Couchbase Mobile 2.5+
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. From 2.0
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase_logo_black.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span> 2021 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../../../_/js/vendor/fontawesome.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
